!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=30)}([function(e,t){e.exports={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}},,,,function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return(i="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return r(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)})(e)}n.d(t,"a",function(){return i})},,function(e,t,n){"use strict";(function(e){n.d(t,"c",function(){return i}),n.d(t,"d",function(){return s}),n.d(t,"b",function(){return a}),n.d(t,"a",function(){return o});const r={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document},i=r.self||r.window||r.global,s=r.window||r.self||r.global,a=r.global||r.self||r.window,o=r.document||{}}).call(this,n(12))},function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"d",function(){return l}),n.d(t,"a",function(){return f}),n.d(t,"c",function(){return h});var r=n(0),i=n.n(r),s=n(37);const a={[i.a.BLEND]:!1,[i.a.BLEND_COLOR]:new Float32Array([0,0,0,0]),[i.a.BLEND_EQUATION_RGB]:i.a.FUNC_ADD,[i.a.BLEND_EQUATION_ALPHA]:i.a.FUNC_ADD,[i.a.BLEND_SRC_RGB]:i.a.ONE,[i.a.BLEND_DST_RGB]:i.a.ZERO,[i.a.BLEND_SRC_ALPHA]:i.a.ONE,[i.a.BLEND_DST_ALPHA]:i.a.ZERO,[i.a.COLOR_CLEAR_VALUE]:new Float32Array([0,0,0,0]),[i.a.COLOR_WRITEMASK]:[!0,!0,!0,!0],[i.a.CULL_FACE]:!1,[i.a.CULL_FACE_MODE]:i.a.BACK,[i.a.DEPTH_TEST]:!1,[i.a.DEPTH_CLEAR_VALUE]:1,[i.a.DEPTH_FUNC]:i.a.LESS,[i.a.DEPTH_RANGE]:new Float32Array([0,1]),[i.a.DEPTH_WRITEMASK]:!0,[i.a.DITHER]:!0,[i.a.FRAMEBUFFER_BINDING]:null,[i.a.FRONT_FACE]:i.a.CCW,[i.a.GENERATE_MIPMAP_HINT]:i.a.DONT_CARE,[i.a.LINE_WIDTH]:1,[i.a.POLYGON_OFFSET_FILL]:!1,[i.a.POLYGON_OFFSET_FACTOR]:0,[i.a.POLYGON_OFFSET_UNITS]:0,[i.a.SAMPLE_COVERAGE_VALUE]:1,[i.a.SAMPLE_COVERAGE_INVERT]:!1,[i.a.SCISSOR_TEST]:!1,[i.a.SCISSOR_BOX]:new Int32Array([0,0,1024,1024]),[i.a.STENCIL_TEST]:!1,[i.a.STENCIL_CLEAR_VALUE]:0,[i.a.STENCIL_WRITEMASK]:4294967295,[i.a.STENCIL_BACK_WRITEMASK]:4294967295,[i.a.STENCIL_FUNC]:i.a.ALWAYS,[i.a.STENCIL_REF]:0,[i.a.STENCIL_VALUE_MASK]:4294967295,[i.a.STENCIL_BACK_FUNC]:i.a.ALWAYS,[i.a.STENCIL_BACK_REF]:0,[i.a.STENCIL_BACK_VALUE_MASK]:4294967295,[i.a.STENCIL_FAIL]:i.a.KEEP,[i.a.STENCIL_PASS_DEPTH_FAIL]:i.a.KEEP,[i.a.STENCIL_PASS_DEPTH_PASS]:i.a.KEEP,[i.a.STENCIL_BACK_FAIL]:i.a.KEEP,[i.a.STENCIL_BACK_PASS_DEPTH_FAIL]:i.a.KEEP,[i.a.STENCIL_BACK_PASS_DEPTH_PASS]:i.a.KEEP,[i.a.VIEWPORT]:new Int32Array([0,0,1024,1024]),[i.a.PACK_ALIGNMENT]:4,[i.a.UNPACK_ALIGNMENT]:4,[i.a.UNPACK_FLIP_Y_WEBGL]:!1,[i.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:!1,[i.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:i.a.BROWSER_DEFAULT_WEBGL,[i.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:i.a.DONT_CARE,[i.a.READ_FRAMEBUFFER_BINDING]:null,[i.a.RASTERIZER_DISCARD]:!1,[i.a.PACK_ROW_LENGTH]:0,[i.a.PACK_SKIP_PIXELS]:0,[i.a.PACK_SKIP_ROWS]:0,[i.a.UNPACK_ROW_LENGTH]:0,[i.a.UNPACK_IMAGE_HEIGHT]:0,[i.a.UNPACK_SKIP_PIXELS]:0,[i.a.UNPACK_SKIP_ROWS]:0,[i.a.UNPACK_SKIP_IMAGES]:0},o=(e,t,n)=>t?e.enable(n):e.disable(n),u=(e,t,n)=>e.hint(n,t),c=(e,t,n)=>e.pixelStorei(n,t),l={[i.a.BLEND]:o,[i.a.BLEND_COLOR]:(e,t)=>e.blendColor(...t),[i.a.BLEND_EQUATION_RGB]:"blendEquation",[i.a.BLEND_EQUATION_ALPHA]:"blendEquation",[i.a.BLEND_SRC_RGB]:"blendFunc",[i.a.BLEND_DST_RGB]:"blendFunc",[i.a.BLEND_SRC_ALPHA]:"blendFunc",[i.a.BLEND_DST_ALPHA]:"blendFunc",[i.a.COLOR_CLEAR_VALUE]:(e,t)=>e.clearColor(...t),[i.a.COLOR_WRITEMASK]:(e,t)=>e.colorMask(...t),[i.a.CULL_FACE]:o,[i.a.CULL_FACE_MODE]:(e,t)=>e.cullFace(t),[i.a.DEPTH_TEST]:o,[i.a.DEPTH_CLEAR_VALUE]:(e,t)=>e.clearDepth(t),[i.a.DEPTH_FUNC]:(e,t)=>e.depthFunc(t),[i.a.DEPTH_RANGE]:(e,t)=>e.depthRange(...t),[i.a.DEPTH_WRITEMASK]:(e,t)=>e.depthMask(t),[i.a.DITHER]:o,[i.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:u,[i.a.FRAMEBUFFER_BINDING]:(e,t)=>{const n=Object(s.b)(e)?i.a.DRAW_FRAMEBUFFER:i.a.FRAMEBUFFER;return e.bindFramebuffer(n,t)},[i.a.FRONT_FACE]:(e,t)=>e.frontFace(t),[i.a.GENERATE_MIPMAP_HINT]:u,[i.a.LINE_WIDTH]:(e,t)=>e.lineWidth(t),[i.a.POLYGON_OFFSET_FILL]:o,[i.a.POLYGON_OFFSET_FACTOR]:"polygonOffset",[i.a.POLYGON_OFFSET_UNITS]:"polygonOffset",[i.a.RASTERIZER_DISCARD]:o,[i.a.SAMPLE_COVERAGE_VALUE]:"sampleCoverage",[i.a.SAMPLE_COVERAGE_INVERT]:"sampleCoverage",[i.a.SCISSOR_TEST]:o,[i.a.SCISSOR_BOX]:(e,t)=>e.scissor(...t),[i.a.STENCIL_TEST]:o,[i.a.STENCIL_CLEAR_VALUE]:(e,t)=>e.clearStencil(t),[i.a.STENCIL_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(i.a.FRONT,t),[i.a.STENCIL_BACK_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(i.a.BACK,t),[i.a.STENCIL_FUNC]:"stencilFuncFront",[i.a.STENCIL_REF]:"stencilFuncFront",[i.a.STENCIL_VALUE_MASK]:"stencilFuncFront",[i.a.STENCIL_BACK_FUNC]:"stencilFuncBack",[i.a.STENCIL_BACK_REF]:"stencilFuncBack",[i.a.STENCIL_BACK_VALUE_MASK]:"stencilFuncBack",[i.a.STENCIL_FAIL]:"stencilOpFront",[i.a.STENCIL_PASS_DEPTH_FAIL]:"stencilOpFront",[i.a.STENCIL_PASS_DEPTH_PASS]:"stencilOpFront",[i.a.STENCIL_BACK_FAIL]:"stencilOpBack",[i.a.STENCIL_BACK_PASS_DEPTH_FAIL]:"stencilOpBack",[i.a.STENCIL_BACK_PASS_DEPTH_PASS]:"stencilOpBack",[i.a.VIEWPORT]:(e,t)=>e.viewport(...t),[i.a.PACK_ALIGNMENT]:c,[i.a.UNPACK_ALIGNMENT]:c,[i.a.UNPACK_FLIP_Y_WEBGL]:c,[i.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:c,[i.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:c,[i.a.PACK_ROW_LENGTH]:c,[i.a.PACK_SKIP_PIXELS]:c,[i.a.PACK_SKIP_ROWS]:c,[i.a.READ_FRAMEBUFFER_BINDING]:(e,t)=>e.bindFramebuffer(i.a.READ_FRAMEBUFFER,t),[i.a.UNPACK_ROW_LENGTH]:c,[i.a.UNPACK_IMAGE_HEIGHT]:c,[i.a.UNPACK_SKIP_PIXELS]:c,[i.a.UNPACK_SKIP_ROWS]:c,[i.a.UNPACK_SKIP_IMAGES]:c},f={blendEquation:(e,t)=>e.blendEquationSeparate(t[i.a.BLEND_EQUATION_RGB],t[i.a.BLEND_EQUATION_ALPHA]),blendFunc:(e,t)=>e.blendFuncSeparate(t[i.a.BLEND_SRC_RGB],t[i.a.BLEND_DST_RGB],t[i.a.BLEND_SRC_ALPHA],t[i.a.BLEND_DST_ALPHA]),polygonOffset:(e,t)=>e.polygonOffset(t[i.a.POLYGON_OFFSET_FACTOR],t[i.a.POLYGON_OFFSET_UNITS]),sampleCoverage:(e,t)=>e.sampleCoverage(t[i.a.SAMPLE_COVERAGE_VALUE],t[i.a.SAMPLE_COVERAGE_INVERT]),stencilFuncFront:(e,t)=>e.stencilFuncSeparate(i.a.FRONT,t[i.a.STENCIL_FUNC],t[i.a.STENCIL_REF],t[i.a.STENCIL_VALUE_MASK]),stencilFuncBack:(e,t)=>e.stencilFuncSeparate(i.a.BACK,t[i.a.STENCIL_BACK_FUNC],t[i.a.STENCIL_BACK_REF],t[i.a.STENCIL_BACK_VALUE_MASK]),stencilOpFront:(e,t)=>e.stencilOpSeparate(i.a.FRONT,t[i.a.STENCIL_FAIL],t[i.a.STENCIL_PASS_DEPTH_FAIL],t[i.a.STENCIL_PASS_DEPTH_PASS]),stencilOpBack:(e,t)=>e.stencilOpSeparate(i.a.BACK,t[i.a.STENCIL_BACK_FAIL],t[i.a.STENCIL_BACK_PASS_DEPTH_FAIL],t[i.a.STENCIL_BACK_PASS_DEPTH_PASS])},_=(e,t)=>e.isEnabled(t),h={[i.a.BLEND]:_,[i.a.CULL_FACE]:_,[i.a.DEPTH_TEST]:_,[i.a.DITHER]:_,[i.a.POLYGON_OFFSET_FILL]:_,[i.a.SAMPLE_ALPHA_TO_COVERAGE]:_,[i.a.SAMPLE_COVERAGE]:_,[i.a.SCISSOR_TEST]:_,[i.a.STENCIL_TEST]:_,[i.a.RASTERIZER_DISCARD]:_}},function(e,t,n){"use strict";(function(e,r){n.d(t,"b",function(){return a}),n.d(t,"a",function(){return o});var i=n(4),s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==e&&e,document:"undefined"!=typeof document&&document,process:"object"===(void 0===r?"undefined":Object(i.a)(r))&&r},a=s.window||s.self||s.global,o=s.process||{};console}).call(this,n(12),n(13))},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t||"webgl2-polyfill: assertion failed.")}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i="undefined"!=typeof window&&window.addEventListener,s=new Map,a=function(){return i&&window.__SEER_INITIALIZED__},o=function(e,t){var n=s.get(e),r=Date.now();return!!(n&&r-n<t)||(s.set(e,r),!1)},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i&&a()){var n=new Set,s=JSON.stringify(t,function(e){return function(t,n){if(!n||"object"!==(void 0===n?"undefined":r(n))||!e.has(n))return e.add(n),Object.prototype.toString.call(n).slice(8,-1).includes("Array")?Array.prototype.slice.call(n,0,20):n}}(n));try{window.postMessage({type:e,payload:s,source:"seer-agent"},"*")}catch(e){if(o("seer-log",2e3))return;console.log(e)}}},c=new Map,l=function(e){if(e&&e.data&&"seer-core"===e.data.source){var t=e.data,n=t.type,r=t.payload,i=c.get(n);i&&i.forEach(function(e){return e(r)})}},f=function(){i&&!window.__SEER_LISTENER__&&(window.addEventListener("message",l),window.__SEER_LISTENER__=!0)};t.default={send:u,throttle:o,isReady:a,list:function(e,t){return u("LIST",{key:e,data:t})},listItem:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u("LIST_ITEM",{key:e,itemKey:t,data:n})},updateItem:function(e,t,n,r){return u("UPDATE_ITEM",{key:e,itemKey:t,path:n,data:r})},multiUpdate:function(e,t,n){return u("MULTI_UPDATE_ITEM",{key:e,itemKey:t,array:n})},deleteItem:function(e,t){return u("DELETE_ITEM",{key:e,itemKey:t})},addLog:function(e,t,n){return u("ADD_LOG",{key:e,itemKey:t,msg:n})},listeners:c,listenFor:function(e,t){if(i){if(!e||!t)throw new Error("Please provide a type and callback");c.has(e)||c.set(e,[]),window.__SEER_LISTENER__||f(),c.get(e).push(t)}},removeListener:function(e){c.forEach(function(t,n){c.set(n,t.filter(function(t){return t!==e}))})},init:f,clean:function(){i&&window.__SEER_LISTENER__&&(window.removeEventListener("message",l),delete window.__SEER_LISTENER__)}}},function(e,t,n){"use strict";var r=n(0),i=n.n(r),s=n(9);const a=e=>u(e)?void 0:0,o={[i.a.READ_BUFFER]:e=>u(e)?void 0:i.a.COLOR_ATTACHMENT0,35723:e=>u(e)?void 0:4352,[i.a.RASTERIZER_DISCARD]:a,[i.a.SAMPLES]:a,36795:(e,t)=>{const n=u(e)?e.getExtension("EXT_disjoint_timer_query_webgl2"):e.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?t(n.GPU_DISJOINT_EXT):0},37445:(e,t)=>{const n=e.getExtension("WEBGL_debug_renderer_info");return t(n&&n.UNMASKED_VENDOR_WEBGL||i.a.VENDOR)},37446:(e,t)=>{const n=e.getExtension("WEBGL_debug_renderer_info");return t(n&&n.UNMASKED_RENDERER_WEBGL||i.a.RENDERER)},34047:(e,t)=>{const n=e.luma.extensions.EXT_texture_filter_anisotropic;return n?t(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[i.a.MAX_3D_TEXTURE_SIZE]:a,[i.a.MAX_ARRAY_TEXTURE_LAYERS]:a,[i.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:a,[i.a.MAX_COLOR_ATTACHMENTS]:(e,t)=>{if(!u(e)){const n=e.getExtension("WEBGL_draw_buffers");return n?t(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[i.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:a,[i.a.MAX_COMBINED_UNIFORM_BLOCKS]:a,[i.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:a,[i.a.MAX_DRAW_BUFFERS]:e=>{if(!u(e)){const t=e.getExtension("WEBGL_draw_buffers");return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},[i.a.MAX_ELEMENT_INDEX]:e=>e.getExtension("OES_element_index")?2147483647:65535,[i.a.MAX_ELEMENTS_INDICES]:e=>e.getExtension("OES_element_index")?16777216:65535,[i.a.MAX_ELEMENTS_VERTICES]:e=>16777216,[i.a.MAX_FRAGMENT_INPUT_COMPONENTS]:a,[i.a.MAX_FRAGMENT_UNIFORM_BLOCKS]:a,[i.a.MAX_FRAGMENT_UNIFORM_COMPONENTS]:a,[i.a.MAX_SAMPLES]:a,[i.a.MAX_SERVER_WAIT_TIMEOUT]:a,[i.a.MAX_TEXTURE_LOD_BIAS]:a,[i.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:a,[i.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:a,[i.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:a,[i.a.MAX_UNIFORM_BLOCK_SIZE]:a,[i.a.MAX_UNIFORM_BUFFER_BINDINGS]:a,[i.a.MAX_VARYING_COMPONENTS]:a,[i.a.MAX_VERTEX_OUTPUT_COMPONENTS]:a,[i.a.MAX_VERTEX_UNIFORM_BLOCKS]:a,[i.a.MAX_VERTEX_UNIFORM_COMPONENTS]:a,[i.a.MIN_PROGRAM_TEXEL_OFFSET]:a,[i.a.MAX_PROGRAM_TEXEL_OFFSET]:a,[i.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:a};function u(e){return Boolean(e&&2===e._version)}n.d(t,"b",function(){return l}),n.d(t,"a",function(){return f});function c(e){return Boolean(e&&2===e._version)}const l={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{Object(s.a)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},ANGLE_instanced_arrays:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){Object(s.a)(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Object(s.a)(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{Object(s.a)(!1)},deleteQuery:()=>{Object(s.a)(!1)},beginQuery:()=>{Object(s.a)(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:()=>{}}},f={readBuffer:(e,t,n)=>{c(e)&&t(n)},getVertexAttrib:(e,t,n,r)=>{const{webgl2:s,ext:a}=function(e,t){return{webgl2:c(e),ext:e.getExtension(t)}}(e,"ANGLE_instanced_arrays");let o;switch(r){case i.a.VERTEX_ATTRIB_ARRAY_INTEGER:o=!!s&&void 0;break;case i.a.VERTEX_ATTRIB_ARRAY_DIVISOR:o=s||a?void 0:0}return void 0!==o?o:t(n,r)},getProgramParameter:(e,t,n,r)=>{if(!c(e))switch(r){case i.a.TRANSFORM_FEEDBACK_BUFFER_MODE:return i.a.SEPARATE_ATTRIBS;case i.a.TRANSFORM_FEEDBACK_VARYINGS:case i.a.ACTIVE_UNIFORM_BLOCKS:return 0}return t(n,r)},getInternalformatParameter:(e,t,n,r,s)=>{if(!c(e))switch(s){case i.a.SAMPLES:return new Int32Array([0])}return e.getInternalformatParameter(n,r,s)},getTexParameter(e,t,n,r){switch(r){case i.a.TEXTURE_MAX_ANISOTROPY_EXT:const{extensions:t}=e.luma,n=t.EXT_texture_filter_anisotropic;r=n&&n.TEXTURE_MAX_ANISOTROPY_EXT||i.a.TEXTURE_MAX_ANISOTROPY_EXT}return t(n,r)},getParameter:function(e,t,n){const r=o[n],i="function"==typeof r?r(e,t,n):r;return void 0!==i?i:t(n)},hint:(e,t,n,r)=>t(n,r)}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){var n,r,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],l=!1,f=-1;function _(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&h())}function h(){if(!l){var e=o(_);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function E(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||l||o(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=E,i.addListener=E,i.once=E,i.off=E,i.removeListener=E,i.removeAllListeners=E,i.emit=E,i.prependListener=E,i.prependOnceListener=E,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";n.d(t,"e",function(){return a}),n.d(t,"f",function(){return o}),n.d(t,"b",function(){return u}),n.d(t,"c",function(){return c}),n.d(t,"d",function(){return l}),n.d(t,"a",function(){return f});var r=n(7),i=n(26),s=n(15);function a(e,t,n){const i=r.c[t],a=i?i(e,Number(t)):e.getParameter(Number(t)),o=r.d[t];return Object(s.a)("function"==typeof o),o(e,n,Number(t)),a}function o(e,t){const n={};for(const i in t){const s=Number(i),a=r.d[i];a&&("string"==typeof a?n[a]=!0:a(e,t[i],s))}const i=e.state&&e.state.cache;if(i){const s=Object.assign({},i,t);for(const t in n){(0,r.a[t])(e,s)}}}function u(e,t){const n=r.c[t];return n?n(e,Number(t)):e.getParameter(Number(t))}function c(e,t){t=t||r.b;const n=Array.isArray(t)?t:Object.keys(t),i={};for(const t of n)i[t]=u(e,t);return i}function l(e){o(e,Object.assign({},r.b,{}))}function f(e){const t=c(e,Object.keys(r.b)),n={};for(const e in r.b)Object(i.a)(t[e],r.b[e])||(n[e]=t[e]);return n}},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}n.d(t,"a",function(){return r})},,,,function(e,t,n){"use strict";(function(e){var t=n(9),r=n(11);function i(e,{extension:n,target:i,target2:s}){const a=r.b[n];Object(t.a)(a);const{meta:o={}}=a,{suffix:u=""}=o,c=e.getExtension(n);for(const t of Object.keys(a)){const n=`${t}${u}`;let r=null;"meta"===t||"function"==typeof e[t]||(c&&"function"==typeof c[n]?r=(...e)=>c[n](...e):"function"==typeof a[t]&&(r=a[t].bind(i))),r&&(i[t]=r,s[t]=r)}}(void 0!==e?e:window).polyfillContext=function(e){return e.luma=e.luma||{},function(e){e.luma.extensions={};const t=e.getSupportedExtensions()||[];for(const n of t)e.luma[n]=e.getExtension(n)}(e),e.luma.polyfilled||(function(e,t){for(const n of Object.getOwnPropertyNames(t))"overrides"!==n&&i(e,{extension:n,target:e.luma,target2:e})}(e,r.b),function(e,{target:t,target2:n}){Object.keys(r.a).forEach(i=>{if("function"==typeof r.a[i]){const s=e[i]?e[i].bind(e):()=>{},a=r.a[i].bind(null,e,s);t[i]=a,n[i]=a}})}(e,{target:e.luma,target2:e}),e.luma.polyfilled=!0),e}}).call(this,n(12))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return s});var r=n(4),i=n(21);function s(){return!("object"===(void 0===e?"undefined":Object(r.a)(e))&&"[object process]"===String(e)&&!e.browser)||Object(i.a)()}}).call(this,n(13))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return i});var r=n(4);function i(t){if("undefined"!=typeof window&&"object"===Object(r.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==e&&"object"===Object(r.a)(e.versions)&&Boolean(e.versions.electron))return!0;var n="object"===("undefined"==typeof navigator?"undefined":Object(r.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=t||n;return!!(i&&i.indexOf("Electron")>=0)}}).call(this,n(13))},function(e,t,n){"use strict";(function(e){var r=n(29);const i=!("object"==typeof e&&"[object process]"===String(e)&&!e.browser)||r.a;t.a=i}).call(this,n(13))},function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return f}),n.d(t,"c",function(){return _}),n.d(t,"b",function(){return h});var r=n(27),i=n(7),s=n(14),a=n(15),o=n(26);function u(e,t){const n=e[t].bind(e);e[t]=function(...t){const r=t[0];return r in e.state.cache||(e.state.cache[r]=n(...t)),e.state.enable?e.state.cache[r]:n(...t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function c(e,t,n){const r=e[t].bind(e);e[t]=function(...i){const{valueChanged:s,oldValue:a}=n(e.state._updateCache,...i);return s&&(e.state.log(`gl.${t}`,...i),r(...i)),a},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}class l{constructor(e,{copyState:t=!1,log:n=(()=>{})}={}){this.gl=e,this.stateStack=[],this.enable=!0,this.cache=t?Object(s.c)(e):Object.assign({},i.b),this.log=n,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){Object(a.a)(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Object(s.f)(this.gl,e,this.cache),this.stateStack.pop()}_updateCache(e){let t,n=!1;const r=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const i in e)Object(a.a)(void 0!==i),Object(o.a)(e[i],this.cache[i])||(n=!0,t=this.cache[i],!r||i in r||(r[i]=this.cache[i]),this.cache[i]=e[i]);return{valueChanged:n,oldValue:t}}}function f(t,{enable:n=!0,copyState:i}={}){if(Object(a.a)(void 0!==i),!t.state){const s=void 0!==e?e:window;s.polyfillContext&&s.polyfillContext(t),t.state=new l(t,{copyState:i,enable:n});for(const e in r.a){c(t,e,r.a[e])}u(t,"getParameter"),u(t,"isEnabled")}return t.state.enable=n,t}function _(e){e.state||f(e,{copyState:!1}),e.state.push()}function h(e){Object(a.a)(e.state),e.state.pop()}}).call(this,n(12))},,function(e,t,n){"use strict";(function(e){n.d(t,"c",function(){return u}),n.d(t,"b",function(){return h}),n.d(t,"a",function(){return T});var r=n(6),i=n(22);const s="luma.gl: loaded under Node.js without headless gl installed, meaning that WebGL contexts can not be created. This may not be an error. For example, this is a typical configuration for isorender applications running on the server.",a=e;let o=null;function u(...e){const t=a.require("gl");if(!t)throw new Error(s);return t(...e)}if(!i.a)try{o=a.require("gl/wrap")}catch(e){}class c{}const{WebGLRenderingContext:l=c,WebGLProgram:f=c,WebGLShader:_=c,WebGLBuffer:h=c,WebGLFramebuffer:d=c,WebGLRenderbuffer:E=c,WebGLTexture:g=c,WebGLUniformLocation:m=c,WebGLActiveInfo:p=c,WebGLShaderPrecisionFormat:A=c}=o||r.b;const T=r.b.WebGL2RenderingContext||class{};r.b.Image}).call(this,n(35)(e))},function(e,t,n){"use strict";function r(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),r=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&r&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";var r=n(0),i=n.n(r);t.a={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),bindFramebuffer:(e,t,n)=>{switch(t){case i.a.FRAMEBUFFER:return e({[i.a.DRAW_FRAMEBUFFER_BINDING]:n,[i.a.READ_FRAMEBUFFER_BINDING]:n});case i.a.DRAW_FRAMEBUFFER:return e({[i.a.DRAW_FRAMEBUFFER_BINDING]:n});case i.a.READ_FRAMEBUFFER:return e({[i.a.READ_FRAMEBUFFER_BINDING]:n});default:return null}},blendColor:(e,t,n,r,s)=>e({[i.a.BLEND_COLOR]:new Float32Array([t,n,r,s])}),blendEquation:(e,t)=>e({[i.a.BLEND_EQUATION_RGB]:t,[i.a.BLEND_EQUATION_ALPHA]:t}),blendEquationSeparate:(e,t,n)=>e({[i.a.BLEND_EQUATION_RGB]:t,[i.a.BLEND_EQUATION_ALPHA]:n}),blendFunc:(e,t,n)=>e({[i.a.BLEND_SRC_RGB]:t,[i.a.BLEND_DST_RGB]:n,[i.a.BLEND_SRC_ALPHA]:t,[i.a.BLEND_DST_ALPHA]:n}),blendFuncSeparate:(e,t,n,r,s)=>e({[i.a.BLEND_SRC_RGB]:t,[i.a.BLEND_DST_RGB]:n,[i.a.BLEND_SRC_ALPHA]:r,[i.a.BLEND_DST_ALPHA]:s}),clearColor:(e,t,n,r,s)=>e({[i.a.COLOR_CLEAR_VALUE]:new Float32Array([t,n,r,s])}),clearDepth:(e,t)=>e({[i.a.DEPTH_CLEAR_VALUE]:t}),clearStencil:(e,t)=>e({[i.a.STENCIL_CLEAR_VALUE]:t}),colorMask:(e,t,n,r,s)=>e({[i.a.COLOR_WRITEMASK]:[t,n,r,s]}),cullFace:(e,t)=>e({[i.a.CULL_FACE_MODE]:t}),depthFunc:(e,t)=>e({[i.a.DEPTH_FUNC]:t}),depthRange:(e,t,n)=>e({[i.a.DEPTH_RANGE]:new Float32Array([t,n])}),depthMask:(e,t)=>e({[i.a.DEPTH_WRITEMASK]:t}),frontFace:(e,t)=>e({[i.a.FRONT_FACE]:t}),lineWidth:(e,t)=>e({[i.a.LINE_WIDTH]:t}),polygonOffset:(e,t,n)=>e({[i.a.POLYGON_OFFSET_FACTOR]:t,[i.a.POLYGON_OFFSET_UNITS]:n}),sampleCoverage:(e,t,n)=>e({[i.a.SAMPLE_COVERAGE_VALUE]:t,[i.a.SAMPLE_COVERAGE_INVERT]:n}),scissor:(e,t,n,r,s)=>e({[i.a.SCISSOR_BOX]:new Int32Array([t,n,r,s])}),stencilMask:(e,t)=>e({[i.a.STENCIL_WRITEMASK]:t,[i.a.STENCIL_BACK_WRITEMASK]:t}),stencilMaskSeparate:(e,t,n)=>e({[t===i.a.FRONT?i.a.STENCIL_WRITEMASK:i.a.STENCIL_BACK_WRITEMASK]:n}),stencilFunc:(e,t,n,r)=>e({[i.a.STENCIL_FUNC]:t,[i.a.STENCIL_REF]:n,[i.a.STENCIL_VALUE_MASK]:r,[i.a.STENCIL_BACK_FUNC]:t,[i.a.STENCIL_BACK_REF]:n,[i.a.STENCIL_BACK_VALUE_MASK]:r}),stencilFuncSeparate:(e,t,n,r,s)=>e({[t===i.a.FRONT?i.a.STENCIL_FUNC:i.a.STENCIL_BACK_FUNC]:n,[t===i.a.FRONT?i.a.STENCIL_REF:i.a.STENCIL_BACK_REF]:r,[t===i.a.FRONT?i.a.STENCIL_VALUE_MASK:i.a.STENCIL_BACK_VALUE_MASK]:s}),stencilOp:(e,t,n,r)=>e({[i.a.STENCIL_FAIL]:t,[i.a.STENCIL_PASS_DEPTH_FAIL]:n,[i.a.STENCIL_PASS_DEPTH_PASS]:r,[i.a.STENCIL_BACK_FAIL]:t,[i.a.STENCIL_BACK_PASS_DEPTH_FAIL]:n,[i.a.STENCIL_BACK_PASS_DEPTH_PASS]:r}),stencilOpSeparate:(e,t,n,r,s)=>e({[t===i.a.FRONT?i.a.STENCIL_FAIL:i.a.STENCIL_BACK_FAIL]:n,[t===i.a.FRONT?i.a.STENCIL_PASS_DEPTH_FAIL:i.a.STENCIL_BACK_PASS_DEPTH_FAIL]:r,[t===i.a.FRONT?i.a.STENCIL_PASS_DEPTH_PASS:i.a.STENCIL_BACK_PASS_DEPTH_PASS]:s}),viewport:(e,t,n,r,s)=>e({[i.a.VIEWPORT]:new Int32Array([t,n,r,s])})}},,function(e,t,n){"use strict";(function(e){t.a="undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!(void 0===e||"object"!=typeof e.versions||!Boolean(e.versions.electron))||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}).call(this,n(13))},function(e,t,n){(function(t){const r=n(36),i="undefined"==typeof window?t:window;i.loaders=i.luma||{},e.exports=Object.assign(i.luma,r)}).call(this,n(12))},,,,function(e,t){},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}n.r(t);const i="Invalid WebGLRenderingContext",s="Requires WebGL2";function a(e){return Boolean(e&&Number.isFinite(e._version))}function o(e){return Boolean(e&&2===e._version)}function u(e){r(a(e),i)}function c(e){r(o(e),s)}var l=n(22),f=n(6),_=n(4);function h(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),e}var m=n(20),p="7.3.1",A=Object(m.a)();var T=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";d(this,e),this.storage=function(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(e){return null}}(r),this.id=t,this.config={},Object.assign(this.config,n),this._loadConfiguration()}return g(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}();function R(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>r&&(n=Math.min(n,r/e.width));var s=e.width*n,a=e.height*n,o=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),o]}var v={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function b(e){return"string"==typeof e?v[e.toUpperCase()]||v.WHITE:e}function I(e,t){if(!e)throw new Error(t||"Assertion failed")}var N=n(8);function S(){var e;if(A&&N.b.performance)e=N.b.performance.now();else if(N.a.hrtime){var t=N.a.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}var F={debug:A&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},L={enabled:!1,priority:0};function O(){}var y={};var C=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;d(this,e),this.id=t,this.VERSION=p,this._startTs=S(),this._deltaTs=S(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new T("__probe-".concat(this.id,"__"),L),this.userData={},this.timeStamp("".concat(this.id," started")),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],n=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(n),i=!0,s=!1,a=void 0;try{for(var o,u=function(){var n=o.value;"function"==typeof e[n]&&(t.find(function(e){return n===e})||(e[n]=e[n].bind(e)))},c=r[Symbol.iterator]();!(i=(o=c.next()).done);i=!0)u()}catch(e){s=!0,a=e}finally{try{i||null==c.return||c.return()}finally{if(s)throw a}}}(this),Object.seal(this)}return g(e,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getPriority",value:function(){return this._storage.config.priority}},{key:"getLevel",value:function(){return this._storage.config.priority}},{key:"getTotal",value:function(){return Number((S()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((S()-this._deltaTs).toPrecision(10))}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({priority:e}),this}},{key:"assert",value:function(e,t){I(e,t)}},{key:"warn",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this._getLogFunction({message:e,args:n,method:F.warn,once:!0})}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this._getLogFunction({message:e,args:n,method:F.error})}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._getLogFunction({priority:e,message:t,args:r,method:F.log,time:!0,once:!0})}},{key:"log",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._getLogFunction({priority:e,message:t,args:r,method:F.debug})}},{key:"info",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._getLogFunction({priority:e,message:t,args:r,method:console.info})}},{key:"once",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return this._getLogFunction({priority:e,message:t,args:r,method:F.debug||F.info,once:!0})}},{key:"table",value:function(e,t,n){if(t){var r=function(e){for(var t in e)for(var n in e[t])return n||"untitled";return"empty"}(t);return this._getLogFunction({priority:e,message:t,args:n&&[n],tag:r,method:console.table||O})}return O}},{key:"image",value:function(e){var t=e.priority,n=e.image,r=e.message,i=void 0===r?"":r,s=e.scale,a=void 0===s?1:s;return t>this.getPriority()?O:A?this._logImageInBrowser({image:n,message:i,scale:a}):this._logImageInNode({image:n,message:i,scale:a})}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,t){this._storage.updateConfiguration(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},e,t))}},{key:"_logImageInNode",value:function(e){var t=e.image,r=(e.message,e.scale),i=void 0===r?1:r,s=null;try{s=n(34)}catch(e){}return s?function(){return s(t,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then(function(e){return console.log(e)})}:O}},{key:"_logImageInBrowser",value:function(e){var t=e.image,n=e.message,r=void 0===n?"":n,i=e.scale,s=void 0===i?1:i;if("string"==typeof t){var a=new Image;return a.onload=function(){var e,t=R(a,r,s);(e=console).log.apply(e,h(t))},a.src=t,O}var o,u=t.nodeName||"";if("img"===u.toLowerCase())return(o=console).log.apply(o,h(R(t,r,s))),O;if("canvas"===u.toLowerCase()){var c=new Image;return c.onload=function(){var e;return(e=console).log.apply(e,h(R(c,r,s)))},c.src=t.toDataURL(),O}return O}},{key:"time",value:function(e,t){return this._getLogFunction({priority:e,message:t,method:console.time?console.time:console.info})}},{key:"timeEnd",value:function(e,t){return this._getLogFunction({priority:e,message:t,method:console.timeEnd?console.timeEnd:console.info})}},{key:"timeStamp",value:function(e,t){return this._getLogFunction({priority:e,message:t,method:console.timeStamp||O})}},{key:"group",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},r=(n=this._normalizeArguments({priority:e,message:t,opts:n})).collapsed;return this._getLogFunction({priority:e,message:t,opts:n,method:(r?console.groupCollapsed:console.group)||console.info})}},{key:"groupCollapsed",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction({priority:e,message:"",method:console.groupEnd||O})}},{key:"withGroup",value:function(e,t,n){var r=this._normalizeArguments({priority:e,message:t});this.group(r);try{n()}finally{this.groupEnd(r.message)}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return 0===(e=this._normalizePriority(e))||this.isEnabled()&&this.getPriority()>=e}},{key:"_getElapsedTime",value:function(){var e=this.getTotal(),t=this.getDelta();return this._deltaTs=S(),{total:e,delta:t}}},{key:"_getLogFunction",value:function(e){if(this._shouldLog(e.priority)){var t=e.method;e=this._parseArguments(e),I(t);var n=e.message,r=e.tag||e.message;if(e.once){if(y[r])return O;y[r]=S()}return n=this._decorateMessage(n,e),t.bind.apply(t,[console,n].concat(h(e.args)))}return O}},{key:"_parseArguments",value:function(e){var t=this._normalizeArguments(e),n=this._getElapsedTime(),r=n.delta,i=n.total;return Object.assign(e,t,{delta:r,total:i})}},{key:"_normalizePriority",value:function(e){var t;switch(Object(_.a)(e)){case"number":t=e;break;case"object":t=e.priority||0;break;default:t=0}return I(Number.isFinite(t)&&t>=0),t}},{key:"_normalizeArguments",value:function(e){var t=e.priority,n=e.message,r=e.args,i=void 0===r?[]:r,s=e.opts,a={priority:this._normalizePriority(t),message:n,args:i};switch(Object(_.a)(t)){case"string":case"function":void 0!==n&&i.unshift(n),Object.assign(a,{message:t});break;case"object":Object.assign(a,t)}return"function"==typeof a.message&&(a.message=this._shouldLog(a.priority)?a.message():""),I("string"==typeof a.message||"object"===Object(_.a)(a.message)),Object.assign(a,s)}},{key:"_decorateMessage",value:function(e,t){if("string"==typeof e){var n="";if(t.time){var r=this._getElapsedTime().total;n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}((o=r)<10?"".concat(o.toFixed(2),"ms"):o<100?"".concat(o.toFixed(1),"ms"):o<1e3?"".concat(o.toFixed(0),"ms"):"".concat((o/1e3).toFixed(2),"s"))}e=t.time?"".concat(this.id,": ").concat(n,"  ").concat(e):"".concat(this.id,": ").concat(e),i=e,s=t.color,a=t.background,A||"string"!=typeof i||(s&&(s=b(s),i="[".concat(s,"m").concat(i,"[39m")),a&&(s=b(a),i="[".concat(a+10,"m").concat(i,"[49m"))),e=i}var i,s,a,o;return e}},{key:"priority",set:function(e){return this._storage.updateConfiguration({priority:e}),this},get:function(){return this._storage.config.priority}}]),e}();C.VERSION=p;var M=new C({id:"luma"}).enable(),P=function(){function e(t,n){d(this,e),this.name=t,this.type=n,this.sampleSize=1,this.reset()}return g(e,[{key:"setSampleSize",value:function(e){return this.sampleSize=e,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(e){return this._count+=e,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(e){return this._count-=e,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=S(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(S()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),e}(),B=function(){function e(t){var n=t.id,r=t.stats;d(this,e),this.id=n,this.stats={},this._initializeStats(r),Object.seal(this)}return g(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:e,type:t})}},{key:"reset",value:function(){for(var e in this.stats)this.stats[e].reset();return this}},{key:"forEach",value:function(e){for(var t in this.stats)e(this.stats[t])}},{key:"getTable",value:function(){var e={};return this.forEach(function(t){e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}},{key:"_initializeStats",value:function(){var e=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){return e._getOrCreate(t)})}},{key:"_getOrCreate",value:function(e){if(!e||!e.name)return null;var t=e.name,n=e.type;return this.stats[t]||(this.stats[t]=e instanceof P?e:new P(t,n)),this.stats[t]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),e}();n(19);const D=new class{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new B({id:e})),this.stats.get(e)}};if(f.b.luma&&"7.3.1"!==f.b.luma.VERSION)throw new Error(`luma.gl - multiple VERSIONs detected: ${f.b.luma.VERSION} vs 7.3.1`);f.b.luma||(l.a&&M.log(1,"luma.gl 7.3.1 - set luma.log.priority=1 (or higher) to trace rendering")(),f.b.luma=f.b.luma||{VERSION:"7.3.1",version:"7.3.1",log:M,stats:D,globals:{modules:{},nodeIO:{}}});f.b.luma;var x=n(23),U=n(25);const w="Failed to create WebGL context in Node.js, headless gl not available",G="Failed to create WebGL context in Node.js, headless gl returned null";const k=l.a&&"undefined"!=typeof document;let H,V=k&&"complete"===document.readyState;function X(){return H||(H=k?new Promise((e,t)=>{if(k&&"complete"===document.readyState)return V=!0,void e(document);window.onload=()=>{V=!0,e(document)}}):Promise.resolve({})),H}function j({canvas:e,width:t,height:n,onError:r=(()=>{})}){let i;return"string"==typeof e?(V||r(`createGLContext called on canvas '${e}' before page was loaded`),i=document.getElementById(e)):i=e||function({width:e=800,height:t=600,id:n="gl-canvas",insert:r=!0}){const i=document.createElement("canvas");if(i.id=n,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",r){const e=document.body;e.insertBefore(i,e.firstChild)}return i}({id:"lumagl-canvas",width:t,height:n,onError:r}),i}var W=n(0),z=n.n(W);function K(e){const t=e.getParameter(z.a.VENDOR),n=e.getParameter(z.a.RENDERER),r=e.getExtension("WEBGL_debug_renderer_info");return{vendor:r&&e.getParameter(r.UNMASKED_VENDOR_WEBGL||z.a.VENDOR)||t,renderer:r&&e.getParameter(r.UNMASKED_RENDERER_WEBGL||z.a.RENDERER)||n,vendorMasked:t,rendererMasked:n,version:e.getParameter(z.a.VERSION),shadingLanguageVersion:e.getParameter(z.a.SHADING_LANGUAGE_VERSION)}}function $(e){return e.canvas?e.drawingBufferWidth/(e.canvas.clientWidth||e.canvas.width||1):1}function Y(e,t,n=!0){return function(e,t,n,r,i){const s=q(e[0],t,n);let a=Q(e[1],t,r,i),o=q(e[0]+1,t,n);const u=o===n-1?o:o-1;let c;o=Q(e[1]+1,t,r,i),i?(c=a,a=o=0===o?o:o+1):c=o===r-1?o:o-1;return{x:s,y:a,width:Math.max(u-s+1,1),height:Math.max(c-a+1,1)}}(t,$(e),e.drawingBufferWidth,e.drawingBufferHeight,n)}function q(e,t,n){return Math.min(Math.round(e*t),n-1)}function Q(e,t,n,r){return r?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}function Z(e){return Boolean(e&&2===e._version)}const J={webgl2:!0,webgl1:!0,throwOnFailure:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function ee(e={}){Object.assign(J,{width:1,height:1},e)}function te(e={}){e=Object.assign({},J,e);const{width:t,height:n}=e;function r(t){if(e.throwOnError)throw new Error(t);return null}let i;if(l.a){const{canvas:s}=e;i=function(e,t){const{onError:n=(e=>null)}=t,r=e=>n(`WebGL context: ${e.statusMessage||"error"}`);e.addEventListener("webglcontextcreationerror",r,!1);const{webgl1:i=!0,webgl2:s=!0}=t;let a=null;return s&&(a=(a=a||e.getContext("webgl2",t))||e.getContext("experimental-webgl2",t)),i&&(a=(a=a||e.getContext("webgl",t))||e.getContext("experimental-webgl",t)),e.removeEventListener("webglcontextcreationerror",r,!1),a||n(`Failed to create ${s&&!i?"WebGL2":"WebGL"} context`)}(j({canvas:s,width:t,height:n,onError:r}),e)}else i=function(e){const{width:t,height:n,webgl1:r,webgl2:i,onError:s}=e;if(i&&!r)return s("headless-gl does not support WebGL2");if(!U.c)return s(w);const a=Object(U.c)(t,n,e);return a||s(G)}({...e,width:t,height:n,onError:r});return i?(function(e){const t=Z(e)?"WebGL2":"WebGL1",n=K(e),r=n?`(${n.vendor},${n.renderer})`:"",i=e.debug?" debug":"";M.info(1,`${t}${i} context ${r}`)()}(i=ne(i,e)),i):null}function ne(e,t={}){if(e._instrumented)return e;e._version=e._version||function(e){if(void 0!==U.a&&e instanceof U.a)return 2;return 1}(e),e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{},t=Object.assign({},J,t);const{manageState:n,debug:r}=t;return n&&Object(x.a)(e,{copyState:!1,log:(...e)=>M.log(1,...e)()}),l.a&&r&&(f.b.makeDebugContext?(e=f.b.makeDebugContext(e,t),M.priority=Math.max(M.priority,1)):M.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),e._instrumented=!0,e}function re(e){const t=e.getExtension("STACKGL_destroy_context");t&&t.destroy()}function ie(e,t={}){if(e.canvas){return void function(e,t,n){const r="width"in n?n.width:e.canvas.clientWidth||e.canvas.width||1,i="height"in n?n.height:e.canvas.clientHeight||e.canvas.height||1;e.luma=e.luma||{},e.luma.canvasSizeInfo=e.luma.canvasSizeInfo||{};const s=e.luma.canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==t){let n=t;const s=Math.floor(r*n),a=Math.floor(i*n);e.canvas.width=s,e.canvas.height=a,e.drawingBufferWidth===s&&e.drawingBufferHeight===a||(M.warn("Device pixel ratio clamped")(),n=Math.min(e.drawingBufferWidth/r,e.drawingBufferHeight/i),e.canvas.width=Math.floor(r*n),e.canvas.height=Math.floor(i*n)),Object.assign(e.luma.canvasSizeInfo,{clientWidth:r,clientHeight:i,devicePixelRatio:t})}}(e,function(e){const t="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(e)?e<=0?1:e:e?t:1}(t.useDevicePixels),t)}const n=e.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in t&&"height"in t&&n.resize(t.width,t.height)}var se={[z.a.ALIASED_LINE_WIDTH_RANGE]:{gl1:new Float32Array([1,1])},[z.a.ALIASED_POINT_SIZE_RANGE]:{gl1:new Float32Array([1,1])},[z.a.MAX_TEXTURE_SIZE]:{gl1:64,gl2:2048},[z.a.MAX_CUBE_MAP_TEXTURE_SIZE]:{gl1:16},[z.a.MAX_TEXTURE_IMAGE_UNITS]:{gl1:8},[z.a.MAX_COMBINED_TEXTURE_IMAGE_UNITS]:{gl1:8},[z.a.MAX_VERTEX_TEXTURE_IMAGE_UNITS]:{gl1:0},[z.a.MAX_RENDERBUFFER_SIZE]:{gl1:1},[z.a.MAX_VARYING_VECTORS]:{gl1:8},[z.a.MAX_VERTEX_ATTRIBS]:{gl1:8},[z.a.MAX_VERTEX_UNIFORM_VECTORS]:{gl1:128},[z.a.MAX_FRAGMENT_UNIFORM_VECTORS]:{gl1:16},[z.a.MAX_VIEWPORT_DIMS]:{gl1:new Int32Array([0,0])},[z.a.MAX_3D_TEXTURE_SIZE]:{gl1:0,gl2:256},[z.a.MAX_ARRAY_TEXTURE_LAYERS]:{gl1:0,gl2:256},[z.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:{gl1:0,gl2:0},[z.a.MAX_COLOR_ATTACHMENTS]:{gl1:0,gl2:4},[z.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[z.a.MAX_COMBINED_UNIFORM_BLOCKS]:{gl1:0,gl2:0},[z.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[z.a.MAX_DRAW_BUFFERS]:{gl1:0,gl2:4},[z.a.MAX_ELEMENT_INDEX]:{gl1:0,gl2:0},[z.a.MAX_ELEMENTS_INDICES]:{gl1:0,gl2:0},[z.a.MAX_ELEMENTS_VERTICES]:{gl1:0,gl2:0},[z.a.MAX_FRAGMENT_INPUT_COMPONENTS]:{gl1:0,gl2:0},[z.a.MAX_FRAGMENT_UNIFORM_BLOCKS]:{gl1:0,gl2:0},[z.a.MAX_FRAGMENT_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[z.a.MAX_SAMPLES]:{gl1:0,gl2:0},[z.a.MAX_SERVER_WAIT_TIMEOUT]:{gl1:0,gl2:0},[z.a.MAX_TEXTURE_LOD_BIAS]:{gl1:0,gl2:0},[z.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:{gl1:0,gl2:0},[z.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:{gl1:0,gl2:0},[z.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:{gl1:0,gl2:0},[z.a.MAX_UNIFORM_BLOCK_SIZE]:{gl1:0,gl2:0},[z.a.MAX_UNIFORM_BUFFER_BINDINGS]:{gl1:0,gl2:0},[z.a.MAX_VARYING_COMPONENTS]:{gl1:0,gl2:0},[z.a.MAX_VERTEX_OUTPUT_COMPONENTS]:{gl1:0,gl2:0},[z.a.MAX_VERTEX_UNIFORM_BLOCKS]:{gl1:0,gl2:0},[z.a.MAX_VERTEX_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[z.a.MIN_PROGRAM_TEXEL_OFFSET]:{gl1:0,gl2:-8,negative:!0},[z.a.MAX_PROGRAM_TEXEL_OFFSET]:{gl1:0,gl2:7},[z.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:{gl1:0,gl2:0}};function ae(e){if(e.luma=e.luma||{},!e.luma.limits){e.luma.limits={},e.luma.webgl1MinLimits={},e.luma.webgl2MinLimits={};const t=o(e);for(const n in se){const r=se[n],i=r.gl1,s="gl2"in r?r.gl2:r.gl1,a=t?s:i,o="gl2"in r&&!t||"extension"in r&&!e.getExtension(r.extension)?a:e.getParameter(n);e.luma.limits[n]=o,e.luma.webgl1MinLimits[n]=i,e.luma.webgl2MinLimits[n]=s}}return e.luma.limits}function oe(e){e.luma=e.luma||{};const t=K(e);return e.luma.info||(e.luma.info={[z.a.UNMASKED_VENDOR_WEBGL]:t.vendor,[z.a.UNMASKED_RENDERER_WEBGL]:t.renderer,[z.a.VENDOR]:t.vendorMasked,[z.a.RENDERER]:t.rendererMasked,[z.a.VERSION]:t.version,[z.a.SHADING_LANGUAGE_VERSION]:t.shadingLanguageVersion}),e.luma.info}function ue(e){return Object.assign(K(e),{limits:ae(e),info:oe(e),webgl1MinLimits:e.luma.webgl1MinLimits,webgl2MinLimits:e.luma.webgl2MinLimits})}function ce(e,t){if("string"!=typeof t)return t;const n=Number(t);if(!isNaN(n))return n;const i=e[t=t.replace(/^.*\./,"")];return r(void 0!==i,`Accessing undefined constant GL.${t}`),i}function le(e,t){t=Number(t);for(const n in e)if(e[n]===t)return`GL.${n}`;return String(t)}const fe={};function _e(e="id"){return fe[e]=fe[e]||1,`${e}-${fe[e]++}`}function he(e){return r("number"==typeof e,"Input must be a number"),e&&0==(e&e-1)}function de(e){let t=!0;for(const n in e){t=!1;break}return t}function Ee(e,t,n,r){const i=`See luma.gl ${n} Upgrade Guide at http://uber.github.io/luma.gl/#/documentation/overview/upgrade-guide`,s=Object.getPrototypeOf(e);r.forEach(e=>{s.methodName||(s[e]=()=>{throw M.removed(`Calling removed method ${t}.${e}: `,i)(),new Error(e)})})}const ge="Resource subclass must define virtual methods";class me{constructor(e,t={}){u(e);const{id:n,userData:r={}}=t;this.gl=e,this.id=n||_e(this.constructor.name),this.userData=r,this._bound=!1,this._handle=t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:e=!1}={}){const t=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,t&&e&&t.filter(Boolean).forEach(e=>{e.delete()}),this}bind(e=this.handle){if("function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e,t={}){r(e=ce(this.gl,e));const n=(this.constructor.PARAMETERS||{})[e];if(n){const e=o(this.gl);if(!((!("webgl2"in n)||e)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const t=n.webgl1,r="webgl2"in n?n.webgl2:n.webgl1;return e?r:t}}return this._getParameter(e,t)}getParameters(e={}){const{parameters:t,keys:n}={},r=this.constructor.PARAMETERS||{},i=o(this.gl),s={},a=t||Object.keys(r);for(const t of a){const a=r[t];if(a&&(!("webgl2"in a)||i)&&(!("extension"in a)||this.gl.getExtension(a.extension))){const r=n?le(this.gl,t):t;s[r]=this.getParameter(t,e),n&&"GLenum"===a.type&&(s[r]=le(this.gl,s[r]))}}return s}setParameter(e,t){r(e=ce(this.gl,e));const n=(this.constructor.PARAMETERS||{})[e];if(n){const e=o(this.gl);if(!((!("webgl2"in n)||e)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(t=ce(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,n){return Ee(this,e,t,n)}initialize(e){}_createHandle(){throw new Error(ge)}_deleteHandle(){throw new Error(ge)}_bindHandle(){throw new Error(ge)}_getOptsFromHandle(){throw new Error(ge)}_getParameter(e,t){throw new Error(ge)}_setParameter(e,t){throw new Error(ge)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this.constructor.name,t=D.get("Resource Counts");t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}_removeStats(){const e=this.constructor.name;D.get("Resource Counts").get(`${e}s Active`).decrementCount()}_trackAllocatedMemory(e,t=this.constructor.name){const n=D.get("Memory Usage");n.get("GPU Memory").addCount(e),n.get(`${t} Memory`).addCount(e),this.byteLength=e}_trackDeallocatedMemory(e=this.constructor.name){const t=D.get("Memory Usage");t.get("GPU Memory").subtractCount(this.byteLength),t.get(`${e} Memory`).subtractCount(this.byteLength),this.byteLength=0}}const pe="Failed to deduce GL constant from typed array";function Ae(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return z.a.FLOAT;case Uint16Array:return z.a.UNSIGNED_SHORT;case Uint32Array:return z.a.UNSIGNED_INT;case Uint8Array:case Uint8ClampedArray:return z.a.UNSIGNED_BYTE;case Int8Array:return z.a.BYTE;case Int16Array:return z.a.SHORT;case Int32Array:return z.a.INT;default:throw new Error(pe)}}function Te(e,{clamped:t=!0}={}){switch(e){case z.a.FLOAT:return Float32Array;case z.a.UNSIGNED_SHORT:case z.a.UNSIGNED_SHORT_5_6_5:case z.a.UNSIGNED_SHORT_4_4_4_4:case z.a.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case z.a.UNSIGNED_INT:return Uint32Array;case z.a.UNSIGNED_BYTE:return t?Uint8ClampedArray:Uint8Array;case z.a.BYTE:return Int8Array;case z.a.SHORT:return Int16Array;case z.a.INT:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Re({data:e,width:t,height:n}){const r=Math.round(t/2),i=Math.round(n/2),s=new Uint8Array(r*i*4);for(let n=0;n<i;n++)for(let i=0;i<r;i++)for(let a=0;a<4;a++)s[4*(n*r+i)+a]=e[4*(2*n*t+2*i)+a];return{data:s,width:r,height:i}}function ve(e,t,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const n in r)if(n in t){const t=r[n]?`${e}.${r[n]}`:"N/A";M.removed(`${e}.${n}`,t)()}for(const n in i)if(n in t){const t=i[n];M.deprecated(`${e}.${n}`,`${e}.${t}`)()}let a=null;for(const n in s)if(n in t){const r=s[n];M.deprecated(`${e}.${n}`,`${e}.${r}`)(),(a=a||Object.assign({},t))[r]=t[n],delete a[n]}return a||t}const be={offset:0,stride:0,type:z.a.FLOAT,size:1,divisor:0,normalized:!1,integer:!1},Ie={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Ne{static getBytesPerElement(e){return Te(e.type||z.a.FLOAT).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return r(e.size),Te(e.type||z.a.FLOAT).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Ne(...[be,...e])}constructor(...e){e.forEach(e=>this._assign(e)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Ne.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Ne.getBytesPerVertex(this)}_assign(e={}){return void 0!==(e=ve("Accessor",e,Ie)).type&&(this.type=e.type,e.type!==z.a.INT&&e.type!==z.a.UNSIGNED_INT||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),this}}const Se=10,Fe={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Le={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Fe},Oe={removedProps:Fe};class ye extends me{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=t.target||(this.gl.webgl2?z.a.COPY_READ_BUFFER:z.a.ARRAY_BUFFER),this.initialize(t),Object.seal(this)}getElementCount(e=this.accessor){return Math.round(this.byteLength/Ne.getBytesPerElement(e))}getVertexCount(e=this.accessor){return Math.round(this.byteLength/Ne.getBytesPerVertex(e))}initialize(e={}){return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=ve("Buffer",e,Le),this.usage=e.usage||z.a.STATIC_DRAW,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data):this._setByteLength(e.byteLength||0),this}setProps(e){return"accessor"in(e=ve("Buffer",e,Oe))&&this.setAccessor(e.accessor),this}setAccessor(e){return delete(e=Object.assign({},e)).buffer,this.accessor=new Ne(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:t,offset:n=0,srcOffset:i=0}=e,s=e.byteLength||e.length;r(t);const a=this.gl.webgl2?z.a.COPY_WRITE_BUFFER:this.target;return this.gl.bindBuffer(a,this.handle),0!==i||void 0!==s?(c(this.gl),this.gl.bufferSubData(this.target,n,t,i,s)):this.gl.bufferSubData(a,n,t),this.gl.bindBuffer(a,null),this.debugData=null,this._inferType(t),this}copyData({sourceBuffer:e,readOffset:t=0,writeOffset:n=0,size:r}){const{gl:i}=this;return c(i),i.bindBuffer(z.a.COPY_READ_BUFFER,e.handle),i.bindBuffer(z.a.COPY_WRITE_BUFFER,this.handle),i.copyBufferSubData(z.a.COPY_READ_BUFFER,z.a.COPY_WRITE_BUFFER,t,n,r),i.bindBuffer(z.a.COPY_READ_BUFFER,null),i.bindBuffer(z.a.COPY_WRITE_BUFFER,null),this.debugData=null,this}getData({dstData:e=null,srcByteOffset:t=0,dstOffset:n=0,length:i=0}={}){c(this.gl);const s=Te(this.accessor.type||z.a.FLOAT,{clamped:!1}),a=this._getAvailableElementCount(t),o=n;let u,l;e?u=(l=e.length)-o:l=o+(u=Math.min(a,i||a));const f=Math.min(a,u);return r((i=i||f)<=f),e=e||new s(l),this.gl.bindBuffer(z.a.COPY_READ_BUFFER,this.handle),this.gl.getBufferSubData(z.a.COPY_READ_BUFFER,t,e,n,i),this.gl.bindBuffer(z.a.COPY_READ_BUFFER,null),e}bind({target:e=this.target,index:t=this.accessor&&this.accessor.index,offset:n=0,size:i}={}){return e===z.a.UNIFORM_BUFFER||e===z.a.TRANSFORM_FEEDBACK_BUFFER?void 0!==i?this.gl.bindBufferRange(e,t,this.handle,n,i):(r(0===n),this.gl.bindBufferBase(e,t,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind({target:e=this.target,index:t=this.accessor&&this.accessor.index}={}){return e===z.a.UNIFORM_BUFFER||e===z.a.TRANSFORM_FEEDBACK_BUFFER?this.gl.bindBufferBase(e,t,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Se,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e,t=this.usage){r(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const n=this._getTarget();this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,e,t),this.gl.bindBuffer(n,null),this.usage=t,this.debugData=e.slice(0,Se),this.bytesUsed=e.byteLength,this._trackAllocatedMemory(e.byteLength);const i=Ae(e);return r(i),this.setAccessor(new Ne(this.accessor,{type:i})),this}_setByteLength(e,t=this.usage){r(e>=0),this._trackDeallocatedMemory();let n=e;0===e&&(n=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,t),this.gl.bindBuffer(i,null),this.usage=t,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?z.a.COPY_WRITE_BUFFER:this.target}_getAvailableElementCount(e){const t=e/Te(this.accessor.type||z.a.FLOAT,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-t}_inferType(e){this.accessor.type||this.setAccessor(new Ne(this.accessor,{type:Ae(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const t=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),t}get type(){return M.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return M.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return M.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return M.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Ne(this.accessor,e),this}}const Ce={[z.a.RGB]:{dataFormat:z.a.RGB,types:[z.a.UNSIGNED_BYTE,z.a.UNSIGNED_SHORT_5_6_5]},[z.a.RGBA]:{dataFormat:z.a.RGBA,types:[z.a.UNSIGNED_BYTE,z.a.UNSIGNED_SHORT_4_4_4_4,z.a.UNSIGNED_SHORT_5_5_5_1]},[z.a.ALPHA]:{dataFormat:z.a.ALPHA,types:[z.a.UNSIGNED_BYTE]},[z.a.LUMINANCE]:{dataFormat:z.a.LUMINANCE,types:[z.a.UNSIGNED_BYTE]},[z.a.LUMINANCE_ALPHA]:{dataFormat:z.a.LUMINANCE_ALPHA,types:[z.a.UNSIGNED_BYTE]},[z.a.R32F]:{dataFormat:z.a.RED,types:[z.a.FLOAT],gl2:!0},[z.a.RG32F]:{dataFormat:z.a.RG,types:[z.a.FLOAT],gl2:!0},[z.a.RGB32F]:{dataFormat:z.a.RGB,types:[z.a.FLOAT],gl2:!0},[z.a.RGBA32F]:{dataFormat:z.a.RGBA,types:[z.a.FLOAT],gl2:!0}},Me={[z.a.RED]:1,[z.a.RED_INTEGER]:1,[z.a.RG]:2,[z.a.RG_INTEGER]:2,[z.a.RGB]:3,[z.a.RGB_INTEGER]:3,[z.a.RGBA]:4,[z.a.RGBA_INTEGER]:4,[z.a.DEPTH_COMPONENT]:1,[z.a.DEPTH_STENCIL]:1,[z.a.ALPHA]:1,[z.a.LUMINANCE]:1,[z.a.LUMINANCE_ALPHA]:2},Pe={[z.a.FLOAT]:4,[z.a.UNSIGNED_INT]:4,[z.a.INT]:4,[z.a.UNSIGNED_SHORT]:2,[z.a.SHORT]:2,[z.a.HALF_FLOAT]:2,[z.a.BYTE]:1,[z.a.UNSIGNED_BYTE]:1};var Be=n(14);function De(e){return Array.isArray(e)||ArrayBuffer.isView(e)}var xe={framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(z.a.FRAMEBUFFER,n)},blend:(e,t)=>t?e.enable(z.a.BLEND):e.disable(z.a.BLEND),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{t=De(t)?t:[t,t],e.blendEquationSeparate(...t)},blendFunc:(e,t)=>{t=De(t)&&2===t.length?[...t,...t]:t,e.blendFuncSeparate(...t)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(z.a.CULL_FACE):e.disable(z.a.CULL_FACE),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(z.a.DEPTH_TEST):e.disable(z.a.DEPTH_TEST),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(z.a.DITHER):e.disable(z.a.DITHER),derivativeHint:(e,t)=>{e.hint(z.a.FRAGMENT_SHADER_DERIVATIVE_HINT,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(z.a.GENERATE_MIPMAP_HINT,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(z.a.POLYGON_OFFSET_FILL):e.disable(z.a.POLYGON_OFFSET_FILL),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(z.a.SCISSOR_TEST):e.disable(z.a.SCISSOR_TEST),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(z.a.STENCIL_TEST):e.disable(z.a.STENCIL_TEST),stencilMask:(e,t)=>{t=De(t)?t:[t,t];const[n,r]=t;e.stencilMaskSeparate(z.a.FRONT,n),e.stencilMaskSeparate(z.a.BACK,r)},stencilFunc:(e,t)=>{t=De(t)&&3===t.length?[...t,...t]:t;const[n,r,i,s,a,o]=t;e.stencilFuncSeparate(z.a.FRONT,n,r,i),e.stencilFuncSeparate(z.a.BACK,s,a,o)},stencilOp:(e,t)=>{t=De(t)&&3===t.length?[...t,...t]:t;const[n,r,i,s,a,o]=t;e.stencilOpSeparate(z.a.FRONT,n,r,i),e.stencilOpSeparate(z.a.BACK,s,a,o)},viewport:(e,t)=>e.viewport(...t)};function Ue(e,t){Object(Be.f)(e,t);for(const n in t){const r=xe[n];r&&r(e,t[n],n)}}var we=n(37),Ge=n(15);function ke(e,t,n){if(Object(we.a)(t))return n(e);const{nocatch:r=!0}=t;let i;if(Object(Ge.a)(!t.frameBuffer),Object(x.c)(e),Ue(e,t),r)i=n(e),Object(x.b)(e);else try{i=n(e)}finally{Object(x.b)(e)}return i}const He=[z.a.LINEAR,z.a.NEAREST];class Ve extends me{static isSupported(e,{format:t,linearFiltering:n}={}){let r=!0;return t&&(r=(r=r&&function(e,t){const n=Ce[t];if(!n)return!1;if(void 0===n.gl1&&void 0===n.gl2)return!0;const r=o(e)&&n.gl2||n.gl1;return"string"==typeof r?e.getExtension(r):r}(e,t))&&(!n||function(e,t){const n=Ce[t];switch(n&&n.types[0]){case z.a.FLOAT:return e.getExtension("OES_texture_float_linear");case z.a.HALF_FLOAT:return e.getExtension("OES_texture_half_float_linear");default:return!0}}(e,t))),r}constructor(e,t){const{id:n=_e("texture"),handle:r,target:i}=t;super(e,{id:n,handle:r}),this.target=i,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(e={}){let t=e.data;if(t instanceof Promise)return t.then(t=>this.initialize(Object.assign({},e,{pixels:t,data:t}))),this;const{pixels:n=null,format:r=z.a.RGBA,border:i=0,recreate:s=!1,parameters:a={},pixelStore:o={},textureUnit:u,unpackFlipY:c=!0}=e;let{mipmaps:l=!0}=e;t||(t=n);let{width:f,height:_,dataFormat:h,type:d}=e;const{depth:E=0}=e;({width:f,height:_,dataFormat:h,type:d}=this._deduceParameters({format:r,type:d,dataFormat:h,compressed:!1,data:t,width:f,height:_})),this.width=f,this.height=_,this.depth=E,this.format=r,this.type=d,this.dataFormat=h,this.border=i,this.textureUnit=u,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(z.a.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,this.handle));const g={[z.a.UNPACK_FLIP_Y_WEBGL]:c},m=Object.assign({},g,o);return l&&this._isNPOT()&&(M.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),l=!1,this._updateForNPOT(a)),this.mipmaps=l,this.setImageData({data:t,width:f,height:_,depth:E,format:r,type:d,dataFormat:h,border:i,mipmaps:l,parameters:m}),l&&this.generateMipmap(),this.setParameters(a),s&&(this.data=t),this}resize({height:e,width:t,mipmaps:n=!1}){return t!==this.width||e!==this.height?this.initialize({width:t,height:e,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:n}):this}generateMipmap(e={}){return this._isNPOT()?(M.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),ke(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:n=null,level:i=0,format:s=this.format,border:a=this.border,offset:u=0,parameters:l={}}=e;let{data:f=null,type:_=this.type,width:h=this.width,height:d=this.height,dataFormat:E=this.dataFormat,compressed:g=!1}=e;f||(f=n),({type:_,dataFormat:E,compressed:g,width:h,height:d}=this._deduceParameters({format:s,type:_,dataFormat:E,compressed:g,data:f,width:h,height:d}));const{gl:m}=this;m.bindTexture(this.target,this.handle);let p=null;if(({data:f,dataType:p}=this._getDataType({data:f,compressed:g})),ke(this.gl,l,()=>{switch(p){case"null":m.texImage2D(t,i,s,h,d,a,E,_,f);break;case"typed-array":m.texImage2D(t,i,s,h,d,a,E,_,f,u);break;case"buffer":c(m),m.bindBuffer(z.a.PIXEL_UNPACK_BUFFER,f.handle||f),m.texImage2D(t,i,s,h,d,a,E,_,u),m.bindBuffer(z.a.PIXEL_UNPACK_BUFFER,null);break;case"browser-object":o(m)?m.texImage2D(t,i,s,h,d,a,E,_,f):m.texImage2D(t,i,s,E,_,f);break;case"compressed":m.compressedTexImage2D(t,i,s,h,d,a,f);break;default:r(!1,"Unknown image data type")}}),f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const e=Me[this.dataFormat]||4,t=Pe[this.type]||1;this._trackAllocatedMemory(this.width*this.height*e*t,"Texture")}return this.loaded=!0,this}setSubImageData({target:e=this.target,pixels:t=null,data:n=null,x:i=0,y:s=0,width:a=this.width,height:u=this.height,level:l=0,format:f=this.format,type:_=this.type,dataFormat:h=this.dataFormat,compressed:d=!1,offset:E=0,border:g=this.border,parameters:m={}}){if(({type:_,dataFormat:h,compressed:d,width:a,height:u}=this._deduceParameters({format:f,type:_,dataFormat:h,compressed:d,data:n,width:a,height:u})),r(0===this.depth,"texSubImage not supported for 3D textures"),n||(n=t),n&&n.data){const e=n;n=e.data,a=e.shape[0],u=e.shape[1]}n instanceof ye&&(n=n.handle),this.gl.bindTexture(this.target,this.handle),ke(this.gl,m,()=>{d?this.gl.compressedTexSubImage2D(e,l,i,s,a,u,f,n):null===n?this.gl.texSubImage2D(e,l,i,s,a,u,h,_,null):ArrayBuffer.isView(n)?this.gl.texSubImage2D(e,l,i,s,a,u,h,_,n,E):n instanceof U.b?(c(this.gl),this.gl.bindBuffer(z.a.PIXEL_UNPACK_BUFFER,n),this.gl.texSubImage2D(e,l,i,s,a,u,h,_,E),this.gl.bindBuffer(z.a.PIXEL_UNPACK_BUFFER,null)):o(this.gl)?this.gl.texSubImage2D(e,l,i,s,a,u,h,_,n):this.gl.texSubImage2D(e,l,i,s,h,_,n)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(e={}){return M.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(z.a.ACTIVE_TEXTURE)-z.a.TEXTURE0}bind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,this.handle),e}unbind(e=this.textureUnit){const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,null),e}_getDataType({data:e,compressed:t=!1}){return t?{data:e,dataType:"compressed"}:null===e?{data:e,dataType:"null"}:ArrayBuffer.isView(e)?{data:e,dataType:"typed-array"}:e instanceof ye?{data:e.handle,dataType:"buffer"}:e instanceof U.b?{data:e,dataType:"buffer"}:{data:e,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:n}=e;let{width:r,height:i,dataFormat:s,type:a,compressed:o}=e;const u=Ce[t];return s=s||u&&u.dataFormat,a=a||u&&u.types[0],o=o||u&&u.compressed,({width:r,height:i}=this._deduceImageSize(n,r,i)),{dataFormat:s,type:a,compressed:o,width:r,height:i,format:t,data:n}}_deduceImageSize(e,t,n){let i;return r(i="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement?{width:e.width,height:e.height}:"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:n}:{width:t>=0?t:1,height:n>=0?n:1},"Could not deduced texture size"),r(void 0===t||i.width===t,"Deduced texture width does not match supplied width"),r(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case z.a.TEXTURE_WIDTH:return this.width;case z.a.TEXTURE_HEIGHT:return this.height;default:this.gl.bindTexture(this.target,this.handle);const t=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),t}}_setParameter(e,t){switch(this.gl.bindTexture(this.target,this.handle),t=this._getNPOTParam(e,t),e){case z.a.TEXTURE_MIN_LOD:case z.a.TEXTURE_MAX_LOD:this.gl.texParameterf(this.handle,e,t);break;case z.a.TEXTURE_WIDTH:case z.a.TEXTURE_HEIGHT:r(!1);break;default:this.gl.texParameteri(this.target,e,t)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!o(this.gl)&&(!(!this.width||!this.height)&&(!he(this.width)||!he(this.height)))}_updateForNPOT(e){void 0===e[this.gl.TEXTURE_MIN_FILTER]&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===e[this.gl.TEXTURE_WRAP_S]&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===e[this.gl.TEXTURE_WRAP_T]&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,t){if(this._isNPOT())switch(e){case z.a.TEXTURE_MIN_FILTER:-1===He.indexOf(t)&&(t=z.a.LINEAR);break;case z.a.TEXTURE_WRAP_S:case z.a.TEXTURE_WRAP_T:t!==z.a.CLAMP_TO_EDGE&&(t=z.a.CLAMP_TO_EDGE)}return t}}let Xe="";function je(e){Xe=e}function We(e,t={}){r("string"==typeof e),e=Xe+e;const n=t.dataType||"text";return fetch(e,t).then(e=>e[n]())}function ze(e,t){return r("string"==typeof e),e=Xe+e,new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error(`Could not load image ${e}.`)),i.crossOrigin=t&&t.crossOrigin||"anonymous",i.src=e}catch(e){r(e)}})}class Ke extends Ve{static isSupported(e,t){return Ve.isSupported(e,t)}constructor(e,t={}){u(e),(t instanceof Promise||"string"==typeof t)&&(t={data:t}),"string"==typeof t.data&&(t=Object.assign({},t,{data:ze(t.data)})),super(e,Object.assign({},t,{target:z.a.TEXTURE_2D})),this.initialize(t),Object.seal(this)}}const $e="EXT_color_buffer_float";var Ye={[z.a.DEPTH_COMPONENT16]:{bpp:2},[z.a.DEPTH_COMPONENT24]:{gl2:!0,bpp:3},[z.a.DEPTH_COMPONENT32F]:{gl2:!0,bpp:4},[z.a.STENCIL_INDEX8]:{bpp:1},[z.a.DEPTH_STENCIL]:{bpp:4},[z.a.DEPTH24_STENCIL8]:{gl2:!0,bpp:4},[z.a.DEPTH32F_STENCIL8]:{gl2:!0,bpp:5},[z.a.RGBA4]:{bpp:2},[z.a.RGB565]:{bpp:2},[z.a.RGB5_A1]:{bpp:2},[z.a.R8]:{gl2:!0,bpp:1},[z.a.R8UI]:{gl2:!0,bpp:1},[z.a.R8I]:{gl2:!0,bpp:1},[z.a.R16UI]:{gl2:!0,bpp:2},[z.a.R16I]:{gl2:!0,bpp:2},[z.a.R32UI]:{gl2:!0,bpp:4},[z.a.R32I]:{gl2:!0,bpp:4},[z.a.RG8]:{gl2:!0,bpp:2},[z.a.RG8UI]:{gl2:!0,bpp:2},[z.a.RG8I]:{gl2:!0,bpp:2},[z.a.RG16UI]:{gl2:!0,bpp:4},[z.a.RG16I]:{gl2:!0,bpp:4},[z.a.RG32UI]:{gl2:!0,bpp:8},[z.a.RG32I]:{gl2:!0,bpp:8},[z.a.RGB8]:{gl2:!0,bpp:3},[z.a.RGBA8]:{gl2:!0,bpp:4},[z.a.RGB10_A2]:{gl2:!0,bpp:4},[z.a.RGBA8UI]:{gl2:!0,bpp:4},[z.a.RGBA8I]:{gl2:!0,bpp:4},[z.a.RGB10_A2UI]:{gl2:!0,bpp:4},[z.a.RGBA16UI]:{gl2:!0,bpp:8},[z.a.RGBA16I]:{gl2:!0,bpp:8},[z.a.RGBA32I]:{gl2:!0,bpp:16},[z.a.RGBA32UI]:{gl2:!0,bpp:16},[z.a.R16F]:{gl2:$e,bpp:2},[z.a.RG16F]:{gl2:$e,bpp:4},[z.a.RGBA16F]:{gl2:$e,bpp:8},[z.a.R32F]:{gl2:$e,bpp:4},[z.a.RG32F]:{gl2:$e,bpp:8},[z.a.RGBA32F]:{gl2:$e,bpp:16},[z.a.R11F_G11F_B10F]:{gl2:$e,bpp:4}};class qe extends me{static isSupported(e,{format:t}={}){return!t||function(e,t,n){const r=n[t];if(!r)return!1;const i=o(e)&&r.gl2||r.gl1;return"string"==typeof i?e.getExtension(i):i}(e,t,Ye)}static getSamplesForFormat(e,{format:t}){return e.getInternalformatParameter(z.a.RENDERBUFFER,t,z.a.SAMPLES)}constructor(e,t={}){super(e,t),this.initialize(t),Object.seal(this)}initialize({format:e,width:t=1,height:n=1,samples:i=0}){return r(e,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(z.a.RENDERBUFFER,this.handle),0!==i&&o(this.gl)?this.gl.renderbufferStorageMultisample(z.a.RENDERBUFFER,i,e,t,n):this.gl.renderbufferStorage(z.a.RENDERBUFFER,e,t,n),this.format=e,this.width=t,this.height=n,this.samples=i,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Ye[this.format].bpp),this}resize({width:e,height:t}){return e!==this.width||t!==this.height?this.initialize({width:e,height:t,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(z.a.RENDERBUFFER,e)}_syncHandle(e){this.format=this.getParameter(z.a.RENDERBUFFER_INTERNAL_FORMAT),this.width=this.getParameter(z.a.RENDERBUFFER_WIDTH),this.height=this.getParameter(z.a.RENDERBUFFER_HEIGHT),this.samples=this.getParameter(z.a.RENDERBUFFER_SAMPLES)}_getParameter(e){return this.gl.bindRenderbuffer(z.a.RENDERBUFFER,this.handle),this.gl.getRenderbufferParameter(z.a.RENDERBUFFER,e)}}const Qe=256,Ze=1024,Je=16384,et=6144,tt=6145,nt=6146,rt=34041,it="clear: bad arguments";function st(e,{framebuffer:t=null,color:n=null,depth:i=null,stencil:s=null}={}){const a={};t&&(a.framebuffer=t);let o=0;n&&(o|=Je,!0!==n&&(a.clearColor=n)),i&&(o|=Qe,!0!==i&&(a.clearDepth=i)),s&&(o|=Ze,!0!==i&&(a.clearStencil=i)),r(0!==o,it),ke(e,a,()=>{e.clear(o)})}function at(e,{framebuffer:t=null,buffer:n=et,drawBuffer:i=0,value:s=[0,0,0,0]}={}){c(e),ke(e,{framebuffer:t},()=>{switch(n){case et:switch(s.constructor){case Int32Array:e.clearBufferiv(n,i,s);break;case Uint32Array:e.clearBufferuiv(n,i,s);break;case Float32Array:default:e.clearBufferfv(n,i,s)}break;case tt:e.clearBufferfv(tt,0,[s]);break;case nt:e.clearBufferiv(nt,0,[s]);break;case rt:const[t,a]=s;e.clearBufferfi(rt,0,t,a);break;default:r(!1,it)}})}function ot(e){switch(e){case z.a.ALPHA:case z.a.R32F:case z.a.RED:return 1;case z.a.RG32F:case z.a.RG:return 2;case z.a.RGB:case z.a.RGB32F:return 3;case z.a.RGBA:case z.a.RGBA32F:return 4;default:return r(!1),0}}const ut=[z.a.TEXTURE_CUBE_MAP_POSITIVE_X,z.a.TEXTURE_CUBE_MAP_NEGATIVE_X,z.a.TEXTURE_CUBE_MAP_POSITIVE_Y,z.a.TEXTURE_CUBE_MAP_NEGATIVE_Y,z.a.TEXTURE_CUBE_MAP_POSITIVE_Z,z.a.TEXTURE_CUBE_MAP_NEGATIVE_Z];class ct extends Ve{constructor(e,t={}){u(e),super(e,Object.assign({},t,{target:z.a.TEXTURE_CUBE_MAP})),this.initialize(t),Object.seal(this)}initialize(e={}){const{mipmaps:t=!0,parameters:n={}}=e;this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setParameters(n)})}subImage({face:e,data:t,x:n=0,y:r=0,mipmapLevel:i=0}){return this._subImage({target:e,data:t,x:n,y:r,mipmapLevel:i})}async setCubeMapImageData({width:e,height:t,pixels:n,data:r,border:i=0,format:s=z.a.RGBA,type:a=z.a.UNSIGNED_BYTE}){const{gl:o}=this,u=n||r,c=await Promise.all(ut.map(e=>{const t=u[e];return Promise.all(Array.isArray(t)?t:[t])}));this.bind(),ut.forEach((n,r)=>{c[r].length>1&&!1!==this.opts.mipmaps&&M.warn(`${this.id} has mipmap and multiple LODs.`)(),c[r].forEach((r,u)=>{e&&t?o.texImage2D(n,u,s,e,t,i,s,a,r):o.texImage2D(n,u,s,s,a,r)})}),this.unbind()}setImageDataForFace(e){const{face:t,width:n,height:r,pixels:i,data:s,border:a=0,format:o=z.a.RGBA,type:u=z.a.UNSIGNED_BYTE}=e,{gl:c}=this,l=i||s;return this.bind(),l instanceof Promise?l.then(n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n}))):this.width||this.height?c.texImage2D(t,0,o,n,r,a,o,u,l):c.texImage2D(t,0,o,o,u,l),this}}ct.FACES=ut;class lt extends Ve{static isSupported(e){return o(e)}constructor(e,t={}){c(e),super(e,t=Object.assign({depth:1},t,{target:z.a.TEXTURE_3D,unpackFlipY:!1})),this.initialize(t),Object.seal(this)}setImageData({level:e=0,dataFormat:t=z.a.RGBA,width:n,height:r,depth:i=1,border:s=0,format:a,type:o=z.a.UNSIGNED_BYTE,offset:u=0,data:c,parameters:l={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),ke(this.gl,l,()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,e,t,n,r,i,s,a,o,c),c instanceof ye&&(this.gl.bindBuffer(z.a.PIXEL_UNPACK_BUFFER,c.handle),this.gl.texImage3D(this.target,e,t,n,r,i,s,a,o,u))}),c&&c.byteLength)this._trackAllocatedMemory(c.byteLength,"Texture");else{const e=Me[this.dataFormat]||4,t=Pe[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*e*t,"Texture")}return this.loaded=!0,this}}function ft(e,t){r(e instanceof Ke||e instanceof ct||e instanceof lt);const n=e.constructor,{gl:i,width:s,height:a,format:o,type:u,dataFormat:c,border:l,mipmaps:f}=e;return new n(i,Object.assign({width:s,height:a,format:o,type:u,dataFormat:c,border:l,mipmaps:f},t))}function _t(e,t){const{gl:n,width:r,height:i,id:s}=e;return new St(n,Object.assign({},t,{id:`framebuffer-for-${s}`,width:r,height:i,attachments:{[z.a.COLOR_ATTACHMENT0]:e}}))}function ht(e,{sourceX:t=0,sourceY:n=0,sourceFormat:i=z.a.RGBA,sourceAttachment:s=z.a.COLOR_ATTACHMENT0,target:a=null,sourceWidth:o,sourceHeight:u,sourceType:c}={}){const{framebuffer:l,deleteFramebuffer:f}=At(e);r(l);const{gl:_,handle:h,attachments:d}=l;o=o||l.width,u=u||l.height,s===z.a.COLOR_ATTACHMENT0&&null===h&&(s=z.a.FRONT),r(d[s]),a=function(e,t,n,r,i){if(e)return e;const s=Te(t=t||z.a.UNSIGNED_BYTE,{clamped:!1}),a=ot(n);return new s(r*i*a)}(a,c=c||d[s].type,i,o,u),c=c||Ae(a);const E=_.bindFramebuffer(z.a.FRAMEBUFFER,h);return _.readPixels(t,n,o,u,i,c,a),_.bindFramebuffer(z.a.FRAMEBUFFER,E||null),f&&l.delete(),a}function dt(e,{sourceX:t=0,sourceY:n=0,sourceFormat:i=z.a.RGBA,target:s=null,targetByteOffset:a=0,sourceWidth:o,sourceHeight:u,sourceType:l}){const{framebuffer:f,deleteFramebuffer:_}=At(e);r(f);const{gl:h}=f;if(o=o||f.width,u=u||f.height,c(h),l=l||(s?s.type:z.a.UNSIGNED_BYTE),!s){const e=ot(i),t=function(e){switch(e){case z.a.UNSIGNED_BYTE:return 1;case z.a.UNSIGNED_SHORT_5_6_5:case z.a.UNSIGNED_SHORT_4_4_4_4:case z.a.UNSIGNED_SHORT_5_5_5_1:return 2;case z.a.FLOAT:return 4;default:return r(!1),0}}(l);s=new ye(h,{byteLength:a+o*u*e*t,accessor:{type:l,size:e}})}return s.bind({target:z.a.PIXEL_PACK_BUFFER}),ke(h,{framebuffer:f},()=>{h.readPixels(t,n,o,u,i,l,a)}),s.unbind({target:z.a.PIXEL_PACK_BUFFER}),_&&f.delete(),s}function Et(e,{sourceAttachment:t=z.a.COLOR_ATTACHMENT0,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}={}){let r=ht(e,{sourceAttachment:t}),{width:i,height:s}=e;for(;s>n;)({data:r,width:i,height:s}=Re({data:r,width:i,height:s}));!function({data:e,width:t,height:n,bytesPerPixel:r=4,temp:i}){const s=t*r;i=i||new Uint8Array(s);for(let t=0;t<n/2;++t){const r=t*s,a=(n-t-1)*s;i.set(e.subarray(r,r+s)),e.copyWithin(r,a,a+s),e.set(i,a)}}({data:r,width:i,height:s});const a=document.createElement("canvas");a.width=i,a.height=s;const o=a.getContext("2d"),u=o.createImageData(i,s);return u.data.set(r),o.putImageData(u,0,0),a.toDataURL()}function gt(e,{sourceAttachment:t=z.a.COLOR_ATTACHMENT0,targetImage:n=null}={}){const r=Et(e,{sourceAttachment:t});return(n=n||new Image).src=r,n}function mt(e,t,{sourceX:n=0,sourceY:i=0,targetX:s,targetY:a,targetZ:o,targetMipmaplevel:u=0,targetInternalFormat:c=z.a.RGBA,width:l,height:f}={}){const{framebuffer:_,deleteFramebuffer:h}=At(e);r(_);const{gl:d,handle:E}=_,g=void 0!==s||void 0!==a||void 0!==o;s=s||0,a=a||0,o=o||0;const m=d.bindFramebuffer(z.a.FRAMEBUFFER,E);r(t);let p=null;if(t instanceof Ve&&(p=t,l=Number.isFinite(l)?l:p.width,f=Number.isFinite(f)?f:p.height,p.bind(0),t=p.target),g)switch(t){case z.a.TEXTURE_2D:case z.a.TEXTURE_CUBE_MAP:d.copyTexSubImage2D(t,u,s,a,n,i,l,f);break;case z.a.TEXTURE_2D_ARRAY:case z.a.TEXTURE_3D:d.copyTexSubImage3D(t,u,s,a,o,n,i,l,f)}else d.copyTexImage2D(t,u,c,n,i,l,f,0);return p&&p.unbind(),d.bindFramebuffer(z.a.FRAMEBUFFER,m||null),h&&_.delete(),p}function pt(e,t,{sourceAttachment:n=z.a.COLOR_ATTACHMENT0,sourceX0:i=0,sourceY0:s=0,sourceX1:a,sourceY1:o,targetX0:u=0,targetY0:l=0,targetX1:f,targetY1:_,color:h=!0,depth:d=!1,stencil:E=!1,mask:g=0,filter:m=z.a.NEAREST}={}){const{framebuffer:p,deleteFramebuffer:A}=At(e),{framebuffer:T,deleteFramebuffer:R}=At(t);r(p),r(T);const{gl:v,handle:b,width:I,height:N,readBuffer:S}=T;c(v),p.handle||n!==z.a.COLOR_ATTACHMENT0||(n=z.a.FRONT),h&&(g|=z.a.COLOR_BUFFER_BIT),d&&(g|=z.a.DEPTH_BUFFER_BIT),E&&(g|=z.a.STENCIL_BUFFER_BIT),(A||R)&&g&(z.a.DEPTH_BUFFER_BIT|z.a.STENCIL_BUFFER_BIT)&&(g=z.a.COLOR_BUFFER_BIT,M.warn("Blitting from or into a Texture object, forcing mask to GL.COLOR_BUFFER_BIT")()),r(g),a=void 0===a?p.width:a,o=void 0===o?p.height:o,f=void 0===f?I:f,_=void 0===_?N:_;const F=v.bindFramebuffer(z.a.DRAW_FRAMEBUFFER,b),L=v.bindFramebuffer(z.a.READ_FRAMEBUFFER,p.handle);return v.readBuffer(n),v.blitFramebuffer(i,s,a,o,u,l,f,_,g,m),v.readBuffer(S),v.bindFramebuffer(z.a.READ_FRAMEBUFFER,L||null),v.bindFramebuffer(z.a.DRAW_FRAMEBUFFER,F||null),A&&p.delete(),R&&T.delete(),T}function At(e){return e instanceof St?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:_t(e),deleteFramebuffer:!0}}const Tt=2;function Rt(e,t){return vt(e,t)}function vt(e,t){return(t=Array.isArray(t)?t:[t]).every(t=>It(e,t))}function bt(e){if(e.luma=e.luma||{},!e.luma.caps){e.luma.caps={},e.luma.caps.webgl2=o(e);for(const t in yt)e.luma.caps[t]=It(e,t)}return e.luma.caps}function It(e,t){const n=yt[t];r(n,t);const i=o(e)&&n[1]||n[0];let s;if("function"==typeof i)s=i(e);else if(Array.isArray(i)){s=!0;for(const t of i)s=s&&Boolean(e.getExtension(t))}else"string"==typeof i?s=Boolean(e.getExtension(i)):"boolean"==typeof i?s=i:r(!1);return s||M.log(Tt,`Feature: ${t} not supported`)(),s}const Nt="Multiple render targets not supported";class St extends me{static isSupported(e,{colorBufferFloat:t,colorBufferHalfFloat:n}={}){let r=!0;return t&&(r=Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),n&&(r=r&&Boolean(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),r}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new St(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}constructor(e,t={}){super(e,t),this.width=null,this.height=null,this.attachments={},this.readBuffer=z.a.COLOR_ATTACHMENT0,this.drawBuffers=[z.a.COLOR_ATTACHMENT0],this.ownResources=[],this.initialize(t),Object.seal(this)}get color(){return this.attachments[z.a.COLOR_ATTACHMENT0]||null}get texture(){return this.attachments[z.a.COLOR_ATTACHMENT0]||null}get depth(){return this.attachments[z.a.DEPTH_ATTACHMENT]||this.attachments[z.a.DEPTH_STENCIL_ATTACHMENT]||null}get stencil(){return this.attachments[z.a.STENCIL_ATTACHMENT]||this.attachments[z.a.DEPTH_STENCIL_ATTACHMENT]||null}initialize({width:e=1,height:t=1,attachments:n=null,color:i=!0,depth:s=!0,stencil:a=!1,check:o=!0,readBuffer:u,drawBuffers:c}){if(r(e>=0&&t>=0,"Width and height need to be integers"),this.width=e,this.height=t,n)for(const r in n){const i=n[r];(Array.isArray(i)?i[0]:i).resize({width:e,height:t})}else n=this._createDefaultAttachments(i,s,a,e,t);this.update({clearAttachments:!0,attachments:n,readBuffer:u,drawBuffers:c}),n&&o&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();super.delete()}update({attachments:e={},readBuffer:t,drawBuffers:n,clearAttachments:r=!1,resizeAttachments:i=!0}){this.attach(e,{clearAttachments:r,resizeAttachments:i});const{gl:s}=this,a=s.bindFramebuffer(z.a.FRAMEBUFFER,this.handle);return t&&this._setReadBuffer(t),n&&this._setDrawBuffers(n),s.bindFramebuffer(z.a.FRAMEBUFFER,a||null),this}resize({width:e,height:t}={}){if(null===this.handle)return r(void 0===e&&void 0===t),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===t&&(t=this.gl.drawingBufferHeight),e!==this.width&&t!==this.height&&M.log(2,`Resizing framebuffer ${this.id} to ${e}x${t}`)();for(const n in this.attachments)this.attachments[n].resize({width:e,height:t});return this.width=e,this.height=t,this}attach(e,{clearAttachments:t=!1,resizeAttachments:n=!0}={}){const i={};t&&Object.keys(this.attachments).forEach(e=>{i[e]=null}),Object.assign(i,e);const s=this.gl.bindFramebuffer(z.a.FRAMEBUFFER,this.handle);for(const e in i){r(void 0!==e,"Misspelled framebuffer binding point?");const t=Number(e),s=i[t];let a=s;if(a)if(a instanceof qe)this._attachRenderbuffer({attachment:t,renderbuffer:a});else if(Array.isArray(s)){const[e,n=0,r=0]=s;a=e,this._attachTexture({attachment:t,texture:e,layer:n,level:r})}else this._attachTexture({attachment:t,texture:a,layer:0,level:0});else this._unattach(t);n&&a&&a.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(z.a.FRAMEBUFFER,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(e=>!this.attachments[e]).forEach(e=>{delete this.attachments[e]})}checkStatus(){const{gl:e}=this,t=this.getStatus();if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error(function(e){return(St.STATUS||{})[e]||`Framebuffer error ${e}`}(t));return this}getStatus(){const{gl:e}=this,t=e.bindFramebuffer(z.a.FRAMEBUFFER,this.handle),n=e.checkFramebufferStatus(z.a.FRAMEBUFFER);return e.bindFramebuffer(z.a.FRAMEBUFFER,t||null),n}clear({color:e,depth:t,stencil:n,drawBuffers:r=[]}={}){const i=this.gl.bindFramebuffer(z.a.FRAMEBUFFER,this.handle);return(e||t||n)&&st(this.gl,{color:e,depth:t,stencil:n}),r.forEach((e,t)=>{at({drawBuffer:t,value:e})}),this.gl.bindFramebuffer(z.a.FRAMEBUFFER,i||null),this}readPixels(e={}){return M.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(e={}){return M.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(e={}){return M.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(e={}){return M.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(e={}){return M.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(e={}){return M.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:e=[],x:t=0,y:n=0,width:r,height:i}){const{gl:s}=this;c(s);const a=s.bindFramebuffer(z.a.READ_FRAMEBUFFER,this.handle);return 0===t&&0===n&&void 0===r&&void 0===i?s.invalidateFramebuffer(z.a.READ_FRAMEBUFFER,e):s.invalidateFramebuffer(z.a.READ_FRAMEBUFFER,e,t,n,r,i),s.bindFramebuffer(z.a.READ_FRAMEBUFFER,a),this}getAttachmentParameter(e,t,n){let r=this._getAttachmentParameterFallback(t);return null===r&&(this.gl.bindFramebuffer(z.a.FRAMEBUFFER,this.handle),r=this.gl.getFramebufferAttachmentParameter(z.a.FRAMEBUFFER,e,t),this.gl.bindFramebuffer(z.a.FRAMEBUFFER,null)),n&&r>1e3&&(r=le(this.gl,r)),r}getAttachmentParameters(e=z.a.COLOR_ATTACHMENT0,t,n=this.constructor.ATTACHMENT_PARAMETERS||[]){const r={};for(const i of n){r[t?le(this.gl,i):i]=this.getAttachmentParameter(e,i,t)}return r}getParameters(e=!0){const t=Object.keys(this.attachments),n={};for(const r of t){const t=Number(r);n[e?le(this.gl,t):t]=this.getAttachmentParameters(t,e)}return n}show(){return"undefined"!=typeof window&&window.open(Et(this),"luma-debug-texture"),this}log(e=0,t=""){if(e>M.priority||"undefined"==typeof window)return this;t=t||`Framebuffer ${this.id}`;const n=Et(this,{maxHeight:100});return M.image({priority:e,message:t,image:n},t)(),this}bind({target:e=z.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(e,this.handle),this}unbind({target:e=z.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,t,n,i,s){let a=null;return e&&((a=a||{})[z.a.COLOR_ATTACHMENT0]=new Ke(this.gl,{id:`${this.id}-color0`,pixels:null,format:z.a.RGBA,type:z.a.UNSIGNED_BYTE,width:i,height:s,mipmaps:!1,parameters:{[z.a.TEXTURE_MIN_FILTER]:z.a.LINEAR,[z.a.TEXTURE_MAG_FILTER]:z.a.LINEAR,[z.a.TEXTURE_WRAP_S]:z.a.CLAMP_TO_EDGE,[z.a.TEXTURE_WRAP_T]:z.a.CLAMP_TO_EDGE}}),this.ownResources.push(a[z.a.COLOR_ATTACHMENT0])),t&&n?((a=a||{})[z.a.DEPTH_STENCIL_ATTACHMENT]=new qe(this.gl,{id:`${this.id}-depth-stencil`,format:z.a.DEPTH24_STENCIL8,width:i,height:111}),this.ownResources.push(a[z.a.DEPTH_STENCIL_ATTACHMENT])):t?((a=a||{})[z.a.DEPTH_ATTACHMENT]=new qe(this.gl,{id:`${this.id}-depth`,format:z.a.DEPTH_COMPONENT16,width:i,height:s}),this.ownResources.push(a[z.a.DEPTH_ATTACHMENT])):n&&r(!1),a}_unattach(e){const t=this.attachments[e];t&&(t instanceof qe?this.gl.framebufferRenderbuffer(z.a.FRAMEBUFFER,e,z.a.RENDERBUFFER,null):this.gl.framebufferTexture2D(z.a.FRAMEBUFFER,e,z.a.TEXTURE_2D,null,0),delete this.attachments[e])}_attachRenderbuffer({attachment:e=z.a.COLOR_ATTACHMENT0,renderbuffer:t}){const{gl:n}=this;n.framebufferRenderbuffer(z.a.FRAMEBUFFER,e,z.a.RENDERBUFFER,t.handle),this.attachments[e]=t}_attachTexture({attachment:e=z.a.COLOR_ATTACHMENT0,texture:t,layer:n,level:i}){const{gl:s}=this;switch(s.bindTexture(t.target,t.handle),t.target){case z.a.TEXTURE_2D_ARRAY:case z.a.TEXTURE_3D:s.framebufferTextureLayer(z.a.FRAMEBUFFER,e,t.target,i,n);break;case z.a.TEXTURE_CUBE_MAP:const a=function(e){return e<z.a.TEXTURE_CUBE_MAP_POSITIVE_X?e+z.a.TEXTURE_CUBE_MAP_POSITIVE_X:e}(n);s.framebufferTexture2D(z.a.FRAMEBUFFER,e,a,t.handle,i);break;case z.a.TEXTURE_2D:s.framebufferTexture2D(z.a.FRAMEBUFFER,e,z.a.TEXTURE_2D,t.handle,i);break;default:r(!1,"Illegal texture type")}s.bindTexture(t.target,null),this.attachments[e]=t}_setReadBuffer(e){const{gl:t}=this;o(t)?t.readBuffer(e):r(e===z.a.COLOR_ATTACHMENT0||e===z.a.BACK,Nt),this.readBuffer=e}_setDrawBuffers(e){const{gl:t}=this;if(o(t))t.drawBuffers(e);else{const n=t.getExtension("WEBGL.draw_buffers");n?n.drawBuffersWEBGL(e):r(1===e.length&&(e[0]===z.a.COLOR_ATTACHMENT0||e[0]===z.a.BACK),Nt)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const t=bt(this.gl);switch(e){case z.a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:return t.webgl2?null:0;case z.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE:case z.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:case z.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:case z.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:case z.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:case z.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:return t.webgl2?null:8;case z.a.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:return t.webgl2?null:z.a.UNSIGNED_INT;case z.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:return t.webgl2||t.EXT_sRGB?null:z.a.LINEAR;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(z.a.FRAMEBUFFER,e)}}const Ft=[z.a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME,z.a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE,z.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,z.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE,z.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE,z.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE,z.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE,z.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE,z.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE];St.ATTACHMENT_PARAMETERS=Ft;const Lt={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};let Ot=null;var yt={[Lt.WEBGL2]:[!1,!0],[Lt.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Lt.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Lt.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Lt.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Lt.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Lt.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Lt.FLOAT_BLEND]:["EXT_float_blend"],[Lt.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Lt.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Lt.TEXTURE_FLOAT]:["OES_texture_float",!0],[Lt.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Lt.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Lt.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Lt.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Lt.COLOR_ATTACHMENT_RGBA32F]:[function(e){if(null!==Ot)return Ot;const t=new Ke(e,{format:e.RGBA,type:e.FLOAT,dataFormat:e.RGBA}),n=new St(e,{id:"test-framebuffer",check:!1,attachments:{[e.COLOR_ATTACHMENT0]:t}}),r=n.getStatus();return t.delete(),n.delete(),Ot=r===e.FRAMEBUFFER_COMPLETE},"EXT_color_buffer_float"],[Lt.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Lt.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Lt.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Lt.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Lt.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Lt.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};const Ct={};function Mt(e,t,n={}){const i=yt[t];if(r(i,t),!function(e={}){const t="undefined"!=typeof window&&window.navigator||{},n=e.userAgent||t.userAgent||"",r=-1!==n.indexOf("MSIE "),i=-1!==n.indexOf("Trident/");return r||i}(n))return!0;if(t in Ct)return Ct[t];const s=`#extension GL_${i[0]} : enable\nvoid main(void) {}`,a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,s),e.compileShader(a);const o=e.getShaderParameter(a,e.COMPILE_STATUS);return e.deleteShader(a),Ct[t]=o,o}function Pt(e,t="unnamed"){const n=e.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return n?n[1]:t}const Bt=35632,Dt=35633;function xt(e,t,n,r){const i=e.split(/\r?\n/),s={},a={},o=r||Pt(t)||"(unnamed)",u=`${function(e){switch(e){case Bt:return"fragment";case Dt:return"vertex";default:return"unknown type"}}(n)} shader ${o}`;for(let t=0;t<i.length;t++){const n=i[t];if(n.length<=1)continue;const r=n.split(":"),o=r[0],c=parseInt(r[2],10);if(isNaN(c))throw new Error(`GLSL compilation error in ${u}: ${e}`);"WARNING"!==o?s[c]=n:a[c]=n}const c=function(e,t=1,n=": "){const r=e.split(/\r?\n/),i=String(r.length+t-1).length;return r.map((e,r)=>{const s=r+t,a=String(s).length,o=wt(s,i-a);return o+n+e})}(t);return{shaderName:u,errors:Ut(s,c),warnings:Ut(a,c)}}function Ut(e,t){let n="";for(let r=0;r<t.length;r++){const i=t[r];if((e[r+3]||e[r+2]||e[r+1])&&(n+=`${i}\n`,e[r+1])){const t=e[r+1],i=t.split(":",3),s=i[0],a=parseInt(i[1],10)||0;n+=wt(`^^^ ${s}: ${t.substring(i.join(":").length+1).trim()}\n\n`,a)}}return n}function wt(e,t){let n="";for(let e=0;e<t;++e)n+=" ";return`${n}${e}`}const Gt="Shader: GLSL source code must be a JavaScript string";class kt extends me{static getTypeName(e){switch(e){case z.a.VERTEX_SHADER:return"vertex-shader";case z.a.FRAGMENT_SHADER:return"fragment-shader";default:return r(!1),"unknown"}}constructor(e,t){u(e),r("string"==typeof t.source,Gt),super(e,{id:Pt(t.source,null)||t.id||_e(`unnamed ${kt.getTypeName(t.shaderType)}`)}),this.shaderType=t.shaderType,this.source=t.source,this.initialize(t)}initialize({source:e}){const t=Pt(e,null);t&&(this.id=_e(t)),this._compile(e)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return`${kt.getTypeName(this.shaderType)}:${this.id}`}getName(){return Pt(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL.debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL.debug_shaders not implemented"}_compile(e=this.source){if(e.startsWith("#version ")||(e=`#version 100\n${e}`),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(z.a.COMPILE_STATUS)){const e=this.gl.getShaderInfoLog(this.handle),{shaderName:t,errors:n,warnings:r}=xt(e,this.source,this.shaderType,this.id);throw M.error(`GLSL compilation errors in ${t}\n${n}`)(),M.warn(`GLSL compilation warnings in ${t}\n${r}`)(),new Error(`GLSL compilation errors in ${t}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(z.a.SHADER_TYPE),source:this.getSource()}}}class Ht extends kt{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:z.a.VERTEX_SHADER}))}_createHandle(){return this.gl.createShader(z.a.VERTEX_SHADER)}}class Vt extends kt{constructor(e,t){"string"==typeof t&&(t={source:t}),super(e,Object.assign({},t,{shaderType:z.a.FRAGMENT_SHADER}))}_createHandle(){return this.gl.createShader(z.a.FRAGMENT_SHADER)}}const Xt={[z.a.FLOAT]:(e,t,n)=>e.uniform1fv(t,Yt(n,1)),[z.a.FLOAT_VEC2]:(e,t,n)=>e.uniform2fv(t,Yt(n,2)),[z.a.FLOAT_VEC3]:(e,t,n)=>e.uniform3fv(t,Yt(n,3)),[z.a.FLOAT_VEC4]:(e,t,n)=>e.uniform4fv(t,Yt(n,4)),[z.a.INT]:(e,t,n)=>e.uniform1iv(t,qt(n,1)),[z.a.INT_VEC2]:(e,t,n)=>e.uniform2iv(t,qt(n,2)),[z.a.INT_VEC3]:(e,t,n)=>e.uniform3iv(t,qt(n,3)),[z.a.INT_VEC4]:(e,t,n)=>e.uniform4iv(t,qt(n,4)),[z.a.BOOL]:(e,t,n)=>e.uniform1iv(t,qt(n,1)),[z.a.BOOL_VEC2]:(e,t,n)=>e.uniform2iv(t,qt(n,2)),[z.a.BOOL_VEC3]:(e,t,n)=>e.uniform3iv(t,qt(n,3)),[z.a.BOOL_VEC4]:(e,t,n)=>e.uniform4iv(t,qt(n,4)),[z.a.FLOAT_MAT2]:(e,t,n)=>e.uniformMatrix2fv(t,!1,Yt(n,4)),[z.a.FLOAT_MAT3]:(e,t,n)=>e.uniformMatrix3fv(t,!1,Yt(n,9)),[z.a.FLOAT_MAT4]:(e,t,n)=>e.uniformMatrix4fv(t,!1,Yt(n,16)),[z.a.SAMPLER_2D]:(e,t,n)=>e.uniform1i(t,n),[z.a.SAMPLER_CUBE]:(e,t,n)=>e.uniform1i(t,n),[z.a.UNSIGNED_INT]:(e,t,n)=>e.uniform1uiv(t,Qt(n,1)),[z.a.UNSIGNED_INT_VEC2]:(e,t,n)=>e.uniform2uiv(t,Qt(n,2)),[z.a.UNSIGNED_INT_VEC3]:(e,t,n)=>e.uniform3uiv(t,Qt(n,3)),[z.a.UNSIGNED_INT_VEC4]:(e,t,n)=>e.uniform4uiv(t,Qt(n,4)),[z.a.FLOAT_MAT2x3]:(e,t,n)=>e.uniformMatrix2x3fv(t,!1,Yt(n,6)),[z.a.FLOAT_MAT2x4]:(e,t,n)=>e.uniformMatrix2x4fv(t,!1,Yt(n,8)),[z.a.FLOAT_MAT3x2]:(e,t,n)=>e.uniformMatrix3x2fv(t,!1,Yt(n,6)),[z.a.FLOAT_MAT3x4]:(e,t,n)=>e.uniformMatrix3x4fv(t,!1,Yt(n,12)),[z.a.FLOAT_MAT4x2]:(e,t,n)=>e.uniformMatrix4x2fv(t,!1,Yt(n,8)),[z.a.FLOAT_MAT4x3]:(e,t,n)=>e.uniformMatrix4x3fv(t,!1,Yt(n,12)),[z.a.SAMPLER_3D]:(e,t,n)=>e.uniform1i(t,n),[z.a.SAMPLER_2D_SHADOW]:(e,t,n)=>e.uniform1i(t,n),[z.a.SAMPLER_2D_ARRAY]:(e,t,n)=>e.uniform1i(t,n),[z.a.SAMPLER_2D_ARRAY_SHADOW]:(e,t,n)=>e.uniform1i(t,n),[z.a.SAMPLER_CUBE_SHADOW]:(e,t,n)=>e.uniform1i(t,n),[z.a.INT_SAMPLER_2D]:(e,t,n)=>e.uniform1i(t,n),[z.a.INT_SAMPLER_3D]:(e,t,n)=>e.uniform1i(t,n),[z.a.INT_SAMPLER_CUBE]:(e,t,n)=>e.uniform1i(t,n),[z.a.INT_SAMPLER_2D_ARRAY]:(e,t,n)=>e.uniform1i(t,n),[z.a.UNSIGNED_INT_SAMPLER_2D]:(e,t,n)=>e.uniform1i(t,n),[z.a.UNSIGNED_INT_SAMPLER_3D]:(e,t,n)=>e.uniform1i(t,n),[z.a.UNSIGNED_INT_SAMPLER_CUBE]:(e,t,n)=>e.uniform1i(t,n),[z.a.UNSIGNED_INT_SAMPLER_2D_ARRAY]:(e,t,n)=>e.uniform1i(t,n)},jt={},Wt={},zt={},Kt=[0];function $t(e,t,n,r){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(Kt[0]=e,e=Kt);const i=e.length;if(i%t&&M.warn(`Uniform size should be multiples of ${t}`,e)(),e instanceof n)return e;let s=r[i];s||(s=new n(i),r[i]=s);for(let t=0;t<i;t++)s[t]=e[t];return s}function Yt(e,t){return $t(e,t,Float32Array,jt)}function qt(e,t){return $t(e,t,Int32Array,Wt)}function Qt(e,t){return $t(e,t,Uint32Array,zt)}function Zt(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=e.match(/([^[]*)(\[[0-9]+\])?/);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:t[2]||1,isArray:Boolean(t[2])}}function Jt(e,t,n){const r=Xt[n.type];if(!r)throw new Error(`Unknown GLSL uniform type ${n.type}`);return r.bind(null,e,t)}function en(e){return Array.isArray(e)||ArrayBuffer.isView(e)?function(e){if(0===e.length)return!1;const t=Math.min(e.length,16);for(let n=0;n<t;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e):!!isFinite(e)||(!0===e||!1===e||(e instanceof Ve||(e instanceof qe||e instanceof St&&Boolean(e.texture))))}function tn(e,t){if(Array.isArray(e)||ArrayBuffer.isView(e)){if(!t)return!1;const n=e.length;if(t.length!==n)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}return e===t}const nn=5120,rn=5121,sn=5122,an=5123,on=0,un=1,cn=2,ln=3,fn=4,_n=5,hn=6,dn=5126,En={[dn]:[dn,1,"float"],35664:[dn,2,"vec2"],35665:[dn,3,"vec3"],35666:[dn,4,"vec4"],5124:[5124,1,"int"],35667:[5124,2,"ivec2"],35668:[5124,3,"ivec3"],35669:[5124,4,"ivec4"],5125:[5125,1,"uint"],36294:[5125,2,"uvec2"],36295:[5125,3,"uvec3"],36296:[5125,4,"uvec4"],35670:[dn,1,"bool"],35671:[dn,2,"bvec2"],35672:[dn,3,"bvec3"],35673:[dn,4,"bvec4"],35674:[dn,8,"mat2"],35685:[dn,8,"mat2x3"],35686:[dn,8,"mat2x4"],35675:[dn,12,"mat3"],35687:[dn,12,"mat3x2"],35688:[dn,12,"mat3x4"],35676:[dn,16,"mat4"],35689:[dn,16,"mat4x2"],35690:[dn,16,"mat4x3"]};function gn(e){switch(e){case on:return on;case un:case ln:case cn:return un;case fn:case _n:case hn:return fn;default:return r(!1),0}}function mn(e){const t=En[e];if(!t)return null;const[n,r]=t;return{type:n,components:r}}function pn(e,t){switch(e){case nn:case rn:case sn:case an:e=dn}for(const n in En){const[r,i,s]=En[n];if(r===e&&i===t)return{glType:n,name:s}}return null}class An{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const t=Number(e);return Number.isFinite(t)?this.attributeInfosByLocation[t]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const t=this.getAttributeInfo(e);return t?t.location:-1}getAttributeAccessor(e){const t=this.getAttributeInfo(e);return t?t.accessor:null}getVaryingInfo(e){const t=Number(e);return Number.isFinite(t)?this.varyingInfos[t]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const t=this.getVaryingInfo();return t?t.location:-1}getVaryingAccessor(e){const t=this.getVaryingInfo();return t?t.accessor:null}_readAttributesFromProgram(e){const{gl:t}=e,n=t.getProgramParameter(e.handle,t.ACTIVE_ATTRIBUTES);for(let r=0;r<n;r++){const{name:n,type:i,size:s}=t.getActiveAttrib(e.handle,r),a=t.getAttribLocation(e.handle,n);a>=0&&this._addAttribute(a,n,i,s)}this.attributeInfos.sort((e,t)=>e.location-t.location)}_readVaryingsFromProgram(e){const{gl:t}=e;if(!o(t))return;const n=t.getProgramParameter(e.handle,t.TRANSFORM_FEEDBACK_VARYINGS);for(let r=0;r<n;r++){const{name:n,type:i,size:s}=t.getTransformFeedbackVarying(e.handle,r);this._addVarying(r,n,i,s)}this.varyingInfos.sort((e,t)=>e.location-t.location)}_addAttribute(e,t,n,r){const{type:i,components:s}=mn(n),a={type:i,size:r*s};this._inferProperties(e,t,a);const o={location:e,name:t,accessor:new Ne(a)};this.attributeInfos.push(o),this.attributeInfosByLocation[e]=o,this.attributeInfosByName[o.name]=o}_inferProperties(e,t,n){/instance/i.test(t)&&(n.divisor=1)}_addVarying(e,t,n,r){const{type:i,components:s}=mn(n),a={location:e,name:t,accessor:new Ne({type:i,size:r*s})};this.varyingInfos.push(a),this.varyingInfosByName[a.name]=a}}const Tn=4,Rn=35981,vn=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class bn extends me{constructor(e,t={}){super(e,t),this.stubRemovedMethods("Program","v6.0",vn),this._isCached=!1,this.initialize(t),Object.seal(this),this._setId(t.id)}initialize(e={}){const{hash:t,vs:n,fs:i,varyings:s,bufferMode:a=Rn}=e;return this.hash=t||"",this.vs="string"==typeof n?new Ht(this.gl,{id:`${e.id}-vs`,source:n}):n,this.fs="string"==typeof i?new Vt(this.gl,{id:`${e.id}-fs`,source:i}):i,r(this.vs instanceof Ht),r(this.fs instanceof Vt),this.uniforms={},s&&s.length>0&&(c(this.gl),this.varyings=s,this.gl.transformFeedbackVaryings(this.handle,s,a)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new An(this),this.setProps(e)}delete(e={}){return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw({logPriority:e,drawMode:t=z.a.TRIANGLES,vertexCount:n,offset:i=0,start:s,end:a,isIndexed:u=!1,indexType:c=z.a.UNSIGNED_SHORT,isInstanced:l=!1,instanceCount:f=0,vertexArray:_=null,transformFeedback:h,framebuffer:d,parameters:E={},uniforms:g,samplers:m}){if((g||m)&&(M.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(g||{})),void 0!==e){const r=d?d.id:"default",i=`mode=${le(this.gl,t)} verts=${n} `+`instances=${f} indexType=${le(this.gl,c)} `+`isInstanced=${l} isIndexed=${u} `+`Framebuffer=${r}`;M.log(e,i)()}return r(_),this.gl.useProgram(this.handle),!!this._areTexturesRenderable()&&(_.bindForDraw(n,f,()=>{if(void 0!==d&&(E=Object.assign({},E,{framebuffer:d})),h){const e=gn(t);h.begin(e)}this._bindTextures(),ke(this.gl,E,()=>{u&&l?this.gl.drawElementsInstanced(t,n,c,i,f):u&&o(this.gl)&&!isNaN(s)&&!isNaN(a)?this.gl.drawRangeElements(t,s,a,n,c,i):u?this.gl.drawElements(t,n,c,i):l?this.gl.drawArraysInstanced(t,i,n,f):this.gl.drawArrays(t,i,n)}),h&&h.end()}),!0)}setUniforms(e={},t=(()=>{})){let n=!1;const r={};for(const t in e)tn(this.uniforms[t],e[t])||(n=!0,r[t]=e[t],this.uniforms[t]=(i=e[t],Array.isArray(i)||ArrayBuffer.isView(i)?i.slice():i));var i;return n&&(t(),function(e,t,n){for(const r in e){const i=e[r];if((!n||Boolean(n[r]))&&!en(i))throw t=t?`${t} `:"",console.error(`${t} Bad uniform ${r}`,i),new Error(`${t} Bad uniform ${r}`)}}(r,this.id,this._uniformSetters),this._setUniforms(r)),this}reset(){}_areTexturesRenderable(){let e=!0;for(const t in this.uniforms){const n=this._uniformSetters[t];if(n&&void 0!==n.textureIndex){let n=this.uniforms[t];if(n instanceof St){n=n.texture}if(n instanceof Ve){const t=n;e=e&&t.loaded}}}return e}_bindTextures(){for(const e in this.uniforms){const t=this._uniformSetters[e];if(t&&void 0!==t.textureIndex){let n=this.uniforms[e];if(n instanceof St&&(n=n.texture),n instanceof Ve){n.bind(t.textureIndex)}}}}_setUniforms(e){this.gl.useProgram(this.handle);for(const t in e){let n=e[t];const r=this._uniformSetters[t];if(r)if(n instanceof St&&(n=n.texture),n instanceof Ve){void 0===r.textureIndex&&(r.textureIndex=this._textureIndexCounter++);const e=n,{textureIndex:t}=r;e.bind(t),r(t)}else r(n)}return this}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const t=this.gl.getAttachedShaders(e),n={};for(const e of t){switch(this.gl.getShaderParameter(this.handle,z.a.SHADER_TYPE)){case z.a.VERTEX_SHADER:n.vs=new Ht({handle:e});break;case z.a.FRAGMENT_SHADER:n.fs=new Vt({handle:e})}}return n}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const e=this._getName();this.id=_e(e)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=(e=e.replace(/shader/i,""))?`${e}-program`:"program"}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),M.time(Tn,`linkProgram for ${this._getName()}`)(),e.linkProgram(this.handle),M.timeEnd(Tn,`linkProgram for ${this._getName()}`)(),e.debug||M.priority>0){if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,e.LINK_STATUS))throw new Error(`Error linking: ${e.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(z.a.ACTIVE_UNIFORMS);for(let t=0;t<this._uniformCount;t++){const n=this.gl.getActiveUniform(this.handle,t),{name:r,isArray:i}=Zt(n.name);let s=e.getUniformLocation(this.handle,r);if(this._uniformSetters[r]=Jt(e,s,n),n.size>1)for(let t=0;t<n.size;t++)s=e.getUniformLocation(this.handle,`${r}[${t}]`),this._uniformSetters[`${r}[${t}]`]=Jt(e,s,n)}this._textureIndexCounter=0}getActiveUniforms(e,t){return this.gl.getActiveUniforms(this.handle,e,t)}getUniformBlockIndex(e){return this.gl.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,t){return this.gl.getActiveUniformBlockParameter(this.handle,e,t)}uniformBlockBinding(e,t){this.gl.uniformBlockBinding(this.handle,e,t)}}const In=34918,Nn=34919,Sn=35007,Fn=36795,Ln=35976,On=35887,yn=36202;class Cn extends me{static isSupported(e,t=[]){const n=o(e),i=vt(e,Lt.TIMER_QUERY);let s=n||i;for(const e of t)switch(e){case"queries":s=s&&n;break;case"timers":s=s&&i;break;default:r(!1)}return s}constructor(e,t={}){super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(Sn)}beginOcclusionQuery({conservative:e=!1}={}){return this.begin(e?yn:On)}beginTransformFeedbackQuery(){return this.begin(Ln)}begin(e){return this._queryPending?this:(this.target=e,this.gl.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl.getQueryParameter(this.handle,Nn);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl.getParameter(Fn)}getResult(){return this.gl.getQueryParameter(this.handle,In)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((n,r)=>{const i=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(r("Timed out"),this._pollingPromise=null):requestAnimationFrame(i)};requestAnimationFrame(i)}),this._pollingPromise}_createHandle(){return Cn.isSupported(this.gl)?this.gl.createQuery():null}_deleteHandle(){this.gl.deleteQuery(this.handle)}}class Mn extends me{static isSupported(e){return o(e)}constructor(e,t={}){c(e),super(e,t),this.initialize(t),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(e={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,de(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(e={}){return this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])}),this}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:r,byteSize:i,byteOffset:s}=this._getBufferParams(t);return n<0?(this.unused[e]=r,M.warn(()=>`${this.id} unused varying buffer ${e}`)(),this):(this.buffers[n]=t,this.bindOnUse||this._bindBuffer(n,r,s,i),this)}begin(e=z.a.POINTS){return this.gl.bindTransformFeedback(z.a.TRANSFORM_FEEDBACK,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(z.a.TRANSFORM_FEEDBACK,null),this}_getBufferParams(e){let t,n,r;return e instanceof ye==!1?(r=e.buffer,n=e.byteSize,t=e.byteOffset):r=e,void 0===t&&void 0===n||(t=t||0,n=n||r.byteLength-t),{buffer:r,byteOffset:t,byteSize:n}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const t=Number(e);return Number.isFinite(t)?t:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:t,byteSize:n,byteOffset:r}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,t,r,n)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,t,n=0,r){const i=t&&t.handle;return i&&void 0!==r?this.gl.bindBufferRange(z.a.TRANSFORM_FEEDBACK_BUFFER,e,i,n,r):this.gl.bindBufferBase(z.a.TRANSFORM_FEEDBACK_BUFFER,e,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(z.a.TRANSFORM_FEEDBACK,this.handle)}}let Pn=null;function Bn(e,t){var n;return new e((n=e.BYTES_PER_ELEMENT*t,(!Pn||Pn.byteLength<n)&&(Pn=new ArrayBuffer(n)),Pn),0,t)}var Dn=n(21);const xn="OES_vertex_array_object",Un="elements must be GL.ELEMENT_ARRAY_BUFFER";class wn extends me{static isSupported(e,t={}){return t.constantAttributeZero?o(e)||"Chrome"===function(e){if(!e&&!Object(m.a)())return"Node";if(Object(Dn.a)(e))return"Electron";var t="undefined"!=typeof navigator?navigator:{},n=e||t.userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";var r=-1!==n.indexOf("MSIE "),i=-1!==n.indexOf("Trident/");return r||i?"IE":N.b.chrome?"Chrome":N.b.safari?"Safari":N.b.mozInnerScreenX?"Firefox":"Unknown"}():o(e)||e.getExtension(xn)}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new wn(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return wn.MAX_ATTRIBUTES=wn.MAX_ATTRIBUTES||e.getParameter(e.MAX_VERTEX_ATTRIBS),wn.MAX_ATTRIBUTES}static setConstant(e,t,n){switch(n.constructor){case Float32Array:wn._setConstantFloatArray(e,t,n);break;case Int32Array:wn._setConstantIntArray(e,t,n);break;case Uint32Array:wn._setConstantUintArray(e,t,n);break;default:r(!1)}}constructor(e,t={}){const n=t.id||t.program&&t.program.id;super(e,Object.assign({},t,{id:n})),this.hasVertexArrays=wn.isSupported(e),this.buffer=null,this.bufferValue=null,this.initialize(t),Object.seal(this)}delete(){super.delete(),this.buffer&&this.buffer.delete()}get MAX_ATTRIBUTES(){return wn.getMaxAttributes(this.gl)}initialize(e={}){return this.setProps(e)}setProps(e){return this}setElementBuffer(e=null,t={}){return r(!e||e.target===z.a.ELEMENT_ARRAY_BUFFER,Un),this.bind(()=>{this.gl.bindBuffer(z.a.ELEMENT_ARRAY_BUFFER,e?e.handle:null)}),this}setBuffer(e,t,n){if(t.target===z.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(t,n);const{size:i,type:s,stride:a,offset:u,normalized:c,integer:l,divisor:f}=n,{gl:_}=this;return e=Number(e),this.bind(()=>{_.bindBuffer(_.ARRAY_BUFFER,t.handle),l?(r(o(_)),_.vertexAttribIPointer(e,i,s,a,u)):_.vertexAttribPointer(e,i,s,c,a,u),_.enableVertexAttribArray(e),_.vertexAttribDivisor(e,f||0)}),this}enable(e,t=!0){return!t&&0===e&&!wn.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,t,n){const r=this._normalizeConstantArrayValue(t,n),i=r.byteLength*e,s=r.length*e;let a=!this.buffer;if(this.buffer=this.buffer||new ye(this.gl,i),a=(a=a||this.buffer.reallocate(i))||!this._compareConstantArrayValues(r,this.bufferValue)){const e=Bn(t.constructor,s);!function({target:e,source:t,start:n=0,count:r=1}){const i=t.length,s=r*i;let a=0;for(let r=n;a<i;a++)e[r++]=t[a];for(;a<s;)a<s-a?(e.copyWithin(n+a,n,n+a),a*=2):(e.copyWithin(n+a,n,n+s-a),a=s)}({target:e,source:r,start:0,count:s}),this.buffer.subData(e),this.bufferValue=t}return this.buffer}_normalizeConstantArrayValue(e,t){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}static _setConstantFloatArray(e,t,n){switch(n.length){case 1:e.vertexAttrib1fv(t,n);break;case 2:e.vertexAttrib2fv(t,n);break;case 3:e.vertexAttrib3fv(t,n);break;case 4:e.vertexAttrib4fv(t,n);break;default:r(!1)}}static _setConstantIntArray(e,t,n){switch(r(o(e)),n.length){case 1:e.vertexAttribI1iv(t,n);break;case 2:e.vertexAttribI2iv(t,n);break;case 3:e.vertexAttribI3iv(t,n);break;case 4:e.vertexAttribI4iv(t,n);break;default:r(!1)}}static _setConstantUintArray(e,t,n){switch(r(o(e)),n.length){case 1:e.vertexAttribI1uiv(t,n);break;case 2:e.vertexAttribI2uiv(t,n);break;case 3:e.vertexAttribI3uiv(t,n);break;case 4:e.vertexAttribI4uiv(t,n);break;default:r(!1)}}_createHandle(){return this.hasVertexArrays=wn.isSupported(this.gl),this.hasVertexArrays?this.gl.createVertexArray():null}_deleteHandle(e){return this.hasVertexArrays&&this.gl.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.hasVertexArrays&&this.gl.bindVertexArray(e)}_getParameter(e,{location:t}){return r(Number.isFinite(t)),this.bind(()=>{switch(e){case z.a.VERTEX_ATTRIB_ARRAY_POINTER:return this.gl.getVertexAttribOffset(t,e);default:return this.gl.getVertexAttrib(t,e)}})}}const Gn="VertexArray: attributes must be Buffers or constants (i.e. typed array)",kn=/^(.+)__LOCATION_([0-9]+)$/,Hn=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class Vn{constructor(e,t={}){const n=t.id||t.program&&t.program.id;this.id=n,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=wn.isSupported(e)?new wn(e):wn.getDefaultArray(e),Ee(this,"VertexArray","v6.0",Hn),this.initialize(t),Object.seal(this)}delete(){this.buffer&&this.buffer.delete()}initialize(e={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(e){return this.drawParams=this.drawParams||this._updateDrawParams(),Object.assign({},this.drawParams,e)}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const t in e){const n=e[t];this._setAttribute(t,n)}this.gl.bindBuffer(z.a.ARRAY_BUFFER,null)}),this}setElementBuffer(e=null,t={}){return this.elements=e,this.elementsAccessor=t,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setElementBuffer(e,t),this}setBuffer(e,t,n={}){if(t.target===z.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(t,n);const{location:r,accessor:i}=this._resolveLocationAndAccessor(e,t,t.accessor,n);return r>=0&&(this.values[r]=t,this.accessors[r]=i,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setBuffer(r,t,i)),this}setConstant(e,t,n={}){const{location:r,accessor:i}=this._resolveLocationAndAccessor(e,t,Object.assign({size:t.length},n));return r>=0&&(t=this.vertexArrayObject._normalizeConstantArrayValue(t,i),this.values[r]=t,this.accessors[r]=i,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.enable(r,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&(this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setElementBuffer(null)),this.buffer=this.buffer||new ye(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof ye&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(z.a.ARRAY_BUFFER,this.buffer.handle),this.gl.vertexAttribPointer(e,1,z.a.FLOAT,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const t=this.values[e];t instanceof ye&&this.setBuffer(e,t)}}),this}bindForDraw(e,t,n){let r;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,t),this.vertexArrayObject.hasVertexArrays||this.bindBuffers(),r=n(),this.vertexArrayObject.hasVertexArrays||this.unbindBuffers()}),r}_resolveLocationAndAccessor(e,t,n,i){const{location:s,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(s)||s<0)return this.unused[e]=t,M.once(3,()=>`unused value ${e} in ${this.id}`)(),this;const o=this._getAttributeInfo(a||s);if(!o)return{location:-1,accessor:null};const u=Ne.resolve(o.accessor,n,i),{size:c,type:l}=u;return r(Number.isFinite(c)&&Number.isFinite(l)),{location:s,accessor:u}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const t=Number(e);if(Number.isFinite(t))return{location:t};const n=kn.exec(e),r=n?n[1]:e,i=n?Number(n[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(r)+i,name:r}:{location:-1}}_setAttribute(e,t){if(t instanceof ye)this.setBuffer(e,t);else if(Array.isArray(t)&&t.length&&t[0]instanceof ye){const n=t[0],r=t[1];this.setBuffer(e,n,r)}else if(ArrayBuffer.isView(t)||Array.isArray(t)){const n=t;this.setConstant(e,n)}else{if(!(t.buffer instanceof ye))throw new Error(Gn);{const n=t;this.setBuffer(e,n.buffer,n)}}}_setConstantAttributes(e,t){const n=Math.max(0|e,0|t);let r=this.values[0];ArrayBuffer.isView(r)&&this._setConstantAttributeZero(r,n);for(let e=1;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)r=this.values[e],ArrayBuffer.isView(r)&&this._setConstantAttribute(e,r)}_setConstantAttributeZero(e,t){if(wn.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,e);const n=this.vertexArrayObject.getConstantBuffer(t,e);this.vertexArrayObject.setBuffer(0,n,this.accessors[0])}_setConstantAttribute(e,t){wn.setConstant(this.gl,e,t),this.vertexArrayObject.isDefaultArray&&this.vertexArrayObject.enable(e,!1)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this._updateDrawParamsForLocation(e,t);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,t){const n=this.values[t],r=this.accessors[t];if(!n)return;const{divisor:i}=r,s=i>0;if(e.isInstanced=e.isInstanced||s,n instanceof ye){const t=n;if(s){const n=t.getVertexCount(r);e.instanceCount=Math.min(e.instanceCount,n)}else{const n=t.getVertexCount(r);e.vertexCount=Math.min(e.vertexCount,n)}}}setElements(e=null,t={}){return M.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,t)}}const Xn="UniformBufferLayout illegal argument",jn=5126,Wn=5124,zn=5125;class Kn{constructor(e){this.layout={},this.size=0;for(const t in e)this._addUniform(t,e[t]);this.size+=(4-this.size%4)%4;const t=new Float32Array(this.size);this.typedArray={[jn]:t,[Wn]:new Int32Array(t.buffer),[zn]:new Uint32Array(t.buffer)}}getBytes(){return 4*this.size}getData(){return this.typedArray[jn]}getSubData(e){let t,n;if(void 0===e)t=this.data,n=0;else{const r=this.offsets[e],i=r+this.sizes[e];t=this.data.subarray(r,i),n=4*r}return{data:t,offset:n}}setUniforms(e){for(const t in e)this._setValue(t,e[t]);return this}_setValue(e,t){const n=this.layout[e];r(n,"UniformLayoutStd140 illegal argument");const i=this.typedArray[n.type];1===n.size?i[n.offset]=t:i.set(t,n.offset)}_addUniform(e,t){const n=mn(t);r(n,Xn);const{type:i,components:s}=n;this.size=this._alignTo(this.size,s);const a=this.size;this.size+=s,this.layout[e]={type:i,size:s,offset:a}}_alignTo(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}}const $n={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Yn{static get DRAW_MODE(){return $n}constructor(e={}){const{id:t=_e("geometry"),drawMode:n=$n.TRIANGLES,attributes:r={},indices:i=null,vertexCount:s=null}=e;this.id=t,this.drawMode=0|n,this.attributes={},this.userData={},this._setAttributes(r,i),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){t&&(this.indices=ArrayBuffer.isView(t)?{value:t,size:1}:t);for(const t in e){let n=e[t];n=ArrayBuffer.isView(n)?{value:n}:n,r(ArrayBuffer.isView(n.value),`${this._print(t)}: must be typed array or object with value as typed array`),"POSITION"!==t&&"positions"!==t||n.size||(n.size=3),"indices"===t?(r(!this.indices),this.indices=n):this.attributes[t]=n}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const t in e){const r=e[t],{value:i,size:s,constant:a}=r;!a&&i&&s>=1&&(n=Math.min(n,i.length/s))}return r(Number.isFinite(n)),n}}class qn{}function Qn(e,t){return!t||"object"!==Object(_.a)(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zn(e){return(Zn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jn(e,t){return(Jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function er(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jn(e,t)}function tr(e,t,n){return(tr=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&Jn(i,n.prototype),i}).apply(null,arguments)}function nr(e){var t="function"==typeof Map?new Map:void 0;return(nr=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return tr(e,arguments,Zn(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Jn(r,e)})(e)}function rr(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}Math.PI,Math.PI;var ir={};function sr(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).precision,n=void 0===t?ir.precision||4:t;return e=function(e){return Math.round(e/ir.EPSILON)*ir.EPSILON}(e),"".concat(parseFloat(e.toPrecision(n)))}function ar(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&void 0!==e.length}function or(e,t,n){var r=ir.EPSILON;n&&(ir.EPSILON=n);try{if(e===t)return!0;if(ar(e)&&ar(t)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(!or(e[i],t[i]))return!1;return!0}return e&&"object"===Object(_.a)(e)&&e.equals?e.equals(t):t&&"object"===Object(_.a)(t)&&t.equals?t.equals(e):Math.abs(e-t)<=ir.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{ir.EPSILON=r}}ir.EPSILON=1e-12,ir.debug=!1,ir.precision=4,ir.printTypes=!1,ir.printDegrees=!1,ir.printRowMajor=!0;var ur=function(e){function t(){return d(this,t),Qn(this,Zn(t).apply(this,arguments))}return er(t,nr(Array)),g(t,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}},{key:"to",value:function(e){return e===this?this:ar(e)?this.toArray(e):this.toObject(e)}},{key:"toTarget",value:function(e){return e?this.to(e):this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(ir)}},{key:"formatString",value:function(e){for(var t="",n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+sr(this[n],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}},{key:"equals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(!or(this[t],e[t]))return!1;return!0}},{key:"exactEquals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}},{key:"negate",value:function(){for(var e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}},{key:"lerp",value:function(e,t,n){void 0===n&&(n=t,t=e,e=this);for(var r=0;r<this.ELEMENTS;++r){var i=e[r];this[r]=i+n*(t[r]-i)}return this.check()}},{key:"min",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}},{key:"max",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}},{key:"clamp",value:function(e,t){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++)for(var s=i[r],a=0;a<this.ELEMENTS;++a)this[a]+=s[a];return this.check()}},{key:"subtract",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++)for(var s=i[r],a=0;a<this.ELEMENTS;++a)this[a]-=s[a];return this.check()}},{key:"scale",value:function(e){if(Array.isArray(e))return this.multiply(e);for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"sub",value:function(e){return this.subtract(e)}},{key:"setScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}},{key:"addScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}},{key:"subScalar",value:function(e){return this.addScalar(-e)}},{key:"multiplyScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"divideScalar",value:function(e){return this.scale(1/e)}},{key:"clampScalar",value:function(e,t){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}},{key:"multiplyByScalar",value:function(e){return this.scale(e)}},{key:"check",value:function(){if(ir.debug&&!this.validate(this))throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var e=this.length===this.ELEMENTS,t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}},{key:"elements",get:function(){return this}}]),t}();function cr(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(e));return e}function lr(e,t,n){if(ir.debug&&!function(e,t){if(e.length!==t)return!1;for(var n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}(e,t))throw new Error("math.gl: ".concat(""|n," some fields set to invalid numbers'"));return e}var fr={};function _r(e,t){fr[e]||(fr[e]=!0,console.warn("".concat(e," has been removed in version ").concat(t,", see upgrade guide for more information")))}var hr=function(e){function t(){return d(this,t),Qn(this,Zn(t).apply(this,arguments))}return er(t,ur),g(t,[{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var e=0,t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(e){return Math.sqrt(this.distanceSquared(e))}},{key:"distanceSquared",value:function(e){for(var t=0,n=0;n<this.ELEMENTS;++n){var r=this[n]-e[n];t+=r*r}return cr(t)}},{key:"dot",value:function(e){for(var t=0,n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return cr(t)}},{key:"normalize",value:function(){var e=this.magnitude();if(0!==e)for(var t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}},{key:"multiply",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++)for(var s=i[r],a=0;a<this.ELEMENTS;++a)this[a]*=s[a];return this.check()}},{key:"divide",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++)for(var s=i[r],a=0;a<this.ELEMENTS;++a)this[a]/=s[a];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(e){return this.distance(e)}},{key:"distanceToSquared",value:function(e){return this.distanceSquared(e)}},{key:"getComponent",value:function(e){return rr(e>=0&&e<this.ELEMENTS,"index is out of range"),cr(this[e])}},{key:"setComponent",value:function(e,t){return rr(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}},{key:"addVectors",value:function(e,t){return this.copy(e).add(t)}},{key:"subVectors",value:function(e,t){return this.copy(e).subtract(t)}},{key:"multiplyVectors",value:function(e,t){return this.copy(e).multiply(t)}},{key:"addScaledVector",value:function(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}},{key:"x",get:function(){return this[0]},set:function(e){return this[0]=cr(e)}},{key:"y",get:function(){return this[1]},set:function(e){return this[1]=cr(e)}}]),t}(),dr=1e-6,Er="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function gr(e,t,n){var r=new Er(3);return r[0]=e,r[1]=t,r[2]=n,r}function mr(e,t){var n=t[0],r=t[1],i=t[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function pr(e,t,n){var r=t[0],i=t[1],s=t[2],a=n[3]*r+n[7]*i+n[11]*s+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/a,e}var Ar,Tr;Ar=new Er(3),Er!=Float32Array&&(Ar[0]=0,Ar[1]=0,Ar[2]=0),Tr=Ar;function Rr(e,t,n){var r=t[0],i=t[1],s=t[2],a=n[3]*r+n[7]*i+n[11]*s||1;return e[0]=(n[0]*r+n[4]*i+n[8]*s)/a,e[1]=(n[1]*r+n[5]*i+n[9]*s)/a,e[2]=(n[2]*r+n[6]*i+n[10]*s)/a,e}var vr=[0,0,0],br=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return d(this,t),e=Qn(this,Zn(t).call(this,-0,-0,-0)),1===arguments.length&&ar(n)?e.copy(n):(ir.debug&&(cr(n),cr(r),cr(i)),e[0]=n,e[1]=r,e[2]=i),e}return er(t,hr),g(t,[{key:"set",value:function(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}},{key:"fromObject",value:function(e){return ir.debug&&(cr(e.x),cr(e.y),cr(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}},{key:"toObject",value:function(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}},{key:"angle",value:function(e){return function(e,t){var n=gr(e[0],e[1],e[2]),r=gr(t[0],t[1],t[2]);mr(n,n),mr(r,r);var i=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}(this,e)}},{key:"cross",value:function(e){return function(e,t,n){var r=t[0],i=t[1],s=t[2],a=n[0],o=n[1],u=n[2];e[0]=i*u-s*o,e[1]=s*a-r*u,e[2]=r*o-i*a}(this,this,e),this.check()}},{key:"rotateX",value:function(e){var t=e.radians,n=e.origin;return function(e,t,n,r){var i=[],s=[];i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,void 0===n?vr:n,t),this.check()}},{key:"rotateY",value:function(e){var t=e.radians,n=e.origin;return function(e,t,n,r){var i=[],s=[];i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,void 0===n?vr:n,t),this.check()}},{key:"rotateZ",value:function(e){var t=e.radians,n=e.origin;return function(e,t,n,r){var i=[],s=[];i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,void 0===n?vr:n,t),this.check()}},{key:"transform",value:function(e){return this.transformAsPoint(e)}},{key:"transformAsPoint",value:function(e){return pr(this,this,e),this.check()}},{key:"transformAsVector",value:function(e){return Rr(this,this,e),this.check()}},{key:"transformByMatrix3",value:function(e){return function(e,t,n){var r=t[0],i=t[1],s=t[2];e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8]}(this,this,e),this.check()}},{key:"transformByMatrix2",value:function(e){return function(e,t,n){var r=t[0],i=t[1];e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e[2]=t[2]}(this,this,e),this.check()}},{key:"transformByQuaternion",value:function(e){return function(e,t,n){var r=n[0],i=n[1],s=n[2],a=n[3],o=t[0],u=t[1],c=t[2],l=i*c-s*u,f=s*o-r*c,_=r*u-i*o,h=i*_-s*f,d=s*l-r*_,E=r*f-i*l,g=2*a;l*=g,f*=g,_*=g,h*=2,d*=2,E*=2,e[0]=o+l+h,e[1]=u+f+d,e[2]=c+_+E}(this,this,e),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(e){return this[2]=cr(e)}}]),t}();const Ir=[255,255,255],Nr=1,Sr=[0,0,1],Fr=[0,0,-1],Lr=[0,0,1];class Or{constructor(e={}){this.id=e.id||_e("light");const{color:t=Ir}=e;this.color=t;const{intensity:n=Nr}=e;this.intensity=n}}class yr extends Or{constructor(e={}){super(e),this.type="ambient"}}class Cr extends Or{constructor(e={}){super(e),this.type="directional";const{direction:t=Fr}=e;this.direction=new br(t).normalize().toArray()}}class Mr extends Or{constructor(e={}){super(e),this.type="point";const{position:t=Lr}=e;this.position=t,this.attenuation=this._getAttenuation(e)}_getAttenuation(e){return"attenuation"in e?e.attenuation:"intensity"in e?[0,0,e.intensity]:Sr}}function Pr(e){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function Br(e){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}let Dr=0;class xr{constructor(e={}){const{onCreateContext:t=(e=>te(e)),onAddHTML:n=null,onInitialize:r=(()=>{}),onRender:i=(()=>{}),onFinalize:s=(()=>{}),gl:a=null,glOptions:o={},debug:u=!1,createFramebuffer:c=!1,autoResizeViewport:l=!0,autoResizeDrawingBuffer:f=!0,stats:_=D.get(`animation-loop-${Dr++}`)}=e;let{useDevicePixels:h=!0}=e;"useDevicePixelRatio"in e&&(M.deprecated("useDevicePixelRatio","useDevicePixels")(),h=e.useDevicePixelRatio),this.props={onCreateContext:t,onAddHTML:n,onInitialize:r,onRender:i,onFinalize:s,gl:a,glOptions:o,debug:u,createFramebuffer:c},this.gl=a,this.needsRedraw=null,this.timeline=null,this.stats=_,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:l,autoResizeDrawingBuffer:f,useDevicePixels:h}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return r("string"==typeof e),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){return this._running?this:(this._running=!0,X().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=Cn.isSupported(this.gl,["timers"])?new Cn(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(e=>{this._running&&(this._addCallbackData(e||{}),!1!==e&&this._startLoop())}),this)}redraw(){return this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this}stop(){return this._running&&(this._finalizeCallbackData(),Br(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}onCreateContext(...e){return this.props.onCreateContext(...e)}onInitialize(...e){return this.props.onInitialize(...e)}onRender(...e){return this.props.onRender(...e)}onFinalize(...e){return this.props.onFinalize(...e)}getHTMLControlValue(e,t=1){const n=document.getElementById(e);return n?Number(n.value):t}setViewParameters(){return M.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};Br(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(e){this.display&&this.display.requestAnimationFrame(e)||Pr(e)}_renderFrame(...e){this.display?this.display._renderFrame(...e):this.onRender(...e)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._onSetupFrame?this._onSetupFrame(this.animationProps):(this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer())}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){"object"==typeof e&&null!==e&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&"undefined"!=typeof OffscreenCanvas&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?ne(this.props.gl,e):this.onCreateContext(e),!a(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");Object(Be.d)(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,t=this.gl.drawingBufferHeight;let n=1;const{canvas:r}=this.gl;return r&&r.clientHeight?n=r.clientWidth/r.clientHeight:e>0&&t>0&&(n=e/t),{width:e,height:t,aspect:n}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&ie(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new St(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const Ur=new Uint8Array([0,0,0]);function wr(e){return[e+1&255,e+1>>8&255,e+1>>16&255]}function Gr(e){const[t,n,r]=e;return t+256*n+65536*r-1}function kr(){return Ur}const Hr={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function Vr(e,t){const{attributeMap:n=Hr}=t||{};return n&&n[e]||e}function Xr(e,t){let n;switch(e){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors"}switch(n){case"vectors":t.size=t.size||3;break;case"uvs":t.size=t.size||2}r(Number.isFinite(t.size),`attribute ${e} needs size`)}const jr="vs",Wr="fs";function zr(e,t,n){switch(t){case 300:return n?function(e){return e.replace(/attribute\s+/g,"in ").replace(/varying\s+/g,"out ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(+/g,"texture(").replace(/texture2DLodEXT\(/g,"textureLod(").replace(/textureCubeLodEXT\(/g,"textureLod(")}(e):function(e){return e.replace(/varying\s+/g,"in ").replace(/texture2D\(/g,"texture(").replace(/textureCube\(/g,"texture(").replace(/texture2DLodEXT\(/g,"textureLod(").replace(/textureCubeLodEXT\(/g,"textureLod(")}(e);case 100:return n?function(e){return e.replace(/^in\s+/gm,"attribute ").replace(/^out\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(e):function(e){return e.replace(/^in\s+/gm,"varying ").replace(/texture\(/g,"texture2D(")}(e);default:throw new Error(`unknown GLSL version ${t}`)}}function Kr(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}const $r={number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},array:{validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function Yr(e){let t=qr(e);return"object"===t?e?"type"in e?Object.assign({},e,$r[e.type]):"value"in e?(t=qr(e.value),Object.assign({type:t},e,$r[t])):{type:"object",value:e}:{type:"object",value:null}:Object.assign({type:t,value:e},$r[t])}function qr(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const Qr="vs",Zr="fs";class Jr{constructor({name:e,vs:t,fs:n,dependencies:r=[],uniforms:i,getUniforms:s,deprecations:a=[],defines:o={},vertexShader:u,fragmentShader:c}){Kr("string"==typeof e),this.name=e,this.vs=t||u,this.fs=n||c,this.getModuleUniforms=s,this.dependencies=r,this.deprecations=this._parseDeprecationDefinitions(a),this.defines=o,i&&(this.uniforms=function(e){const t={};for(const n in e){const r=Yr(e[n]);t[n]=r}return t}(i))}getModuleSource(e,t){let n;switch(e){case Qr:n=zr(this.vs||"",t,!0);break;case Zr:n=zr(this.fs||"",t,!1);break;default:Kr(!1)}return`#define MODULE_${this.name.toUpperCase()}\n${n}// END MODULE_${this.name}\n\n`}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach(n=>{n.regex.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())})}_parseDeprecationDefinitions(e){return e.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),e}_defaultGetUniforms(e={}){const t={},n=this.uniforms;for(const r in n){const i=n[r];r in e&&!i.private?(i.validate&&Kr(i.validate(e[r],i),`${this.name}: invalid ${r}`),t[r]=e[r]):t[r]=i.value}return t}}function ei(e){if(!e.normalized&&(e.normalized=!0,e.uniforms&&!e.getUniforms)){const t=new Jr(e);e.getUniforms=t.getUniforms.bind(t)}return e}const ti=new class{constructor(){this.shaderModules={},this.defaultShaderModules=[]}setDefaultShaderModules(e){this.defaultShaderModules=this.resolveModules(e)}getDefaultShaderModules(){return this.defaultShaderModules}registerShaderModules(e,{ignoreMultipleRegistrations:t=!1}={}){for(const n of e)this._registerShaderModule(n,t)}getShaderModule(e){if(e instanceof Jr)return e;if("string"!=typeof e)return this._registerShaderModule(e,!0);const t=this.shaderModules[e];return t||Kr(!1,`Unknown shader module ${e}`),t}resolveModules(e){return e.map(e=>this.getShaderModule(e))}_registerShaderModule(e,t=!1){if(e instanceof Jr)return e;if(Kr(e.name,"shader module has no name"),this.shaderModules[e.name]&&!t)throw new Error(`shader module ${e.name} already registered`);return(e=new Jr(e)).dependencies=this.resolveModules(e.dependencies),this.shaderModules[e.name]=e,this.shaderModules[e.name]}};function ni(e){ti.setDefaultShaderModules(e)}function ri(){return ti.getDefaultShaderModules()}function ii(e,{ignoreMultipleRegistrations:t=!1}={}){ti.registerShaderModules(e,{ignoreMultipleRegistrations:t})}function si(e){const t={},n={};return ai({modules:e,level:0,moduleMap:t,moduleDepth:n}),Object.keys(n).sort((e,t)=>n[t]-n[e]).map(e=>t[e])}function ai({modules:e,level:t,moduleMap:n,moduleDepth:r}){if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const i of e)n[i.name]=i,(void 0===r[i.name]||r[i.name]<t)&&(r[i.name]=t);for(const i of e)i.dependencies&&ai({modules:i.dependencies,level:t+1,moduleMap:n,moduleDepth:r})}const oi=7936,ui=7937,ci=7938,li=35724,fi={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},_i={};Object.keys(fi).forEach(e=>{_i[e]=e});const hi={};function di(e,t,n={}){const r=fi[t];if(Kr(r,t),!function(e={}){const t="undefined"!=typeof window&&window.navigator||{},n=e.userAgent||t.userAgent||"",r=-1!==n.indexOf("MSIE "),i=-1!==n.indexOf("Trident/");return r||i}(n))return!0;if(t in hi)return hi[t];const i=`#extension GL_${r[0]} : ${n.behavior||"enable"}\nvoid main(void) {}`,s=e.createShader(e.VERTEX_SHADER);e.shaderSource(s,i),e.compileShader(s);const a=e.getShaderParameter(s,e.COMPILE_STATUS);return e.deleteShader(s),hi[t]=a,a}function Ei(e,t){const n=fi[t];Kr(n,t);const r=function(e){return Boolean(e&&2===e._version)}(e)&&n[1]||n[0],i="string"==typeof r?Boolean(e.getExtension(r)):r;return Kr(!1===i||!0===i),i}function gi(e,t){return(t=Array.isArray(t)?t:[t]).every(t=>Ei(e,t))}function mi(e){switch(function(e){const t=e.getExtension("WEBGL_debug_renderer_info"),n=e.getParameter(t&&t.UNMASKED_VENDOR_WEBGL||oi),r=e.getParameter(t&&t.UNMASKED_RENDERER_WEBGL||ui);return{gpuVendor:function(e,t){return e.match(/NVIDIA/i)||t.match(/NVIDIA/i)?"NVIDIA":e.match(/INTEL/i)||t.match(/INTEL/i)?"INTEL":e.match(/AMD/i)||t.match(/AMD/i)||e.match(/ATI/i)||t.match(/ATI/i)?"AMD":"UNKNOWN GPU"}(n,r),vendor:n,renderer:r,version:e.getParameter(ci),shadingLanguageVersion:e.getParameter(li)}}(e).gpuVendor.toLowerCase()){case"nvidia":return"#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n";case"intel":return"#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n";case"amd":return"#define AMD_GPU\n";default:return"#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"}}const pi={[jr]:"#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n",[Wr]:"#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"},Ai="__LUMA_INJECT_DECLARATIONS__",Ti=/void main\s*\([^)]*\)\s*\{\n?/,Ri=/}\n?[^{}]*$/,vi=[];function bi(e){const t={};return Kr(Array.isArray(e)&&e.length>1),e.forEach(e=>{for(const n in e)t[n]=t[n]?`${t[n]}\n${e[n]}`:e[n]}),t}const Ii=`\n\n${Ai}\n\n`,Ni={[jr]:"vertex",[Wr]:"fragment"},Si={[jr]:{},[Wr]:{}},Fi={[jr]:{},[Wr]:{}},Li="precision highp float;\n\n";function Oi(e,t={}){e=e.trim();const[n,r]=e.split(":"),i=e.replace(/\(.+/,"");Si[n][i]=Object.assign(t,{signature:r})}function yi(e,t){const{hook:n,injection:r,order:i=0}=t,s=n.slice(0,2),a=Fi[s];a[e]=a[e]||{},Kr(!a[e][n],"Module injection already created"),a[e][n]={injection:r,order:i}}function Ci(e,t){const{vs:n,fs:r}=t,i=function(e){return e=e.concat(ti.defaultShaderModules),si(e=ti.resolveModules(e))}(t.modules||[]);return{gl:e,vs:Mi(e,Object.assign({},t,{source:n,type:jr,modules:i})),fs:Mi(e,Object.assign({},t,{source:r,type:Wr,modules:i})),getUniforms:Pi(i),modules:Bi(i)}}function Mi(e,{id:t,source:n,type:r,modules:i,defines:s={},hookFunctions:a=Si,moduleInjections:o=Fi,inject:u={},prologue:c=!0,log:l}){Kr("string"==typeof n,"shader source must be a string"),a!==Si&&(a={[jr]:Object.assign({},Si[jr],a[jr]),[Wr]:Object.assign({},Si[Wr],a[Wr])}),o!==Fi&&(o={[jr]:Object.assign({},Fi[jr],o[jr]),[Wr]:Object.assign({},Fi[Wr],o[Wr])});const f=r===jr,_=n.split("\n");let h=100,d="",E=n;0===_[0].indexOf("#version ")?(h=300,d=_[0],E=_.slice(1).join("\n")):d=`#version ${h}`;const g={};i.forEach(e=>{Object.assign(g,e.getDefines())}),Object.assign(g,s);let m=c?`${d}\n${function({id:e,source:t,type:n}){return e&&"string"==typeof e&&-1===t.indexOf("SHADER_NAME")?`\n#define SHADER_NAME ${e}_${Ni[n]}\n\n`:""}({id:t,source:n,type:r})}\n${function({type:e}){return`\n#define SHADER_TYPE_${Ni[e].toUpperCase()}\n`}({type:r})}\n${mi(e)}\n${function(e,t,n){let r="#if (__VERSION__ > 120)\n\n# define FRAG_DEPTH\n# define DERIVATIVES\n# define DRAW_BUFFERS\n# define TEXTURE_LOD\n\n#endif // __VERSION\n";return gi(e,_i.GLSL_FRAG_DEPTH)&&(r+="// FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"),gi(e,_i.GLSL_DERIVATIVES)&&di(e,_i.GLSL_DERIVATIVES)&&(r+="// DERIVATIVES => dxdF, dxdY and fwidth are available\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n# define DERIVATIVES\n#endif\n"),gi(e,_i.GLSL_FRAG_DATA)&&di(e,_i.GLSL_FRAG_DATA,{behavior:"require"})&&(r+="// DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers : require\n#define DRAW_BUFFERS\n#endif\n"),gi(e,_i.GLSL_TEXTURE_LOD)&&(r+="// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n# define TEXTURE_LOD\n#define texture2DLod texture2DLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define texture2DProjLod texture2DProjLodEXT\n#define textureCubeLod textureCubeLodEXT\n#define texture2DGrad texture2DGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define texture2DProjGrad texture2DProjGradEXT\n#define textureCubeGrad textureCubeGradEXT\n#endif\n"),r}(e)}\n${function(e={}){let t=0,n="";for(const r in e){0===t&&(n+="\n// APPLICATION DEFINES\n"),t++;const i=e[r];(i||Number.isFinite(i))&&(n+=`#define ${r.toUpperCase()} ${e[r]}\n`)}0===t&&(n+="\n");return n}(g)}\n${f?"":Li}\n`:`${d}\n`,p=!1;const A={},T={};for(const e in u){const t="string"==typeof u[e]?{injection:u[e],order:0}:u[e];e.match(/^(v|f)s:/)?"#"===e[3]?T[e]=[t]:A[e]=[t]:T[e]=[t]}for(const e of i)switch(e.name){case"inject":p=!0;break;default:if(l&&e.checkDeprecations(E,l),m+=e.getModuleSource(r,h),o[r][e.name]){const t=o[r][e.name];for(const e in t)e.match(/^(v|f)s:#/)?(T[e]=T[e]||[],T[e].push(t[e])):(A[e]=A[e]||[],A[e].push(t[e]))}}return m+=Ii,m+=function(e,t){let n="";for(const r in e){const i=e[r];if(n+=`void ${i.signature} {\n`,i.header&&(n+=`  ${i.header}`),t[r]){const e=t[r];e.sort((e,t)=>e.order-t.order);for(const t of e)n+=`  ${t.injection}\n`}i.footer&&(n+=`  ${i.footer}`),n+="}\n"}return n}(a[r],A),m=function(e,t,n,r){const i=t===jr;for(const t in n){const r=n[t];r.sort((e,t)=>e.order-t.order),vi.length=r.length;for(let e=0,t=r.length;e<t;++e)vi[e]=r[e].injection;const s=`${vi.join("\n")}\n`;switch(t){case"vs:#decl":i&&(e=e.replace(Ai,s));break;case"vs:#main-start":i&&(e=e.replace(Ti,e=>e+s));break;case"vs:#main-end":i&&(e=e.replace(Ri,e=>s+e));break;case"fs:#decl":i||(e=e.replace(Ai,s));break;case"fs:#main-start":i||(e=e.replace(Ti,e=>e+s));break;case"fs:#main-end":i||(e=e.replace(Ri,e=>s+e));break;default:e=e.replace(t,e=>e+s)}}return e=e.replace(Ai,""),r&&(e=e.replace(/\}\s*$/,e=>e+pi[t])),e}(m+=E,r,T,p)}function Pi(e){return function(t){const n={};for(const r of e){const e=r.getUniforms(t,n);Object.assign(n,e)}return n}}function Bi(e){const t={};for(const r of e){const e=(n=r,ti.getShaderModule(n));t[r]=e}var n;return t}class Di{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new Di(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._moduleInjections={vs:{},fs:{}},this._hookFunctions={vs:{},fs:{}},this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(t=>t.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t),this.stateHash++}addModuleInjection(e,t){const n="string"==typeof e?e:e.name,{hook:r,injection:i,order:s=0}=t,a=r.slice(0,2),o=this._moduleInjections[a];o[n]=o[n]||{},o[n][r]={injection:i,order:s},this.stateHash++}addShaderHook(e,t={}){e=e.trim();const[n,r]=e.split(":"),i=e.replace(/\(.+/,"");this._hookFunctions[n][i]=Object.assign(t,{signature:r}),this.stateHash++}get(e={}){const{vs:t="",fs:n="",defines:r={},inject:i={},varyings:s=[],bufferMode:a=35981}=e,o=this._getModuleList(e.modules),u=this._getHash(t),c=this._getHash(n),l=o.map(e=>this._getHash("string"==typeof e?e:e.name)).sort(),f=s.map(e=>this._getHash(e)),_=Object.keys(r).sort(),h=Object.keys(i).sort(),d=[],E=[];for(const e of _)d.push(this._getHash(e)),d.push(this._getHash(r[e]));for(const e of h)E.push(this._getHash(e)),E.push(this._getHash(i[e]));const g=`${u}/${c}D${d.join("/")}M${l.join("/")}I${E.join("/")}V${f.join("/")}H${this.stateHash}B${a}`;if(!this._programCache[g]){const e=Ci(this.gl,{vs:t,fs:n,modules:o,inject:i,defines:r,hookFunctions:this._hookFunctions,moduleInjections:this._moduleInjections});this._programCache[g]=new bn(this.gl,{hash:g,vs:e.vs,fs:e.fs,varyings:s,bufferMode:a}),this._getUniforms[g]=e.getUniforms||(e=>{}),this._useCounts[g]=0}return this._useCounts[g]++,this._programCache[g]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._programCache[t].delete(),delete this._programCache[t],delete this._getUniforms[t],delete this._useCounts[t])}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),n={};let r=0;for(let e=0,i=this._defaultModules.length;e<i;++e){const i=this._defaultModules[e],s="string"==typeof i?i:i.name;t[r++]=i,n[s]=!0}for(let i=0,s=e.length;i<s;++i){const s=e[i],a="string"==typeof s?s:s.name;n[a]||(t[r++]=s,n[a]=!0)}return t.length=r,t}}const xi={vs:"#define SHADER_NAME luma_modular_vertex\n\n// object attributes\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec4 colors;\nattribute vec2 texCoords;\nattribute vec3 pickingColors;\n\nvoid main(void) {\n\n  // Set up position\n#ifdef MODULE_GEOMETRY\n  geometry_setPosition(positions);\n  geometry_setNormal(normals);\n#endif\n\n#ifdef MODULE_PROJECT\n  project_setPositionAndNormal_Model(positions, normals);\n  gl_Position = project_model_to_clipspace(positions);\n#endif\n\n  // Set up depth\n#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n\n#ifdef MODULE_DIFFUSE\n  diffuse_setTextureCoordinate(texCoords);\n#endif\n\n  // Set up color calculations\n#ifdef MODULE_MATERIAL\n  material_setDiffuseColor(colors);\n  material_setDiffuseTextureCoordinates(texCoords);\n#endif\n\n#ifdef MODULE_LIGHTING\n  lighting_setPositionAndNormal(positions, normals);\n  lighting_apply_light(positions);\n  lighting_apply_reflection(positions);\n#endif\n\n#ifdef MODULE_PICKING\n  picking_setPickingColor(pickingColors);\n#endif\n\n}\n",fs:"#define SHADER_NAME luma-modular-fragment\n\nprecision highp float;\n\n// varyings\nvarying vec4 vColor;\n\nvoid main(){\n  gl_FragColor = vec4(1., 0., 1., 1.);\n\n#ifdef MODULE_DIFFUSE\n  gl_FragColor = diffuse_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth(gl_Position);\n#endif\n}\n",uniforms:{}};function Ui(e,t={}){const{isInteger:n=!1}=t;if(Array.isArray(e)||ArrayBuffer.isView(e))return function(e,t){const{maxElts:n=16,size:r=1}=t;let i="[";for(let s=0;s<e.length&&s<n;++s)s>0&&(i+=`,${s%r==0?" ":""}`),i+=Ui(e[s],t);return`${i}${e.length>n?"...":"]"}`}(e,t);if(!Number.isFinite(e))return String(e);if(Math.abs(e)<1e-16)return n?"0":"0.";if(n)return e.toFixed(0);if(Math.abs(e)>100&&Math.abs(e)<1e4)return e.toFixed(0);const r=e.toPrecision(2);return r.indexOf(".0")===r.length-2?r.slice(0,-1):r}function wi(e,t,n,r){const{gl:i}=e;if(!t)return{[r]:"null","Format ":"N/A"};let s,a,o,u="NOT PROVIDED",c="N/A",l="N/A",f="N/A";if(n&&(u=n.type,c=n.size,s=-1!==(u=String(u).replace("Array","")).indexOf("nt")),t instanceof ye){const e=t,{data:_,modified:h}=e.getDebugData();let d;if(a=h?"*":"",o=_,l=(f=e.byteLength)/_.BYTES_PER_ELEMENT/c,n){d=`${n.divisor>0?"I ":"P "} ${l} (x${c}=${f} bytes ${le(i,u)})`}else s=!0,d=`${f} bytes`;return{[r]:`${a}${Ui(o,{size:c,isInteger:s})}`,"Format ":d}}return{[r]:`${Ui(o=t,{size:c=t.length,isInteger:s=-1!==(u=String(t.constructor.name).replace("Array","")).indexOf("nt")})} (constant)`,"Format ":`${c}x${u} (constant)`}}function Gi(e,t){const{type:n,size:r}=t,i=pn(n,r);return i?`${e} (${i.name})`:e}function ki({header:e="Uniforms",program:t,uniforms:n,undefinedOnly:i=!1}={}){r(t);const s=t._uniformSetters,a={},o=Object.keys(s).sort();let u=0;for(const t of o)t.match(".*_.*")||t.match(".*Matrix")||Hi({table:a,header:e,uniforms:n,uniformName:t,undefinedOnly:i})&&u++;for(const t of o)t.match(".*Matrix")&&Hi({table:a,header:e,uniforms:n,uniformName:t,undefinedOnly:i})&&u++;for(const t of o)a[t]||Hi({table:a,header:e,uniforms:n,uniformName:t,undefinedOnly:i})&&u++;let c=0;const l={};if(!i)for(const t in n){const r=n[t];a[t]||(c++,l[t]={Type:`NOT USED: ${r}`,[e]:Ui(r)})}return{table:a,count:u,unusedTable:l,unusedCount:c}}function Hi({table:e,header:t,uniforms:n,uniformName:r,undefinedOnly:i}){const s=n[r],a=function(e){return null!=e}(s);return(!i||!a)&&(e[r]={[t]:a?Ui(s):"N/A","Uniform Type":a?s:"NOT PROVIDED"},!0)}function Vi(e){const{type:t,size:n}=e.accessor,r=pn(t,n);return r?`${r.name} ${e.name}`:e.name}var Xi=n(10),ji=n.n(Xi);const Wi={},zi=e=>{Wi[e.id]||(Wi[e.id]=e,ji.a.listItem("luma.gl",e.id))},Ki=(e,t)=>{if(!ji.a.isReady()||ji.a.throttle(`luma.gl:${e.id}`,1e3))return;const n=e.geometry?Object.assign({},e.geometry.attributes,e.attributes):e.attributes,r=Object.assign({},e.uniforms,t);ji.a.multiUpdate("luma.gl",e.id,[{path:"objects.uniforms",data:r},{path:"objects.attributes",data:n}])},$i=e=>{delete Wi[e],ji.a.deleteItem("luma.gl",e)},Yi=(e,t,n)=>{e&&(t.length>1?Yi(e[t[0]],t.slice(1),n):e[t[0]]=n)},qi=new Map,Qi=(e,t)=>{if(!f.d.__SEER_INITIALIZED__||!e)return;const n=qi.get(e);n&&n.forEach((e,n)=>{Yi(t,n,e)})};ji.a.listenFor("luma.gl",e=>{const t=Wi[e.itemKey];if(!t||"edit"!==e.type||"uniforms"!==e.valuePath[0])return;const n=e.valuePath.slice(1);((e,t,n)=>{if(!f.d.__SEER_INITIALIZED__)return;qi.has(e)||qi.set(e,new Map),qi.get(e).set(t,n)})(e.itemKey,n,e.value);const r=t.getUniforms();Yi(r,n,e.value),t.setUniforms(r)});const Zi=2,Ji=1e4;class es{constructor(e,t={}){r(a(e));const{id:n=_e("base-model")}=t;this.id=n,this.gl=e,this.id=t.id||_e("Model"),this.lastLogTime=0,this.initialize(t)}initialize(e){this.props={},e.shaderCache&&M.warn("ShaderCache property is deprecated")(),this.programManager=e.programManager||Di.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:t=null,vs:n,fs:r,modules:i,defines:s,inject:a,varyings:o,bufferMode:u}=e;this.programProps={program:t,vs:n,fs:r,modules:i,defines:s,inject:a,varyings:o,bufferMode:u},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.animatedUniforms={},this.animated=!1,this.animationLoop=null,this.timerQueryEnabled=!1,this.timeElapsedQuery=void 0,this.lastQueryReturned=!0,this.stats={accumulatedFrameTime:0,averageFrameTime:0,profileFrameCount:0},this.pickable=!0,this._checkProgram(),this._setBaseModelProps(e),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings)))}setProps(e){this._setBaseModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&this.programManager.release(this.program),this.vertexArray.delete(),$i(this.id)}isAnimated(){return this.animated}getProgram(){return this.program}setProgram(e){this.programProps=Object.assign({},e),this._programDirty=!0}getUniforms(){return this.uniforms}setUniforms(e={}){return e=Object.assign({},e),Qi(this.id,e),e=this._extractAnimatedUniforms(e),Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const t=this.programManager.getUniforms(this.program);return t?t(e):{}}updateModuleSettings(e){const t=this.getModuleUniforms(e||{});return this.setUniforms(t)}clear(e){return st(this.program.gl,e),this}drawGeometry(e={}){this._checkProgram();const{moduleSettings:t=null,framebuffer:n,uniforms:r={},attributes:i={},transformFeedback:s=this.transformFeedback,parameters:a={},vertexArray:o=this.vertexArray,animationProps:u}=e;zi(this),this.setAttributes(i),this.updateModuleSettings(t),this.setUniforms(r),this._refreshAnimationProps(u);const c=this._logDrawCallStart(2),l=this.vertexArray.getDrawParams(this.props);l.isInstanced&&!this.isInstanced&&M.warn("Found instanced attributes on non-instanced model",this.id)();const{isIndexed:f,indexType:_,indexOffset:h}=l,{isInstanced:d,instanceCount:E}=this,g=()=>{},{onBeforeRender:m=g,onAfterRender:p=g}=this.props;m(),this._timerQueryStart(),this.program.setUniforms(this.uniforms);const A=this.program.draw(Object.assign({},e,{logPriority:c,uniforms:null,framebuffer:n,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:o,transformFeedback:s,isIndexed:f,indexType:_,isInstanced:d,instanceCount:E,offset:f?h:0}));return this._timerQueryEnd(),p(),this._logDrawCallEnd(c,o,n),A}_setBaseModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"timerQueryEnabled"in e&&(this.timerQueryEnabled=e.timerQueryEnabled&&Cn.isSupported(this.gl,["timers"]),e.timerQueryEnabled&&!this.timerQueryEnabled&&M.warn("GPU timer not supported")()),"_animationProps"in e&&this._setAnimationProps(e._animationProps),"_animationLoop"in e&&(this.animationLoop=e._animationLoop)}_checkProgram(e=null){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:t}=this.programProps;if(t)this._managedProgram=!1;else{const{vs:e=xi.vs,fs:n=xi.fs,modules:r,inject:i,defines:s,varyings:a,bufferMode:o}=this.programProps;t=this.programManager.get({vs:e,fs:n,modules:r,inject:i,defines:s,varyings:a,bufferMode:o}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}r(t instanceof bn,"Model needs a program"),this._programDirty=!1,t!==this.program&&(this.program=t,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new Vn(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_refreshAnimationProps(e){(e=e||this.animationLoop&&this.animationLoop.animationProps)&&this._setAnimationProps(e)}_evaluateAnimateUniforms(e){if(!this.animated)return{};const t={};for(const n in this.animatedUniforms){const r=this.animatedUniforms[n];t[n]=r(e)}return t}_extractAnimatedUniforms(e){let t=!1;for(const n in e){const r=e[n];"function"==typeof r?(this.animatedUniforms[n]=r,t=!0):delete this.animatedUniforms[n]}if(this.animated=!de(this.animatedUniforms),!t)return e;const n={};for(const t in e)this.animatedUniforms[t]||(n[t]=e[t]);return n}_timerQueryStart(){!0===this.timerQueryEnabled&&(this.timeElapsedQuery||(this.timeElapsedQuery=new Cn(this.gl)),this.lastQueryReturned&&(this.lastQueryReturned=!1,this.timeElapsedQuery.beginTimeElapsedQuery()))}_timerQueryEnd(){if(!0===this.timerQueryEnabled&&(this.timeElapsedQuery.end(),this.timeElapsedQuery.isResultAvailable())){this.lastQueryReturned=!0;const e=this.timeElapsedQuery.getTimerMilliseconds();this.stats.lastFrameTime=e,this.stats.accumulatedFrameTime+=e,this.stats.profileFrameCount++,this.stats.averageFrameTime=this.stats.accumulatedFrameTime/this.stats.profileFrameCount,M.log(Zi,`GPU time ${this.program.id}: ${this.stats.lastFrameTime}ms average ${this.stats.averageFrameTime}ms accumulated: ${this.stats.accumulatedFrameTime}ms count: ${this.stats.profileFrameCount}`)()}}_logDrawCallStart(e){const t=e>3?0:Ji;if(!(M.priority<e||Date.now()-this.lastLogTime<t))return this.lastLogTime=Date.now(),M.group(Zi,`>>> DRAWING MODEL ${this.id}`,{collapsed:M.priority<=2})(),e}_logDrawCallEnd(e,t,n,r){if(void 0===e)return;const i=function({vertexArray:e,header:t="Attributes"}={}){if(!e.configuration)return{};const n={};e.elements&&(n.ELEMENT_ARRAY_BUFFER=wi(e,e.elements,null,t));const r=e.values;for(const i in r){const s=e._getAttributeInfo(i);if(s){let a=`${i}: ${s.name}`;const o=e.accessors[s.location];o&&(a=`${i}: ${Gi(s.name,o)}`),n[a]=wi(e,r[i],o,t)}}return n}({vertexArray:t,header:`${this.id} attributes`,attributes:this._attributes}),{table:s,unusedTable:a,unusedCount:o}=ki({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,n)}),{table:u,count:c}=ki({header:`${this.id} uniforms`,program:this.program,uniforms:Object.assign({},this.program.uniforms,n),undefinedOnly:!0});c>0&&M.log("MISSING UNIFORMS",Object.keys(u))(),o>0&&M.log("UNUSED UNIFORMS",Object.keys(a))();const l=function(e){const t={},n=`Accessors for ${e.id}`;for(const r of e.attributeInfos)r&&(t[`in ${Vi(r)}`]={[n]:JSON.stringify(r.accessor)});for(const r of e.varyingInfos)r&&(t[`out ${Vi(r)}`]={[n]:JSON.stringify(r.accessor)});return t}(this.vertexArray.configuration);M.table(e,i)(),M.table(e,s)(),M.table(e+1,l)(),Ki(this,n),r&&r.log({priority:Zi,message:`Rendered to ${r.id}`}),M.groupEnd(Zi,`>>> DRAWING MODEL ${this.id}`)()}}const ts="Model needs drawMode and vertexCount";class ns extends es{constructor(e,t={}){const{id:n=_e("model")}=t;super(e,{...t,id:n})}initialize(e){super.initialize(e),this.drawMode=void 0!==e.drawMode?e.drawMode:z.a.TRIANGLES,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced,this._setModelProps(e),this.geometry={},r(void 0!==this.drawMode&&Number.isFinite(this.vertexCount),ts)}setProps(e){super.setProps(e),this._setModelProps(e)}delete(){super.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return r(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return r(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=function(e,t,n){const i={};let s=t.indices;for(const r in t.attributes){const a=t.attributes[r],o=Vr(r,n);if("indices"===r)s=a;else if(a.constant)i[o]=a.value;else{const t=a.value,n={...a};delete n.value,i[o]=[new ye(e,t),n],Xr(r,n)}}if(s){const t=s.value||s;r(t instanceof Uint16Array||t instanceof Uint32Array,'attribute array for "indices" must be of integer type');const n={size:1,isIndexed:void 0===s.isIndexed||s.isIndexed};i.indices=[new ye(e,{data:t,target:z.a.ELEMENT_ARRAY_BUFFER}),n]}return i}(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(e={}){if(de(e))return this;const t={};for(const n in e){const r=e[n];t[n]=r.getValue?r.getValue():r}return this.vertexArray.setAttributes(t),this}draw(e={}){return this.drawGeometry(e)}transform(e={}){const{discard:t=!0,feedbackBuffers:n,unbindModels:r=[]}=e;let{parameters:i}=e;n&&this._setFeedbackBuffers(n),t&&(i=Object.assign({},i,{[z.a.RASTERIZER_DISCARD]:t})),r.forEach(e=>e.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:i}))}finally{r.forEach(e=>e.vertexArray.bindBuffers())}return this}render(e={}){return M.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const t=this.geometryBuffers[e][0]||this.geometryBuffers[e];t instanceof ye&&t.delete()}}_setAnimationProps(e){if(this.animated){r(e,"Model.draw(): animated uniforms but no animationProps");const t=this._evaluateAnimateUniforms(e);Object.assign(this.uniforms,t)}}_setFeedbackBuffers(e={}){if(de(e))return this;const{gl:t}=this.program;return this.transformFeedback=this.transformFeedback||new Mn(t,{program:this.program}),this.transformFeedback.setBuffers(e),this}}const rs="void main() {gl_FragColor = vec4(0);}",is="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",ss=`#version 300 es\n${is}`;function as(e,t){t=Array.isArray(t)?t:[t];const n=e.replace(/^\s+/,"").split(/\s+/),[r,i,s]=n;return t.includes(r)&&i&&s?{qualifier:r,type:i,name:s.split(";")[0]}:null}function os({version:e=100,input:t,inputType:n,output:r}={}){if(!t)return 300===e?ss:e>300?`#version ${e}\n${is}`:rs;const i=ls(t,n);return e>=300?`#version ${e} ${300===e?"es":""}\nin ${n} ${t};\nout vec4 ${r};\nvoid main() {\n  ${r} = ${i};\n}`:`varying ${n} ${t};\nvoid main() {\n  gl_FragColor = ${i};\n}`}function us(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Kr(!1),null}}function cs(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Kr(!1),null}}function ls(e,t){switch(t){case"float":return`vec4(${e}, 0.0, 0.0, 1.0)`;case"vec2":return`vec4(${e}, 0.0, 1.0)`;case"vec3":return`vec4(${e}, 1.0)`;case"vec4":return e;default:return Kr(!1),null}}class fs{constructor(e,t={}){this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}setupResources(e){for(const t of this.bindings)this._setupTransformFeedback(t,e)}updateModelProps(e={}){const{varyings:t}=this;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e}getDrawOptions(e={}){const t=this.bindings[this.currentIndex],{sourceBuffers:n,transformFeedback:r}=t;return{attributes:Object.assign({},n,e.attributes),transformFeedback:r}}swap(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:t}=this.bindings[this.currentIndex],n=e?t[e]:null;return n?n instanceof ye?n:n.buffer:null}getData({varyingName:e}={}){const t=this.getBuffer(e);return t?t.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(e={}){this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&r(o(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:t={}}=e,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const e in this.feedbackMap){const r=this.feedbackMap[e];e in t&&(n[r]=e)}Object.assign(n,e.feedbackBuffers);for(const e in n){const r=n[e];if("string"==typeof r){const i=t[r],{byteLength:s,usage:a,accessor:o}=i;n[e]=this._createNewBuffer(e,{byteLength:s,usage:a,accessor:o})}}return n}_setupBuffers(e={}){const{sourceBuffers:t=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const n=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:t,feedbackBuffers:n})}_setupTransformFeedback(e,{model:t}){const{program:n}=t;e.transformFeedback=new Mn(this.gl,{program:n,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:e,feedbackBuffers:t}=this._swapBuffers(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceBuffers:e,feedbackBuffers:t})}}_updateBinding(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const t=Object.assign({},e.sourceBuffers),n=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const s=this.feedbackMap[i];t[i]=e.feedbackBuffers[s],n[s]=e.sourceBuffers[i],r(n[s]instanceof ye)}return{sourceBuffers:t,feedbackBuffers:n}}_createNewBuffer(e,t){const n=new ye(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=n,n}_getNextIndex(){return(this.currentIndex+1)%2}}function _s(e){let t=100;const n=e.match(/[^\s]+/g);if(n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}return t}var hs={name:"transform",vs:"attribute float transform_elementID;\n\n// returns half of pixel size, used to move the pixel position to center of the pixel.\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\n// returns current elements pixel indeces [x, y],\n// where x ranges in [0 to texSize-1] and y ranges in [0 to texSize-1]\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  // Add safe offset (half of pixel height) before doing floor\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\n\n// returns current elementID's texture co-ordianate\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\n\n// returns current elementID's position\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  // Change from [0 1] range to [-1 1]\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\n\n// returns current elementID's pixel value\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null};const ds="transform_uSampler_",Es="transform_uSize_",gs="transform_position";function ms({vs:e,sourceTextureMap:t,targetTextureVarying:n,targetTexture:i}){let s=Object.keys(t).length,a=null;const o={};let u=e,c={};if(s>0||n){const e=u.split("\n"),l=e.slice();if(e.forEach((e,r,i)=>{if(s>0){const n=function(e,t){const n={},r=function(e){return as(e,["attribute","in"])}(e);if(!r)return null;const{type:i,name:s}=r;if(s&&t[s]){const t=`// ${e} => Replaced by Transform with a sampler`,{samplerName:r,sizeName:a,uniformDeclerations:o}=function(e){const t=`${ds}${e}`,n=`${Es}${e}`;return{samplerName:t,sizeName:n,uniformDeclerations:`  uniform sampler2D ${t};\n  uniform vec2 ${n};`}}(s),u=us(i),c=`  ${i} ${s} = transform_getInput(${r}, ${a}).${u};\n`;n[r]=s;const l={"vs:#decl":o,"vs:#main-start":c};return{updatedLine:t,inject:l,samplerTextureMap:n}}return null}(e,t);if(n){const{updatedLine:e,inject:t}=n;l[r]=e,c=bi([c,t]),Object.assign(o,n.samplerTextureMap),s--}}n&&!a&&(a=function(e,t){const n=as(e,["varying","out"]);if(!n)return null;return n.name===t?n.type:null}(e,n))}),n){r(i);const e=`${Es}${n}`;c=bi([c,{"vs:#decl":`uniform vec2 ${e};\n`,"vs:#main-start":`     vec2 ${gs} = transform_getPos(${e});\n     gl_Position = vec4(${gs}, 0, 1.);\n`}])}u=l.join("\n")}return{vs:u,targetTextureType:a,inject:c,samplerTextureMap:o}}const ps={[z.a.TEXTURE_MIN_FILTER]:z.a.NEAREST,[z.a.TEXTURE_MAG_FILTER]:z.a.NEAREST,[z.a.TEXTURE_WRAP_S]:z.a.CLAMP_TO_EDGE,[z.a.TEXTURE_WRAP_T]:z.a.CLAMP_TO_EDGE},As="transform_output";class Ts{constructor(e,t={}){this.gl=e,this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}updateModelProps(e={}){const t=this._processVertexShader(e);return Object.assign({},e,t)}getDrawOptions(e={}){const{sourceTextures:t,framebuffer:n,targetTexture:r}=this.bindings[this.currentIndex],i=Object.assign({},e.attributes),s=Object.assign({},e.uniforms),a=Object.assign({},e.parameters);let o=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){i.transform_elementID=this.elementIDBuffer;for(const e in this.samplerTextureMap){const n=this.samplerTextureMap[e];s[e]=t[n]}this._setSourceTextureParameters();const e=function({sourceTextureMap:e,targetTextureVarying:t,targetTexture:n}){const r={};let i,s;t&&(({width:i,height:s}=n),r[`${Es}${t}`]=[i,s]);for(const t in e)({width:i,height:s}=e[t]),r[`${Es}${t}`]=[i,s];return r}({sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:r});Object.assign(s,e)}return this.hasTargetTexture&&(o=!1,a.viewport=[0,0,n.width,n.height]),{attributes:i,framebuffer:n,uniforms:s,discard:o,parameters:a}}swap(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)}update(e={}){this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData({packed:e=!1}={}){const{framebuffer:t}=this.bindings[this.currentIndex],n=ht(t);if(!e)return n;const r=n.constructor,i=cs(this.targetTextureType),s=new r(n.length*i/4);let a=0;for(let e=0;e<n.length;e+=4)for(let t=0;t<i;t++)s[a++]=n[e+t];return s}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(e={}){const{_targetTextureVarying:t,_swapTexture:n}=e;this._swapTexture=n,this.targetTextureVarying=t,this.hasTargetTexture=t,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:t,textureOrReference:n}=e;if(n instanceof Ke)return n;const r=t[n];return r?(this._targetRefTexName=n,this._createNewTexture(r)):null}_setupTextures(e={}){const{_sourceTextures:t={},_targetTexture:n}=e,r=this._createTargetTexture({sourceTextures:t,textureOrReference:n});this.hasSourceTextures=this.hasSourceTextures||t&&Object.keys(t).length>0,this._updateBindings({sourceTextures:t,targetTexture:r}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if("number"!=typeof e||this.elementCount>=e)return;const t=new Float32Array(e);t.forEach((e,t,n)=>{n[t]=t}),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new ye(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:e,targetTexture:t}=this._swapTextures(this.bindings[this.currentIndex]),n=this._getNextIndex();this.bindings[n]=this._updateBinding(this.bindings[n],{sourceTextures:e,targetTexture:t})}}_updateBinding(e,t){const{sourceTextures:n,targetTexture:r}=t;if(e||(e={sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,n),r){e.targetTexture=r;const{width:t,height:n}=r,{framebuffer:i}=e;i?(i.update({attachments:{[z.a.COLOR_ATTACHMENT0]:r},resizeAttachments:!1}),i.resize({width:t,height:n})):e.framebuffer=new St(this.gl,{id:`${this.id||"transform"}-framebuffer`,width:t,height:n,attachments:{[z.a.COLOR_ATTACHMENT0]:r}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const e in t)t[e].setParameters(ps)}_swapTextures(e){if(!this._swapTexture)return null;const t=Object.assign({},e.sourceTextures);return t[this._swapTexture]=e.targetTexture,{sourceTextures:t,targetTexture:e.sourceTextures[this._swapTexture]}}_createNewTexture(e){const t=ft(e,{parameters:{[z.a.TEXTURE_MIN_FILTER]:z.a.NEAREST,[z.a.TEXTURE_MAG_FILTER]:z.a.NEAREST,[z.a.TEXTURE_WRAP_S]:z.a.CLAMP_TO_EDGE,[z.a.TEXTURE_WRAP_T]:z.a.CLAMP_TO_EDGE},pixelStore:{[z.a.UNPACK_FLIP_Y_WEBGL]:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=t,t}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(e={}){const{sourceTextures:t,targetTexture:n}=this.bindings[this.currentIndex],{vs:r,uniforms:i,targetTextureType:s,inject:a,samplerTextureMap:o}=ms({vs:e.vs,sourceTextureMap:t,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),u=bi([e.inject||{},a]);return this.targetTextureType=s,this.samplerTextureMap=o,{vs:r,fs:e._fs||os({version:_s(r),input:this.targetTextureVarying,inputType:s,output:As}),modules:this.hasSourceTextures||this.targetTextureVarying?[hs].concat(e.modules||[]):e.modules,uniforms:i,inject:u}}}class Rs{static isSupported(e){return o(e)}constructor(e,t={}){this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}delete(){const{model:e,bufferTransform:t,textureTransform:n}=this;e&&e.delete(),t&&t.delete(),n&&n.delete()}run(e={}){const{clearRenderTarget:t=!0}=e,n=this._updateDrawOptions(e);t&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)}swap(){let e=!1;const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of t)e=e||n.swap();r(e,"Nothing to swap")}getBuffer(e=null){return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(e={}){const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of t){const t=n.getData(e);if(t)return t}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(e={}){"elementCount"in e&&this.model.setVertexCount(e.elementCount);const t=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const n of t)n.update(e)}_initialize(e={}){const{gl:t}=this;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new ns(t,Object.assign({},e,{fs:e.fs||os({version:_s(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||z.a.POINTS,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let t=Object.assign({},e);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of n)t=e.updateModelProps(t);return t}_buildResourceTransforms(e,t){(function(e){if(!de(e.sourceBuffers)||!de(e.feedbackBuffers)||e.varyings&&e.varyings.length>0)return!0;return!1})(t)&&(this.bufferTransform=new fs(e,t)),function(e){if(!de(e._sourceTextures)||e._targetTexture||e._targetTextureVarying)return!0;return!1}(t)&&(this.textureTransform=new Ts(e,t)),r(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let t=Object.assign({},e);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const e of n)t=Object.assign(t,e.getDrawOptions(t));return t}}const vs="attribute vec2 aClipSpacePosition;\nattribute vec2 aTexCoord;\nattribute vec2 aCoordinate;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main(void) {\n  gl_Position = vec4(aClipSpacePosition, 0., 1.);\n  position = aClipSpacePosition;\n  coordinate = aCoordinate;\n  uv = aTexCoord;\n}\n",bs=[-1,-1,1,-1,-1,1,1,1];class Is extends ns{constructor(e,t){const n=bs.map(e=>-1===e?0:e);super(e,Object.assign({},t,{vs:vs,geometry:new Yn({drawMode:z.a.TRIANGLE_STRIP,vertexCount:4,attributes:{aClipSpacePosition:{size:2,value:new Float32Array(bs)},aTexCoord:{size:2,value:new Float32Array(n)},aCoordinate:{size:2,value:new Float32Array(n)}}})})),this.setVertexCount(4)}}class Ns{constructor({gl:e,_cachePrograms:t=!1}={}){r(e),this.gl=e,this.vertexShaders={},this.fragmentShaders={},this.programs={},this._cachePrograms=t}delete(){return this}getVertexShader(e,t){r("string"==typeof t),r(this._compareContexts(e,this.gl));let n=this.vertexShaders[t];return n||(n=new Ht(e,t),this.vertexShaders[t]=n),n}getFragmentShader(e,t){r("string"==typeof t),r(this._compareContexts(e,this.gl));let n=this.fragmentShaders[t];return n||(n=new Vt(e,t),this.fragmentShaders[t]=n),n}getProgram(e,t){r(this._compareContexts(e,this.gl)),r("string"==typeof t.vs),r("string"==typeof t.fs),r("string"==typeof t.id);const n=this._getProgramKey(t);let i=this.programs[n];return i?(this._resetProgram(i),i):(i=this._createNewProgram(e,t),this._cachePrograms&&this._checkProgramProp(i)&&(i._isCached=!0,this.programs[n]=i),i)}_getProgramKey(e){return`${e.id}-${e.vs}-${e.fs}`}_checkProgramProp(e){return!e.varyings}_createNewProgram(e,t){const{vs:n,fs:r}=t,i=this.getVertexShader(e,n),s=this.getFragmentShader(e,r);return new bn(this.gl,Object.assign({},t,{vs:i,fs:s}))}_resetProgram(e,t){e.reset()}_compareContexts(e,t){return(e.gl||e)===(t.gl||t)}}class Ss{static createWorker(e){return t=>{e.setProps({useDevicePixels:!1,autoResizeDrawingBuffer:!1}),t.canvas=null,t.onmessage=n=>{const r=n.data;switch(r.command){case"start":!function(e,t){const n=new Map;t.addEventListener=(t,r)=>{e.postMessage({command:"addEventListener",type:t}),n.has(t)||n.set(t,[]),n.get(t).push(r)},t.removeEventListener=(t,r)=>{e.postMessage({command:"removeEventListener",type:t});const i=n.get(t);i&&i.splice(i.indexOf(r),1)},t.dispatchEvent=(e,t)=>{const r=n.get(e);r&&r.forEach(e=>e(t))},e.canvas=t}(t,r.opts.canvas),e.start(r.opts);break;case"stop":e.stop();break;case"resize":t.canvas.width=r.width,t.canvas.height=r.height;break;case"event":t.canvas.dispatchEvent(r.type,r.event)}}}}constructor(e,t={}){const{onInitialize:n=(()=>{}),onFinalize:i=(()=>{}),useDevicePixels:s=!0,autoResizeDrawingBuffer:a=!0}=t;this.props={onInitialize:n,onFinalize:i},this.setProps({autoResizeDrawingBuffer:a,useDevicePixels:s}),r(e instanceof Worker),this.worker=e,this.canvas=null,this.width=null,this.height=null,this._running=!1,this._animationFrameId=null,this._onMessage=this._onMessage.bind(this),this._onEvent=this._onEvent.bind(this),this._updateFrame=this._updateFrame.bind(this)}setProps(e){return"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(e={}){return this._running?this:(this._running=!0,this.worker.onmessage=this._onMessage,X().then(()=>this._running?(this._createAndTransferCanvas(e),this.props.onInitialize(this)):null).then(()=>{this._running&&(this._animationFrameId=Pr(this._updateFrame))}),this)}stop(){return this._running&&(Br(this._animationFrameId),this._animationFrameId=null,this._running=!1,this.props.onFinalize(this)),this.worker.postMessage({command:"stop"}),this}_onMessage(e){switch(e.data.command){case"addEventListener":this.canvas.addEventListener(e.data.type,this._onEvent);break;case"removeEventListener":this.canvas.removeEventListener(e.data.type,this._onEvent)}}_onEvent(e){const t=this.useDevicePixels&&window.devicePixelRatio||1,n=e.type,r={};for(const n in e){let i=e[n];const s=typeof i;"offsetX"!==n&&"offsetY"!==n||(i*=t),"number"!==s&&"boolean"!==s&&"string"!==s||(r[n]=i)}this.worker.postMessage({command:"event",type:n,event:r})}_updateFrame(){this._resizeCanvasDrawingBuffer(),this._animationFrameId=Pr(this._updateFrame)}_createAndTransferCanvas(e){const t=j(e);t.transferControlToOffscreen||M.error("OffscreenCanvas is not available in your browser.")();const n=t.transferControlToOffscreen();this.worker.postMessage({command:"start",opts:Object.assign({},e,{canvas:n})},[n]),this.canvas=t}_resizeCanvasDrawingBuffer(){if(this.autoResizeDrawingBuffer){const e=this.useDevicePixels&&window.devicePixelRatio||1,t=Math.ceil(this.canvas.clientWidth*e),n=Math.ceil(this.canvas.clientHeight*e);this.width===t&&this.height===n||(this.width=t,this.height=n,this.worker.postMessage({command:"resize",width:t,height:n}))}}}class Fs{constructor(e,t={}){const{id:n="pass"}=t;this.id=n,this.gl=e,this.props={enabled:!0,screen:!1,swap:!1},Object.assign(this.props,t)}setProps(e){Object.assign(this.props,e)}render(e,t){if(!this.props.enabled)return;const n=this.gl,r={gl:n,outputBuffer:e.writeBuffer,inputBuffer:e.readBuffer,animationProps:t,swapBuffers:()=>e._swapFramebuffers()};this.props.screen?(r.inputBuffer=r.outputBuffer,r.outputBuffer=St.getDefaultFramebuffer(n)):this.props.swap&&(r.inputBuffer=e.writeBuffer,r.outputBuffer=e.readBuffer),ke(n,{framebuffer:r.outputBuffer},()=>this._renderPass(r)),this.props.debug&&r.outputBuffer.log(1,this.id),this.props.swap&&e._swapFramebuffers()}delete(){}_renderPass({gl:e,inputBuffer:t,outputBuffer:n,animationProps:r}){}}class Ls extends Fs{constructor(e,t={}){t=Array.isArray(t)?{passes:t}:t,super(e,Object.assign({id:"composite-pass"},t))}render(...e){const{passes:t=[]}=this.props;for(const n of t)n.render(...e)}delete(){}}class Os{constructor(e,t={}){this.gl=e,this.framebuffer1=new St(e,{id:"multi-pass-1",stencil:!0}),this.framebuffer2=new St(e,{id:"multi-pass-2",stencil:!0}),this.reset()}reset(){this.framebuffer1.resize(),this.framebuffer2.resize(),this.writeBuffer=this.framebuffer1,this.readBuffer=this.framebuffer2,this.maskActive=!1}delete(){this.framebuffer1.delete(),this.framebuffer2.delete()}_swapFramebuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}}class ys extends Ls{constructor(e,t={}){t=Array.isArray(t)?{passes:t}:t,super(e,Object.assign({id:"multi-pass"},t)),this.renderState=new Os(e,t)}render(e){this.renderState.reset();const{passes:t=[]}=this.props;for(const n of t)n.render(this.renderState,e);return this}delete(){this.renderState.delete(),super.delete()}}class Cs extends Fs{constructor(e,t={}){super(e,Object.assign({id:"clear-pass"},t))}_renderPass(){const{gl:e}=this,{clearBits:t=e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT}=this.props;e.clear(t)}}class Ms extends Fs{constructor(e,t={}){super(e,Object.assign({id:"render-pass"},t))}_renderPass({animationProps:e}){const{models:t=[],drawParams:n}=this.props;for(const r of t)r.draw(Object.assign({},n,{animationProps:e}))}}const Ps="uniform sampler2D uDiffuseSampler;\nuniform float uOpacity;\n\nvarying vec2 uv;\n\nvoid main() {\n  vec4 texel = texture2D(uDiffuseSampler, uv);\n  gl_FragColor = uOpacity * texel;\n}\n";class Bs extends Fs{constructor(e,t={}){super(e,Object.assign({id:"copy-pass",swap:!0},t)),this.clipspace=new Is(e,{id:"copy-pass",fs:Ps})}delete(){super.delete(),this.clipspace.delete()}_renderPass({inputBuffer:e}){const{opacity:t=1}=this.props;this.clipspace.draw({uniforms:{uDiffuseSampler:e,uOpacity:t},parameters:{depthWrite:!1,depthTest:!1}})}}const Ds="uniform sampler2D uDiffuseSampler;\nuniform float uOpacity;\nvarying vec2 uv;\n\nvoid main() {\n  vec4 texel = texture2D(uDiffuseSampler, uv);\n  gl_FragColor = uOpacity * texel;\n}\n";class xs extends Fs{constructor(e,t={}){super(e,Object.assign({id:"texture-pass"},t));const{texture:n,opacity:r=1}=t;this.clipspace=new Is(e,{id:"texture-pass",fs:Ds,uniforms:{uDiffuseSampler:n,uOpacity:r}})}delete(){this.clipspace.delete(),super.delete()}_renderPass(){this.clipspace.draw({parameters:{depthWrite:!1,depthTest:!1}})}}class Us extends Fs{constructor(e,t={}){super(e,Object.assign({swap:!0},t))}_renderPass({inputBuffer:e,swapBuffers:t}){this.props.model.setUniforms(this.props),this.props.model.draw({uniforms:{texture:e,texSize:[e.width,e.height]},parameters:{depthWrite:!1,depthTest:!1}})}}class ws extends Ls{constructor(e,t,n={}){const r=`${t.name}-pass`;ei(t);const i=function(e,t,n,r){if(t.filter||t.sampler){const i=Vs(t),s=new Us(e,{id:n,model:Gs(e,t,i,n,r),uniforms:null});return[s]}const i=t.passes||[];return i.map(s=>{const a=Vs(t,s),o=`${n}-${i.length+1}`;return new Us(e,Object.assign({id:o,model:Gs(e,t,a,o,r),uniforms:s.uniforms},r))})}(e,t,r,n);super(e,Object.assign({id:r,passes:i},n)),this.module=t}_renderPass({inputBuffer:e,swapBuffers:t}){let n=!0;for(const r of this.props.passes){n||t(),n=!1;const{uniforms:i,model:s}=r.props;i&&s.setUniforms(i),s.draw({uniforms:{texture:e,texSize:[e.width,e.height]},parameters:{depthWrite:!1,depthTest:!1}})}}}function Gs(e,t,n,r,i){const s=new Is(e,{id:r,fs:n,modules:[t]}),a=Object.assign(t.getUniforms(),t.getUniforms(i));return s.setUniforms(a),s}const ks=e=>`uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = texture2D(texture, texCoord);\n  gl_FragColor = ${e}(gl_FragColor, texSize, texCoord);\n}\n`,Hs=e=>`uniform sampler2D texture;\nuniform vec2 texSize;\n\nvarying vec2 position;\nvarying vec2 coordinate;\nvarying vec2 uv;\n\nvoid main() {\n  vec2 texCoord = coordinate;\n\n  gl_FragColor = ${e}(texture, texSize, texCoord);\n}\n`;function Vs(e,t=e){if(t.filter){const n="string"==typeof t.filter?t.filter:`${e.name}_filterColor`;return ks(n)}if(t.sampler){const n="string"==typeof t.sampler?t.sampler:`${e.name}_sampleColor`;return Hs(n)}return null}const Xs={x:[2,0,1],y:[0,1,2],z:[1,2,0]};class js extends Yn{constructor(e={}){const{id:t=_e("truncated-code-geometry")}=e,{indices:n,attributes:r}=function(e){const{bottomRadius:t=0,topRadius:n=0,height:r=1,nradial:i=10,nvertical:s=10,verticalAxis:a="y",topCap:o=!1,bottomCap:u=!1}=e,c=(o?2:0)+(u?2:0),l=(i+1)*(s+1+c),f=Math.atan2(t-n,r),_=Math.sin,h=Math.cos,d=Math.PI,E=h(f),g=_(f),m=o?-2:0,p=s+(u?2:0),A=i+1,T=new Uint16Array(i*(s+c)*6),R=Xs[a],v=new Float32Array(3*l),b=new Float32Array(3*l),I=new Float32Array(2*l);let N=0,S=0;for(let e=m;e<=p;e++){let a,o=e/s,u=r*o;e<0?(u=0,o=1,a=t):e>s?(u=r,o=1,a=n):a=t+e/s*(n-t),-2!==e&&e!==s+2||(a=0,o=0),u-=r/2;for(let t=0;t<A;t++){const n=_(t*d*2/i),r=h(t*d*2/i);v[N+R[0]]=n*a,v[N+R[1]]=u,v[N+R[2]]=r*a,b[N+R[0]]=e<0||e>s?0:n*E,b[N+R[1]]=e<0?-1:e>s?1:g,b[N+R[2]]=e<0||e>s?0:r*E,I[S+0]=t/i,I[S+1]=o,S+=2,N+=3}}for(let e=0;e<s+c;e++)for(let t=0;t<i;t++){const n=6*(e*i+t);T[n+0]=A*(e+0)+0+t,T[n+1]=A*(e+0)+1+t,T[n+2]=A*(e+1)+1+t,T[n+3]=A*(e+0)+0+t,T[n+4]=A*(e+1)+1+t,T[n+5]=A*(e+1)+0+t}return{indices:T,attributes:{POSITION:{size:3,value:v},NORMAL:{size:3,value:b},TEXCOORD_0:{size:2,value:I}}}}(e);super({...e,id:t,indices:n,attributes:{...r,...e.attributes}})}}class Ws extends js{constructor(e={}){const{id:t=_e("cone-geometry"),radius:n=1,cap:r=!0}=e;super({...e,id:t,topRadius:0,topCap:Boolean(r),bottomCap:Boolean(r),bottomRadius:n})}}const zs=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Ks=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),$s=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Ys=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),qs={POSITION:{size:3,value:new Float32Array(Ks)},NORMAL:{size:3,value:new Float32Array($s)},TEXCOORD_0:{size:2,value:new Float32Array(Ys)}};class Qs extends Yn{constructor(e={}){const{id:t=_e("cube-geometry")}=e;super({...e,id:t,indices:{size:1,value:new Uint16Array(zs)},attributes:{...qs,...e.attributes}})}}class Zs extends js{constructor(e={}){const{id:t=_e("cylinder-geometry"),radius:n=1}=e;super({...e,id:t,bottomRadius:n,topRadius:n})}}const Js=[-1,0,0,0,1,0,0,0,-1,0,0,1,0,-1,0,1,0,0],ea=[3,4,5,3,5,1,3,1,0,3,0,4,4,0,2,4,2,5,2,0,1,5,2,1];class ta extends Yn{constructor(e={}){const{id:t=_e("ico-sphere-geometry")}=e,{indices:n,attributes:r}=function(e){const{iterations:t=0}=e,n=Math.PI,r=2*n,i=[...Js];let s=[...ea];i.push(),s.push();const a=(()=>{const e={};return(t,n)=>{const r=(t*=3)<(n*=3)?t:n,s=t>n?t:n,a=`${r}|${s}`;if(a in e)return e[a];const o=i[t],u=i[t+1],c=i[t+2],l=i[n],f=i[n+1],_=i[n+2];let h=(o+l)/2,d=(u+f)/2,E=(c+_)/2;const g=Math.sqrt(h*h+d*d+E*E);return h/=g,d/=g,E/=g,i.push(h,d,E),e[a]=i.length/3-1}})();for(let e=0;e<t;e++){const e=[];for(let t=0;t<s.length;t+=3){const n=a(s[t+0],s[t+1]),r=a(s[t+1],s[t+2]),i=a(s[t+2],s[t+0]);e.push(i,s[t+0],n,n,s[t+1],r,r,s[t+2],i,n,r,i)}s=e}const o=new Array(i.length),u=new Array(i.length/3*2);for(let e=s.length-3;e>=0;e-=3){const t=s[e+0],a=s[e+1],c=s[e+2],l=3*t,f=3*a,_=3*c,h=2*t,d=2*a,E=2*c,g=i[l+0],m=i[l+1],p=i[l+2],A=Math.acos(p/Math.sqrt(g*g+m*m+p*p)),T=Math.atan2(m,g)+n,R=A/n,v=1-T/r,b=i[f+0],I=i[f+1],N=i[f+2],S=Math.acos(N/Math.sqrt(b*b+I*I+N*N)),F=Math.atan2(I,b)+n,L=S/n,O=1-F/r,y=i[_+0],C=i[_+1],M=i[_+2],P=Math.acos(M/Math.sqrt(y*y+C*C+M*M)),B=Math.atan2(C,y)+n,D=P/n,x=1-B/r,U=[y-b,C-I,M-N],w=[g-b,m-I,p-N],G=new br(U).cross(w).normalize();let k;(0===v||0===O||0===x)&&(0===v||v>.5)&&(0===O||O>.5)&&(0===x||x>.5)&&(i.push(i[l+0],i[l+1],i[l+2]),k=i.length/3-1,s.push(k),u[2*k+0]=1,u[2*k+1]=R,o[3*k+0]=G.x,o[3*k+1]=G.y,o[3*k+2]=G.z,i.push(i[f+0],i[f+1],i[f+2]),k=i.length/3-1,s.push(k),u[2*k+0]=1,u[2*k+1]=L,o[3*k+0]=G.x,o[3*k+1]=G.y,o[3*k+2]=G.z,i.push(i[_+0],i[_+1],i[_+2]),k=i.length/3-1,s.push(k),u[2*k+0]=1,u[2*k+1]=D,o[3*k+0]=G.x,o[3*k+1]=G.y,o[3*k+2]=G.z),o[l+0]=o[f+0]=o[_+0]=G.x,o[l+1]=o[f+1]=o[_+1]=G.y,o[l+2]=o[f+2]=o[_+2]=G.z,u[h+0]=v,u[h+1]=R,u[d+0]=O,u[d+1]=L,u[E+0]=x,u[E+1]=D}return{indices:{size:1,value:new Uint16Array(s)},attributes:{POSITION:{size:3,value:new Float32Array(i)},NORMAL:{size:3,value:new Float32Array(o)},TEXCOORD_0:{size:2,value:new Float32Array(u)}}}}(e);super({...e,id:t,indices:n,attributes:{...r,...e.attributes}})}}class na extends Yn{constructor(e={}){const{id:t=_e("plane-geometry")}=e,{indices:n,attributes:r}=function(e){const{type:t="x,y",offset:n=0,flipCull:r=!1,unpack:i=!1}=e,s=t.split(",");let a=e[`${s[0]}len`]||1;const o=e[`${s[1]}len`]||1,u=e[`n${s[0]}`]||1,c=e[`n${s[1]}`]||1,l=(u+1)*(c+1),f=new Float32Array(3*l),_=new Float32Array(3*l),h=new Float32Array(2*l);r&&(a=-a);let d=0,E=0;for(let e=0;e<=c;e++)for(let i=0;i<=u;i++){const s=i/u,l=e/c;switch(h[d+0]=r?1-s:s,h[d+1]=l,t){case"x,y":f[E+0]=a*s-.5*a,f[E+1]=o*l-.5*o,f[E+2]=n,_[E+0]=0,_[E+1]=0,_[E+2]=r?1:-1;break;case"x,z":f[E+0]=a*s-.5*a,f[E+1]=n,f[E+2]=o*l-.5*o,_[E+0]=0,_[E+1]=r?1:-1,_[E+2]=0;break;case"y,z":f[E+0]=n,f[E+1]=a*s-.5*a,f[E+2]=o*l-.5*o,_[E+0]=r?1:-1,_[E+1]=0,_[E+2]=0;break;default:throw new Error("PlaneGeometry: unknown type")}d+=2,E+=3}const g=u+1,m=new Uint16Array(u*c*6);for(let e=0;e<c;e++)for(let t=0;t<u;t++){const n=6*(e*u+t);m[n+0]=(e+0)*g+t,m[n+1]=(e+1)*g+t,m[n+2]=(e+0)*g+t+1,m[n+3]=(e+1)*g+t,m[n+4]=(e+1)*g+t+1,m[n+5]=(e+0)*g+t+1}const p={indices:{size:1,value:m},attributes:{POSITION:{size:3,value:f},NORMAL:{size:3,value:_},TEXCOORD_0:{size:2,value:h}}};return i?function(e){const{indices:t,attributes:n}=e;if(!t)return e;const r=t.value.length,i={};for(const e in n){const s=n[e],{constant:a,value:o,size:u}=s;if(a||!u)continue;const c=new o.constructor(r*u);for(let e=0;e<r;++e){const n=t.value[e];for(let t=0;t<u;t++)c[e*u+t]=o[n*u+t]}i[e]={size:u,value:c}}return{attributes:Object.assign({},n,i)}}(p):p}(e);super({...e,id:t,indices:n,attributes:{...r,...e.attributes}})}}class ra extends Yn{constructor(e={}){const{id:t=_e("sphere-geometry")}=e,{indices:n,attributes:r}=function(e){const{nlat:t=10,nlong:n=10}=e;let{radius:r=1}=e;const i=Math.PI-0,s=2*Math.PI-0,a=(t+1)*(n+1);if("number"==typeof r){const e=r;r=(t,n,r,i,s)=>e}const o=new Float32Array(3*a),u=new Float32Array(3*a),c=new Float32Array(2*a),l=new Uint16Array(t*n*6);for(let e=0;e<=t;e++)for(let a=0;a<=n;a++){const l=a/n,f=e/t,_=a+e*(n+1),h=2*_,d=3*_,E=s*l,g=i*f,m=Math.sin(E),p=Math.cos(E),A=Math.sin(g),T=Math.cos(g),R=p*A,v=T,b=m*A,I=r(R,v,b,l,f);o[d+0]=I*R,o[d+1]=I*v,o[d+2]=I*b,u[d+0]=R,u[d+1]=v,u[d+2]=b,c[h+0]=l,c[h+1]=1-f}const f=t+1;for(let e=0;e<t;e++)for(let t=0;t<n;t++){const r=6*(e*n+t);l[r+0]=t*f+e,l[r+1]=t*f+e+1,l[r+2]=(t+1)*f+e,l[r+3]=(t+1)*f+e,l[r+4]=t*f+e+1,l[r+5]=(t+1)*f+e+1}return{indices:{size:1,value:l},attributes:{POSITION:{size:3,value:o},NORMAL:{size:3,value:u},TEXCOORD_0:{size:2,value:c}}}}(e);super({...e,id:t,indices:n,attributes:{...r,...e.attributes}})}}const ia={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]};class sa extends qn{constructor(e){super(e),e=Object.assign({},ia,e),Object.assign(this,e)}}class aa extends qn{}function oa(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var ua=function(e){function t(){return d(this,t),Qn(this,Zn(t).apply(this,arguments))}return er(t,ur),g(t,[{key:"toString",value:function(){var e="[";if(ir.printRowMajor){e+="row-major:";for(var t=0;t<this.RANK;++t)for(var n=0;n<this.RANK;++n)e+=" ".concat(this[n*this.RANK+t])}else{e+="column-major:";for(var r=0;r<this.ELEMENTS;++r)e+=" ".concat(this[r])}return e+="]"}},{key:"getElementIndex",value:function(e,t){return t*this.RANK+e}},{key:"getElement",value:function(e,t){return this[t*this.RANK+e]}},{key:"setElement",value:function(e,t,n){return this[t*this.RANK+e]=cr(n),this}},{key:"getColumn",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),n=e*this.RANK,r=0;r<this.RANK;++r)t[r]=this[n+r];return t}},{key:"setColumn",value:function(e,t){for(var n=e*this.RANK,r=0;r<this.RANK;++r)this[n+r]=t[r];return this}}]),t}();function ca(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],u=t[5],c=t[6],l=t[7],f=t[8],_=t[9],h=t[10],d=t[11],E=t[12],g=t[13],m=t[14],p=t[15],A=n[0],T=n[1],R=n[2],v=n[3];return e[0]=A*r+T*o+R*f+v*E,e[1]=A*i+T*u+R*_+v*g,e[2]=A*s+T*c+R*h+v*m,e[3]=A*a+T*l+R*d+v*p,A=n[4],T=n[5],R=n[6],v=n[7],e[4]=A*r+T*o+R*f+v*E,e[5]=A*i+T*u+R*_+v*g,e[6]=A*s+T*c+R*h+v*m,e[7]=A*a+T*l+R*d+v*p,A=n[8],T=n[9],R=n[10],v=n[11],e[8]=A*r+T*o+R*f+v*E,e[9]=A*i+T*u+R*_+v*g,e[10]=A*s+T*c+R*h+v*m,e[11]=A*a+T*l+R*d+v*p,A=n[12],T=n[13],R=n[14],v=n[15],e[12]=A*r+T*o+R*f+v*E,e[13]=A*i+T*u+R*_+v*g,e[14]=A*s+T*c+R*h+v*m,e[15]=A*a+T*l+R*d+v*p,e}function la(e,t,n){var r=n[0],i=n[1],s=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}!function(){var e=function(){var e=new Er(2);return Er!=Float32Array&&(e[0]=0,e[1]=0),e}()}();!function(){var e=function(){var e=new Er(4);return Er!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}()}();var fa=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),_a=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),ha=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),da={},Ea=function(e){function t(e){var n;return d(this,t),n=Qn(this,Zn(t).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(e)?n.copy(e):n.identity(),n}return er(t,ua),g(t,[{key:"INDICES",get:function(){return ha}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return da.IDENTITY=da.IDENTITY||Object.freeze(new t(fa)),da.IDENTITY}},{key:"ZERO",get:function(){return da.ZERO=da.ZERO||Object.freeze(new t(_a)),da.ZERO}}]),g(t,[{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}},{key:"set",value:function(e,t,n,r,i,s,a,o,u,c,l,f,_,h,d,E){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=a,this[7]=o,this[8]=u,this[9]=c,this[10]=l,this[11]=f,this[12]=_,this[13]=h,this[14]=d,this[15]=E,this.check()}},{key:"setRowMajor",value:function(e,t,n,r,i,s,a,o,u,c,l,f,_,h,d,E){return this[0]=e,this[1]=i,this[2]=u,this[3]=_,this[4]=t,this[5]=s,this[6]=c,this[7]=h,this[8]=n,this[9]=a,this[10]=l,this[11]=d,this[12]=r,this[13]=o,this[14]=f,this[15]=E,this.check()}},{key:"toRowMajor",value:function(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}},{key:"identity",value:function(){return this.copy(fa)}},{key:"fromQuaternion",value:function(e){return function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=n+n,o=r+r,u=i+i,c=n*a,l=r*a,f=r*o,_=i*a,h=i*o,d=i*u,E=s*a,g=s*o,m=s*u;e[0]=1-f-d,e[1]=l+m,e[2]=_-g,e[3]=0,e[4]=l-m,e[5]=1-c-d,e[6]=h+E,e[7]=0,e[8]=_+g,e[9]=h-E,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(this,e),this.check()}},{key:"frustum",value:function(e){var n=e.left,r=e.right,i=e.bottom,s=e.top,a=e.near,o=e.far;return o===1/0?t._computeInfinitePerspectiveOffCenter(this,n,r,i,s,a):function(e,t,n,r,i,s,a){var o=1/(n-t),u=1/(i-r),c=1/(s-a);e[0]=2*s*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*u,e[6]=0,e[7]=0,e[8]=(n+t)*o,e[9]=(i+r)*u,e[10]=(a+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*s*2*c,e[15]=0}(this,n,r,i,s,a,o),this.check()}},{key:"lookAt",value:function(e,t,n){if(1===arguments.length){var r=e;e=r.eye,t=r.center,n=r.up}return function(e,t,n,r){var i,s,a,o,u,c,l,f,_,h,d=t[0],E=t[1],g=t[2],m=r[0],p=r[1],A=r[2],T=n[0],R=n[1],v=n[2];Math.abs(d-T)<dr&&Math.abs(E-R)<dr&&Math.abs(g-v)<dr?function(e){e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1}(e):(l=d-T,f=E-R,_=g-v,i=p*(_*=h=1/Math.sqrt(l*l+f*f+_*_))-A*(f*=h),s=A*(l*=h)-m*_,a=m*f-p*l,(h=Math.sqrt(i*i+s*s+a*a))?(i*=h=1/h,s*=h,a*=h):(i=0,s=0,a=0),o=f*a-_*s,u=_*i-l*a,c=l*s-f*i,(h=Math.sqrt(o*o+u*u+c*c))?(o*=h=1/h,u*=h,c*=h):(o=0,u=0,c=0),e[0]=i,e[1]=o,e[2]=l,e[3]=0,e[4]=s,e[5]=u,e[6]=f,e[7]=0,e[8]=a,e[9]=c,e[10]=_,e[11]=0,e[12]=-(i*d+s*E+a*g),e[13]=-(o*d+u*E+c*g),e[14]=-(l*d+f*E+_*g),e[15]=1)}(this,e,t=t||[0,0,0],n=n||[0,1,0]),this.check()}},{key:"ortho",value:function(e){var t=e.left,n=e.right,r=e.bottom,i=e.top,s=e.near,a=void 0===s?.1:s,o=e.far;return function(e,t,n,r,i,s,a){var o=1/(t-n),u=1/(r-i),c=1/(s-a);e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*o,e[13]=(i+r)*u,e[14]=(a+s)*c,e[15]=1}(this,t,n,r,i,a,void 0===o?500:o),this.check()}},{key:"orthographic",value:function(e){var n=e.fovy,r=void 0===n?45*Math.PI/180:n,i=e.aspect,s=void 0===i?1:i,a=e.focalDistance,o=void 0===a?1:a,u=e.near,c=void 0===u?.1:u,l=e.far,f=void 0===l?500:l;if(r>2*Math.PI)throw Error("radians");var _=r/2,h=o*Math.tan(_),d=h*s;return(new t).ortho({left:-d,right:d,bottom:-h,top:h,near:c,far:f})}},{key:"perspective",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fovy,n=e.fov,r=void 0===n?45*Math.PI/180:n,i=e.aspect,s=void 0===i?1:i,a=e.near,o=void 0===a?.1:a,u=e.far,c=void 0===u?500:u;if((t=t||r)>2*Math.PI)throw Error("radians");return function(e,t,n,r,i){var s,a=1/Math.tan(t/2);e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(s=1/(r-i),e[10]=(i+r)*s,e[14]=2*i*r*s):(e[10]=-1,e[14]=-2*r)}(this,t,s,o,c),this.check()}},{key:"determinant",value:function(){return t=(e=this)[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],u=e[7],c=e[8],l=e[9],f=e[10],_=e[11],h=e[12],d=e[13],E=e[14],g=e[15],(t*a-n*s)*(f*g-_*E)-(t*o-r*s)*(l*g-_*d)+(t*u-i*s)*(l*E-f*d)+(n*o-r*a)*(c*g-_*h)-(n*u-i*a)*(c*E-f*h)+(r*u-i*o)*(c*d-l*h);var e,t,n,r,i,s,a,o,u,c,l,f,_,h,d,E,g}},{key:"getScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}},{key:"getTranslation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}},{key:"getRotation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(t||[-0,-0,-0]),r=1/n[0],i=1/n[1],s=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*i,e[2]=this[2]*s,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*i,e[6]=this[6]*s,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*i,e[10]=this[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{key:"getRotationMatrix3",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(t||[-0,-0,-0]),r=1/n[0],i=1/n[1],s=1/n[2];return e[0]=this[0]*r,e[1]=this[1]*i,e[2]=this[2]*s,e[3]=this[4]*r,e[4]=this[5]*i,e[5]=this[6]*s,e[6]=this[8]*r,e[7]=this[9]*i,e[8]=this[10]*s,e}},{key:"transpose",value:function(){return function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],s=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=s,e[11]=t[14],e[12]=i,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15]}(this,this),this.check()}},{key:"invert",value:function(){return function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5],u=t[6],c=t[7],l=t[8],f=t[9],_=t[10],h=t[11],d=t[12],E=t[13],g=t[14],m=t[15],p=n*o-r*a,A=n*u-i*a,T=n*c-s*a,R=r*u-i*o,v=r*c-s*o,b=i*c-s*u,I=l*E-f*d,N=l*g-_*d,S=l*m-h*d,F=f*g-_*E,L=f*m-h*E,O=_*m-h*g,y=p*O-A*L+T*F+R*S-v*N+b*I;y&&(y=1/y,e[0]=(o*O-u*L+c*F)*y,e[1]=(i*L-r*O-s*F)*y,e[2]=(E*b-g*v+m*R)*y,e[3]=(_*v-f*b-h*R)*y,e[4]=(u*S-a*O-c*N)*y,e[5]=(n*O-i*S+s*N)*y,e[6]=(g*T-d*b-m*A)*y,e[7]=(l*b-_*T+h*A)*y,e[8]=(a*L-o*S+c*I)*y,e[9]=(r*S-n*L-s*I)*y,e[10]=(d*v-E*T+m*p)*y,e[11]=(f*T-l*v-h*p)*y,e[12]=(o*N-a*F-u*I)*y,e[13]=(n*F-r*N+i*I)*y,e[14]=(E*A-d*R-g*p)*y,e[15]=(l*R-f*A+_*p)*y)}(this,this),this.check()}},{key:"multiplyLeft",value:function(e){return ca(this,e,this),this.check()}},{key:"multiplyRight",value:function(e){return ca(this,this,e),this.check()}},{key:"rotateX",value:function(e){return function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[4],a=t[5],o=t[6],u=t[7],c=t[8],l=t[9],f=t[10],_=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+c*r,e[5]=a*i+l*r,e[6]=o*i+f*r,e[7]=u*i+_*r,e[8]=c*i-s*r,e[9]=l*i-a*r,e[10]=f*i-o*r,e[11]=_*i-u*r}(this,this,e),this.check()}},{key:"rotateY",value:function(e){return function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],a=t[1],o=t[2],u=t[3],c=t[8],l=t[9],f=t[10],_=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-c*r,e[1]=a*i-l*r,e[2]=o*i-f*r,e[3]=u*i-_*r,e[8]=s*r+c*i,e[9]=a*r+l*i,e[10]=o*r+f*i,e[11]=u*r+_*i}(this,this,e),this.check()}},{key:"rotateZ",value:function(e){return function(e,t,n){var r=Math.sin(n),i=Math.cos(n),s=t[0],a=t[1],o=t[2],u=t[3],c=t[4],l=t[5],f=t[6],_=t[7];t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+c*r,e[1]=a*i+l*r,e[2]=o*i+f*r,e[3]=u*i+_*r,e[4]=c*i-s*r,e[5]=l*i-a*r,e[6]=f*i-o*r,e[7]=_*i-u*r}(this,this,e),this.check()}},{key:"rotateXYZ",value:function(e){var t=oa(e,3),n=t[0],r=t[1],i=t[2];return this.rotateX(n).rotateY(r).rotateZ(i)}},{key:"rotateAxis",value:function(e,t){return function(e,t,n,r){var i,s,a,o,u,c,l,f,_,h,d,E,g,m,p,A,T,R,v,b,I,N,S,F,L=r[0],O=r[1],y=r[2],C=Math.sqrt(L*L+O*O+y*y);C<dr||(L*=C=1/C,O*=C,y*=C,i=Math.sin(n),a=1-(s=Math.cos(n)),o=t[0],u=t[1],c=t[2],l=t[3],f=t[4],_=t[5],h=t[6],d=t[7],E=t[8],g=t[9],m=t[10],p=t[11],A=L*L*a+s,T=O*L*a+y*i,R=y*L*a-O*i,v=L*O*a-y*i,b=O*O*a+s,I=y*O*a+L*i,N=L*y*a+O*i,S=O*y*a-L*i,F=y*y*a+s,e[0]=o*A+f*T+E*R,e[1]=u*A+_*T+g*R,e[2]=c*A+h*T+m*R,e[3]=l*A+d*T+p*R,e[4]=o*v+f*b+E*I,e[5]=u*v+_*b+g*I,e[6]=c*v+h*b+m*I,e[7]=l*v+d*b+p*I,e[8]=o*N+f*S+E*F,e[9]=u*N+_*S+g*F,e[10]=c*N+h*S+m*F,e[11]=l*N+d*S+p*F,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}(this,this,e,t),this.check()}},{key:"scale",value:function(e){return Array.isArray(e)?la(this,this,e):la(this,this,[e,e,e]),this.check()}},{key:"translate",value:function(e){return function(e,t,n){var r,i,s,a,o,u,c,l,f,_,h,d,E=n[0],g=n[1],m=n[2];t===e?(e[12]=t[0]*E+t[4]*g+t[8]*m+t[12],e[13]=t[1]*E+t[5]*g+t[9]*m+t[13],e[14]=t[2]*E+t[6]*g+t[10]*m+t[14],e[15]=t[3]*E+t[7]*g+t[11]*m+t[15]):(r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],u=t[5],c=t[6],l=t[7],f=t[8],_=t[9],h=t[10],d=t[11],e[0]=r,e[1]=i,e[2]=s,e[3]=a,e[4]=o,e[5]=u,e[6]=c,e[7]=l,e[8]=f,e[9]=_,e[10]=h,e[11]=d,e[12]=r*E+o*g+f*m+t[12],e[13]=i*E+u*g+_*m+t[13],e[14]=s*E+c*g+h*m+t[14],e[15]=a*E+l*g+d*m+t[15])}(this,this,e),this.check()}},{key:"transform",value:function(e,t){return 4===e.length?(lr(t=function(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*a,e}(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}},{key:"transformAsPoint",value:function(e,t){switch(e.length){case 2:t=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e}(t||[-0,-0],e,this);break;case 3:t=pr(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return lr(t,e.length),t}},{key:"transformAsVector",value:function(e,t){switch(e.length){case 2:t=function(e,t,n){var r=t[0],i=t[1],s=n[3]*r+n[7]*i||1;return e[0]=(n[0]*r+n[4]*i)/s,e[1]=(n[1]*r+n[5]*i)/s,e}(t||[-0,-0],e,this);break;case 3:t=Rr(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return lr(t,e.length),t}},{key:"makeRotationX",value:function(e){return this.identity().rotateX(e)}},{key:"makeTranslation",value:function(e,t,n){return this.identity().translate([e,t,n])}},{key:"transformPoint",value:function(e,t){return _r("Matrix4.transformPoint","3.0"),this.transformAsPoint(e,t)}},{key:"transformVector",value:function(e,t){return _r("Matrix4.transformVector","3.0"),this.transformAsPoint(e,t)}},{key:"transformDirection",value:function(e,t){return _r("Matrix4.transformDirection","3.0"),this.transformAsVector(e,t)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(e,t,n,r,i,s){var a=2*s/(n-t),o=2*s/(i-r),u=(n+t)/(n-t),c=(i+r)/(i-r),l=-2*s;return e[0]=a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=u,e[9]=c,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=l,e[15]=0,e}}]),t}();class ga{constructor(e={}){const{id:t}=e;this.id=t||_e(this.constructor.name),this.display=!0,this.position=new br,this.rotation=new br,this.scale=new br(1,1,1),this.matrix=new Ea,this.userData={},this.props={},this._setScenegraphNodeProps(e)}delete(){}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return r(3===e.length,"setPosition requires vector argument"),this.position=e,this}setRotation(e){return r(3===e.length,"setRotation requires vector argument"),this.rotation=e,this}setScale(e){return r(3===e.length,"setScale requires vector argument"),this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents({position:e,rotation:t,scale:n,update:r=!0}){return e&&this.setPosition(e),t&&this.setRotation(t),n&&this.setScale(n),r&&this.updateMatrix(),this}updateMatrix(){const e=this.position,t=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(n),this}update({position:e,rotation:t,scale:n}={}){return e&&this.setPosition(e),t&&this.setRotation(t),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,t){r(e),t=t||this.matrix;const n=new Ea(e).multiplyRight(t),i=n.invert(),s=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:n,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"display"in e&&(this.display=e.display),"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class ma extends ga{constructor(e={}){e=Array.isArray(e)?{children:e}:e;const{children:t=[]}=e;M.assert(t.every(e=>e instanceof ga),"every child must an instance of ScenegraphNode"),super(e),this.children=t}add(...e){for(const t of e)Array.isArray(t)?this.add(...t):this.children.push(t);return this}remove(e){const t=this.children,n=t.indexOf(e);return n>-1&&t.splice(n,1),this}removeAll(){return this.children=[],this}delete(){this.children.forEach(e=>e.delete()),this.removeAll(),super.delete()}traverse(e,{worldMatrix:t=new Ea}={}){const n=new Ea(t).multiplyRight(this.matrix);for(const t of this.children)t instanceof ma?t.traverse(e,{worldMatrix:n}):e(t,{worldMatrix:n})}traverseReverse(e,t){return M.warn("traverseReverse is not reverse")(),this.traverse(e,t)}}class pa extends ga{constructor(e,t={}){super(t),this.onBeforeRender=null,this.AfterRender=null,e instanceof ns?(this.model=e,this._setModelNodeProps(t)):this.model=new ns(e,t),this.managedResources=t.managedResources||[]}setProps(e){return super.setProps(e),this._setModelNodeProps(e),this}delete(){this.model&&(this.model.delete(),this.model=null),this.managedResources.forEach(e=>e.delete()),this.managedResources=[]}draw(...e){return this.model.draw(...e)}setUniforms(...e){return this.model.setUniforms(...e),this}setAttributes(...e){return this.model.setAttributes(...e),this}updateModuleSettings(...e){return this.model.updateModuleSettings(...e),this}_setModelNodeProps(e){this.model.setProps(e)}}class Aa extends ga{constructor(e={}){super(e),this.projectionMatrix=e.projectionMatrix}}var Ta={name:"fp32",vs:"#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n\n// All these functions are for substituting tan() function from Intel GPU only\nconst float TWO_PI = 6.2831854820251465;\nconst float PI_2 = 1.5707963705062866;\nconst float PI_16 = 0.1963495463132858;\n\nconst float SIN_TABLE_0 = 0.19509032368659973;\nconst float SIN_TABLE_1 = 0.3826834261417389;\nconst float SIN_TABLE_2 = 0.5555702447891235;\nconst float SIN_TABLE_3 = 0.7071067690849304;\n\nconst float COS_TABLE_0 = 0.9807852506637573;\nconst float COS_TABLE_1 = 0.9238795042037964;\nconst float COS_TABLE_2 = 0.8314695954322815;\nconst float COS_TABLE_3 = 0.7071067690849304;\n\nconst float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!\nconst float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!\nconst float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!\nconst float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!\n\nfloat sin_taylor_fp32(float a) {\n  float r, s, t, x;\n\n  if (a == 0.0) {\n    return 0.0;\n  }\n\n  x = -a * a;\n  s = a;\n  r = a;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_3;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_5;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_7;\n  s = s + t;\n\n  r = r * x;\n  t = r * INVERSE_FACTORIAL_9;\n  s = s + t;\n\n  return s;\n}\n\nvoid sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {\n  if (a == 0.0) {\n    sin_t = 0.0;\n    cos_t = 1.0;\n  }\n  sin_t = sin_taylor_fp32(a);\n  cos_t = sqrt(1.0 - sin_t * sin_t);\n}\n\nfloat tan_taylor_fp32(float a) {\n    float sin_a;\n    float cos_a;\n\n    if (a == 0.0) {\n        return 0.0;\n    }\n\n    // 2pi range reduction\n    float z = floor(a / TWO_PI);\n    float r = a - TWO_PI * z;\n\n    float t;\n    float q = floor(r / PI_2 + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return 0.0 / 0.0;\n    }\n\n    t = r - PI_2 * q;\n\n    q = floor(t / PI_16 + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return 0.0 / 0.0;\n    } else {\n        t = t - PI_16 * q;\n    }\n\n    float u = 0.0;\n    float v = 0.0;\n\n    float sin_t, cos_t;\n    float s, c;\n    sincos_taylor_fp32(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0;\n            v = SIN_TABLE_0;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1;\n            v = SIN_TABLE_1;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2;\n            v = SIN_TABLE_2;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3;\n            v = SIN_TABLE_3;\n        }\n        if (k > 0) {\n            s = u * sin_t + v * cos_t;\n            c = u * cos_t - v * sin_t;\n        } else {\n            s = u * sin_t - v * cos_t;\n            c = u * cos_t + v * sin_t;\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return sin_a / cos_a;\n}\n#endif\n\nfloat tan_fp32(float a) {\n#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND\n  return tan_taylor_fp32(a);\n#else\n  return tan(a);\n#endif\n}\n",fs:null};function Ra(e,t=[],n=0){const r=Math.fround(e),i=e-r;return t[n]=r,t[n+1]=i,t}var va="uniform float ONE;\n\n/*\nAbout LUMA_FP64_CODE_ELIMINATION_WORKAROUND\n\nThe purpose of this workaround is to prevent shader compilers from\noptimizing away necessary arithmetic operations by swapping their sequences\nor transform the equation to some 'equivalent' from.\n\nThe method is to multiply an artifical variable, ONE, which will be known to\nthe compiler to be 1 only at runtime. The whole expression is then represented\nas a polynomial with respective to ONE. In the coefficients of all terms, only one a\nand one b should appear\n\nerr = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE\n*/\n\n// Divide float number to high and low floats to extend fraction bits\nvec2 split(float a) {\n  const float SPLIT = 4097.0;\n  float t = a * SPLIT;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float a_hi = t * ONE - (t - a);\n  float a_lo = a * ONE - a_hi;\n#else\n  float a_hi = t - (t - a);\n  float a_lo = a - a_hi;\n#endif\n  return vec2(a_hi, a_lo);\n}\n\n// Divide float number again when high float uses too many fraction bits\nvec2 split2(vec2 a) {\n  vec2 b = split(a.x);\n  b.y += a.y;\n  return b;\n}\n\n// Special sum operation when a > b\nvec2 quickTwoSum(float a, float b) {\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float sum = (a + b) * ONE;\n  float err = b - (sum - a) * ONE;\n#else\n  float sum = a + b;\n  float err = b - (sum - a);\n#endif\n  return vec2(sum, err);\n}\n\n// General sum operation\nvec2 twoSum(float a, float b) {\n  float s = (a + b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) + (b - v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSub(float a, float b) {\n  float s = (a - b);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float v = (s * ONE - a) * ONE;\n  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);\n#else\n  float v = s - a;\n  float err = (a - (s - v)) - (b + v);\n#endif\n  return vec2(s, err);\n}\n\nvec2 twoSqr(float a) {\n  float prod = a * a;\n  vec2 a_fp64 = split(a);\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *\n    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;\n#else\n  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;\n#endif\n  return vec2(prod, err);\n}\n\nvec2 twoProd(float a, float b) {\n  float prod = a * b;\n  vec2 a_fp64 = split(a);\n  vec2 b_fp64 = split(b);\n  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +\n    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;\n  return vec2(prod, err);\n}\n\nvec2 sum_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSum(a.x, b.x);\n  t = twoSum(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 sub_fp64(vec2 a, vec2 b) {\n  vec2 s, t;\n  s = twoSub(a.x, b.x);\n  t = twoSub(a.y, b.y);\n  s.y += t.x;\n  s = quickTwoSum(s.x, s.y);\n  s.y += t.y;\n  s = quickTwoSum(s.x, s.y);\n  return s;\n}\n\nvec2 mul_fp64(vec2 a, vec2 b) {\n  vec2 prod = twoProd(a.x, b.x);\n  // y component is for the error\n  prod.y += a.x * b.y;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  prod.y += a.y * b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  prod = split2(prod);\n#endif\n  prod = quickTwoSum(prod.x, prod.y);\n  return prod;\n}\n\nvec2 div_fp64(vec2 a, vec2 b) {\n  float xn = 1.0 / b.x;\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  vec2 yn = mul_fp64(a, vec2(xn, 0));\n#else\n  vec2 yn = a * xn;\n#endif\n  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;\n  vec2 prod = twoProd(xn, diff);\n  return sum_fp64(yn, prod);\n}\n\nvec2 sqrt_fp64(vec2 a) {\n  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n\n  float x = 1.0 / sqrt(a.x);\n  float yn = a.x * x;\n#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)\n  vec2 yn_sqr = twoSqr(yn) * ONE;\n#else\n  vec2 yn_sqr = twoSqr(yn);\n#endif\n  float diff = sub_fp64(a, yn_sqr).x;\n  vec2 prod = twoProd(x * 0.5, diff);\n#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)\n  return sum_fp64(split(yn), prod);\n#else\n  return sum_fp64(vec2(yn, 0.0), prod);\n#endif\n}\n";const ba=`${va}\nconst vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);\nconst vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);\nconst vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);\nconst vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);\nconst vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);\nconst vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);\nconst vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);\nconst vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);\nconst vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);\nconst vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);\n\nconst vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);\nconst vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);\nconst vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);\nconst vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);\n\nconst vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);\nconst vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);\nconst vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);\nconst vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);\n\nconst vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09); // 1/3!\nconst vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09); // 1/4!\nconst vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10); // 1/5!\nconst vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11); // 1/6!\nconst vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12); // 1/7!\nconst vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13); // 1/8!\nconst vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14); // 1/9!\nconst vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15); // 1/10!\n\nfloat nint(float d) {\n    if (d == floor(d)) return d;\n    return floor(d + 0.5);\n}\n\nvec2 nint_fp64(vec2 a) {\n    float hi = nint(a.x);\n    float lo;\n    vec2 tmp;\n    if (hi == a.x) {\n        lo = nint(a.y);\n        tmp = quickTwoSum(hi, lo);\n    } else {\n        lo = 0.0;\n        if (abs(hi - a.x) == 0.5 && a.y < 0.0) {\n            hi -= 1.0;\n        }\n        tmp = vec2(hi, lo);\n    }\n    return tmp;\n}\n\n/* k_power controls how much range reduction we would like to have\nRange reduction uses the following method:\nassume a = k_power * r + m * log(2), k and m being integers.\nSet k_power = 4 (we can choose other k to trade accuracy with performance.\nwe only need to calculate exp(r) and using exp(a) = 2^m * exp(r)^k_power;\n*/\n\nvec2 exp_fp64(vec2 a) {\n  // We need to make sure these two numbers match\n  // as bit-wise shift is not available in GLSL 1.0\n  const int k_power = 4;\n  const float k = 16.0;\n\n  const float inv_k = 1.0 / k;\n\n  if (a.x <= -88.0) return vec2(0.0, 0.0);\n  if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);\n  if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);\n  if (a.x == 1.0 && a.y == 0.0) return E_FP64;\n\n  float m = floor(a.x / LOG2_FP64.x + 0.5);\n  vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;\n  vec2 s, t, p;\n\n  p = mul_fp64(r, r);\n  s = sum_fp64(r, p * 0.5);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);\n\n  s = sum_fp64(s, t);\n  p = mul_fp64(p, r);\n  t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);\n\n  // s = sum_fp64(s, t);\n  // p = mul_fp64(p, r);\n  // t = mul_fp64(p, INVERSE_FACTORIAL_6_FP64);\n\n  // s = sum_fp64(s, t);\n  // p = mul_fp64(p, r);\n  // t = mul_fp64(p, INVERSE_FACTORIAL_7_FP64);\n\n  s = sum_fp64(s, t);\n\n\n  // At this point, s = exp(r) - 1; but after following 4 recursions, we will get exp(r) ^ 512 - 1.\n  for (int i = 0; i < k_power; i++) {\n    s = sum_fp64(s * 2.0, mul_fp64(s, s));\n  }\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = sum_fp64(s, vec2(ONE, 0.0));\n#else\n  s = sum_fp64(s, vec2(1.0, 0.0));\n#endif\n\n  return s * pow(2.0, m);\n//   return r;\n}\n\nvec2 log_fp64(vec2 a)\n{\n  if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);\n  if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);\n  vec2 x = vec2(log(a.x), 0.0);\n  vec2 s;\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n  s = vec2(ONE, 0.0);\n#else\n  s = vec2(1.0, 0.0);\n#endif\n\n  x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);\n  return x;\n}\n\nvec2 sin_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(0.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  s = a;\n  r = a;\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);\n  s = sum_fp64(s, t);\n\n  /* keep the following commented code in case we need them\n  for extra accuracy from the Taylor expansion*/\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_7_FP64);\n  // s = sum_fp64(s, t);\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_9_FP64);\n  // s = sum_fp64(s, t);\n\n  return s;\n}\n\nvec2 cos_taylor_fp64(vec2 a) {\n  vec2 r, s, t, x;\n\n  if (a.x == 0.0 && a.y == 0.0) {\n    return vec2(1.0, 0.0);\n  }\n\n  x = -mul_fp64(a, a);\n  r = x;\n  s = sum_fp64(vec2(1.0, 0.0), r * 0.5);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);\n  s = sum_fp64(s, t);\n\n  r = mul_fp64(r, x);\n  t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);\n  s = sum_fp64(s, t);\n\n  /* keep the following commented code in case we need them\n  for extra accuracy from the Taylor expansion*/\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_8_FP64);\n  // s = sum_fp64(s, t);\n\n  // r = mul_fp64(r, x);\n  // t = mul_fp64(r, INVERSE_FACTORIAL_10_FP64);\n  // s = sum_fp64(s, t);\n\n  return s;\n}\n\nvoid sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {\n  if (a.x == 0.0 && a.y == 0.0) {\n    sin_t = vec2(0.0, 0.0);\n    cos_t = vec2(1.0, 0.0);\n  }\n\n  sin_t = sin_taylor_fp64(a);\n  cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));\n}\n\nvec2 sin_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return sin_taylor_fp64(t);\n        } else if (j == 1) {\n            return cos_taylor_fp64(t);\n        } else if (j == -1) {\n            return -cos_taylor_fp64(t);\n        } else {\n            return -sin_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 cos_fp64(vec2 a) {\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(1.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n\n    if (k == 0) {\n        if (j == 0) {\n            return cos_taylor_fp64(t);\n        } else if (j == 1) {\n            return -sin_taylor_fp64(t);\n        } else if (j == -1) {\n            return sin_taylor_fp64(t);\n        } else {\n            return -cos_taylor_fp64(t);\n        }\n    }\n\n    int abs_k = int(abs(float(k)));\n\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n    if (abs(float(abs_k) - 1.0) < 0.5) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs(float(abs_k) - 2.0) < 0.5) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs(float(abs_k) - 3.0) < 0.5) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs(float(abs_k) - 4.0) < 0.5) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#else\n    if (abs_k == 1) {\n        u = COS_TABLE_0_FP64;\n        v = SIN_TABLE_0_FP64;\n    } else if (abs_k == 2) {\n        u = COS_TABLE_1_FP64;\n        v = SIN_TABLE_1_FP64;\n    } else if (abs_k == 3) {\n        u = COS_TABLE_2_FP64;\n        v = SIN_TABLE_2_FP64;\n    } else if (abs_k == 4) {\n        u = COS_TABLE_3_FP64;\n        v = SIN_TABLE_3_FP64;\n    }\n#endif\n\n    vec2 sin_t, cos_t;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    vec2 result = vec2(0.0, 0.0);\n    if (j == 0) {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    } else if (j == 1) {\n        if (k > 0) {\n            result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));\n        }\n    } else if (j == -1) {\n        if (k > 0) {\n            result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        } else {\n            result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n        }\n    } else {\n        if (k > 0) {\n            result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));\n        } else {\n            result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    return result;\n}\n\nvec2 tan_fp64(vec2 a) {\n    vec2 sin_a;\n    vec2 cos_a;\n\n    if (a.x == 0.0 && a.y == 0.0) {\n        return vec2(0.0, 0.0);\n    }\n\n    // 2pi range reduction\n    vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));\n    vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));\n\n    vec2 t;\n    float q = floor(r.x / PI_2_FP64.x + 0.5);\n    int j = int(q);\n\n\n    if (j < -2 || j > 2) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    }\n\n    t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));\n\n    q = floor(t.x / PI_16_FP64.x + 0.5);\n    int k = int(q);\n    int abs_k = int(abs(float(k)));\n\n    // We just can't get PI/16 * 3.0 very accurately.\n    // so let's just store it\n    if (abs_k > 4) {\n        return vec2(0.0 / 0.0, 0.0 / 0.0);\n    } else {\n        t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));\n    }\n\n\n    vec2 u = vec2(0.0, 0.0);\n    vec2 v = vec2(0.0, 0.0);\n\n    vec2 sin_t, cos_t;\n    vec2 s, c;\n    sincos_taylor_fp64(t, sin_t, cos_t);\n\n    if (k == 0) {\n        s = sin_t;\n        c = cos_t;\n    } else {\n#if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)\n        if (abs(float(abs_k) - 1.0) < 0.5) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs(float(abs_k) - 2.0) < 0.5) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs(float(abs_k) - 3.0) < 0.5) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs(float(abs_k) - 4.0) < 0.5) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#else\n        if (abs_k == 1) {\n            u = COS_TABLE_0_FP64;\n            v = SIN_TABLE_0_FP64;\n        } else if (abs_k == 2) {\n            u = COS_TABLE_1_FP64;\n            v = SIN_TABLE_1_FP64;\n        } else if (abs_k == 3) {\n            u = COS_TABLE_2_FP64;\n            v = SIN_TABLE_2_FP64;\n        } else if (abs_k == 4) {\n            u = COS_TABLE_3_FP64;\n            v = SIN_TABLE_3_FP64;\n        }\n#endif\n        if (k > 0) {\n            s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        } else {\n            s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));\n            c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));\n        }\n    }\n\n    if (j == 0) {\n        sin_a = s;\n        cos_a = c;\n    } else if (j == 1) {\n        sin_a = c;\n        cos_a = -s;\n    } else if (j == -1) {\n        sin_a = -c;\n        cos_a = s;\n    } else {\n        sin_a = -s;\n        cos_a = -c;\n    }\n    return div_fp64(sin_a, cos_a);\n}\n\nvec2 radians_fp64(vec2 degree) {\n  return mul_fp64(degree, PI_180_FP64);\n}\n\nvec2 mix_fp64(vec2 a, vec2 b, float x) {\n  vec2 range = sub_fp64(b, a);\n  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));\n}\n\n// Vector functions\n// vec2 functions\nvoid vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sum_fp64(a[0], b[0]);\n    out_val[1] = sum_fp64(a[1], b[1]);\n}\n\nvoid vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = sub_fp64(a[0], b[0]);\n    out_val[1] = sub_fp64(a[1], b[1]);\n}\n\nvoid vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = mul_fp64(a[0], b[0]);\n    out_val[1] = mul_fp64(a[1], b[1]);\n}\n\nvoid vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {\n    out_val[0] = div_fp64(a[0], b[0]);\n    out_val[1] = div_fp64(a[1], b[1]);\n}\n\nvoid vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {\n  vec2 range[2];\n  vec2_sub_fp64(y, x, range);\n  vec2 portion[2];\n  portion[0] = range[0] * a;\n  portion[1] = range[1] * a;\n  vec2_sum_fp64(x, portion, out_val);\n}\n\nvec2 vec2_length_fp64(vec2 x[2]) {\n  return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));\n}\n\nvoid vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {\n  vec2 length = vec2_length_fp64(x);\n  vec2 length_vec2[2];\n  length_vec2[0] = length;\n  length_vec2[1] = length;\n\n  vec2_div_fp64(x, length_vec2, out_val);\n}\n\nvec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {\n  vec2 diff[2];\n  vec2_sub_fp64(x, y, diff);\n  return vec2_length_fp64(diff);\n}\n\nvec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {\n  vec2 v[2];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n\n  return sum_fp64(v[0], v[1]);\n}\n\n// vec3 functions\nvoid vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {\n  for (int i = 0; i < 3; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvec2 vec3_length_fp64(vec2 x[3]) {\n  return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),\n    mul_fp64(x[2], x[2])));\n}\n\nvec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {\n  vec2 diff[3];\n  vec3_sub_fp64(x, y, diff);\n  return vec3_length_fp64(diff);\n}\n\n// vec4 functions\nvoid vec4_fp64(vec4 a, out vec2 out_val[4]) {\n  out_val[0].x = a[0];\n  out_val[0].y = 0.0;\n\n  out_val[1].x = a[1];\n  out_val[1].y = 0.0;\n\n  out_val[2].x = a[2];\n  out_val[2].y = 0.0;\n\n  out_val[3].x = a[3];\n  out_val[3].y = 0.0;\n}\n\nvoid vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {\n  out_val[0] = mul_fp64(a[0], b);\n  out_val[1] = mul_fp64(a[1], b);\n  out_val[2] = mul_fp64(a[2], b);\n  out_val[3] = mul_fp64(a[3], b);\n}\n\nvoid vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {\n  for (int i = 0; i < 4; i++) {\n    out_val[i] = sum_fp64(a[i], b[i]);\n  }\n}\n\nvoid vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {\n  vec2 v[4];\n\n  v[0] = mul_fp64(a[0], b[0]);\n  v[1] = mul_fp64(a[1], b[1]);\n  v[2] = mul_fp64(a[2], b[2]);\n  v[3] = mul_fp64(a[3], b[3]);\n\n  out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));\n}\n\nvoid mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {\n  vec2 tmp[4];\n\n  for (int i = 0; i < 4; i++)\n  {\n    for (int j = 0; j < 4; j++)\n    {\n      tmp[j] = b[j + i * 4];\n    }\n    vec4_dot_fp64(a, tmp, out_val[i]);\n  }\n}\n`,Ia={ONE:1};var Na={name:"fp64",vs:ba,fs:null,fp64ify:Ra,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){const t=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=4*n+r;Ra(e[4*r+n],t,2*i)}return t},getUniforms:function(){return Object.assign({},Ia)}};const Sa=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Fa={modelMatrix:Sa,viewMatrix:Sa,projectionMatrix:Sa,cameraPositionWorld:[0,0,0]};const La="varying vec4 project_vPositionWorld;\nvarying vec3 project_vNormalWorld;\n\nvec4 project_getPosition_World() {\n  return project_vPositionWorld;\n}\n\nvec3 project_getNormal_World() {\n  return project_vNormalWorld;\n}\n";var Oa={name:"project",getUniforms:function(e=Fa,t={}){const n={};return void 0!==e.modelMatrix&&(n.modelMatrix=e.modelMatrix),void 0!==e.viewMatrix&&(n.viewMatrix=e.viewMatrix),void 0!==e.projectionMatrix&&(n.projectionMatrix=e.projectionMatrix),void 0!==e.cameraPositionWorld&&(n.cameraPositionWorld=e.cameraPositionWorld),void 0===e.projectionMatrix&&void 0===e.viewMatrix||(n.viewProjectionMatrix=new Ea(e.projectionMatrix).multiplyRight(e.viewMatrix)),n},vs:`${La}\n\n// Unprefixed uniforms\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform vec3 cameraPositionWorld;\n\nstruct World {\n  vec3 position;\n  vec3 normal;\n};\n\nWorld world;\n\nvoid project_setPosition(vec4 position) {\n  project_vPositionWorld = position;\n}\n\nvoid project_setNormal(vec3 normal) {\n  project_vNormalWorld = normal;\n}\n\nvoid project_setPositionAndNormal_World(vec3 position, vec3 normal) {\n  world.position = position;\n  world.normal = normal;\n}\n\nvoid project_setPositionAndNormal_Model(vec3 position, vec3 normal) {\n  world.position = (modelMatrix * vec4(position, 1.)).xyz;\n  world.normal = mat3(modelMatrix) * normal;\n}\n\nvec4 project_model_to_clipspace(vec4 position) {\n  return viewProjectionMatrix * modelMatrix * position;\n}\n\nvec4 project_model_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * modelMatrix * vec4(position, 1.);\n}\n\nvec4 project_world_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_view_to_clipspace(vec3 position) {\n  return projectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n`,fs:`\n${La}`},ya="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n\n // Constant-Linear-Exponential\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",Ca={name:"lights",vs:ya,fs:ya,getUniforms:function e(t=Ma){if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:r}=t.lightSources||{},i=e||n&&n.length>0||r&&r.length>0;return i?Object.assign({},function({ambientLight:e,pointLights:t=[],directionalLights:n=[]}){const r={};r["lighting_uAmbientLight.color"]=e?Pa(e):[0,0,0];return t.forEach((e,t)=>{r[`lighting_uPointLight[${t}].color`]=Pa(e),r[`lighting_uPointLight[${t}].position`]=e.position,r[`lighting_uPointLight[${t}].attenuation`]=e.attenuation}),r.lighting_uPointLightCount=t.length,n.forEach((e,t)=>{r[`lighting_uDirectionalLight[${t}].color`]=Pa(e),r[`lighting_uDirectionalLight[${t}].direction`]=e.direction}),r.lighting_uDirectionalLightCount=n.length,r}({ambientLight:e,pointLights:n,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const n={pointLights:[],directionalLights:[]};for(const e of t.lights||[])switch(e.type){case"ambient":n.ambientLight=e;break;case"directional":n.directionalLights.push(e);break;case"point":n.pointLights.push(e)}return e({lightSources:n})}return{}},defines:{MAX_LIGHTS:3}};const Ma={};function Pa({color:e=[0,0,0],intensity:t=1}={}){return e.map(e=>e*t/255)}const Ba={lightDirection:new Float32Array([1,1,2])};var Da={name:"dirlight",vs:null,fs:"uniform vec3 dirlight_uLightDirection;\n\n/*\n * Returns color attenuated by angle from light source\n */\nvec4 dirlight_filterColor(vec4 color) {\n  vec3 normal = project_getNormal_World();\n  float d = abs(dot(normalize(normal), normalize(dirlight_uLightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n",getUniforms:function(e=Ba){const t={};return e.lightDirection&&(t.dirlight_uLightDirection=e.lightDirection),t},dependencies:[Oa]};const xa={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingThreshold:1,pickingActive:!1};var Ua={name:"picking",vs:"uniform vec3 picking_uSelectedColor;\nuniform float picking_uThreshold;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    abs(vertexColor.r - picking_uSelectedColor.r) < picking_uThreshold &&\n    abs(vertexColor.g - picking_uSelectedColor.g) < picking_uThreshold &&\n    abs(vertexColor.b - picking_uSelectedColor.b) < picking_uThreshold;\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n  picking_vRGBcolor_Aselected.a =\n    float(isVertexPicked(pickingColor));\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  picking_vRGBcolor_Aselected.rgb = pickingColor * COLOR_SCALE;\n}\n",fs:"uniform bool picking_uActive; // true during rendering to offscreen picking buffer\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Aselected;\n\nconst float COLOR_SCALE = 1. / 255.;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  bool selected = bool(picking_vRGBcolor_Aselected.a);\n\n  if (selected) {\n    vec4 highLightColor = picking_uHighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  vec3 pickingColor = picking_vRGBcolor_Aselected.rgb;\n  if (picking_uActive && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return picking_uActive ? vec4(pickingColor, 1.0) : color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(e=xa){const t={};if(void 0!==e.pickingSelectedColor)if(null===e.pickingSelectedColor)t.picking_uSelectedColorValid=0;else{const n=[e.pickingSelectedColor[0],e.pickingSelectedColor[1],e.pickingSelectedColor[2]];t.picking_uSelectedColorValid=1,t.picking_uSelectedColor=n}return void 0!==e.pickingHighlightColor&&(t.picking_uHighlightColor=e.pickingHighlightColor),void 0!==e.pickingThreshold&&(t.picking_uThreshold=e.pickingThreshold),void 0!==e.pickingActive&&(t.picking_uActive=e.pickingActive?1:0),t}};const wa={diffuseTexture:null,diffuseColor:[.5,.5,.5,1]};var Ga={name:"diffuse",getUniforms:function(e=wa){const t={};return void 0!==e.diffuseTexture&&(t.diffuse_uHasTexture=Boolean(e.diffuseTexture),t.diffuse_uTexture=e.diffuseTexture),void 0!==e.diffuseColor&&(t.diffuse_uColor=e.diffuseColor),t},vs:"out vec2 diffuse_vTexCoord;\n\n/* Set the UV coordinate from attributes */\nvoid diffuse_setTextureCoordinate(vec2 uv) {\n  diffuse_vTexCoord = uv;\n}\n",fs:"uniform vec4 diffuse_uColor;\nuniform bool diffuse_uHasTexture;\nuniform sampler2D diffuse_uTexture;\n\nin vec2 diffuse_vTexCoord;\n\n// Gets diffuse color of material from uniform\n// If we have a standard (diffuse) texture, set color to texture\n// return (vec4) - rgba\n//\nvec4 diffuse_getColor() {\n  vec2 texCoord = diffuse_vTexCoord;\n  return diffuse_uHasTexture ?\n    texture2D(diffuse_uTexture, vec2(texCoord.s, texCoord.t)) :\n    diffuse_uColor;\n}\n\nvec4 diffuse_filterColor(vec4 color) {\n  return diffuse_getColor();\n}\n"},ka="\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n";const Ha={name:"gouraud-lighting",dependencies:[Ca],vs:ka,defines:{LIGHTING_VERTEX:1},getUniforms:ja},Va={name:"phong-lighting",dependencies:[Ca],fs:ka,defines:{LIGHTING_FRAGMENT:1},getUniforms:ja},Xa={};function ja(e=Xa){if(!("material"in e))return{};const{material:t}=e;return t?function(e){const t={};return t.lighting_uAmbient=e.ambient,t.lighting_uDiffuse=e.diffuse,t.lighting_uShininess=e.shininess,t.lighting_uSpecularColor=e.specularColor.map(e=>e/255),t}(t):{lighting_uEnabled:!1}}var Wa="uniform mat4 u_MVPMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_NormalMatrix;\n",za={name:"pbr",vs:"varying vec3 pbr_vPosition;\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n# ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n# else\nvarying vec3 pbr_vNormal;\n# endif\n#endif\n\nvoid pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)\n{\n  vec4 pos = u_ModelMatrix * position;\n  pbr_vPosition = vec3(pos.xyz) / pos.w;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\n  vec3 normalW = normalize(vec3(u_NormalMatrix * vec4(normal.xyz, 0.0)));\n  vec3 tangentW = normalize(vec3(u_ModelMatrix * vec4(tangent.xyz, 0.0)));\n  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;\n  pbr_vTBN = mat3(tangentW, bitangentW, normalW);\n#else // HAS_TANGENTS != 1\n  pbr_vNormal = normalize(vec3(u_ModelMatrix * vec4(normal.xyz, 0.0)));\n#endif\n#endif\n\n#ifdef HAS_UV\n  pbr_vUV = uv;\n#else\n  pbr_vUV = vec2(0.,0.);\n#endif\n}\n",fs:"#if (__VERSION__ < 300)\n#extension GL_EXT_shader_texture_lod: enable\n#extension GL_OES_standard_derivatives : enable\n#endif\n\n// WebGL 1.0 does not support non-constant in for loops\n// This provides an easy way to handle these cases\n// and still take advantage of WebGL 2.0\n#if (__VERSION__ < 300)\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL1COND; INCR)\n#else\n  #define SMART_FOR(INIT, WEBGL1COND, WEBGL2COND, INCR) for (INIT; WEBGL2COND; INCR)\n#endif\n\nprecision highp float;\n\n#ifdef USE_IBL\nuniform samplerCube u_DiffuseEnvSampler;\nuniform samplerCube u_SpecularEnvSampler;\nuniform sampler2D u_brdfLUT;\nuniform vec2 u_ScaleIBLAmbient;\n#endif\n\n#ifdef HAS_BASECOLORMAP\nuniform sampler2D u_BaseColorSampler;\n#endif\n#ifdef HAS_NORMALMAP\nuniform sampler2D u_NormalSampler;\nuniform float u_NormalScale;\n#endif\n#ifdef HAS_EMISSIVEMAP\nuniform sampler2D u_EmissiveSampler;\nuniform vec3 u_EmissiveFactor;\n#endif\n#ifdef HAS_METALROUGHNESSMAP\nuniform sampler2D u_MetallicRoughnessSampler;\n#endif\n#ifdef HAS_OCCLUSIONMAP\nuniform sampler2D u_OcclusionSampler;\nuniform float u_OcclusionStrength;\n#endif\n\n#ifdef ALPHA_CUTOFF\nuniform float u_AlphaCutoff;\n#endif\n\nuniform vec2 u_MetallicRoughnessValues;\nuniform vec4 u_BaseColorFactor;\n\nuniform vec3 u_Camera;\n\n// debugging flags used for shader output of intermediate PBR variables\n#ifdef PBR_DEBUG\nuniform vec4 u_ScaleDiffBaseMR;\nuniform vec4 u_ScaleFGDSpec;\n#endif\n\nvarying vec3 pbr_vPosition;\n\nvarying vec2 pbr_vUV;\n\n#ifdef HAS_NORMALS\n#ifdef HAS_TANGENTS\nvarying mat3 pbr_vTBN;\n#else\nvarying vec3 pbr_vNormal;\n#endif\n#endif\n\n// Encapsulate the various inputs used by the various functions in the shading equation\n// We store values in this struct to simplify the integration of alternative implementations\n// of the shading terms, outlined in the Readme.MD Appendix.\nstruct PBRInfo\n{\n  float NdotL;                  // cos angle between normal and light direction\n  float NdotV;                  // cos angle between normal and view direction\n  float NdotH;                  // cos angle between normal and half vector\n  float LdotH;                  // cos angle between light direction and half vector\n  float VdotH;                  // cos angle between view direction and half vector\n  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)\n  float metalness;              // metallic value at the surface\n  vec3 reflectance0;            // full reflectance color (normal incidence angle)\n  vec3 reflectance90;           // reflectance color at grazing angle\n  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])\n  vec3 diffuseColor;            // color contribution from diffuse lighting\n  vec3 specularColor;           // color contribution from specular lighting\n  vec3 n;                       // normal at surface point\n  vec3 v;                       // vector from surface point to camera\n};\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nvec4 SRGBtoLINEAR(vec4 srgbIn)\n{\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\n  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));\n#else //SRGB_FAST_APPROXIMATION\n  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);\n  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );\n#endif //SRGB_FAST_APPROXIMATION\n  return vec4(linOut,srgbIn.w);;\n#else //MANUAL_SRGB\n  return srgbIn;\n#endif //MANUAL_SRGB\n}\n\n// Find the normal for this fragment, pulling either from a predefined normal map\n// or from the interpolated mesh normal and tangent attributes.\nvec3 getNormal()\n{\n  // Retrieve the tangent space matrix\n#ifndef HAS_TANGENTS\n  vec3 pos_dx = dFdx(pbr_vPosition);\n  vec3 pos_dy = dFdy(pbr_vPosition);\n  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));\n  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));\n  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\n#ifdef HAS_NORMALS\n  vec3 ng = normalize(pbr_vNormal);\n#else\n  vec3 ng = cross(pos_dx, pos_dy);\n#endif\n\n  t = normalize(t - ng * dot(ng, t));\n  vec3 b = normalize(cross(ng, t));\n  mat3 tbn = mat3(t, b, ng);\n#else // HAS_TANGENTS\n  mat3 tbn = pbr_vTBN;\n#endif\n\n#ifdef HAS_NORMALMAP\n  vec3 n = texture2D(u_NormalSampler, pbr_vUV).rgb;\n  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(u_NormalScale, u_NormalScale, 1.0)));\n#else\n  // The tbn matrix is linearly interpolated, so we need to re-normalize\n  vec3 n = normalize(tbn[2].xyz);\n#endif\n\n  return n;\n}\n\n// Calculation of the lighting contribution from an optional Image Based Light source.\n// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].\n// See our README.md on Environment Maps [3] for additional discussion.\n#ifdef USE_IBL\nvec3 getIBLContribution(PBRInfo pbrInputs, vec3 n, vec3 reflection)\n{\n  float mipCount = 9.0; // resolution of 512x512\n  float lod = (pbrInputs.perceptualRoughness * mipCount);\n  // retrieve a scale and bias to F0. See [1], Figure 3\n  vec3 brdf = SRGBtoLINEAR(texture2D(u_brdfLUT,\n    vec2(pbrInputs.NdotV, 1.0 - pbrInputs.perceptualRoughness))).rgb;\n  vec3 diffuseLight = SRGBtoLINEAR(textureCube(u_DiffuseEnvSampler, n)).rgb;\n\n#ifdef USE_TEX_LOD\n  vec3 specularLight = SRGBtoLINEAR(textureCubeLodEXT(u_SpecularEnvSampler, reflection, lod)).rgb;\n#else\n  vec3 specularLight = SRGBtoLINEAR(textureCube(u_SpecularEnvSampler, reflection)).rgb;\n#endif\n\n  vec3 diffuse = diffuseLight * pbrInputs.diffuseColor;\n  vec3 specular = specularLight * (pbrInputs.specularColor * brdf.x + brdf.y);\n\n  // For presentation, this allows us to disable IBL terms\n  diffuse *= u_ScaleIBLAmbient.x;\n  specular *= u_ScaleIBLAmbient.y;\n\n  return diffuse + specular;\n}\n#endif\n\n// Basic Lambertian diffuse\n// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog\n// See also [1], Equation 1\nvec3 diffuse(PBRInfo pbrInputs)\n{\n  return pbrInputs.diffuseColor / M_PI;\n}\n\n// The following equation models the Fresnel reflectance term of the spec equation (aka F())\n// Implementation of fresnel from [4], Equation 15\nvec3 specularReflection(PBRInfo pbrInputs)\n{\n  return pbrInputs.reflectance0 +\n    (pbrInputs.reflectance90 - pbrInputs.reflectance0) *\n    pow(clamp(1.0 - pbrInputs.VdotH, 0.0, 1.0), 5.0);\n}\n\n// This calculates the specular geometric attenuation (aka G()),\n// where rougher material will reflect less light back to the viewer.\n// This implementation is based on [1] Equation 4, and we adopt their modifications to\n// alphaRoughness as input as originally proposed in [2].\nfloat geometricOcclusion(PBRInfo pbrInputs)\n{\n  float NdotL = pbrInputs.NdotL;\n  float NdotV = pbrInputs.NdotV;\n  float r = pbrInputs.alphaRoughness;\n\n  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));\n  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));\n  return attenuationL * attenuationV;\n}\n\n// The following equation(s) model the distribution of microfacet normals across\n// the area being drawn (aka D())\n// Implementation from \"Average Irregularity Representation of a Roughened Surface\n// for Ray Reflection\" by T. S. Trowbridge, and K. P. Reitz\n// Follows the distribution function recommended in the SIGGRAPH 2013 course notes\n// from EPIC Games [1], Equation 3.\nfloat microfacetDistribution(PBRInfo pbrInputs)\n{\n  float roughnessSq = pbrInputs.alphaRoughness * pbrInputs.alphaRoughness;\n  float f = (pbrInputs.NdotH * roughnessSq - pbrInputs.NdotH) * pbrInputs.NdotH + 1.0;\n  return roughnessSq / (M_PI * f * f);\n}\n\nvoid PBRInfo_setAmbientLight(inout PBRInfo pbrInputs) {\n  pbrInputs.NdotL = 1.0;\n  pbrInputs.NdotH = 0.0;\n  pbrInputs.LdotH = 0.0;\n  pbrInputs.VdotH = 1.0;\n}\n\nvoid PBRInfo_setDirectionalLight(inout PBRInfo pbrInputs, vec3 lightDirection) {\n  vec3 n = pbrInputs.n;\n  vec3 v = pbrInputs.v;\n  vec3 l = normalize(lightDirection);             // Vector from surface point to light\n  vec3 h = normalize(l+v);                        // Half vector between both l and v\n\n  pbrInputs.NdotL = clamp(dot(n, l), 0.001, 1.0);\n  pbrInputs.NdotH = clamp(dot(n, h), 0.0, 1.0);\n  pbrInputs.LdotH = clamp(dot(l, h), 0.0, 1.0);\n  pbrInputs.VdotH = clamp(dot(v, h), 0.0, 1.0);\n}\n\nvoid PBRInfo_setPointLight(inout PBRInfo pbrInputs, PointLight pointLight) {\n  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);\n  PBRInfo_setDirectionalLight(pbrInputs, light_direction);\n}\n\nvec3 calculateFinalColor(PBRInfo pbrInputs, vec3 lightColor) {\n  // Calculate the shading terms for the microfacet specular shading model\n  vec3 F = specularReflection(pbrInputs);\n  float G = geometricOcclusion(pbrInputs);\n  float D = microfacetDistribution(pbrInputs);\n\n  // Calculation of analytical lighting contribution\n  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInputs);\n  vec3 specContrib = F * G * D / (4.0 * pbrInputs.NdotL * pbrInputs.NdotV);\n  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)\n  return pbrInputs.NdotL * lightColor * (diffuseContrib + specContrib);\n}\n\nvec4 pbr_filterColor(vec4 colorUnused)\n{\n  // Metallic and Roughness material properties are packed together\n  // In glTF, these factors can be specified by fixed scalar values\n  // or from a metallic-roughness map\n  float perceptualRoughness = u_MetallicRoughnessValues.y;\n  float metallic = u_MetallicRoughnessValues.x;\n#ifdef HAS_METALROUGHNESSMAP\n  // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.\n  // This layout intentionally reserves the 'r' channel for (optional) occlusion map data\n  vec4 mrSample = texture2D(u_MetallicRoughnessSampler, pbr_vUV);\n  perceptualRoughness = mrSample.g * perceptualRoughness;\n  metallic = mrSample.b * metallic;\n#endif\n  perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);\n  metallic = clamp(metallic, 0.0, 1.0);\n  // Roughness is authored as perceptual roughness; as is convention,\n  // convert to material roughness by squaring the perceptual roughness [2].\n  float alphaRoughness = perceptualRoughness * perceptualRoughness;\n\n  // The albedo may be defined from a base texture or a flat color\n#ifdef HAS_BASECOLORMAP\n  vec4 baseColor = SRGBtoLINEAR(texture2D(u_BaseColorSampler, pbr_vUV)) * u_BaseColorFactor;\n#else\n  vec4 baseColor = u_BaseColorFactor;\n#endif\n\n#ifdef ALPHA_CUTOFF\n  if (baseColor.a < u_AlphaCutoff) {\n    discard;\n  }\n#endif\n\n  vec3 f0 = vec3(0.04);\n  vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);\n  diffuseColor *= 1.0 - metallic;\n  vec3 specularColor = mix(f0, baseColor.rgb, metallic);\n\n  // Compute reflectance.\n  float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);\n\n  // For typical incident reflectance range (between 4% to 100%) set the grazing\n  // reflectance to 100% for typical fresnel effect.\n  // For very low reflectance range on highly diffuse objects (below 4%),\n  // incrementally reduce grazing reflecance to 0%.\n  float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);\n  vec3 specularEnvironmentR0 = specularColor.rgb;\n  vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;\n\n  vec3 n = getNormal();                          // normal at surface point\n  vec3 v = normalize(u_Camera - pbr_vPosition);  // Vector from surface point to camera\n\n  float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);\n  vec3 reflection = -normalize(reflect(v, n));\n\n  PBRInfo pbrInputs = PBRInfo(\n    0.0, // NdotL\n    NdotV,\n    0.0, // NdotH\n    0.0, // LdotH\n    0.0, // VdotH\n    perceptualRoughness,\n    metallic,\n    specularEnvironmentR0,\n    specularEnvironmentR90,\n    alphaRoughness,\n    diffuseColor,\n    specularColor,\n    n,\n    v\n  );\n\n  vec3 color = vec3(0, 0, 0);\n\n#ifdef USE_LIGHTS\n  // Apply ambient light\n  PBRInfo_setAmbientLight(pbrInputs);\n  color += calculateFinalColor(pbrInputs, lighting_uAmbientLight.color);\n\n  // Apply directional light\n  SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uDirectionalLightCount, i++) {\n    if (i < lighting_uDirectionalLightCount) {\n      PBRInfo_setDirectionalLight(pbrInputs, lighting_uDirectionalLight[i].direction);\n      color += calculateFinalColor(pbrInputs, lighting_uDirectionalLight[i].color);\n    }\n  }\n\n  // Apply point light\n  SMART_FOR(int i = 0, i < MAX_LIGHTS, i < lighting_uPointLightCount, i++) {\n    if (i < lighting_uPointLightCount) {\n      PBRInfo_setPointLight(pbrInputs, lighting_uPointLight[i]);\n      float attenuation = getPointLightAttenuation(lighting_uPointLight[i], distance(lighting_uPointLight[i].position, pbr_vPosition));\n      color += calculateFinalColor(pbrInputs, lighting_uPointLight[i].color / attenuation);\n    }\n  }\n#endif\n\n  // Calculate lighting contribution from image based lighting source (IBL)\n#ifdef USE_IBL\n  color += getIBLContribution(pbrInputs, n, reflection);\n#endif\n\n  // Apply optional PBR terms for additional (optional) shading\n#ifdef HAS_OCCLUSIONMAP\n  float ao = texture2D(u_OcclusionSampler, pbr_vUV).r;\n  color = mix(color, color * ao, u_OcclusionStrength);\n#endif\n\n#ifdef HAS_EMISSIVEMAP\n  vec3 emissive = SRGBtoLINEAR(texture2D(u_EmissiveSampler, pbr_vUV)).rgb * u_EmissiveFactor;\n  color += emissive;\n#endif\n\n  // This section uses mix to override final color for reference app visualization\n  // of various parameters in the lighting equation.\n#ifdef PBR_DEBUG\n  // TODO: Figure out how to debug multiple lights\n\n  // color = mix(color, F, u_ScaleFGDSpec.x);\n  // color = mix(color, vec3(G), u_ScaleFGDSpec.y);\n  // color = mix(color, vec3(D), u_ScaleFGDSpec.z);\n  // color = mix(color, specContrib, u_ScaleFGDSpec.w);\n\n  // color = mix(color, diffuseContrib, u_ScaleDiffBaseMR.x);\n  color = mix(color, baseColor.rgb, u_ScaleDiffBaseMR.y);\n  color = mix(color, vec3(metallic), u_ScaleDiffBaseMR.z);\n  color = mix(color, vec3(perceptualRoughness), u_ScaleDiffBaseMR.w);\n#endif\n\n  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);\n}\n",defines:{LIGHTING_FRAGMENT:1},dependencies:[{name:"project2",vs:Wa,fs:Wa},Ca]};n.d(t,"isWebGL",function(){return a}),n.d(t,"isWebGL2",function(){return o}),n.d(t,"lumaStats",function(){return D}),n.d(t,"createGLContext",function(){return te}),n.d(t,"destroyGLContext",function(){return re}),n.d(t,"resizeGLContext",function(){return ie}),n.d(t,"setGLContextDefaults",function(){return ee}),n.d(t,"getContextInfo",function(){return ue}),n.d(t,"getGLContextInfo",function(){return oe}),n.d(t,"getContextLimits",function(){return ae}),n.d(t,"FEATURES",function(){return Lt}),n.d(t,"hasFeature",function(){return Rt}),n.d(t,"hasFeatures",function(){return vt}),n.d(t,"getFeatures",function(){return bt}),n.d(t,"canCompileGLGSExtension",function(){return Mt}),n.d(t,"cloneTextureFrom",function(){return ft}),n.d(t,"getKeyValue",function(){return ce}),n.d(t,"getKey",function(){return le}),n.d(t,"cssToDeviceRatio",function(){return $}),n.d(t,"cssToDevicePixels",function(){return Y}),n.d(t,"setContextDefaults",function(){return ee}),n.d(t,"glGetDebugInfo",function(){return K}),n.d(t,"trackContextState",function(){return x.a}),n.d(t,"resetParameters",function(){return Be.d}),n.d(t,"getParameter",function(){return Be.b}),n.d(t,"getParameters",function(){return Be.c}),n.d(t,"setParameter",function(){return Be.e}),n.d(t,"setParameters",function(){return Ue}),n.d(t,"withParameters",function(){return ke}),n.d(t,"getModifiedParameters",function(){return Be.a}),n.d(t,"Buffer",function(){return ye}),n.d(t,"Shader",function(){return kt}),n.d(t,"VertexShader",function(){return Ht}),n.d(t,"FragmentShader",function(){return Vt}),n.d(t,"Program",function(){return bn}),n.d(t,"Framebuffer",function(){return St}),n.d(t,"Renderbuffer",function(){return qe}),n.d(t,"Texture2D",function(){return Ke}),n.d(t,"TextureCube",function(){return ct}),n.d(t,"clear",function(){return st}),n.d(t,"clearBuffer",function(){return at}),n.d(t,"readPixelsToArray",function(){return ht}),n.d(t,"readPixelsToBuffer",function(){return dt}),n.d(t,"copyToDataUrl",function(){return Et}),n.d(t,"copyToImage",function(){return gt}),n.d(t,"copyToTexture",function(){return mt}),n.d(t,"blit",function(){return pt}),n.d(t,"Query",function(){return Cn}),n.d(t,"Texture3D",function(){return lt}),n.d(t,"TransformFeedback",function(){return Mn}),n.d(t,"VertexArrayObject",function(){return wn}),n.d(t,"VertexArray",function(){return Vn}),n.d(t,"UniformBufferLayout",function(){return Kn}),n.d(t,"setPathPrefix",function(){return je}),n.d(t,"loadFile",function(){return We}),n.d(t,"loadImage",function(){return ze}),n.d(t,"_Accessor",function(){return Ne}),n.d(t,"_clearBuffer",function(){return at}),n.d(t,"Geometry",function(){return Yn}),n.d(t,"Material",function(){return qn}),n.d(t,"AmbientLight",function(){return yr}),n.d(t,"DirectionalLight",function(){return Cr}),n.d(t,"PointLight",function(){return Mr}),n.d(t,"AnimationLoop",function(){return xr}),n.d(t,"encodePickingColor",function(){return wr}),n.d(t,"decodePickingColor",function(){return Gr}),n.d(t,"getNullPickingColor",function(){return kr}),n.d(t,"Model",function(){return ns}),n.d(t,"Transform",function(){return Rs}),n.d(t,"ClipSpace",function(){return Is}),n.d(t,"ProgramManager",function(){return Di}),n.d(t,"_ShaderCache",function(){return Ns}),n.d(t,"_AnimationLoopProxy",function(){return Ss}),n.d(t,"_MultiPassRenderer",function(){return ys}),n.d(t,"_RenderState",function(){return Os}),n.d(t,"_Pass",function(){return Fs}),n.d(t,"_CompositePass",function(){return Ls}),n.d(t,"_ClearPass",function(){return Cs}),n.d(t,"_RenderPass",function(){return Ms}),n.d(t,"_CopyPass",function(){return Bs}),n.d(t,"_TexturePass",function(){return xs}),n.d(t,"_ShaderModulePass",function(){return ws}),n.d(t,"ConeGeometry",function(){return Ws}),n.d(t,"CubeGeometry",function(){return Qs}),n.d(t,"CylinderGeometry",function(){return Zs}),n.d(t,"IcoSphereGeometry",function(){return ta}),n.d(t,"PlaneGeometry",function(){return na}),n.d(t,"SphereGeometry",function(){return ra}),n.d(t,"TruncatedConeGeometry",function(){return js}),n.d(t,"PhongMaterial",function(){return sa}),n.d(t,"PBRMaterial",function(){return aa}),n.d(t,"ScenegraphNode",function(){return ga}),n.d(t,"GroupNode",function(){return ma}),n.d(t,"ModelNode",function(){return pa}),n.d(t,"CameraNode",function(){return Aa}),n.d(t,"registerShaderModules",function(){return ii}),n.d(t,"setDefaultShaderModules",function(){return ni}),n.d(t,"getDefaultShaderModules",function(){return ri}),n.d(t,"assembleShaders",function(){return Ci}),n.d(t,"createShaderHook",function(){return Oi}),n.d(t,"createModuleInjection",function(){return yi}),n.d(t,"combineInjects",function(){return bi}),n.d(t,"normalizeShaderModule",function(){return ei}),n.d(t,"fp32",function(){return Ta}),n.d(t,"fp64",function(){return Na}),n.d(t,"project",function(){return Oa}),n.d(t,"lights",function(){return Ca}),n.d(t,"dirlight",function(){return Da}),n.d(t,"picking",function(){return Ua}),n.d(t,"diffuse",function(){return Ga}),n.d(t,"gouraudlighting",function(){return Ha}),n.d(t,"phonglighting",function(){return Va}),n.d(t,"pbr",function(){return za}),n.d(t,"_transform",function(){return hs}),n.d(t,"MODULAR_SHADERS",function(){return xi}),n.d(t,"getQualifierDetails",function(){return as}),n.d(t,"getPassthroughFS",function(){return os}),n.d(t,"typeToChannelSuffix",function(){return us}),n.d(t,"typeToChannelCount",function(){return cs}),n.d(t,"convertToVec4",function(){return ls}),n.d(t,"log",function(){return M}),n.d(t,"assert",function(){return r}),n.d(t,"uid",function(){return _e}),n.d(t,"self",function(){return f.c}),n.d(t,"window",function(){return f.d}),n.d(t,"global",function(){return f.b}),n.d(t,"document",function(){return f.a})},function(e,t,n){"use strict";function r(e){for(const t in e)return!1;return!0}function i(e){return Boolean(e&&2===e._version)}n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i})}])});