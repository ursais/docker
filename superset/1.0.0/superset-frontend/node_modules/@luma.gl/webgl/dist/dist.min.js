!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=25)}([function(t,e){t.exports={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,FUNC_ADD:32774,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,BLEND_COLOR:32773,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,VENDOR:7936,RENDERER:7937,VERSION:7938,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,BROWSER_DEFAULT_WEBGL:37444,STATIC_DRAW:35044,STREAM_DRAW:35040,DYNAMIC_DRAW:35048,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,CULL_FACE:2884,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,BLEND:3042,DEPTH_TEST:2929,DITHER:3024,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,SCISSOR_TEST:3089,STENCIL_TEST:2960,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CONTEXT_LOST_WEBGL:37442,CW:2304,CCW:2305,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,COMPILE_STATUS:35713,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_ATTRIBUTES:35721,ACTIVE_UNIFORMS:35718,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,ALWAYS:519,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,GEQUAL:518,NOTEQUAL:517,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,TEXTURE_WIDTH:4096,TEXTURE_HEIGHT:4097,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,MAX_3D_TEXTURE_SIZE:32883,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,MAX_TEXTURE_LOD_BIAS:34045,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,RASTERIZER_DISCARD:35977,VERTEX_ARRAY_BINDING:34229,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,MAX_ELEMENT_INDEX:36203,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,RGB9_E5:35901,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2UI:36975,TEXTURE_IMMUTABLE_FORMAT:37167,TEXTURE_IMMUTABLE_LEVELS:33503,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,UNSIGNED_INT_24_8:34042,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,INT_2_10_10_10_REV:36255,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,MAX_SAMPLES:36183,SAMPLER_BINDING:35097,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,UNSIGNED_NORMALIZED:35863,SIGNED_NORMALIZED:36764,VERTEX_ATTRIB_ARRAY_INTEGER:35069,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,DEPTH24_STENCIL8:35056,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,COLOR:6144,DEPTH:6145,STENCIL:6146,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,INVALID_INDEX:4294967295,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,TEXTURE_MAX_ANISOTROPY_EXT:34046,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35986,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,UNSIGNED_INT_24_8_WEBGL:34042,HALF_FLOAT_OES:36193,RGBA32F_EXT:34836,RGB32F_EXT:34837,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,UNSIGNED_NORMALIZED_EXT:35863,MIN_EXT:32775,MAX_EXT:32776,SRGB_EXT:35904,SRGB_ALPHA_EXT:35906,SRGB8_ALPHA8_EXT:35907,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067,COLOR_ATTACHMENT4_WEBGL:36068,COLOR_ATTACHMENT5_WEBGL:36069,COLOR_ATTACHMENT6_WEBGL:36070,COLOR_ATTACHMENT7_WEBGL:36071,COLOR_ATTACHMENT8_WEBGL:36072,COLOR_ATTACHMENT9_WEBGL:36073,COLOR_ATTACHMENT10_WEBGL:36074,COLOR_ATTACHMENT11_WEBGL:36075,COLOR_ATTACHMENT12_WEBGL:36076,COLOR_ATTACHMENT13_WEBGL:36077,COLOR_ATTACHMENT14_WEBGL:36078,COLOR_ATTACHMENT15_WEBGL:36079,DRAW_BUFFER0_WEBGL:34853,DRAW_BUFFER1_WEBGL:34854,DRAW_BUFFER2_WEBGL:34855,DRAW_BUFFER3_WEBGL:34856,DRAW_BUFFER4_WEBGL:34857,DRAW_BUFFER5_WEBGL:34858,DRAW_BUFFER6_WEBGL:34859,DRAW_BUFFER7_WEBGL:34860,DRAW_BUFFER8_WEBGL:34861,DRAW_BUFFER9_WEBGL:34862,DRAW_BUFFER10_WEBGL:34863,DRAW_BUFFER11_WEBGL:34864,DRAW_BUFFER12_WEBGL:34865,DRAW_BUFFER13_WEBGL:34866,DRAW_BUFFER14_WEBGL:34867,DRAW_BUFFER15_WEBGL:34868,MAX_COLOR_ATTACHMENTS_WEBGL:36063,MAX_DRAW_BUFFERS_WEBGL:34852,VERTEX_ARRAY_BINDING_OES:34229,QUERY_COUNTER_BITS_EXT:34916,CURRENT_QUERY_EXT:34917,QUERY_RESULT_EXT:34918,QUERY_RESULT_AVAILABLE_EXT:34919,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795}},,,function(t,e,r){"use strict";(function(t){r.d(e,"c",function(){return a}),r.d(e,"d",function(){return i}),r.d(e,"b",function(){return s}),r.d(e,"a",function(){return o});const n={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},a=n.self||n.window||n.global,i=n.window||n.self||n.global,s=n.global||n.self||n.window,o=n.document||{}}).call(this,r(11))},function(t,e,r){"use strict";(function(t){r.d(e,"m",function(){return E}),r.d(e,"n",function(){return N}),r.d(e,"a",function(){return F}),r.d(e,"h",function(){return _}),r.d(e,"f",function(){return c}),r.d(e,"i",function(){return l}),r.d(e,"d",function(){return h}),r.d(e,"e",function(){return f}),r.d(e,"g",function(){return A}),r.d(e,"k",function(){return T}),r.d(e,"l",function(){return d}),r.d(e,"c",function(){return R}),r.d(e,"j",function(){return g}),r.d(e,"b",function(){return m});var n=r(3),a=r(9);const i="luma.gl: loaded under Node.js without headless gl installed, meaning that WebGL contexts can not be created. This may not be an error. For example, this is a typical configuration for isorender applications running on the server.",s=t;let o=null;function E(...t){const e=s.require("gl");if(!e)throw new Error(i);return e(...t)}if(!a.a)try{o=s.require("gl/wrap")}catch(t){}class u{}const{WebGLRenderingContext:_=u,WebGLProgram:c=u,WebGLShader:l=u,WebGLBuffer:h=u,WebGLFramebuffer:f=u,WebGLRenderbuffer:A=u,WebGLTexture:T=u,WebGLUniformLocation:d=u,WebGLActiveInfo:R=u,WebGLShaderPrecisionFormat:g=u}=o||n.b,N=_!==u&&c!==u&&l!==u&&h!==u&&f!==u&&A!==u&&T!==u&&d!==u&&R!==u&&g!==u;const m=n.b.WebGL2RenderingContext||class{},F=n.b.Image||class{}}).call(this,r(29)(t))},function(t,e,r){"use strict";r.d(e,"b",function(){return s}),r.d(e,"d",function(){return _}),r.d(e,"a",function(){return c}),r.d(e,"c",function(){return h});var n=r(0),a=r.n(n),i=r(31);const s={[a.a.BLEND]:!1,[a.a.BLEND_COLOR]:new Float32Array([0,0,0,0]),[a.a.BLEND_EQUATION_RGB]:a.a.FUNC_ADD,[a.a.BLEND_EQUATION_ALPHA]:a.a.FUNC_ADD,[a.a.BLEND_SRC_RGB]:a.a.ONE,[a.a.BLEND_DST_RGB]:a.a.ZERO,[a.a.BLEND_SRC_ALPHA]:a.a.ONE,[a.a.BLEND_DST_ALPHA]:a.a.ZERO,[a.a.COLOR_CLEAR_VALUE]:new Float32Array([0,0,0,0]),[a.a.COLOR_WRITEMASK]:[!0,!0,!0,!0],[a.a.CULL_FACE]:!1,[a.a.CULL_FACE_MODE]:a.a.BACK,[a.a.DEPTH_TEST]:!1,[a.a.DEPTH_CLEAR_VALUE]:1,[a.a.DEPTH_FUNC]:a.a.LESS,[a.a.DEPTH_RANGE]:new Float32Array([0,1]),[a.a.DEPTH_WRITEMASK]:!0,[a.a.DITHER]:!0,[a.a.FRAMEBUFFER_BINDING]:null,[a.a.FRONT_FACE]:a.a.CCW,[a.a.GENERATE_MIPMAP_HINT]:a.a.DONT_CARE,[a.a.LINE_WIDTH]:1,[a.a.POLYGON_OFFSET_FILL]:!1,[a.a.POLYGON_OFFSET_FACTOR]:0,[a.a.POLYGON_OFFSET_UNITS]:0,[a.a.SAMPLE_COVERAGE_VALUE]:1,[a.a.SAMPLE_COVERAGE_INVERT]:!1,[a.a.SCISSOR_TEST]:!1,[a.a.SCISSOR_BOX]:new Int32Array([0,0,1024,1024]),[a.a.STENCIL_TEST]:!1,[a.a.STENCIL_CLEAR_VALUE]:0,[a.a.STENCIL_WRITEMASK]:4294967295,[a.a.STENCIL_BACK_WRITEMASK]:4294967295,[a.a.STENCIL_FUNC]:a.a.ALWAYS,[a.a.STENCIL_REF]:0,[a.a.STENCIL_VALUE_MASK]:4294967295,[a.a.STENCIL_BACK_FUNC]:a.a.ALWAYS,[a.a.STENCIL_BACK_REF]:0,[a.a.STENCIL_BACK_VALUE_MASK]:4294967295,[a.a.STENCIL_FAIL]:a.a.KEEP,[a.a.STENCIL_PASS_DEPTH_FAIL]:a.a.KEEP,[a.a.STENCIL_PASS_DEPTH_PASS]:a.a.KEEP,[a.a.STENCIL_BACK_FAIL]:a.a.KEEP,[a.a.STENCIL_BACK_PASS_DEPTH_FAIL]:a.a.KEEP,[a.a.STENCIL_BACK_PASS_DEPTH_PASS]:a.a.KEEP,[a.a.VIEWPORT]:new Int32Array([0,0,1024,1024]),[a.a.PACK_ALIGNMENT]:4,[a.a.UNPACK_ALIGNMENT]:4,[a.a.UNPACK_FLIP_Y_WEBGL]:!1,[a.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:!1,[a.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:a.a.BROWSER_DEFAULT_WEBGL,[a.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:a.a.DONT_CARE,[a.a.READ_FRAMEBUFFER_BINDING]:null,[a.a.RASTERIZER_DISCARD]:!1,[a.a.PACK_ROW_LENGTH]:0,[a.a.PACK_SKIP_PIXELS]:0,[a.a.PACK_SKIP_ROWS]:0,[a.a.UNPACK_ROW_LENGTH]:0,[a.a.UNPACK_IMAGE_HEIGHT]:0,[a.a.UNPACK_SKIP_PIXELS]:0,[a.a.UNPACK_SKIP_ROWS]:0,[a.a.UNPACK_SKIP_IMAGES]:0},o=(t,e,r)=>e?t.enable(r):t.disable(r),E=(t,e,r)=>t.hint(r,e),u=(t,e,r)=>t.pixelStorei(r,e),_={[a.a.BLEND]:o,[a.a.BLEND_COLOR]:(t,e)=>t.blendColor(...e),[a.a.BLEND_EQUATION_RGB]:"blendEquation",[a.a.BLEND_EQUATION_ALPHA]:"blendEquation",[a.a.BLEND_SRC_RGB]:"blendFunc",[a.a.BLEND_DST_RGB]:"blendFunc",[a.a.BLEND_SRC_ALPHA]:"blendFunc",[a.a.BLEND_DST_ALPHA]:"blendFunc",[a.a.COLOR_CLEAR_VALUE]:(t,e)=>t.clearColor(...e),[a.a.COLOR_WRITEMASK]:(t,e)=>t.colorMask(...e),[a.a.CULL_FACE]:o,[a.a.CULL_FACE_MODE]:(t,e)=>t.cullFace(e),[a.a.DEPTH_TEST]:o,[a.a.DEPTH_CLEAR_VALUE]:(t,e)=>t.clearDepth(e),[a.a.DEPTH_FUNC]:(t,e)=>t.depthFunc(e),[a.a.DEPTH_RANGE]:(t,e)=>t.depthRange(...e),[a.a.DEPTH_WRITEMASK]:(t,e)=>t.depthMask(e),[a.a.DITHER]:o,[a.a.FRAGMENT_SHADER_DERIVATIVE_HINT]:E,[a.a.FRAMEBUFFER_BINDING]:(t,e)=>{const r=Object(i.b)(t)?a.a.DRAW_FRAMEBUFFER:a.a.FRAMEBUFFER;return t.bindFramebuffer(r,e)},[a.a.FRONT_FACE]:(t,e)=>t.frontFace(e),[a.a.GENERATE_MIPMAP_HINT]:E,[a.a.LINE_WIDTH]:(t,e)=>t.lineWidth(e),[a.a.POLYGON_OFFSET_FILL]:o,[a.a.POLYGON_OFFSET_FACTOR]:"polygonOffset",[a.a.POLYGON_OFFSET_UNITS]:"polygonOffset",[a.a.RASTERIZER_DISCARD]:o,[a.a.SAMPLE_COVERAGE_VALUE]:"sampleCoverage",[a.a.SAMPLE_COVERAGE_INVERT]:"sampleCoverage",[a.a.SCISSOR_TEST]:o,[a.a.SCISSOR_BOX]:(t,e)=>t.scissor(...e),[a.a.STENCIL_TEST]:o,[a.a.STENCIL_CLEAR_VALUE]:(t,e)=>t.clearStencil(e),[a.a.STENCIL_WRITEMASK]:(t,e)=>t.stencilMaskSeparate(a.a.FRONT,e),[a.a.STENCIL_BACK_WRITEMASK]:(t,e)=>t.stencilMaskSeparate(a.a.BACK,e),[a.a.STENCIL_FUNC]:"stencilFuncFront",[a.a.STENCIL_REF]:"stencilFuncFront",[a.a.STENCIL_VALUE_MASK]:"stencilFuncFront",[a.a.STENCIL_BACK_FUNC]:"stencilFuncBack",[a.a.STENCIL_BACK_REF]:"stencilFuncBack",[a.a.STENCIL_BACK_VALUE_MASK]:"stencilFuncBack",[a.a.STENCIL_FAIL]:"stencilOpFront",[a.a.STENCIL_PASS_DEPTH_FAIL]:"stencilOpFront",[a.a.STENCIL_PASS_DEPTH_PASS]:"stencilOpFront",[a.a.STENCIL_BACK_FAIL]:"stencilOpBack",[a.a.STENCIL_BACK_PASS_DEPTH_FAIL]:"stencilOpBack",[a.a.STENCIL_BACK_PASS_DEPTH_PASS]:"stencilOpBack",[a.a.VIEWPORT]:(t,e)=>t.viewport(...e),[a.a.PACK_ALIGNMENT]:u,[a.a.UNPACK_ALIGNMENT]:u,[a.a.UNPACK_FLIP_Y_WEBGL]:u,[a.a.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:u,[a.a.UNPACK_COLORSPACE_CONVERSION_WEBGL]:u,[a.a.PACK_ROW_LENGTH]:u,[a.a.PACK_SKIP_PIXELS]:u,[a.a.PACK_SKIP_ROWS]:u,[a.a.READ_FRAMEBUFFER_BINDING]:(t,e)=>t.bindFramebuffer(a.a.READ_FRAMEBUFFER,e),[a.a.UNPACK_ROW_LENGTH]:u,[a.a.UNPACK_IMAGE_HEIGHT]:u,[a.a.UNPACK_SKIP_PIXELS]:u,[a.a.UNPACK_SKIP_ROWS]:u,[a.a.UNPACK_SKIP_IMAGES]:u},c={blendEquation:(t,e)=>t.blendEquationSeparate(e[a.a.BLEND_EQUATION_RGB],e[a.a.BLEND_EQUATION_ALPHA]),blendFunc:(t,e)=>t.blendFuncSeparate(e[a.a.BLEND_SRC_RGB],e[a.a.BLEND_DST_RGB],e[a.a.BLEND_SRC_ALPHA],e[a.a.BLEND_DST_ALPHA]),polygonOffset:(t,e)=>t.polygonOffset(e[a.a.POLYGON_OFFSET_FACTOR],e[a.a.POLYGON_OFFSET_UNITS]),sampleCoverage:(t,e)=>t.sampleCoverage(e[a.a.SAMPLE_COVERAGE_VALUE],e[a.a.SAMPLE_COVERAGE_INVERT]),stencilFuncFront:(t,e)=>t.stencilFuncSeparate(a.a.FRONT,e[a.a.STENCIL_FUNC],e[a.a.STENCIL_REF],e[a.a.STENCIL_VALUE_MASK]),stencilFuncBack:(t,e)=>t.stencilFuncSeparate(a.a.BACK,e[a.a.STENCIL_BACK_FUNC],e[a.a.STENCIL_BACK_REF],e[a.a.STENCIL_BACK_VALUE_MASK]),stencilOpFront:(t,e)=>t.stencilOpSeparate(a.a.FRONT,e[a.a.STENCIL_FAIL],e[a.a.STENCIL_PASS_DEPTH_FAIL],e[a.a.STENCIL_PASS_DEPTH_PASS]),stencilOpBack:(t,e)=>t.stencilOpSeparate(a.a.BACK,e[a.a.STENCIL_BACK_FAIL],e[a.a.STENCIL_BACK_PASS_DEPTH_FAIL],e[a.a.STENCIL_BACK_PASS_DEPTH_PASS])},l=(t,e)=>t.isEnabled(e),h={[a.a.BLEND]:l,[a.a.CULL_FACE]:l,[a.a.DEPTH_TEST]:l,[a.a.DITHER]:l,[a.a.POLYGON_OFFSET_FILL]:l,[a.a.SAMPLE_ALPHA_TO_COVERAGE]:l,[a.a.SAMPLE_COVERAGE]:l,[a.a.SCISSOR_TEST]:l,[a.a.STENCIL_TEST]:l,[a.a.RASTERIZER_DISCARD]:l}},function(t,e,r){"use strict";(function(t,n){r.d(e,"b",function(){return s}),r.d(e,"a",function(){return o});var a=r(7),i={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document,process:"object"===(void 0===n?"undefined":Object(a.a)(n))&&n},s=i.window||i.self||i.global,o=i.process||{};console}).call(this,r(11),r(12))},function(t,e,r){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t){return(a="function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?function(t){return n(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)})(t)}r.d(e,"a",function(){return a})},function(t,e,r){"use strict";function n(t,e){if(!t)throw new Error(e||"webgl2-polyfill: assertion failed.")}r.d(e,"a",function(){return n})},function(t,e,r){"use strict";(function(t){var n=r(24);const a=!("object"==typeof t&&"[object process]"===String(t)&&!t.browser)||n.a;e.a=a}).call(this,r(12))},function(t,e,r){"use strict";var n=r(0),a=r.n(n),i=r(8);const s=t=>E(t)?void 0:0,o={[a.a.READ_BUFFER]:t=>E(t)?void 0:a.a.COLOR_ATTACHMENT0,35723:t=>E(t)?void 0:4352,[a.a.RASTERIZER_DISCARD]:s,[a.a.SAMPLES]:s,36795:(t,e)=>{const r=E(t)?t.getExtension("EXT_disjoint_timer_query_webgl2"):t.getExtension("EXT_disjoint_timer_query");return r&&r.GPU_DISJOINT_EXT?e(r.GPU_DISJOINT_EXT):0},37445:(t,e)=>{const r=t.getExtension("WEBGL_debug_renderer_info");return e(r&&r.UNMASKED_VENDOR_WEBGL||a.a.VENDOR)},37446:(t,e)=>{const r=t.getExtension("WEBGL_debug_renderer_info");return e(r&&r.UNMASKED_RENDERER_WEBGL||a.a.RENDERER)},34047:(t,e)=>{const r=t.luma.extensions.EXT_texture_filter_anisotropic;return r?e(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[a.a.MAX_3D_TEXTURE_SIZE]:s,[a.a.MAX_ARRAY_TEXTURE_LAYERS]:s,[a.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:s,[a.a.MAX_COLOR_ATTACHMENTS]:(t,e)=>{if(!E(t)){const r=t.getExtension("WEBGL_draw_buffers");return r?e(r.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[a.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:s,[a.a.MAX_COMBINED_UNIFORM_BLOCKS]:s,[a.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:s,[a.a.MAX_DRAW_BUFFERS]:t=>{if(!E(t)){const e=t.getExtension("WEBGL_draw_buffers");return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},[a.a.MAX_ELEMENT_INDEX]:t=>t.getExtension("OES_element_index")?2147483647:65535,[a.a.MAX_ELEMENTS_INDICES]:t=>t.getExtension("OES_element_index")?16777216:65535,[a.a.MAX_ELEMENTS_VERTICES]:t=>16777216,[a.a.MAX_FRAGMENT_INPUT_COMPONENTS]:s,[a.a.MAX_FRAGMENT_UNIFORM_BLOCKS]:s,[a.a.MAX_FRAGMENT_UNIFORM_COMPONENTS]:s,[a.a.MAX_SAMPLES]:s,[a.a.MAX_SERVER_WAIT_TIMEOUT]:s,[a.a.MAX_TEXTURE_LOD_BIAS]:s,[a.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:s,[a.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:s,[a.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:s,[a.a.MAX_UNIFORM_BLOCK_SIZE]:s,[a.a.MAX_UNIFORM_BUFFER_BINDINGS]:s,[a.a.MAX_VARYING_COMPONENTS]:s,[a.a.MAX_VERTEX_OUTPUT_COMPONENTS]:s,[a.a.MAX_VERTEX_UNIFORM_BLOCKS]:s,[a.a.MAX_VERTEX_UNIFORM_COMPONENTS]:s,[a.a.MIN_PROGRAM_TEXEL_OFFSET]:s,[a.a.MAX_PROGRAM_TEXEL_OFFSET]:s,[a.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:s};function E(t){return Boolean(t&&2===t._version)}r.d(e,"b",function(){return _}),r.d(e,"a",function(){return c});function u(t){return Boolean(t&&2===t._version)}const _={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{Object(i.a)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},ANGLE_instanced_arrays:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Object(i.a)(0===e,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Object(i.a)(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{Object(i.a)(!1)},deleteQuery:()=>{Object(i.a)(!1)},beginQuery:()=>{Object(i.a)(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},c={readBuffer:(t,e,r)=>{u(t)&&e(r)},getVertexAttrib:(t,e,r,n)=>{const{webgl2:i,ext:s}=function(t,e){return{webgl2:u(t),ext:t.getExtension(e)}}(t,"ANGLE_instanced_arrays");let o;switch(n){case a.a.VERTEX_ATTRIB_ARRAY_INTEGER:o=!!i&&void 0;break;case a.a.VERTEX_ATTRIB_ARRAY_DIVISOR:o=i||s?void 0:0}return void 0!==o?o:e(r,n)},getProgramParameter:(t,e,r,n)=>{if(!u(t))switch(n){case a.a.TRANSFORM_FEEDBACK_BUFFER_MODE:return a.a.SEPARATE_ATTRIBS;case a.a.TRANSFORM_FEEDBACK_VARYINGS:case a.a.ACTIVE_UNIFORM_BLOCKS:return 0}return e(r,n)},getInternalformatParameter:(t,e,r,n,i)=>{if(!u(t))switch(i){case a.a.SAMPLES:return new Int32Array([0])}return t.getInternalformatParameter(r,n,i)},getTexParameter(t,e,r,n){switch(n){case a.a.TEXTURE_MAX_ANISOTROPY_EXT:const{extensions:e}=t.luma,r=e.EXT_texture_filter_anisotropic;n=r&&r.TEXTURE_MAX_ANISOTROPY_EXT||a.a.TEXTURE_MAX_ANISOTROPY_EXT}return e(r,n)},getParameter:function(t,e,r){const n=o[r],a="function"==typeof n?n(t,e,r):n;return void 0!==a?a:e(r)},hint:(t,e,r,n)=>e(r,n)}},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){var r,n,a=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(t){r=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var E,u=[],_=!1,c=-1;function l(){_&&E&&(_=!1,E.length?u=E.concat(u):c=-1,u.length&&h())}function h(){if(!_){var t=o(l);_=!0;for(var e=u.length;e;){for(E=u,u=[];++c<e;)E&&E[c].run();c=-1,e=u.length}E=null,_=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function A(){}a.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];u.push(new f(t,e)),1!==u.length||_||o(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=A,a.addListener=A,a.once=A,a.off=A,a.removeListener=A,a.removeAllListeners=A,a.emit=A,a.prependListener=A,a.prependOnceListener=A,a.listeners=function(t){return[]},a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(t,e,r){"use strict";r.d(e,"e",function(){return s}),r.d(e,"f",function(){return o}),r.d(e,"b",function(){return E}),r.d(e,"c",function(){return u}),r.d(e,"d",function(){return _}),r.d(e,"a",function(){return c});var n=r(5),a=r(21),i=r(14);function s(t,e,r){const a=n.c[e],s=a?a(t,Number(e)):t.getParameter(Number(e)),o=n.d[e];return Object(i.a)("function"==typeof o),o(t,r,Number(e)),s}function o(t,e){const r={};for(const a in e){const i=Number(a),s=n.d[a];s&&("string"==typeof s?r[s]=!0:s(t,e[a],i))}const a=t.state&&t.state.cache;if(a){const i=Object.assign({},a,e);for(const e in r){(0,n.a[e])(t,i)}}}function E(t,e){const r=n.c[e];return r?r(t,Number(e)):t.getParameter(Number(e))}function u(t,e){e=e||n.b;const r=Array.isArray(e)?e:Object.keys(e),a={};for(const e of r)a[e]=E(t,e);return a}function _(t){o(t,Object.assign({},n.b,{}))}function c(t){const e=u(t,Object.keys(n.b)),r={};for(const t in n.b)Object(a.a)(e[t],n.b[t])||(r[t]=e[t]);return r}},function(t,e,r){"use strict";function n(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}r.d(e,"a",function(){return n})},,function(t,e,r){"use strict";(function(t){var e=r(8),n=r(10);function a(t,{extension:r,target:a,target2:i}){const s=n.b[r];Object(e.a)(s);const{meta:o={}}=s,{suffix:E=""}=o,u=t.getExtension(r);for(const e of Object.keys(s)){const r=`${e}${E}`;let n=null;"meta"===e||"function"==typeof t[e]||(u&&"function"==typeof u[r]?n=(...t)=>u[r](...t):"function"==typeof s[e]&&(n=s[e].bind(a))),n&&(a[e]=n,i[e]=n)}}(void 0!==t?t:window).polyfillContext=function(t){return t.luma=t.luma||{},function(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const r of e)t.luma[r]=t.getExtension(r)}(t),t.luma.polyfilled||(function(t,e){for(const r of Object.getOwnPropertyNames(e))"overrides"!==r&&a(t,{extension:r,target:t.luma,target2:t})}(t,n.b),function(t,{target:e,target2:r}){Object.keys(n.a).forEach(a=>{if("function"==typeof n.a[a]){const i=t[a]?t[a].bind(t):()=>{},s=n.a[a].bind(null,t,i);e[a]=s,r[a]=s}})}(t,{target:t.luma,target2:t}),t.luma.polyfilled=!0),t}}).call(this,r(11))},function(t,e,r){"use strict";(function(t){r.d(e,"a",function(){return i});var n=r(7),a=r(18);function i(){return!("object"===(void 0===t?"undefined":Object(n.a)(t))&&"[object process]"===String(t)&&!t.browser)||Object(a.a)()}}).call(this,r(12))},function(t,e,r){"use strict";(function(t){r.d(e,"a",function(){return a});var n=r(7);function a(e){if("undefined"!=typeof window&&"object"===Object(n.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==t&&"object"===Object(n.a)(t.versions)&&Boolean(t.versions.electron))return!0;var r="object"===("undefined"==typeof navigator?"undefined":Object(n.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,a=e||r;return!!(a&&a.indexOf("Electron")>=0)}}).call(this,r(12))},function(t,e,r){"use strict";(function(t){r.d(e,"a",function(){return c}),r.d(e,"c",function(){return l}),r.d(e,"b",function(){return h});var n=r(22),a=r(5),i=r(13),s=r(14),o=r(21);function E(t,e){const r=t[e].bind(t);t[e]=function(...e){const n=e[0];return n in t.state.cache||(t.state.cache[n]=r(...e)),t.state.enable?t.state.cache[n]:r(...e)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function u(t,e,r){const n=t[e].bind(t);t[e]=function(...a){const{valueChanged:i,oldValue:s}=r(t.state._updateCache,...a);return i&&(t.state.log(`gl.${e}`,...a),n(...a)),s},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}class _{constructor(t,{copyState:e=!1,log:r=(()=>{})}={}){this.gl=t,this.stateStack=[],this.enable=!0,this.cache=e?Object(i.c)(t):Object.assign({},a.b),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){Object(s.a)(this.stateStack.length>0);const t=this.stateStack[this.stateStack.length-1];Object(i.f)(this.gl,t,this.cache),this.stateStack.pop()}_updateCache(t){let e,r=!1;const n=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const a in t)Object(s.a)(void 0!==a),Object(o.a)(t[a],this.cache[a])||(r=!0,e=this.cache[a],!n||a in n||(n[a]=this.cache[a]),this.cache[a]=t[a]);return{valueChanged:r,oldValue:e}}}function c(e,{enable:r=!0,copyState:a}={}){if(Object(s.a)(void 0!==a),!e.state){const i=void 0!==t?t:window;i.polyfillContext&&i.polyfillContext(e),e.state=new _(e,{copyState:a,enable:r});for(const t in n.a){u(e,t,n.a[t])}E(e,"getParameter"),E(e,"isEnabled")}return e.state.enable=r,e}function l(t){t.state||c(t,{copyState:!1}),t.state.push()}function h(t){Object(s.a)(t.state),t.state.pop()}}).call(this,r(11))},,function(t,e,r){"use strict";function n(t,e){if(t===e)return!0;const r=Array.isArray(t)||ArrayBuffer.isView(t),n=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&n&&t.length===e.length){for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}return!1}r.d(e,"a",function(){return n})},function(t,e,r){"use strict";var n=r(0),a=r.n(n);e.a={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),bindFramebuffer:(t,e,r)=>{switch(e){case a.a.FRAMEBUFFER:return t({[a.a.DRAW_FRAMEBUFFER_BINDING]:r,[a.a.READ_FRAMEBUFFER_BINDING]:r});case a.a.DRAW_FRAMEBUFFER:return t({[a.a.DRAW_FRAMEBUFFER_BINDING]:r});case a.a.READ_FRAMEBUFFER:return t({[a.a.READ_FRAMEBUFFER_BINDING]:r});default:return null}},blendColor:(t,e,r,n,i)=>t({[a.a.BLEND_COLOR]:new Float32Array([e,r,n,i])}),blendEquation:(t,e)=>t({[a.a.BLEND_EQUATION_RGB]:e,[a.a.BLEND_EQUATION_ALPHA]:e}),blendEquationSeparate:(t,e,r)=>t({[a.a.BLEND_EQUATION_RGB]:e,[a.a.BLEND_EQUATION_ALPHA]:r}),blendFunc:(t,e,r)=>t({[a.a.BLEND_SRC_RGB]:e,[a.a.BLEND_DST_RGB]:r,[a.a.BLEND_SRC_ALPHA]:e,[a.a.BLEND_DST_ALPHA]:r}),blendFuncSeparate:(t,e,r,n,i)=>t({[a.a.BLEND_SRC_RGB]:e,[a.a.BLEND_DST_RGB]:r,[a.a.BLEND_SRC_ALPHA]:n,[a.a.BLEND_DST_ALPHA]:i}),clearColor:(t,e,r,n,i)=>t({[a.a.COLOR_CLEAR_VALUE]:new Float32Array([e,r,n,i])}),clearDepth:(t,e)=>t({[a.a.DEPTH_CLEAR_VALUE]:e}),clearStencil:(t,e)=>t({[a.a.STENCIL_CLEAR_VALUE]:e}),colorMask:(t,e,r,n,i)=>t({[a.a.COLOR_WRITEMASK]:[e,r,n,i]}),cullFace:(t,e)=>t({[a.a.CULL_FACE_MODE]:e}),depthFunc:(t,e)=>t({[a.a.DEPTH_FUNC]:e}),depthRange:(t,e,r)=>t({[a.a.DEPTH_RANGE]:new Float32Array([e,r])}),depthMask:(t,e)=>t({[a.a.DEPTH_WRITEMASK]:e}),frontFace:(t,e)=>t({[a.a.FRONT_FACE]:e}),lineWidth:(t,e)=>t({[a.a.LINE_WIDTH]:e}),polygonOffset:(t,e,r)=>t({[a.a.POLYGON_OFFSET_FACTOR]:e,[a.a.POLYGON_OFFSET_UNITS]:r}),sampleCoverage:(t,e,r)=>t({[a.a.SAMPLE_COVERAGE_VALUE]:e,[a.a.SAMPLE_COVERAGE_INVERT]:r}),scissor:(t,e,r,n,i)=>t({[a.a.SCISSOR_BOX]:new Int32Array([e,r,n,i])}),stencilMask:(t,e)=>t({[a.a.STENCIL_WRITEMASK]:e,[a.a.STENCIL_BACK_WRITEMASK]:e}),stencilMaskSeparate:(t,e,r)=>t({[e===a.a.FRONT?a.a.STENCIL_WRITEMASK:a.a.STENCIL_BACK_WRITEMASK]:r}),stencilFunc:(t,e,r,n)=>t({[a.a.STENCIL_FUNC]:e,[a.a.STENCIL_REF]:r,[a.a.STENCIL_VALUE_MASK]:n,[a.a.STENCIL_BACK_FUNC]:e,[a.a.STENCIL_BACK_REF]:r,[a.a.STENCIL_BACK_VALUE_MASK]:n}),stencilFuncSeparate:(t,e,r,n,i)=>t({[e===a.a.FRONT?a.a.STENCIL_FUNC:a.a.STENCIL_BACK_FUNC]:r,[e===a.a.FRONT?a.a.STENCIL_REF:a.a.STENCIL_BACK_REF]:n,[e===a.a.FRONT?a.a.STENCIL_VALUE_MASK:a.a.STENCIL_BACK_VALUE_MASK]:i}),stencilOp:(t,e,r,n)=>t({[a.a.STENCIL_FAIL]:e,[a.a.STENCIL_PASS_DEPTH_FAIL]:r,[a.a.STENCIL_PASS_DEPTH_PASS]:n,[a.a.STENCIL_BACK_FAIL]:e,[a.a.STENCIL_BACK_PASS_DEPTH_FAIL]:r,[a.a.STENCIL_BACK_PASS_DEPTH_PASS]:n}),stencilOpSeparate:(t,e,r,n,i)=>t({[e===a.a.FRONT?a.a.STENCIL_FAIL:a.a.STENCIL_BACK_FAIL]:r,[e===a.a.FRONT?a.a.STENCIL_PASS_DEPTH_FAIL:a.a.STENCIL_BACK_PASS_DEPTH_FAIL]:n,[e===a.a.FRONT?a.a.STENCIL_PASS_DEPTH_PASS:a.a.STENCIL_BACK_PASS_DEPTH_PASS]:i}),viewport:(t,e,r,n,i)=>t({[a.a.VIEWPORT]:new Int32Array([e,r,n,i])})}},,function(t,e,r){"use strict";(function(t){e.a="undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||!(void 0===t||"object"!=typeof t.versions||!Boolean(t.versions.electron))||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0}).call(this,r(12))},function(t,e,r){(function(e){const n=r(30),a="undefined"==typeof window?e:window;a.loaders=a.luma||{},t.exports=Object.assign(a.luma,n)}).call(this,r(11))},,,function(t,e){},function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},function(t,e,r){"use strict";r.r(e);var n=r(9),a=r(3),i=r(7);function s(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&E(t.prototype,e),r&&E(t,r),t}var _=r(17),c="7.3.1",l=Object(_.a)();var h=function(){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";o(this,t),this.storage=function(t){try{var e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch(t){return null}}(n),this.id=e,this.config={},Object.assign(this.config,r),this._loadConfiguration()}return u(t,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(t){return this.config={},this.updateConfiguration(t)}},{key:"updateConfiguration",value:function(t){if(Object.assign(this.config,t),this.storage){var e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}},{key:"_loadConfiguration",value:function(){var t={};if(this.storage){var e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}]),t}();function f(t,e,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,a=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>n&&(r=Math.min(r,n/t.width));var i=t.width*r,s=t.height*r,o=["font-size:1px;","padding:".concat(Math.floor(s/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(s,"px;"),"background:url(".concat(a,");"),"background-size:".concat(i,"px ").concat(s,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),o]}var A={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function T(t){return"string"==typeof t?A[t.toUpperCase()]||A.WHITE:t}function d(t,e){if(!t)throw new Error(e||"Assertion failed")}var R=r(6);function g(){var t;if(l&&R.b.performance)t=R.b.performance.now();else if(R.a.hrtime){var e=R.a.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}var N={debug:l&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},m={enabled:!1,priority:0};function F(){}var I={};var S=function(){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).id;o(this,t),this.id=e,this.VERSION=c,this._startTs=g(),this._deltaTs=g(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new h("__probe-".concat(this.id,"__"),m),this.userData={},this.timeStamp("".concat(this.id," started")),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],r=Object.getPrototypeOf(t),n=Object.getOwnPropertyNames(r),a=!0,i=!1,s=void 0;try{for(var o,E=function(){var r=o.value;"function"==typeof t[r]&&(e.find(function(t){return r===t})||(t[r]=t[r].bind(t)))},u=n[Symbol.iterator]();!(a=(o=u.next()).done);a=!0)E()}catch(t){i=!0,s=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}}(this),Object.seal(this)}return u(t,[{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getPriority",value:function(){return this._storage.config.priority}},{key:"getLevel",value:function(){return this._storage.config.priority}},{key:"getTotal",value:function(){return Number((g()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((g()-this._deltaTs).toPrecision(10))}},{key:"enable",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}},{key:"setLevel",value:function(t){return this._storage.updateConfiguration({priority:t}),this}},{key:"assert",value:function(t,e){d(t,e)}},{key:"warn",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this._getLogFunction({message:t,args:r,method:N.warn,once:!0})}},{key:"error",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this._getLogFunction({message:t,args:r,method:N.error})}},{key:"deprecated",value:function(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}},{key:"removed",value:function(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}},{key:"probe",value:function(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return this._getLogFunction({priority:t,message:e,args:n,method:N.log,time:!0,once:!0})}},{key:"log",value:function(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return this._getLogFunction({priority:t,message:e,args:n,method:N.debug})}},{key:"info",value:function(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return this._getLogFunction({priority:t,message:e,args:n,method:console.info})}},{key:"once",value:function(t,e){for(var r=arguments.length,n=new Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];return this._getLogFunction({priority:t,message:e,args:n,method:N.debug||N.info,once:!0})}},{key:"table",value:function(t,e,r){if(e){var n=function(t){for(var e in t)for(var r in t[e])return r||"untitled";return"empty"}(e);return this._getLogFunction({priority:t,message:e,args:r&&[r],tag:n,method:console.table||F})}return F}},{key:"image",value:function(t){var e=t.priority,r=t.image,n=t.message,a=void 0===n?"":n,i=t.scale,s=void 0===i?1:i;return e>this.getPriority()?F:l?this._logImageInBrowser({image:r,message:a,scale:s}):this._logImageInNode({image:r,message:a,scale:s})}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(t){return this._storage.config[t]}},{key:"set",value:function(t,e){this._storage.updateConfiguration(function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}({},t,e))}},{key:"_logImageInNode",value:function(t){var e=t.image,n=(t.message,t.scale),a=void 0===n?1:n,i=null;try{i=r(28)}catch(t){}return i?function(){return i(e,{fit:"box",width:"".concat(Math.round(80*a),"%")}).then(function(t){return console.log(t)})}:F}},{key:"_logImageInBrowser",value:function(t){var e=t.image,r=t.message,n=void 0===r?"":r,a=t.scale,i=void 0===a?1:a;if("string"==typeof e){var o=new Image;return o.onload=function(){var t,e=f(o,n,i);(t=console).log.apply(t,s(e))},o.src=e,F}var E,u=e.nodeName||"";if("img"===u.toLowerCase())return(E=console).log.apply(E,s(f(e,n,i))),F;if("canvas"===u.toLowerCase()){var _=new Image;return _.onload=function(){var t;return(t=console).log.apply(t,s(f(_,n,i)))},_.src=e.toDataURL(),F}return F}},{key:"time",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.time?console.time:console.info})}},{key:"timeEnd",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeEnd?console.timeEnd:console.info})}},{key:"timeStamp",value:function(t,e){return this._getLogFunction({priority:t,message:e,method:console.timeStamp||F})}},{key:"group",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},n=(r=this._normalizeArguments({priority:t,message:e,opts:r})).collapsed;return this._getLogFunction({priority:t,message:e,opts:r,method:(n?console.groupCollapsed:console.group)||console.info})}},{key:"groupCollapsed",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},r,{collapsed:!0}))}},{key:"groupEnd",value:function(t){return this._getLogFunction({priority:t,message:"",method:console.groupEnd||F})}},{key:"withGroup",value:function(t,e,r){var n=this._normalizeArguments({priority:t,message:e});this.group(n);try{r()}finally{this.groupEnd(n.message)}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(t){return 0===(t=this._normalizePriority(t))||this.isEnabled()&&this.getPriority()>=t}},{key:"_getElapsedTime",value:function(){var t=this.getTotal(),e=this.getDelta();return this._deltaTs=g(),{total:t,delta:e}}},{key:"_getLogFunction",value:function(t){if(this._shouldLog(t.priority)){var e=t.method;t=this._parseArguments(t),d(e);var r=t.message,n=t.tag||t.message;if(t.once){if(I[n])return F;I[n]=g()}return r=this._decorateMessage(r,t),e.bind.apply(e,[console,r].concat(s(t.args)))}return F}},{key:"_parseArguments",value:function(t){var e=this._normalizeArguments(t),r=this._getElapsedTime(),n=r.delta,a=r.total;return Object.assign(t,e,{delta:n,total:a})}},{key:"_normalizePriority",value:function(t){var e;switch(Object(i.a)(t)){case"number":e=t;break;case"object":e=t.priority||0;break;default:e=0}return d(Number.isFinite(e)&&e>=0),e}},{key:"_normalizeArguments",value:function(t){var e=t.priority,r=t.message,n=t.args,a=void 0===n?[]:n,s=t.opts,o={priority:this._normalizePriority(e),message:r,args:a};switch(Object(i.a)(e)){case"string":case"function":void 0!==r&&a.unshift(r),Object.assign(o,{message:e});break;case"object":Object.assign(o,e)}return"function"==typeof o.message&&(o.message=this._shouldLog(o.priority)?o.message():""),d("string"==typeof o.message||"object"===Object(i.a)(o.message)),Object.assign(o,s)}},{key:"_decorateMessage",value:function(t,e){if("string"==typeof t){var r="";if(e.time){var n=this._getElapsedTime().total;r=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=Math.max(e-t.length,0);return"".concat(" ".repeat(r)).concat(t)}((o=n)<10?"".concat(o.toFixed(2),"ms"):o<100?"".concat(o.toFixed(1),"ms"):o<1e3?"".concat(o.toFixed(0),"ms"):"".concat((o/1e3).toFixed(2),"s"))}t=e.time?"".concat(this.id,": ").concat(r,"  ").concat(t):"".concat(this.id,": ").concat(t),a=t,i=e.color,s=e.background,l||"string"!=typeof a||(i&&(i=T(i),a="[".concat(i,"m").concat(a,"[39m")),s&&(i=T(s),a="[".concat(s+10,"m").concat(a,"[49m"))),t=a}var a,i,s,o;return t}},{key:"priority",set:function(t){return this._storage.updateConfiguration({priority:t}),this},get:function(){return this._storage.config.priority}}]),t}();S.VERSION=c;var O=new S({id:"luma"}).enable(),L=function(){function t(e,r){o(this,t),this.name=e,this.type=r,this.sampleSize=1,this.reset()}return u(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=g(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(g()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),b=function(){function t(e){var r=e.id,n=e.stats;o(this,t),this.id=r,this.stats={},this._initializeStats(n),Object.seal(this)}return u(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach(function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}},{key:"_initializeStats",value:function(){var t=this;(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e){return t._getOrCreate(e)})}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,r=t.type;return this.stats[e]||(this.stats[e]=t instanceof L?t:new L(e,r)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}();r(16);const C=new class{constructor(){this.stats=new Map}get(t){return this.stats.has(t)||this.stats.set(t,new b({id:t})),this.stats.get(t)}};if(a.b.luma&&"7.3.1"!==a.b.luma.VERSION)throw new Error(`luma.gl - multiple VERSIONs detected: ${a.b.luma.VERSION} vs 7.3.1`);a.b.luma||(n.a&&O.log(1,"luma.gl 7.3.1 - set luma.log.priority=1 (or higher) to trace rendering")(),a.b.luma=a.b.luma||{VERSION:"7.3.1",version:"7.3.1",log:O,stats:C,globals:{modules:{},nodeIO:{}}});a.b.luma;var B=r(13),M=r(0),p=r.n(M);function U(t){return Array.isArray(t)||ArrayBuffer.isView(t)}var P={framebuffer:(t,e)=>{const r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(p.a.FRAMEBUFFER,r)},blend:(t,e)=>e?t.enable(p.a.BLEND):t.disable(p.a.BLEND),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=U(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=U(e)&&2===e.length?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(p.a.CULL_FACE):t.disable(p.a.CULL_FACE),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(p.a.DEPTH_TEST):t.disable(p.a.DEPTH_TEST),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(p.a.DITHER):t.disable(p.a.DITHER),derivativeHint:(t,e)=>{t.hint(p.a.FRAGMENT_SHADER_DERIVATIVE_HINT,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(p.a.GENERATE_MIPMAP_HINT,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(p.a.POLYGON_OFFSET_FILL):t.disable(p.a.POLYGON_OFFSET_FILL),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(p.a.SCISSOR_TEST):t.disable(p.a.SCISSOR_TEST),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(p.a.STENCIL_TEST):t.disable(p.a.STENCIL_TEST),stencilMask:(t,e)=>{e=U(e)?e:[e,e];const[r,n]=e;t.stencilMaskSeparate(p.a.FRONT,r),t.stencilMaskSeparate(p.a.BACK,n)},stencilFunc:(t,e)=>{e=U(e)&&3===e.length?[...e,...e]:e;const[r,n,a,i,s,o]=e;t.stencilFuncSeparate(p.a.FRONT,r,n,a),t.stencilFuncSeparate(p.a.BACK,i,s,o)},stencilOp:(t,e)=>{e=U(e)&&3===e.length?[...e,...e]:e;const[r,n,a,i,s,o]=e;t.stencilOpSeparate(p.a.FRONT,r,n,a),t.stencilOpSeparate(p.a.BACK,i,s,o)},viewport:(t,e)=>t.viewport(...e)};function D(t,e){Object(B.f)(t,e);for(const r in e){const n=P[r];n&&n(t,e[r],r)}}var y=r(19),G=r(31),v=r(14);function w(t,e,r){if(Object(G.a)(e))return r(t);const{nocatch:n=!0}=e;let a;if(Object(v.a)(!e.frameBuffer),Object(y.c)(t),D(t,e),n)a=r(t),Object(y.b)(t);else try{a=r(t)}finally{Object(y.b)(t)}return a}var x=r(4);const H="Failed to create WebGL context in Node.js, headless gl not available",X="Failed to create WebGL context in Node.js, headless gl returned null";const V=n.a&&"undefined"!=typeof document;let W,k=V&&"complete"===document.readyState;function K(){return W||(W=V?new Promise((t,e)=>{if(V&&"complete"===document.readyState)return k=!0,void t(document);window.onload=()=>{k=!0,t(document)}}):Promise.resolve({})),W}function Y({canvas:t,width:e,height:r,onError:n=(()=>{})}){let a;return"string"==typeof t?(k||n(`createGLContext called on canvas '${t}' before page was loaded`),a=document.getElementById(t)):a=t||function({width:t=800,height:e=600,id:r="gl-canvas",insert:n=!0}){const a=document.createElement("canvas");if(a.id=r,a.style.width=Number.isFinite(t)?`${t}px`:"100%",a.style.height=Number.isFinite(e)?`${e}px`:"100%",n){const t=document.body;t.insertBefore(a,t.firstChild)}return a}({id:"lumagl-canvas",width:e,height:r,onError:n}),a}function j(t){const e=t.getParameter(p.a.VENDOR),r=t.getParameter(p.a.RENDERER),n=t.getExtension("WEBGL_debug_renderer_info");return{vendor:n&&t.getParameter(n.UNMASKED_VENDOR_WEBGL||p.a.VENDOR)||e,renderer:n&&t.getParameter(n.UNMASKED_RENDERER_WEBGL||p.a.RENDERER)||r,vendorMasked:e,rendererMasked:r,version:t.getParameter(p.a.VERSION),shadingLanguageVersion:t.getParameter(p.a.SHADING_LANGUAGE_VERSION)}}function $(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function z(t){return t.canvas?t.drawingBufferWidth/(t.canvas.clientWidth||t.canvas.width||1):1}function Z(t,e,r=!0){return function(t,e,r,n,a){const i=Q(t[0],e,r);let s=q(t[1],e,n,a),o=Q(t[0]+1,e,r);const E=o===r-1?o:o-1;let u;o=q(t[1]+1,e,n,a),a?(u=s,s=o=0===o?o:o+1):u=o===n-1?o:o-1;return{x:i,y:s,width:Math.max(E-i+1,1),height:Math.max(u-s+1,1)}}(e,z(t),t.drawingBufferWidth,t.drawingBufferHeight,r)}function Q(t,e,r){return Math.min(Math.round(t*e),r-1)}function q(t,e,r,n){return n?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}function J(t){return Boolean(t&&2===t._version)}const tt={webgl2:!0,webgl1:!0,throwOnFailure:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function et(t={}){Object.assign(tt,{width:1,height:1},t)}function rt(t={}){t=Object.assign({},tt,t);const{width:e,height:r}=t;function a(e){if(t.throwOnError)throw new Error(e);return null}let i;if(n.a){const{canvas:n}=t;i=function(t,e){const{onError:r=(t=>null)}=e,n=t=>r(`WebGL context: ${t.statusMessage||"error"}`);t.addEventListener("webglcontextcreationerror",n,!1);const{webgl1:a=!0,webgl2:i=!0}=e;let s=null;return i&&(s=(s=s||t.getContext("webgl2",e))||t.getContext("experimental-webgl2",e)),a&&(s=(s=s||t.getContext("webgl",e))||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",n,!1),s||r(`Failed to create ${i&&!a?"WebGL2":"WebGL"} context`)}(Y({canvas:n,width:e,height:r,onError:a}),t)}else i=function(t){const{width:e,height:r,webgl1:n,webgl2:a,onError:i}=t;if(a&&!n)return i("headless-gl does not support WebGL2");if(!x.m)return i(H);const s=Object(x.m)(e,r,t);return s||i(X)}({...t,width:e,height:r,onError:a});return i?(function(t){const e=J(t)?"WebGL2":"WebGL1",r=j(t),n=r?`(${r.vendor},${r.renderer})`:"",a=t.debug?" debug":"";O.info(1,`${e}${a} context ${n}`)()}(i=nt(i,t)),i):null}function nt(t,e={}){if(t._instrumented)return t;t._version=t._version||function(t){if(void 0!==x.b&&t instanceof x.b)return 2;return 1}(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},tt,e);const{manageState:r,debug:i}=e;return r&&Object(y.a)(t,{copyState:!1,log:(...t)=>O.log(1,...t)()}),n.a&&i&&(a.b.makeDebugContext?(t=a.b.makeDebugContext(t,e),O.priority=Math.max(O.priority,1)):O.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function at(t){const e=t.getExtension("STACKGL_destroy_context");e&&e.destroy()}function it(t,e={}){if(t.canvas){return void function(t,e,r){const n="width"in r?r.width:t.canvas.clientWidth||t.canvas.width||1,a="height"in r?r.height:t.canvas.clientHeight||t.canvas.height||1;t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const i=t.luma.canvasSizeInfo;if(i.clientWidth!==n||i.clientHeight!==a||i.devicePixelRatio!==e){let r=e;const i=Math.floor(n*r),s=Math.floor(a*r);t.canvas.width=i,t.canvas.height=s,t.drawingBufferWidth===i&&t.drawingBufferHeight===s||(O.warn("Device pixel ratio clamped")(),r=Math.min(t.drawingBufferWidth/n,t.drawingBufferHeight/a),t.canvas.width=Math.floor(n*r),t.canvas.height=Math.floor(a*r)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:n,clientHeight:a,devicePixelRatio:e})}}(t,function(t){const e="undefined"==typeof window?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}(e.useDevicePixels),e)}const r=t.getExtension("STACKGL_resize_drawingbuffer");r&&"width"in e&&"height"in e&&r.resize(e.width,e.height)}function st(t){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function ot(t){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}const Et="Invalid WebGLRenderingContext",ut="Requires WebGL2";function _t(t){return Boolean(t&&Number.isFinite(t._version))}function ct(t){return Boolean(t&&2===t._version)}function lt(t){$(_t(t),Et)}function ht(t){$(ct(t),ut)}function ft(t,e){if("string"!=typeof e)return e;const r=Number(e);if(!isNaN(r))return r;const n=t[e=e.replace(/^.*\./,"")];return $(void 0!==n,`Accessing undefined constant GL.${e}`),n}function At(t,e){e=Number(e);for(const r in t)if(t[r]===e)return`GL.${r}`;return String(e)}const Tt={};function dt(t="id"){return Tt[t]=Tt[t]||1,`${t}-${Tt[t]++}`}function Rt(t){return $("number"==typeof t,"Input must be a number"),t&&0==(t&t-1)}function gt(t){let e=!0;for(const r in t){e=!1;break}return e}function Nt(t,e,r,n){const a=`See luma.gl ${r} Upgrade Guide at http://uber.github.io/luma.gl/#/documentation/overview/upgrade-guide`,i=Object.getPrototypeOf(t);n.forEach(t=>{i.methodName||(i[t]=()=>{throw O.removed(`Calling removed method ${e}.${t}: `,a)(),new Error(t)})})}const mt="Resource subclass must define virtual methods";class Ft{constructor(t,e={}){lt(t);const{id:r,userData:n={}}=e;this.gl=t,this.id=r||dt(this.constructor.name),this.userData=n,this._bound=!1,this._handle=e.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return`${this.constructor.name}(${this.id})`}get handle(){return this._handle}delete({deleteChildren:t=!1}={}){const e=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,e&&t&&e.filter(Boolean).forEach(t=>{t.delete()}),this}bind(t=this.handle){if("function"!=typeof t)return this._bindHandle(t),this;let e;return this._bound?e=t():(this._bindHandle(this.handle),this._bound=!0,e=t(),this._bound=!1,this._bindHandle(null)),e}unbind(){this.bind(null)}getParameter(t,e={}){$(t=ft(this.gl,t));const r=(this.constructor.PARAMETERS||{})[t];if(r){const t=ct(this.gl);if(!((!("webgl2"in r)||t)&&(!("extension"in r)||this.gl.getExtension(r.extension)))){const e=r.webgl1,n="webgl2"in r?r.webgl2:r.webgl1;return t?n:e}}return this._getParameter(t,e)}getParameters(t={}){const{parameters:e,keys:r}={},n=this.constructor.PARAMETERS||{},a=ct(this.gl),i={},s=e||Object.keys(n);for(const e of s){const s=n[e];if(s&&(!("webgl2"in s)||a)&&(!("extension"in s)||this.gl.getExtension(s.extension))){const n=r?At(this.gl,e):e;i[n]=this.getParameter(e,t),r&&"GLenum"===s.type&&(i[n]=At(this.gl,i[n]))}}return i}setParameter(t,e){$(t=ft(this.gl,t));const r=(this.constructor.PARAMETERS||{})[t];if(r){const t=ct(this.gl);if(!((!("webgl2"in r)||t)&&(!("extension"in r)||this.gl.getExtension(r.extension))))throw new Error("Parameter not available on this platform");"GLenum"===r.type&&(e=ft(e))}return this._setParameter(t,e),this}setParameters(t){for(const e in t)this.setParameter(e,t[e]);return this}stubRemovedMethods(t,e,r){return Nt(this,t,e,r)}initialize(t){}_createHandle(){throw new Error(mt)}_deleteHandle(){throw new Error(mt)}_bindHandle(){throw new Error(mt)}_getOptsFromHandle(){throw new Error(mt)}_getParameter(t,e){throw new Error(mt)}_setParameter(t,e){throw new Error(mt)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const t=this.constructor.name,e=C.get("Resource Counts");e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}_removeStats(){const t=this.constructor.name;C.get("Resource Counts").get(`${t}s Active`).decrementCount()}_trackAllocatedMemory(t,e=this.constructor.name){const r=C.get("Memory Usage");r.get("GPU Memory").addCount(t),r.get(`${e} Memory`).addCount(t),this.byteLength=t}_trackDeallocatedMemory(t=this.constructor.name){const e=C.get("Memory Usage");e.get("GPU Memory").subtractCount(this.byteLength),e.get(`${t} Memory`).subtractCount(this.byteLength),this.byteLength=0}}const It="Failed to deduce GL constant from typed array";function St(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return p.a.FLOAT;case Uint16Array:return p.a.UNSIGNED_SHORT;case Uint32Array:return p.a.UNSIGNED_INT;case Uint8Array:case Uint8ClampedArray:return p.a.UNSIGNED_BYTE;case Int8Array:return p.a.BYTE;case Int16Array:return p.a.SHORT;case Int32Array:return p.a.INT;default:throw new Error(It)}}function Ot(t,{clamped:e=!0}={}){switch(t){case p.a.FLOAT:return Float32Array;case p.a.UNSIGNED_SHORT:case p.a.UNSIGNED_SHORT_5_6_5:case p.a.UNSIGNED_SHORT_4_4_4_4:case p.a.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case p.a.UNSIGNED_INT:return Uint32Array;case p.a.UNSIGNED_BYTE:return e?Uint8ClampedArray:Uint8Array;case p.a.BYTE:return Int8Array;case p.a.SHORT:return Int16Array;case p.a.INT:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Lt({data:t,width:e,height:r}){const n=Math.round(e/2),a=Math.round(r/2),i=new Uint8Array(n*a*4);for(let r=0;r<a;r++)for(let a=0;a<n;a++)for(let s=0;s<4;s++)i[4*(r*n+a)+s]=t[4*(2*r*e+2*a)+s];return{data:i,width:n,height:a}}function bt(t,e,r){const{removedProps:n={},deprecatedProps:a={},replacedProps:i={}}=r;for(const r in n)if(r in e){const e=n[r]?`${t}.${n[r]}`:"N/A";O.removed(`${t}.${r}`,e)()}for(const r in a)if(r in e){const e=a[r];O.deprecated(`${t}.${r}`,`${t}.${e}`)()}let s=null;for(const r in i)if(r in e){const n=i[r];O.deprecated(`${t}.${r}`,`${t}.${n}`)(),(s=s||Object.assign({},e))[n]=e[r],delete s[r]}return s||e}const Ct={offset:0,stride:0,type:p.a.FLOAT,size:1,divisor:0,normalized:!1,integer:!1},Bt={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Mt{static getBytesPerElement(t){return Ot(t.type||p.a.FLOAT).BYTES_PER_ELEMENT}static getBytesPerVertex(t){return $(t.size),Ot(t.type||p.a.FLOAT).BYTES_PER_ELEMENT*t.size}static resolve(...t){return new Mt(...[Ct,...t])}constructor(...t){t.forEach(t=>this._assign(t)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Mt.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Mt.getBytesPerVertex(this)}_assign(t={}){return void 0!==(t=bt("Accessor",t,Bt)).type&&(this.type=t.type,t.type!==p.a.INT&&t.type!==p.a.UNSIGNED_INT||(this.integer=!0)),void 0!==t.size&&(this.size=t.size),void 0!==t.offset&&(this.offset=t.offset),void 0!==t.stride&&(this.stride=t.stride),void 0!==t.normalized&&(this.normalized=t.normalized),void 0!==t.integer&&(this.integer=t.integer),void 0!==t.divisor&&(this.divisor=t.divisor),void 0!==t.buffer&&(this.buffer=t.buffer),void 0!==t.index&&("boolean"==typeof index?this.index=t.index?1:0:this.index=t.index),void 0!==t.instanced&&(this.divisor=t.instanced?1:0),void 0!==t.isInstanced&&(this.divisor=t.isInstanced?1:0),this}}const pt=10,Ut={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},Pt={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:Ut},Dt={removedProps:Ut};class yt extends Ft{constructor(t,e={}){super(t,e),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=e.target||(this.gl.webgl2?p.a.COPY_READ_BUFFER:p.a.ARRAY_BUFFER),this.initialize(e),Object.seal(this)}getElementCount(t=this.accessor){return Math.round(this.byteLength/Mt.getBytesPerElement(t))}getVertexCount(t=this.accessor){return Math.round(this.byteLength/Mt.getBytesPerVertex(t))}initialize(t={}){return ArrayBuffer.isView(t)&&(t={data:t}),Number.isFinite(t)&&(t={byteLength:t}),t=bt("Buffer",t,Pt),this.usage=t.usage||p.a.STATIC_DRAW,this.debugData=null,this.setAccessor(Object.assign({},t,t.accessor)),t.data?this._setData(t.data):this._setByteLength(t.byteLength||0),this}setProps(t){return"accessor"in(t=bt("Buffer",t,Dt))&&this.setAccessor(t.accessor),this}setAccessor(t){return delete(t=Object.assign({},t)).buffer,this.accessor=new Mt(t),this}reallocate(t){return t>this.byteLength?(this._setByteLength(t),!0):(this.bytesUsed=t,!1)}setData(t){return this.initialize(t)}subData(t){ArrayBuffer.isView(t)&&(t={data:t});const{data:e,offset:r=0,srcOffset:n=0}=t,a=t.byteLength||t.length;$(e);const i=this.gl.webgl2?p.a.COPY_WRITE_BUFFER:this.target;return this.gl.bindBuffer(i,this.handle),0!==n||void 0!==a?(ht(this.gl),this.gl.bufferSubData(this.target,r,e,n,a)):this.gl.bufferSubData(i,r,e),this.gl.bindBuffer(i,null),this.debugData=null,this._inferType(e),this}copyData({sourceBuffer:t,readOffset:e=0,writeOffset:r=0,size:n}){const{gl:a}=this;return ht(a),a.bindBuffer(p.a.COPY_READ_BUFFER,t.handle),a.bindBuffer(p.a.COPY_WRITE_BUFFER,this.handle),a.copyBufferSubData(p.a.COPY_READ_BUFFER,p.a.COPY_WRITE_BUFFER,e,r,n),a.bindBuffer(p.a.COPY_READ_BUFFER,null),a.bindBuffer(p.a.COPY_WRITE_BUFFER,null),this.debugData=null,this}getData({dstData:t=null,srcByteOffset:e=0,dstOffset:r=0,length:n=0}={}){ht(this.gl);const a=Ot(this.accessor.type||p.a.FLOAT,{clamped:!1}),i=this._getAvailableElementCount(e),s=r;let o,E;t?o=(E=t.length)-s:E=s+(o=Math.min(i,n||i));const u=Math.min(i,o);return $((n=n||u)<=u),t=t||new a(E),this.gl.bindBuffer(p.a.COPY_READ_BUFFER,this.handle),this.gl.getBufferSubData(p.a.COPY_READ_BUFFER,e,t,r,n),this.gl.bindBuffer(p.a.COPY_READ_BUFFER,null),t}bind({target:t=this.target,index:e=this.accessor&&this.accessor.index,offset:r=0,size:n}={}){return t===p.a.UNIFORM_BUFFER||t===p.a.TRANSFORM_FEEDBACK_BUFFER?void 0!==n?this.gl.bindBufferRange(t,e,this.handle,r,n):($(0===r),this.gl.bindBufferBase(t,e,this.handle)):this.gl.bindBuffer(t,this.handle),this}unbind({target:t=this.target,index:e=this.accessor&&this.accessor.index}={}){return t===p.a.UNIFORM_BUFFER||t===p.a.TRANSFORM_FEEDBACK_BUFFER?this.gl.bindBufferBase(t,e,null):this.gl.bindBuffer(t,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(pt,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(t,e=this.usage){$(ArrayBuffer.isView(t)),this._trackDeallocatedMemory();const r=this._getTarget();this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,t,e),this.gl.bindBuffer(r,null),this.usage=e,this.debugData=t.slice(0,pt),this.bytesUsed=t.byteLength,this._trackAllocatedMemory(t.byteLength);const n=St(t);return $(n),this.setAccessor(new Mt(this.accessor,{type:n})),this}_setByteLength(t,e=this.usage){$(t>=0),this._trackDeallocatedMemory();let r=t;0===t&&(r=new Float32Array(0));const n=this._getTarget();return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,e),this.gl.bindBuffer(n,null),this.usage=e,this.debugData=null,this.bytesUsed=t,this._trackAllocatedMemory(t),this}_getTarget(){return this.gl.webgl2?p.a.COPY_WRITE_BUFFER:this.target}_getAvailableElementCount(t){const e=t/Ot(this.accessor.type||p.a.FLOAT,{clamped:!1}).BYTES_PER_ELEMENT;return this.getElementCount()-e}_inferType(t){this.accessor.type||this.setAccessor(new Mt(this.accessor,{type:St(t)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(t){this.gl.bindBuffer(this.target,this.handle);const e=this.gl.getBufferParameter(this.target,t);return this.gl.bindBuffer(this.target,null),e}get type(){return O.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return O.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(t){return O.deprecated("setByteLength","reallocate")(),this.reallocate(t)}updateAccessor(t){return O.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new Mt(this.accessor,t),this}}const Gt={[p.a.RGB]:{dataFormat:p.a.RGB,types:[p.a.UNSIGNED_BYTE,p.a.UNSIGNED_SHORT_5_6_5]},[p.a.RGBA]:{dataFormat:p.a.RGBA,types:[p.a.UNSIGNED_BYTE,p.a.UNSIGNED_SHORT_4_4_4_4,p.a.UNSIGNED_SHORT_5_5_5_1]},[p.a.ALPHA]:{dataFormat:p.a.ALPHA,types:[p.a.UNSIGNED_BYTE]},[p.a.LUMINANCE]:{dataFormat:p.a.LUMINANCE,types:[p.a.UNSIGNED_BYTE]},[p.a.LUMINANCE_ALPHA]:{dataFormat:p.a.LUMINANCE_ALPHA,types:[p.a.UNSIGNED_BYTE]},[p.a.R32F]:{dataFormat:p.a.RED,types:[p.a.FLOAT],gl2:!0},[p.a.RG32F]:{dataFormat:p.a.RG,types:[p.a.FLOAT],gl2:!0},[p.a.RGB32F]:{dataFormat:p.a.RGB,types:[p.a.FLOAT],gl2:!0},[p.a.RGBA32F]:{dataFormat:p.a.RGBA,types:[p.a.FLOAT],gl2:!0}},vt={[p.a.RED]:1,[p.a.RED_INTEGER]:1,[p.a.RG]:2,[p.a.RG_INTEGER]:2,[p.a.RGB]:3,[p.a.RGB_INTEGER]:3,[p.a.RGBA]:4,[p.a.RGBA_INTEGER]:4,[p.a.DEPTH_COMPONENT]:1,[p.a.DEPTH_STENCIL]:1,[p.a.ALPHA]:1,[p.a.LUMINANCE]:1,[p.a.LUMINANCE_ALPHA]:2},wt={[p.a.FLOAT]:4,[p.a.UNSIGNED_INT]:4,[p.a.INT]:4,[p.a.UNSIGNED_SHORT]:2,[p.a.SHORT]:2,[p.a.HALF_FLOAT]:2,[p.a.BYTE]:1,[p.a.UNSIGNED_BYTE]:1};const xt=[p.a.LINEAR,p.a.NEAREST];class Ht extends Ft{static isSupported(t,{format:e,linearFiltering:r}={}){let n=!0;return e&&(n=(n=n&&function(t,e){const r=Gt[e];if(!r)return!1;if(void 0===r.gl1&&void 0===r.gl2)return!0;const n=ct(t)&&r.gl2||r.gl1;return"string"==typeof n?t.getExtension(n):n}(t,e))&&(!r||function(t,e){const r=Gt[e];switch(r&&r.types[0]){case p.a.FLOAT:return t.getExtension("OES_texture_float_linear");case p.a.HALF_FLOAT:return t.getExtension("OES_texture_half_float_linear");default:return!0}}(t,e))),n}constructor(t,e){const{id:r=dt("texture"),handle:n,target:a}=e;super(t,{id:r,handle:n}),this.target=a,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return`Texture(${this.id},${this.width}x${this.height})`}initialize(t={}){let e=t.data;if(e instanceof Promise)return e.then(e=>this.initialize(Object.assign({},t,{pixels:e,data:e}))),this;const{pixels:r=null,format:n=p.a.RGBA,border:a=0,recreate:i=!1,parameters:s={},pixelStore:o={},textureUnit:E,unpackFlipY:u=!0}=t;let{mipmaps:_=!0}=t;e||(e=r);let{width:c,height:l,dataFormat:h,type:f}=t;const{depth:A=0}=t;({width:c,height:l,dataFormat:h,type:f}=this._deduceParameters({format:n,type:f,dataFormat:h,compressed:!1,data:e,width:c,height:l})),this.width=c,this.height=l,this.depth=A,this.format=n,this.type=f,this.dataFormat=h,this.border=a,this.textureUnit=E,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(p.a.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,this.handle));const T={[p.a.UNPACK_FLIP_Y_WEBGL]:u},d=Object.assign({},T,o);return _&&this._isNPOT()&&(O.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),_=!1,this._updateForNPOT(s)),this.mipmaps=_,this.setImageData({data:e,width:c,height:l,depth:A,format:n,type:f,dataFormat:h,border:a,mipmaps:_,parameters:d}),_&&this.generateMipmap(),this.setParameters(s),i&&(this.data=e),this}resize({height:t,width:e,mipmaps:r=!1}){return e!==this.width||t!==this.height?this.initialize({width:e,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:r}):this}generateMipmap(t={}){return this._isNPOT()?(O.warn(`texture: ${this} is Non-Power-Of-Two, disabling mipmaping`)(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),w(this.gl,t,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(t){this._trackDeallocatedMemory("Texture");const{target:e=this.target,pixels:r=null,level:n=0,format:a=this.format,border:i=this.border,offset:s=0,parameters:o={}}=t;let{data:E=null,type:u=this.type,width:_=this.width,height:c=this.height,dataFormat:l=this.dataFormat,compressed:h=!1}=t;E||(E=r),({type:u,dataFormat:l,compressed:h,width:_,height:c}=this._deduceParameters({format:a,type:u,dataFormat:l,compressed:h,data:E,width:_,height:c}));const{gl:f}=this;f.bindTexture(this.target,this.handle);let A=null;if(({data:E,dataType:A}=this._getDataType({data:E,compressed:h})),w(this.gl,o,()=>{switch(A){case"null":f.texImage2D(e,n,a,_,c,i,l,u,E);break;case"typed-array":f.texImage2D(e,n,a,_,c,i,l,u,E,s);break;case"buffer":ht(f),f.bindBuffer(p.a.PIXEL_UNPACK_BUFFER,E.handle||E),f.texImage2D(e,n,a,_,c,i,l,u,s),f.bindBuffer(p.a.PIXEL_UNPACK_BUFFER,null);break;case"browser-object":ct(f)?f.texImage2D(e,n,a,_,c,i,l,u,E):f.texImage2D(e,n,a,l,u,E);break;case"compressed":f.compressedTexImage2D(e,n,a,_,c,i,E);break;default:$(!1,"Unknown image data type")}}),E&&E.byteLength)this._trackAllocatedMemory(E.byteLength,"Texture");else{const t=vt[this.dataFormat]||4,e=wt[this.type]||1;this._trackAllocatedMemory(this.width*this.height*t*e,"Texture")}return this.loaded=!0,this}setSubImageData({target:t=this.target,pixels:e=null,data:r=null,x:n=0,y:a=0,width:i=this.width,height:s=this.height,level:o=0,format:E=this.format,type:u=this.type,dataFormat:_=this.dataFormat,compressed:c=!1,offset:l=0,border:h=this.border,parameters:f={}}){if(({type:u,dataFormat:_,compressed:c,width:i,height:s}=this._deduceParameters({format:E,type:u,dataFormat:_,compressed:c,data:r,width:i,height:s})),$(0===this.depth,"texSubImage not supported for 3D textures"),r||(r=e),r&&r.data){const t=r;r=t.data,i=t.shape[0],s=t.shape[1]}r instanceof yt&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),w(this.gl,f,()=>{c?this.gl.compressedTexSubImage2D(t,o,n,a,i,s,E,r):null===r?this.gl.texSubImage2D(t,o,n,a,i,s,_,u,null):ArrayBuffer.isView(r)?this.gl.texSubImage2D(t,o,n,a,i,s,_,u,r,l):r instanceof x.d?(ht(this.gl),this.gl.bindBuffer(p.a.PIXEL_UNPACK_BUFFER,r),this.gl.texSubImage2D(t,o,n,a,i,s,_,u,l),this.gl.bindBuffer(p.a.PIXEL_UNPACK_BUFFER,null)):ct(this.gl)?this.gl.texSubImage2D(t,o,n,a,i,s,_,u,r):this.gl.texSubImage2D(t,o,n,a,_,u,r)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(t={}){return O.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(p.a.ACTIVE_TEXTURE)-p.a.TEXTURE0}bind(t=this.textureUnit){const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(e.TEXTURE0+t)),e.bindTexture(this.target,this.handle),t}unbind(t=this.textureUnit){const{gl:e}=this;return void 0!==t&&(this.textureUnit=t,e.activeTexture(e.TEXTURE0+t)),e.bindTexture(this.target,null),t}_getDataType({data:t,compressed:e=!1}){return e?{data:t,dataType:"compressed"}:null===t?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof yt?{data:t.handle,dataType:"buffer"}:t instanceof x.d?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(t){const{format:e,data:r}=t;let{width:n,height:a,dataFormat:i,type:s,compressed:o}=t;const E=Gt[e];return i=i||E&&E.dataFormat,s=s||E&&E.types[0],o=o||E&&E.compressed,({width:n,height:a}=this._deduceImageSize(r,n,a)),{dataFormat:i,type:s,compressed:o,width:n,height:a,format:e,data:r}}_deduceImageSize(t,e,r){let n;return $(n="undefined"!=typeof ImageData&&t instanceof ImageData?{width:t.width,height:t.height}:"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?{width:t.naturalWidth,height:t.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement?{width:t.width,height:t.height}:"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?{width:t.width,height:t.height}:"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t?{width:e,height:r}:{width:e>=0?e:1,height:r>=0?r:1},"Could not deduced texture size"),$(void 0===e||n.width===e,"Deduced texture width does not match supplied width"),$(void 0===r||n.height===r,"Deduced texture height does not match supplied height"),n}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(t){switch(t){case p.a.TEXTURE_WIDTH:return this.width;case p.a.TEXTURE_HEIGHT:return this.height;default:this.gl.bindTexture(this.target,this.handle);const e=this.gl.getTexParameter(this.target,t);return this.gl.bindTexture(this.target,null),e}}_setParameter(t,e){switch(this.gl.bindTexture(this.target,this.handle),e=this._getNPOTParam(t,e),t){case p.a.TEXTURE_MIN_LOD:case p.a.TEXTURE_MAX_LOD:this.gl.texParameterf(this.handle,t,e);break;case p.a.TEXTURE_WIDTH:case p.a.TEXTURE_HEIGHT:$(!1);break;default:this.gl.texParameteri(this.target,t,e)}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return!ct(this.gl)&&(!(!this.width||!this.height)&&(!Rt(this.width)||!Rt(this.height)))}_updateForNPOT(t){void 0===t[this.gl.TEXTURE_MIN_FILTER]&&(t[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),void 0===t[this.gl.TEXTURE_WRAP_S]&&(t[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),void 0===t[this.gl.TEXTURE_WRAP_T]&&(t[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(t,e){if(this._isNPOT())switch(t){case p.a.TEXTURE_MIN_FILTER:-1===xt.indexOf(e)&&(e=p.a.LINEAR);break;case p.a.TEXTURE_WRAP_S:case p.a.TEXTURE_WRAP_T:e!==p.a.CLAMP_TO_EDGE&&(e=p.a.CLAMP_TO_EDGE)}return e}}let Xt="";function Vt(t){Xt=t}function Wt(t,e={}){$("string"==typeof t),t=Xt+t;const r=e.dataType||"text";return fetch(t,e).then(t=>t[r]())}function kt(t,e){return $("string"==typeof t),t=Xt+t,new Promise((r,n)=>{try{const a=new Image;a.onload=()=>r(a),a.onerror=()=>n(new Error(`Could not load image ${t}.`)),a.crossOrigin=e&&e.crossOrigin||"anonymous",a.src=t}catch(t){n(t)}})}class Kt extends Ht{static isSupported(t,e){return Ht.isSupported(t,e)}constructor(t,e={}){lt(t),(e instanceof Promise||"string"==typeof e)&&(e={data:e}),"string"==typeof e.data&&(e=Object.assign({},e,{data:kt(e.data)})),super(t,Object.assign({},e,{target:p.a.TEXTURE_2D})),this.initialize(e),Object.seal(this)}}const Yt=[p.a.TEXTURE_CUBE_MAP_POSITIVE_X,p.a.TEXTURE_CUBE_MAP_NEGATIVE_X,p.a.TEXTURE_CUBE_MAP_POSITIVE_Y,p.a.TEXTURE_CUBE_MAP_NEGATIVE_Y,p.a.TEXTURE_CUBE_MAP_POSITIVE_Z,p.a.TEXTURE_CUBE_MAP_NEGATIVE_Z];class jt extends Ht{constructor(t,e={}){lt(t),super(t,Object.assign({},e,{target:p.a.TEXTURE_CUBE_MAP})),this.initialize(e),Object.seal(this)}initialize(t={}){const{mipmaps:e=!0,parameters:r={}}=t;this.opts=t,this.setCubeMapImageData(t).then(()=>{this.loaded=!0,e&&this.generateMipmap(t),this.setParameters(r)})}subImage({face:t,data:e,x:r=0,y:n=0,mipmapLevel:a=0}){return this._subImage({target:t,data:e,x:r,y:n,mipmapLevel:a})}async setCubeMapImageData({width:t,height:e,pixels:r,data:n,border:a=0,format:i=p.a.RGBA,type:s=p.a.UNSIGNED_BYTE}){const{gl:o}=this,E=r||n,u=await Promise.all(Yt.map(t=>{const e=E[t];return Promise.all(Array.isArray(e)?e:[e])}));this.bind(),Yt.forEach((r,n)=>{u[n].length>1&&!1!==this.opts.mipmaps&&O.warn(`${this.id} has mipmap and multiple LODs.`)(),u[n].forEach((n,E)=>{t&&e?o.texImage2D(r,E,i,t,e,a,i,s,n):o.texImage2D(r,E,i,i,s,n)})}),this.unbind()}setImageDataForFace(t){const{face:e,width:r,height:n,pixels:a,data:i,border:s=0,format:o=p.a.RGBA,type:E=p.a.UNSIGNED_BYTE}=t,{gl:u}=this,_=a||i;return this.bind(),_ instanceof Promise?_.then(r=>this.setImageDataForFace(Object.assign({},t,{face:e,data:r,pixels:r}))):this.width||this.height?u.texImage2D(e,0,o,r,n,s,o,E,_):u.texImage2D(e,0,o,o,E,_),this}}jt.FACES=Yt;class $t extends Ht{static isSupported(t){return ct(t)}constructor(t,e={}){ht(t),super(t,e=Object.assign({depth:1},e,{target:p.a.TEXTURE_3D,unpackFlipY:!1})),this.initialize(e),Object.seal(this)}setImageData({level:t=0,dataFormat:e=p.a.RGBA,width:r,height:n,depth:a=1,border:i=0,format:s,type:o=p.a.UNSIGNED_BYTE,offset:E=0,data:u,parameters:_={}}){if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),w(this.gl,_,()=>{ArrayBuffer.isView(u)&&this.gl.texImage3D(this.target,t,e,r,n,a,i,s,o,u),u instanceof yt&&(this.gl.bindBuffer(p.a.PIXEL_UNPACK_BUFFER,u.handle),this.gl.texImage3D(this.target,t,e,r,n,a,i,s,o,E))}),u&&u.byteLength)this._trackAllocatedMemory(u.byteLength,"Texture");else{const t=vt[this.dataFormat]||4,e=wt[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*t*e,"Texture")}return this.loaded=!0,this}}const zt="EXT_color_buffer_float";var Zt={[p.a.DEPTH_COMPONENT16]:{bpp:2},[p.a.DEPTH_COMPONENT24]:{gl2:!0,bpp:3},[p.a.DEPTH_COMPONENT32F]:{gl2:!0,bpp:4},[p.a.STENCIL_INDEX8]:{bpp:1},[p.a.DEPTH_STENCIL]:{bpp:4},[p.a.DEPTH24_STENCIL8]:{gl2:!0,bpp:4},[p.a.DEPTH32F_STENCIL8]:{gl2:!0,bpp:5},[p.a.RGBA4]:{bpp:2},[p.a.RGB565]:{bpp:2},[p.a.RGB5_A1]:{bpp:2},[p.a.R8]:{gl2:!0,bpp:1},[p.a.R8UI]:{gl2:!0,bpp:1},[p.a.R8I]:{gl2:!0,bpp:1},[p.a.R16UI]:{gl2:!0,bpp:2},[p.a.R16I]:{gl2:!0,bpp:2},[p.a.R32UI]:{gl2:!0,bpp:4},[p.a.R32I]:{gl2:!0,bpp:4},[p.a.RG8]:{gl2:!0,bpp:2},[p.a.RG8UI]:{gl2:!0,bpp:2},[p.a.RG8I]:{gl2:!0,bpp:2},[p.a.RG16UI]:{gl2:!0,bpp:4},[p.a.RG16I]:{gl2:!0,bpp:4},[p.a.RG32UI]:{gl2:!0,bpp:8},[p.a.RG32I]:{gl2:!0,bpp:8},[p.a.RGB8]:{gl2:!0,bpp:3},[p.a.RGBA8]:{gl2:!0,bpp:4},[p.a.RGB10_A2]:{gl2:!0,bpp:4},[p.a.RGBA8UI]:{gl2:!0,bpp:4},[p.a.RGBA8I]:{gl2:!0,bpp:4},[p.a.RGB10_A2UI]:{gl2:!0,bpp:4},[p.a.RGBA16UI]:{gl2:!0,bpp:8},[p.a.RGBA16I]:{gl2:!0,bpp:8},[p.a.RGBA32I]:{gl2:!0,bpp:16},[p.a.RGBA32UI]:{gl2:!0,bpp:16},[p.a.R16F]:{gl2:zt,bpp:2},[p.a.RG16F]:{gl2:zt,bpp:4},[p.a.RGBA16F]:{gl2:zt,bpp:8},[p.a.R32F]:{gl2:zt,bpp:4},[p.a.RG32F]:{gl2:zt,bpp:8},[p.a.RGBA32F]:{gl2:zt,bpp:16},[p.a.R11F_G11F_B10F]:{gl2:zt,bpp:4}};class Qt extends Ft{static isSupported(t,{format:e}={}){return!e||function(t,e,r){const n=r[e];if(!n)return!1;const a=ct(t)&&n.gl2||n.gl1;return"string"==typeof a?t.getExtension(a):a}(t,e,Zt)}static getSamplesForFormat(t,{format:e}){return t.getInternalformatParameter(p.a.RENDERBUFFER,e,p.a.SAMPLES)}constructor(t,e={}){super(t,e),this.initialize(e),Object.seal(this)}initialize({format:t,width:e=1,height:r=1,samples:n=0}){return $(t,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(p.a.RENDERBUFFER,this.handle),0!==n&&ct(this.gl)?this.gl.renderbufferStorageMultisample(p.a.RENDERBUFFER,n,t,e,r):this.gl.renderbufferStorage(p.a.RENDERBUFFER,t,e,r),this.format=t,this.width=e,this.height=r,this.samples=n,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Zt[this.format].bpp),this}resize({width:t,height:e}){return t!==this.width||e!==this.height?this.initialize({width:t,height:e,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(t){this.gl.bindRenderbuffer(p.a.RENDERBUFFER,t)}_syncHandle(t){this.format=this.getParameter(p.a.RENDERBUFFER_INTERNAL_FORMAT),this.width=this.getParameter(p.a.RENDERBUFFER_WIDTH),this.height=this.getParameter(p.a.RENDERBUFFER_HEIGHT),this.samples=this.getParameter(p.a.RENDERBUFFER_SAMPLES)}_getParameter(t){return this.gl.bindRenderbuffer(p.a.RENDERBUFFER,this.handle),this.gl.getRenderbufferParameter(p.a.RENDERBUFFER,t)}}const qt=256,Jt=1024,te=16384,ee=6144,re=6145,ne=6146,ae=34041,ie="clear: bad arguments";function se(t,{framebuffer:e=null,color:r=null,depth:n=null,stencil:a=null}={}){const i={};e&&(i.framebuffer=e);let s=0;r&&(s|=te,!0!==r&&(i.clearColor=r)),n&&(s|=qt,!0!==n&&(i.clearDepth=n)),a&&(s|=Jt,!0!==n&&(i.clearStencil=n)),$(0!==s,ie),w(t,i,()=>{t.clear(s)})}function oe(t,{framebuffer:e=null,buffer:r=ee,drawBuffer:n=0,value:a=[0,0,0,0]}={}){ht(t),w(t,{framebuffer:e},()=>{switch(r){case ee:switch(a.constructor){case Int32Array:t.clearBufferiv(r,n,a);break;case Uint32Array:t.clearBufferuiv(r,n,a);break;case Float32Array:default:t.clearBufferfv(r,n,a)}break;case re:t.clearBufferfv(re,0,[a]);break;case ne:t.clearBufferiv(ne,0,[a]);break;case ae:const[e,i]=a;t.clearBufferfi(ae,0,e,i);break;default:$(!1,ie)}})}function Ee(t){switch(t){case p.a.ALPHA:case p.a.R32F:case p.a.RED:return 1;case p.a.RG32F:case p.a.RG:return 2;case p.a.RGB:case p.a.RGB32F:return 3;case p.a.RGBA:case p.a.RGBA32F:return 4;default:return $(!1),0}}function ue(t,{sourceX:e=0,sourceY:r=0,sourceFormat:n=p.a.RGBA,sourceAttachment:a=p.a.COLOR_ATTACHMENT0,target:i=null,sourceWidth:s,sourceHeight:o,sourceType:E}={}){const{framebuffer:u,deleteFramebuffer:_}=Ae(t);$(u);const{gl:c,handle:l,attachments:h}=u;s=s||u.width,o=o||u.height,a===p.a.COLOR_ATTACHMENT0&&null===l&&(a=p.a.FRONT),$(h[a]),i=function(t,e,r,n,a){if(t)return t;const i=Ot(e=e||p.a.UNSIGNED_BYTE,{clamped:!1}),s=Ee(r);return new i(n*a*s)}(i,E=E||h[a].type,n,s,o),E=E||St(i);const f=c.bindFramebuffer(p.a.FRAMEBUFFER,l);return c.readPixels(e,r,s,o,n,E,i),c.bindFramebuffer(p.a.FRAMEBUFFER,f||null),_&&u.delete(),i}function _e(t,{sourceX:e=0,sourceY:r=0,sourceFormat:n=p.a.RGBA,target:a=null,targetByteOffset:i=0,sourceWidth:s,sourceHeight:o,sourceType:E}){const{framebuffer:u,deleteFramebuffer:_}=Ae(t);$(u);const{gl:c}=u;if(s=s||u.width,o=o||u.height,ht(c),E=E||(a?a.type:p.a.UNSIGNED_BYTE),!a){const t=Ee(n),e=function(t){switch(t){case p.a.UNSIGNED_BYTE:return 1;case p.a.UNSIGNED_SHORT_5_6_5:case p.a.UNSIGNED_SHORT_4_4_4_4:case p.a.UNSIGNED_SHORT_5_5_5_1:return 2;case p.a.FLOAT:return 4;default:return $(!1),0}}(E);a=new yt(c,{byteLength:i+s*o*t*e,accessor:{type:E,size:t}})}return a.bind({target:p.a.PIXEL_PACK_BUFFER}),w(c,{framebuffer:u},()=>{c.readPixels(e,r,s,o,n,E,i)}),a.unbind({target:p.a.PIXEL_PACK_BUFFER}),_&&u.delete(),a}function ce(t,{sourceAttachment:e=p.a.COLOR_ATTACHMENT0,targetMaxHeight:r=Number.MAX_SAFE_INTEGER}={}){let n=ue(t,{sourceAttachment:e}),{width:a,height:i}=t;for(;i>r;)({data:n,width:a,height:i}=Lt({data:n,width:a,height:i}));!function({data:t,width:e,height:r,bytesPerPixel:n=4,temp:a}){const i=e*n;a=a||new Uint8Array(i);for(let e=0;e<r/2;++e){const n=e*i,s=(r-e-1)*i;a.set(t.subarray(n,n+i)),t.copyWithin(n,s,s+i),t.set(a,s)}}({data:n,width:a,height:i});const s=document.createElement("canvas");s.width=a,s.height=i;const o=s.getContext("2d"),E=o.createImageData(a,i);return E.data.set(n),o.putImageData(E,0,0),s.toDataURL()}function le(t,{sourceAttachment:e=p.a.COLOR_ATTACHMENT0,targetImage:r=null}={}){const n=ce(t,{sourceAttachment:e});return(r=r||new Image).src=n,r}function he(t,e,{sourceX:r=0,sourceY:n=0,targetX:a,targetY:i,targetZ:s,targetMipmaplevel:o=0,targetInternalFormat:E=p.a.RGBA,width:u,height:_}={}){const{framebuffer:c,deleteFramebuffer:l}=Ae(t);$(c);const{gl:h,handle:f}=c,A=void 0!==a||void 0!==i||void 0!==s;a=a||0,i=i||0,s=s||0;const T=h.bindFramebuffer(p.a.FRAMEBUFFER,f);$(e);let d=null;if(e instanceof Ht&&(d=e,u=Number.isFinite(u)?u:d.width,_=Number.isFinite(_)?_:d.height,d.bind(0),e=d.target),A)switch(e){case p.a.TEXTURE_2D:case p.a.TEXTURE_CUBE_MAP:h.copyTexSubImage2D(e,o,a,i,r,n,u,_);break;case p.a.TEXTURE_2D_ARRAY:case p.a.TEXTURE_3D:h.copyTexSubImage3D(e,o,a,i,s,r,n,u,_)}else h.copyTexImage2D(e,o,E,r,n,u,_,0);return d&&d.unbind(),h.bindFramebuffer(p.a.FRAMEBUFFER,T||null),l&&c.delete(),d}function fe(t,e,{sourceAttachment:r=p.a.COLOR_ATTACHMENT0,sourceX0:n=0,sourceY0:a=0,sourceX1:i,sourceY1:s,targetX0:o=0,targetY0:E=0,targetX1:u,targetY1:_,color:c=!0,depth:l=!1,stencil:h=!1,mask:f=0,filter:A=p.a.NEAREST}={}){const{framebuffer:T,deleteFramebuffer:d}=Ae(t),{framebuffer:R,deleteFramebuffer:g}=Ae(e);$(T),$(R);const{gl:N,handle:m,width:F,height:I,readBuffer:S}=R;ht(N),T.handle||r!==p.a.COLOR_ATTACHMENT0||(r=p.a.FRONT),c&&(f|=p.a.COLOR_BUFFER_BIT),l&&(f|=p.a.DEPTH_BUFFER_BIT),h&&(f|=p.a.STENCIL_BUFFER_BIT),(d||g)&&f&(p.a.DEPTH_BUFFER_BIT|p.a.STENCIL_BUFFER_BIT)&&(f=p.a.COLOR_BUFFER_BIT,O.warn("Blitting from or into a Texture object, forcing mask to GL.COLOR_BUFFER_BIT")()),$(f),i=void 0===i?T.width:i,s=void 0===s?T.height:s,u=void 0===u?F:u,_=void 0===_?I:_;const L=N.bindFramebuffer(p.a.DRAW_FRAMEBUFFER,m),b=N.bindFramebuffer(p.a.READ_FRAMEBUFFER,T.handle);return N.readBuffer(r),N.blitFramebuffer(n,a,i,s,o,E,u,_,f,A),N.readBuffer(S),N.bindFramebuffer(p.a.READ_FRAMEBUFFER,b||null),N.bindFramebuffer(p.a.DRAW_FRAMEBUFFER,L||null),d&&T.delete(),g&&R.delete(),R}function Ae(t){return t instanceof Oe?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Ce(t),deleteFramebuffer:!0}}const Te={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};let de=null;var Re={[Te.WEBGL2]:[!1,!0],[Te.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[Te.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[Te.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[Te.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[Te.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[Te.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[Te.FLOAT_BLEND]:["EXT_float_blend"],[Te.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[Te.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[Te.TEXTURE_FLOAT]:["OES_texture_float",!0],[Te.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[Te.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[Te.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[Te.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[Te.COLOR_ATTACHMENT_RGBA32F]:[function(t){if(null!==de)return de;const e=new Kt(t,{format:t.RGBA,type:t.FLOAT,dataFormat:t.RGBA}),r=new Oe(t,{id:"test-framebuffer",check:!1,attachments:{[t.COLOR_ATTACHMENT0]:e}}),n=r.getStatus();return e.delete(),r.delete(),de=n===t.FRAMEBUFFER_COMPLETE},"EXT_color_buffer_float"],[Te.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[Te.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[Te.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[Te.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[Te.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[Te.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]};const ge=2;function Ne(t,e){return me(t,e)}function me(t,e){return(e=Array.isArray(e)?e:[e]).every(e=>Ie(t,e))}function Fe(t){if(t.luma=t.luma||{},!t.luma.caps){t.luma.caps={},t.luma.caps.webgl2=ct(t);for(const e in Re)t.luma.caps[e]=Ie(t,e)}return t.luma.caps}function Ie(t,e){const r=Re[e];$(r,e);const n=ct(t)&&r[1]||r[0];let a;if("function"==typeof n)a=n(t);else if(Array.isArray(n)){a=!0;for(const e of n)a=a&&Boolean(t.getExtension(e))}else"string"==typeof n?a=Boolean(t.getExtension(n)):"boolean"==typeof n?a=n:$(!1);return a||O.log(ge,`Feature: ${e} not supported`)(),a}const Se="Multiple render targets not supported";class Oe extends Ft{static isSupported(t,{colorBufferFloat:e,colorBufferHalfFloat:r}={}){let n=!0;return e&&(n=Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("WEBGL_color_buffer_float")||t.getExtension("OES_texture_float"))),r&&(n=n&&Boolean(t.getExtension("EXT_color_buffer_float")||t.getExtension("EXT_color_buffer_half_float"))),n}static getDefaultFramebuffer(t){return t.luma=t.luma||{},t.luma.defaultFramebuffer=t.luma.defaultFramebuffer||new Oe(t,{id:"default-framebuffer",handle:null,attachments:{}}),t.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){return this.gl.getParameter(this.gl.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){return this.gl.getParameter(this.gl.MAX_DRAW_BUFFERS)}constructor(t,e={}){super(t,e),this.width=null,this.height=null,this.attachments={},this.readBuffer=p.a.COLOR_ATTACHMENT0,this.drawBuffers=[p.a.COLOR_ATTACHMENT0],this.ownResources=[],this.initialize(e),Object.seal(this)}get color(){return this.attachments[p.a.COLOR_ATTACHMENT0]||null}get texture(){return this.attachments[p.a.COLOR_ATTACHMENT0]||null}get depth(){return this.attachments[p.a.DEPTH_ATTACHMENT]||this.attachments[p.a.DEPTH_STENCIL_ATTACHMENT]||null}get stencil(){return this.attachments[p.a.STENCIL_ATTACHMENT]||this.attachments[p.a.DEPTH_STENCIL_ATTACHMENT]||null}initialize({width:t=1,height:e=1,attachments:r=null,color:n=!0,depth:a=!0,stencil:i=!1,check:s=!0,readBuffer:o,drawBuffers:E}){if($(t>=0&&e>=0,"Width and height need to be integers"),this.width=t,this.height=e,r)for(const n in r){const a=r[n];(Array.isArray(a)?a[0]:a).resize({width:t,height:e})}else r=this._createDefaultAttachments(n,a,i,t,e);this.update({clearAttachments:!0,attachments:r,readBuffer:o,drawBuffers:E}),r&&s&&this.checkStatus()}delete(){for(const t of this.ownResources)t.delete();super.delete()}update({attachments:t={},readBuffer:e,drawBuffers:r,clearAttachments:n=!1,resizeAttachments:a=!0}){this.attach(t,{clearAttachments:n,resizeAttachments:a});const{gl:i}=this,s=i.bindFramebuffer(p.a.FRAMEBUFFER,this.handle);return e&&this._setReadBuffer(e),r&&this._setDrawBuffers(r),i.bindFramebuffer(p.a.FRAMEBUFFER,s||null),this}resize({width:t,height:e}={}){if(null===this.handle)return $(void 0===t&&void 0===e),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===t&&(t=this.gl.drawingBufferWidth),void 0===e&&(e=this.gl.drawingBufferHeight),t!==this.width&&e!==this.height&&O.log(2,`Resizing framebuffer ${this.id} to ${t}x${e}`)();for(const r in this.attachments)this.attachments[r].resize({width:t,height:e});return this.width=t,this.height=e,this}attach(t,{clearAttachments:e=!1,resizeAttachments:r=!0}={}){const n={};e&&Object.keys(this.attachments).forEach(t=>{n[t]=null}),Object.assign(n,t);const a=this.gl.bindFramebuffer(p.a.FRAMEBUFFER,this.handle);for(const t in n){$(void 0!==t,"Misspelled framebuffer binding point?");const e=Number(t),a=n[e];let i=a;if(i)if(i instanceof Qt)this._attachRenderbuffer({attachment:e,renderbuffer:i});else if(Array.isArray(a)){const[t,r=0,n=0]=a;i=t,this._attachTexture({attachment:e,texture:t,layer:r,level:n})}else this._attachTexture({attachment:e,texture:i,layer:0,level:0});else this._unattach(e);r&&i&&i.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(p.a.FRAMEBUFFER,a||null),Object.assign(this.attachments,t),Object.keys(this.attachments).filter(t=>!this.attachments[t]).forEach(t=>{delete this.attachments[t]})}checkStatus(){const{gl:t}=this,e=this.getStatus();if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error(function(t){return(Oe.STATUS||{})[t]||`Framebuffer error ${t}`}(e));return this}getStatus(){const{gl:t}=this,e=t.bindFramebuffer(p.a.FRAMEBUFFER,this.handle),r=t.checkFramebufferStatus(p.a.FRAMEBUFFER);return t.bindFramebuffer(p.a.FRAMEBUFFER,e||null),r}clear({color:t,depth:e,stencil:r,drawBuffers:n=[]}={}){const a=this.gl.bindFramebuffer(p.a.FRAMEBUFFER,this.handle);return(t||e||r)&&se(this.gl,{color:t,depth:e,stencil:r}),n.forEach((t,e)=>{oe({drawBuffer:e,value:t})}),this.gl.bindFramebuffer(p.a.FRAMEBUFFER,a||null),this}readPixels(t={}){return O.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(t={}){return O.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(t={}){return O.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(t={}){return O.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(t={}){return O.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(t={}){return O.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate({attachments:t=[],x:e=0,y:r=0,width:n,height:a}){const{gl:i}=this;ht(i);const s=i.bindFramebuffer(p.a.READ_FRAMEBUFFER,this.handle);return 0===e&&0===r&&void 0===n&&void 0===a?i.invalidateFramebuffer(p.a.READ_FRAMEBUFFER,t):i.invalidateFramebuffer(p.a.READ_FRAMEBUFFER,t,e,r,n,a),i.bindFramebuffer(p.a.READ_FRAMEBUFFER,s),this}getAttachmentParameter(t,e,r){let n=this._getAttachmentParameterFallback(e);return null===n&&(this.gl.bindFramebuffer(p.a.FRAMEBUFFER,this.handle),n=this.gl.getFramebufferAttachmentParameter(p.a.FRAMEBUFFER,t,e),this.gl.bindFramebuffer(p.a.FRAMEBUFFER,null)),r&&n>1e3&&(n=At(this.gl,n)),n}getAttachmentParameters(t=p.a.COLOR_ATTACHMENT0,e,r=this.constructor.ATTACHMENT_PARAMETERS||[]){const n={};for(const a of r){n[e?At(this.gl,a):a]=this.getAttachmentParameter(t,a,e)}return n}getParameters(t=!0){const e=Object.keys(this.attachments),r={};for(const n of e){const e=Number(n);r[t?At(this.gl,e):e]=this.getAttachmentParameters(e,t)}return r}show(){return"undefined"!=typeof window&&window.open(ce(this),"luma-debug-texture"),this}log(t=0,e=""){if(t>O.priority||"undefined"==typeof window)return this;e=e||`Framebuffer ${this.id}`;const r=ce(this,{maxHeight:100});return O.image({priority:t,message:e,image:r},e)(),this}bind({target:t=p.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(t,this.handle),this}unbind({target:t=p.a.FRAMEBUFFER}={}){return this.gl.bindFramebuffer(t,null),this}_createDefaultAttachments(t,e,r,n,a){let i=null;return t&&((i=i||{})[p.a.COLOR_ATTACHMENT0]=new Kt(this.gl,{id:`${this.id}-color0`,pixels:null,format:p.a.RGBA,type:p.a.UNSIGNED_BYTE,width:n,height:a,mipmaps:!1,parameters:{[p.a.TEXTURE_MIN_FILTER]:p.a.LINEAR,[p.a.TEXTURE_MAG_FILTER]:p.a.LINEAR,[p.a.TEXTURE_WRAP_S]:p.a.CLAMP_TO_EDGE,[p.a.TEXTURE_WRAP_T]:p.a.CLAMP_TO_EDGE}}),this.ownResources.push(i[p.a.COLOR_ATTACHMENT0])),e&&r?((i=i||{})[p.a.DEPTH_STENCIL_ATTACHMENT]=new Qt(this.gl,{id:`${this.id}-depth-stencil`,format:p.a.DEPTH24_STENCIL8,width:n,height:111}),this.ownResources.push(i[p.a.DEPTH_STENCIL_ATTACHMENT])):e?((i=i||{})[p.a.DEPTH_ATTACHMENT]=new Qt(this.gl,{id:`${this.id}-depth`,format:p.a.DEPTH_COMPONENT16,width:n,height:a}),this.ownResources.push(i[p.a.DEPTH_ATTACHMENT])):r&&$(!1),i}_unattach(t){const e=this.attachments[t];e&&(e instanceof Qt?this.gl.framebufferRenderbuffer(p.a.FRAMEBUFFER,t,p.a.RENDERBUFFER,null):this.gl.framebufferTexture2D(p.a.FRAMEBUFFER,t,p.a.TEXTURE_2D,null,0),delete this.attachments[t])}_attachRenderbuffer({attachment:t=p.a.COLOR_ATTACHMENT0,renderbuffer:e}){const{gl:r}=this;r.framebufferRenderbuffer(p.a.FRAMEBUFFER,t,p.a.RENDERBUFFER,e.handle),this.attachments[t]=e}_attachTexture({attachment:t=p.a.COLOR_ATTACHMENT0,texture:e,layer:r,level:n}){const{gl:a}=this;switch(a.bindTexture(e.target,e.handle),e.target){case p.a.TEXTURE_2D_ARRAY:case p.a.TEXTURE_3D:a.framebufferTextureLayer(p.a.FRAMEBUFFER,t,e.target,n,r);break;case p.a.TEXTURE_CUBE_MAP:const i=function(t){return t<p.a.TEXTURE_CUBE_MAP_POSITIVE_X?t+p.a.TEXTURE_CUBE_MAP_POSITIVE_X:t}(r);a.framebufferTexture2D(p.a.FRAMEBUFFER,t,i,e.handle,n);break;case p.a.TEXTURE_2D:a.framebufferTexture2D(p.a.FRAMEBUFFER,t,p.a.TEXTURE_2D,e.handle,n);break;default:$(!1,"Illegal texture type")}a.bindTexture(e.target,null),this.attachments[t]=e}_setReadBuffer(t){const{gl:e}=this;ct(e)?e.readBuffer(t):$(t===p.a.COLOR_ATTACHMENT0||t===p.a.BACK,Se),this.readBuffer=t}_setDrawBuffers(t){const{gl:e}=this;if(ct(e))e.drawBuffers(t);else{const r=e.getExtension("WEBGL.draw_buffers");r?r.drawBuffersWEBGL(t):$(1===t.length&&(t[0]===p.a.COLOR_ATTACHMENT0||t[0]===p.a.BACK),Se)}this.drawBuffers=t}_getAttachmentParameterFallback(t){const e=Fe(this.gl);switch(t){case p.a.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:return e.webgl2?null:0;case p.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE:case p.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:case p.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:case p.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:case p.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:case p.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:return e.webgl2?null:8;case p.a.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:return e.webgl2?null:p.a.UNSIGNED_INT;case p.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:return e.webgl2||e.EXT_sRGB?null:p.a.LINEAR;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(t){return this.gl.bindFramebuffer(p.a.FRAMEBUFFER,t)}}const Le=[p.a.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME,p.a.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE,p.a.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,p.a.FRAMEBUFFER_ATTACHMENT_RED_SIZE,p.a.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE,p.a.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE,p.a.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE,p.a.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE,p.a.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE];function be(t,e){$(t instanceof Kt||t instanceof jt||t instanceof $t);const r=t.constructor,{gl:n,width:a,height:i,format:s,type:o,dataFormat:E,border:u,mipmaps:_}=t;return new r(n,Object.assign({width:a,height:i,format:s,type:o,dataFormat:E,border:u,mipmaps:_},e))}function Ce(t,e){const{gl:r,width:n,height:a,id:i}=t;return new Oe(r,Object.assign({},e,{id:`framebuffer-for-${i}`,width:n,height:a,attachments:{[p.a.COLOR_ATTACHMENT0]:t}}))}Oe.ATTACHMENT_PARAMETERS=Le;var Be={[p.a.ALIASED_LINE_WIDTH_RANGE]:{gl1:new Float32Array([1,1])},[p.a.ALIASED_POINT_SIZE_RANGE]:{gl1:new Float32Array([1,1])},[p.a.MAX_TEXTURE_SIZE]:{gl1:64,gl2:2048},[p.a.MAX_CUBE_MAP_TEXTURE_SIZE]:{gl1:16},[p.a.MAX_TEXTURE_IMAGE_UNITS]:{gl1:8},[p.a.MAX_COMBINED_TEXTURE_IMAGE_UNITS]:{gl1:8},[p.a.MAX_VERTEX_TEXTURE_IMAGE_UNITS]:{gl1:0},[p.a.MAX_RENDERBUFFER_SIZE]:{gl1:1},[p.a.MAX_VARYING_VECTORS]:{gl1:8},[p.a.MAX_VERTEX_ATTRIBS]:{gl1:8},[p.a.MAX_VERTEX_UNIFORM_VECTORS]:{gl1:128},[p.a.MAX_FRAGMENT_UNIFORM_VECTORS]:{gl1:16},[p.a.MAX_VIEWPORT_DIMS]:{gl1:new Int32Array([0,0])},[p.a.MAX_3D_TEXTURE_SIZE]:{gl1:0,gl2:256},[p.a.MAX_ARRAY_TEXTURE_LAYERS]:{gl1:0,gl2:256},[p.a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:{gl1:0,gl2:0},[p.a.MAX_COLOR_ATTACHMENTS]:{gl1:0,gl2:4},[p.a.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[p.a.MAX_COMBINED_UNIFORM_BLOCKS]:{gl1:0,gl2:0},[p.a.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[p.a.MAX_DRAW_BUFFERS]:{gl1:0,gl2:4},[p.a.MAX_ELEMENT_INDEX]:{gl1:0,gl2:0},[p.a.MAX_ELEMENTS_INDICES]:{gl1:0,gl2:0},[p.a.MAX_ELEMENTS_VERTICES]:{gl1:0,gl2:0},[p.a.MAX_FRAGMENT_INPUT_COMPONENTS]:{gl1:0,gl2:0},[p.a.MAX_FRAGMENT_UNIFORM_BLOCKS]:{gl1:0,gl2:0},[p.a.MAX_FRAGMENT_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[p.a.MAX_SAMPLES]:{gl1:0,gl2:0},[p.a.MAX_SERVER_WAIT_TIMEOUT]:{gl1:0,gl2:0},[p.a.MAX_TEXTURE_LOD_BIAS]:{gl1:0,gl2:0},[p.a.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:{gl1:0,gl2:0},[p.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:{gl1:0,gl2:0},[p.a.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:{gl1:0,gl2:0},[p.a.MAX_UNIFORM_BLOCK_SIZE]:{gl1:0,gl2:0},[p.a.MAX_UNIFORM_BUFFER_BINDINGS]:{gl1:0,gl2:0},[p.a.MAX_VARYING_COMPONENTS]:{gl1:0,gl2:0},[p.a.MAX_VERTEX_OUTPUT_COMPONENTS]:{gl1:0,gl2:0},[p.a.MAX_VERTEX_UNIFORM_BLOCKS]:{gl1:0,gl2:0},[p.a.MAX_VERTEX_UNIFORM_COMPONENTS]:{gl1:0,gl2:0},[p.a.MIN_PROGRAM_TEXEL_OFFSET]:{gl1:0,gl2:-8,negative:!0},[p.a.MAX_PROGRAM_TEXEL_OFFSET]:{gl1:0,gl2:7},[p.a.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:{gl1:0,gl2:0}};function Me(t){if(t.luma=t.luma||{},!t.luma.limits){t.luma.limits={},t.luma.webgl1MinLimits={},t.luma.webgl2MinLimits={};const e=ct(t);for(const r in Be){const n=Be[r],a=n.gl1,i="gl2"in n?n.gl2:n.gl1,s=e?i:a,o="gl2"in n&&!e||"extension"in n&&!t.getExtension(n.extension)?s:t.getParameter(r);t.luma.limits[r]=o,t.luma.webgl1MinLimits[r]=a,t.luma.webgl2MinLimits[r]=i}}return t.luma.limits}function pe(t){t.luma=t.luma||{};const e=j(t);return t.luma.info||(t.luma.info={[p.a.UNMASKED_VENDOR_WEBGL]:e.vendor,[p.a.UNMASKED_RENDERER_WEBGL]:e.renderer,[p.a.VENDOR]:e.vendorMasked,[p.a.RENDERER]:e.rendererMasked,[p.a.VERSION]:e.version,[p.a.SHADING_LANGUAGE_VERSION]:e.shadingLanguageVersion}),t.luma.info}function Ue(t){return Object.assign(j(t),{limits:Me(t),info:pe(t),webgl1MinLimits:t.luma.webgl1MinLimits,webgl2MinLimits:t.luma.webgl2MinLimits})}const Pe={};function De(t,e,r={}){const n=Re[e];if($(n,e),!function(t={}){const e="undefined"!=typeof window&&window.navigator||{},r=t.userAgent||e.userAgent||"",n=-1!==r.indexOf("MSIE "),a=-1!==r.indexOf("Trident/");return n||a}(r))return!0;if(e in Pe)return Pe[e];const a=`#extension GL_${n[0]} : enable\nvoid main(void) {}`,i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,a),t.compileShader(i);const s=t.getShaderParameter(i,t.COMPILE_STATUS);return t.deleteShader(i),Pe[e]=s,s}function ye(t,e="unnamed"){const r=t.match(/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/);return r?r[1]:e}const Ge=35632,ve=35633;function we(t,e,r,n){const a=t.split(/\r?\n/),i={},s={},o=n||ye(e)||"(unnamed)",E=`${function(t){switch(t){case Ge:return"fragment";case ve:return"vertex";default:return"unknown type"}}(r)} shader ${o}`;for(let e=0;e<a.length;e++){const r=a[e];if(r.length<=1)continue;const n=r.split(":"),o=n[0],u=parseInt(n[2],10);if(isNaN(u))throw new Error(`GLSL compilation error in ${E}: ${t}`);"WARNING"!==o?i[u]=r:s[u]=r}const u=function(t,e=1,r=": "){const n=t.split(/\r?\n/),a=String(n.length+e-1).length;return n.map((t,n)=>{const i=n+e,s=String(i).length,o=He(i,a-s);return o+r+t})}(e);return{shaderName:E,errors:xe(i,u),warnings:xe(s,u)}}function xe(t,e){let r="";for(let n=0;n<e.length;n++){const a=e[n];if((t[n+3]||t[n+2]||t[n+1])&&(r+=`${a}\n`,t[n+1])){const e=t[n+1],a=e.split(":",3),i=a[0],s=parseInt(a[1],10)||0;r+=He(`^^^ ${i}: ${e.substring(a.join(":").length+1).trim()}\n\n`,s)}}return r}function He(t,e){let r="";for(let t=0;t<e;++t)r+=" ";return`${r}${t}`}const Xe="Shader: GLSL source code must be a JavaScript string";class Ve extends Ft{static getTypeName(t){switch(t){case p.a.VERTEX_SHADER:return"vertex-shader";case p.a.FRAGMENT_SHADER:return"fragment-shader";default:return $(!1),"unknown"}}constructor(t,e){lt(t),$("string"==typeof e.source,Xe),super(t,{id:ye(e.source,null)||e.id||dt(`unnamed ${Ve.getTypeName(e.shaderType)}`)}),this.shaderType=e.shaderType,this.source=e.source,this.initialize(e)}initialize({source:t}){const e=ye(t,null);e&&(this.id=dt(e)),this._compile(t)}getParameter(t){return this.gl.getShaderParameter(this.handle,t)}toString(){return`${Ve.getTypeName(this.shaderType)}:${this.id}`}getName(){return ye(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const t=this.gl.getExtension("WEBGL.debug_shaders");return t?t.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL.debug_shaders not implemented"}_compile(t=this.source){if(t.startsWith("#version ")||(t=`#version 100\n${t}`),this.source=t,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(p.a.COMPILE_STATUS)){const t=this.gl.getShaderInfoLog(this.handle),{shaderName:e,errors:r,warnings:n}=we(t,this.source,this.shaderType,this.id);throw O.error(`GLSL compilation errors in ${e}\n${r}`)(),O.warn(`GLSL compilation warnings in ${e}\n${n}`)(),new Error(`GLSL compilation errors in ${e}`)}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(p.a.SHADER_TYPE),source:this.getSource()}}}class We extends Ve{constructor(t,e){"string"==typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:p.a.VERTEX_SHADER}))}_createHandle(){return this.gl.createShader(p.a.VERTEX_SHADER)}}class ke extends Ve{constructor(t,e){"string"==typeof e&&(e={source:e}),super(t,Object.assign({},e,{shaderType:p.a.FRAGMENT_SHADER}))}_createHandle(){return this.gl.createShader(p.a.FRAGMENT_SHADER)}}const Ke={[p.a.FLOAT]:(t,e,r)=>t.uniform1fv(e,Qe(r,1)),[p.a.FLOAT_VEC2]:(t,e,r)=>t.uniform2fv(e,Qe(r,2)),[p.a.FLOAT_VEC3]:(t,e,r)=>t.uniform3fv(e,Qe(r,3)),[p.a.FLOAT_VEC4]:(t,e,r)=>t.uniform4fv(e,Qe(r,4)),[p.a.INT]:(t,e,r)=>t.uniform1iv(e,qe(r,1)),[p.a.INT_VEC2]:(t,e,r)=>t.uniform2iv(e,qe(r,2)),[p.a.INT_VEC3]:(t,e,r)=>t.uniform3iv(e,qe(r,3)),[p.a.INT_VEC4]:(t,e,r)=>t.uniform4iv(e,qe(r,4)),[p.a.BOOL]:(t,e,r)=>t.uniform1iv(e,qe(r,1)),[p.a.BOOL_VEC2]:(t,e,r)=>t.uniform2iv(e,qe(r,2)),[p.a.BOOL_VEC3]:(t,e,r)=>t.uniform3iv(e,qe(r,3)),[p.a.BOOL_VEC4]:(t,e,r)=>t.uniform4iv(e,qe(r,4)),[p.a.FLOAT_MAT2]:(t,e,r)=>t.uniformMatrix2fv(e,!1,Qe(r,4)),[p.a.FLOAT_MAT3]:(t,e,r)=>t.uniformMatrix3fv(e,!1,Qe(r,9)),[p.a.FLOAT_MAT4]:(t,e,r)=>t.uniformMatrix4fv(e,!1,Qe(r,16)),[p.a.SAMPLER_2D]:(t,e,r)=>t.uniform1i(e,r),[p.a.SAMPLER_CUBE]:(t,e,r)=>t.uniform1i(e,r),[p.a.UNSIGNED_INT]:(t,e,r)=>t.uniform1uiv(e,Je(r,1)),[p.a.UNSIGNED_INT_VEC2]:(t,e,r)=>t.uniform2uiv(e,Je(r,2)),[p.a.UNSIGNED_INT_VEC3]:(t,e,r)=>t.uniform3uiv(e,Je(r,3)),[p.a.UNSIGNED_INT_VEC4]:(t,e,r)=>t.uniform4uiv(e,Je(r,4)),[p.a.FLOAT_MAT2x3]:(t,e,r)=>t.uniformMatrix2x3fv(e,!1,Qe(r,6)),[p.a.FLOAT_MAT2x4]:(t,e,r)=>t.uniformMatrix2x4fv(e,!1,Qe(r,8)),[p.a.FLOAT_MAT3x2]:(t,e,r)=>t.uniformMatrix3x2fv(e,!1,Qe(r,6)),[p.a.FLOAT_MAT3x4]:(t,e,r)=>t.uniformMatrix3x4fv(e,!1,Qe(r,12)),[p.a.FLOAT_MAT4x2]:(t,e,r)=>t.uniformMatrix4x2fv(e,!1,Qe(r,8)),[p.a.FLOAT_MAT4x3]:(t,e,r)=>t.uniformMatrix4x3fv(e,!1,Qe(r,12)),[p.a.SAMPLER_3D]:(t,e,r)=>t.uniform1i(e,r),[p.a.SAMPLER_2D_SHADOW]:(t,e,r)=>t.uniform1i(e,r),[p.a.SAMPLER_2D_ARRAY]:(t,e,r)=>t.uniform1i(e,r),[p.a.SAMPLER_2D_ARRAY_SHADOW]:(t,e,r)=>t.uniform1i(e,r),[p.a.SAMPLER_CUBE_SHADOW]:(t,e,r)=>t.uniform1i(e,r),[p.a.INT_SAMPLER_2D]:(t,e,r)=>t.uniform1i(e,r),[p.a.INT_SAMPLER_3D]:(t,e,r)=>t.uniform1i(e,r),[p.a.INT_SAMPLER_CUBE]:(t,e,r)=>t.uniform1i(e,r),[p.a.INT_SAMPLER_2D_ARRAY]:(t,e,r)=>t.uniform1i(e,r),[p.a.UNSIGNED_INT_SAMPLER_2D]:(t,e,r)=>t.uniform1i(e,r),[p.a.UNSIGNED_INT_SAMPLER_3D]:(t,e,r)=>t.uniform1i(e,r),[p.a.UNSIGNED_INT_SAMPLER_CUBE]:(t,e,r)=>t.uniform1i(e,r),[p.a.UNSIGNED_INT_SAMPLER_2D_ARRAY]:(t,e,r)=>t.uniform1i(e,r)},Ye={},je={},$e={},ze=[0];function Ze(t,e,r,n){1===e&&"boolean"==typeof t&&(t=t?1:0),Number.isFinite(t)&&(ze[0]=t,t=ze);const a=t.length;if(a%e&&O.warn(`Uniform size should be multiples of ${e}`,t)(),t instanceof r)return t;let i=n[a];i||(i=new r(a),n[a]=i);for(let e=0;e<a;e++)i[e]=t[e];return i}function Qe(t,e){return Ze(t,e,Float32Array,Ye)}function qe(t,e){return Ze(t,e,Int32Array,je)}function Je(t,e){return Ze(t,e,Uint32Array,$e)}function tr(t){if("]"!==t[t.length-1])return{name:t,length:1,isArray:!1};const e=t.match(/([^[]*)(\[[0-9]+\])?/);if(!e||e.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:e[1],length:e[2]||1,isArray:Boolean(e[2])}}function er(t,e,r){const n=Ke[r.type];if(!n)throw new Error(`Unknown GLSL uniform type ${r.type}`);return n.bind(null,t,e)}function rr(t){return Array.isArray(t)||ArrayBuffer.isView(t)?function(t){if(0===t.length)return!1;const e=Math.min(t.length,16);for(let r=0;r<e;++r)if(!Number.isFinite(t[r]))return!1;return!0}(t):!!isFinite(t)||(!0===t||!1===t||(t instanceof Ht||(t instanceof Qt||t instanceof Oe&&Boolean(t.texture))))}function nr(t,e){if(Array.isArray(t)||ArrayBuffer.isView(t)){if(!e)return!1;const r=t.length;if(e.length!==r)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}return t===e}const ar=5120,ir=5121,sr=5122,or=5123,Er=0,ur=1,_r=2,cr=3,lr=4,hr=5,fr=6,Ar=5126,Tr={[Ar]:[Ar,1,"float"],35664:[Ar,2,"vec2"],35665:[Ar,3,"vec3"],35666:[Ar,4,"vec4"],5124:[5124,1,"int"],35667:[5124,2,"ivec2"],35668:[5124,3,"ivec3"],35669:[5124,4,"ivec4"],5125:[5125,1,"uint"],36294:[5125,2,"uvec2"],36295:[5125,3,"uvec3"],36296:[5125,4,"uvec4"],35670:[Ar,1,"bool"],35671:[Ar,2,"bvec2"],35672:[Ar,3,"bvec3"],35673:[Ar,4,"bvec4"],35674:[Ar,8,"mat2"],35685:[Ar,8,"mat2x3"],35686:[Ar,8,"mat2x4"],35675:[Ar,12,"mat3"],35687:[Ar,12,"mat3x2"],35688:[Ar,12,"mat3x4"],35676:[Ar,16,"mat4"],35689:[Ar,16,"mat4x2"],35690:[Ar,16,"mat4x3"]};function dr(t){switch(t){case Er:return Er;case ur:case cr:case _r:return ur;case lr:case hr:case fr:return lr;default:return $(!1),0}}function Rr(t){const e=Tr[t];if(!e)return null;const[r,n]=e;return{type:r,components:n}}function gr(t,e){switch(t){case ar:case ir:case sr:case or:t=Ar}for(const r in Tr){const[n,a,i]=Tr[r];if(n===t&&a===e)return{glType:r,name:i}}return null}class Nr{constructor(t){this.id=t.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(t),this._readVaryingsFromProgram(t)}getAttributeInfo(t){const e=Number(t);return Number.isFinite(e)?this.attributeInfosByLocation[e]:this.attributeInfosByName[t]||null}getAttributeLocation(t){const e=this.getAttributeInfo(t);return e?e.location:-1}getAttributeAccessor(t){const e=this.getAttributeInfo(t);return e?e.accessor:null}getVaryingInfo(t){const e=Number(t);return Number.isFinite(e)?this.varyingInfos[e]:this.varyingInfosByName[t]||null}getVaryingIndex(t){const e=this.getVaryingInfo();return e?e.location:-1}getVaryingAccessor(t){const e=this.getVaryingInfo();return e?e.accessor:null}_readAttributesFromProgram(t){const{gl:e}=t,r=e.getProgramParameter(t.handle,e.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const{name:r,type:a,size:i}=e.getActiveAttrib(t.handle,n),s=e.getAttribLocation(t.handle,r);s>=0&&this._addAttribute(s,r,a,i)}this.attributeInfos.sort((t,e)=>t.location-e.location)}_readVaryingsFromProgram(t){const{gl:e}=t;if(!ct(e))return;const r=e.getProgramParameter(t.handle,e.TRANSFORM_FEEDBACK_VARYINGS);for(let n=0;n<r;n++){const{name:r,type:a,size:i}=e.getTransformFeedbackVarying(t.handle,n);this._addVarying(n,r,a,i)}this.varyingInfos.sort((t,e)=>t.location-e.location)}_addAttribute(t,e,r,n){const{type:a,components:i}=Rr(r),s={type:a,size:n*i};this._inferProperties(t,e,s);const o={location:t,name:e,accessor:new Mt(s)};this.attributeInfos.push(o),this.attributeInfosByLocation[t]=o,this.attributeInfosByName[o.name]=o}_inferProperties(t,e,r){/instance/i.test(e)&&(r.divisor=1)}_addVarying(t,e,r,n){const{type:a,components:i}=Rr(r),s={location:t,name:e,accessor:new Mt({type:a,size:n*i})};this.varyingInfos.push(s),this.varyingInfosByName[s.name]=s}}const mr=4,Fr=35981,Ir=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class Sr extends Ft{constructor(t,e={}){super(t,e),this.stubRemovedMethods("Program","v6.0",Ir),this._isCached=!1,this.initialize(e),Object.seal(this),this._setId(e.id)}initialize(t={}){const{hash:e,vs:r,fs:n,varyings:a,bufferMode:i=Fr}=t;return this.hash=e||"",this.vs="string"==typeof r?new We(this.gl,{id:`${t.id}-vs`,source:r}):r,this.fs="string"==typeof n?new ke(this.gl,{id:`${t.id}-fs`,source:n}):n,$(this.vs instanceof We),$(this.fs instanceof ke),this.uniforms={},a&&a.length>0&&(ht(this.gl),this.varyings=a,this.gl.transformFeedbackVaryings(this.handle,a,i)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new Nr(this),this.setProps(t)}delete(t={}){return this._isCached?this:super.delete(t)}setProps(t){return"uniforms"in t&&this.setUniforms(t.uniforms),this}draw({logPriority:t,drawMode:e=p.a.TRIANGLES,vertexCount:r,offset:n=0,start:a,end:i,isIndexed:s=!1,indexType:o=p.a.UNSIGNED_SHORT,isInstanced:E=!1,instanceCount:u=0,vertexArray:_=null,transformFeedback:c,framebuffer:l,parameters:h={},uniforms:f,samplers:A}){if((f||A)&&(O.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(f||{})),void 0!==t){const n=l?l.id:"default",a=`mode=${At(this.gl,e)} verts=${r} `+`instances=${u} indexType=${At(this.gl,o)} `+`isInstanced=${E} isIndexed=${s} `+`Framebuffer=${n}`;O.log(t,a)()}return $(_),this.gl.useProgram(this.handle),!!this._areTexturesRenderable()&&(_.bindForDraw(r,u,()=>{if(void 0!==l&&(h=Object.assign({},h,{framebuffer:l})),c){const t=dr(e);c.begin(t)}this._bindTextures(),w(this.gl,h,()=>{s&&E?this.gl.drawElementsInstanced(e,r,o,n,u):s&&ct(this.gl)&&!isNaN(a)&&!isNaN(i)?this.gl.drawRangeElements(e,a,i,r,o,n):s?this.gl.drawElements(e,r,o,n):E?this.gl.drawArraysInstanced(e,n,r,u):this.gl.drawArrays(e,n,r)}),c&&c.end()}),!0)}setUniforms(t={},e=(()=>{})){let r=!1;const n={};for(const e in t)nr(this.uniforms[e],t[e])||(r=!0,n[e]=t[e],this.uniforms[e]=(a=t[e],Array.isArray(a)||ArrayBuffer.isView(a)?a.slice():a));var a;return r&&(e(),function(t,e,r){for(const n in t){const a=t[n];if((!r||Boolean(r[n]))&&!rr(a))throw e=e?`${e} `:"",console.error(`${e} Bad uniform ${n}`,a),new Error(`${e} Bad uniform ${n}`)}}(n,this.id,this._uniformSetters),this._setUniforms(n)),this}reset(){}_areTexturesRenderable(){let t=!0;for(const e in this.uniforms){const r=this._uniformSetters[e];if(r&&void 0!==r.textureIndex){let r=this.uniforms[e];if(r instanceof Oe){r=r.texture}if(r instanceof Ht){const e=r;t=t&&e.loaded}}}return t}_bindTextures(){for(const t in this.uniforms){const e=this._uniformSetters[t];if(e&&void 0!==e.textureIndex){let r=this.uniforms[t];if(r instanceof Oe&&(r=r.texture),r instanceof Ht){r.bind(e.textureIndex)}}}}_setUniforms(t){this.gl.useProgram(this.handle);for(const e in t){let r=t[e];const n=this._uniformSetters[e];if(n)if(r instanceof Oe&&(r=r.texture),r instanceof Ht){void 0===n.textureIndex&&(n.textureIndex=this._textureIndexCounter++);const t=r,{textureIndex:e}=n;t.bind(e),n(e)}else n(r)}return this}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(t){const e=this.gl.getAttachedShaders(t),r={};for(const t of e){switch(this.gl.getShaderParameter(this.handle,p.a.SHADER_TYPE)){case p.a.VERTEX_SHADER:r.vs=new We({handle:t});break;case p.a.FRAGMENT_SHADER:r.fs=new ke({handle:t})}}return r}_getParameter(t){return this.gl.getProgramParameter(this.handle,t)}_setId(t){if(!t){const t=this._getName();this.id=dt(t)}}_getName(){let t=this.vs.getName()||this.fs.getName();return t=(t=t.replace(/shader/i,""))?`${t}-program`:"program"}_compileAndLink(){const{gl:t}=this;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),O.time(mr,`linkProgram for ${this._getName()}`)(),t.linkProgram(this.handle),O.timeEnd(mr,`linkProgram for ${this._getName()}`)(),t.debug||O.priority>0){if(t.validateProgram(this.handle),!t.getProgramParameter(this.handle,t.LINK_STATUS))throw new Error(`Error linking: ${t.getProgramInfoLog(this.handle)}`)}}_readUniformLocationsFromLinkedProgram(){const{gl:t}=this;this._uniformSetters={},this._uniformCount=this._getParameter(p.a.ACTIVE_UNIFORMS);for(let e=0;e<this._uniformCount;e++){const r=this.gl.getActiveUniform(this.handle,e),{name:n,isArray:a}=tr(r.name);let i=t.getUniformLocation(this.handle,n);if(this._uniformSetters[n]=er(t,i,r),r.size>1)for(let e=0;e<r.size;e++)i=t.getUniformLocation(this.handle,`${n}[${e}]`),this._uniformSetters[`${n}[${e}]`]=er(t,i,r)}this._textureIndexCounter=0}getActiveUniforms(t,e){return this.gl.getActiveUniforms(this.handle,t,e)}getUniformBlockIndex(t){return this.gl.getUniformBlockIndex(this.handle,t)}getActiveUniformBlockParameter(t,e){return this.gl.getActiveUniformBlockParameter(this.handle,t,e)}uniformBlockBinding(t,e){this.gl.uniformBlockBinding(this.handle,t,e)}}const Or=34918,Lr=34919,br=35007,Cr=36795,Br=35976,Mr=35887,pr=36202;class Ur extends Ft{static isSupported(t,e=[]){const r=ct(t),n=me(t,Te.TIMER_QUERY);let a=r||n;for(const t of e)switch(t){case"queries":a=a&&r;break;case"timers":a=a&&n;break;default:$(!1)}return a}constructor(t,e={}){super(t,e),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(br)}beginOcclusionQuery({conservative:t=!1}={}){return this.begin(t?pr:Mr)}beginTransformFeedbackQuery(){return this.begin(Br)}begin(t){return this._queryPending?this:(this.target=t,this.gl.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.gl.getQueryParameter(this.handle,Lr);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.gl.getParameter(Cr)}getResult(){return this.gl.getQueryParameter(this.handle,Or)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let e=0;return this._pollingPromise=new Promise((r,n)=>{const a=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):e++>t?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}_createHandle(){return Ur.isSupported(this.gl)?this.gl.createQuery():null}_deleteHandle(){this.gl.deleteQuery(this.handle)}}class Pr extends Ft{static isSupported(t){return ct(t)}constructor(t,e={}){ht(t),super(t,e),this.initialize(e),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(t={}){return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,gt(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(t),this}setProps(t){"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"bindOnUse"in t&&(t=t.bindOnUse),"buffers"in t&&this.setBuffers(t.buffers)}setBuffers(t={}){return this.bind(()=>{for(const e in t)this.setBuffer(e,t[e])}),this}setBuffer(t,e){const r=this._getVaryingIndex(t),{buffer:n,byteSize:a,byteOffset:i}=this._getBufferParams(e);return r<0?(this.unused[t]=n,O.warn(()=>`${this.id} unused varying buffer ${t}`)(),this):(this.buffers[r]=e,this.bindOnUse||this._bindBuffer(r,n,i,a),this)}begin(t=p.a.POINTS){return this.gl.bindTransformFeedback(p.a.TRANSFORM_FEEDBACK,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(t),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(p.a.TRANSFORM_FEEDBACK,null),this}_getBufferParams(t){let e,r,n;return t instanceof yt==!1?(n=t.buffer,r=t.byteSize,e=t.byteOffset):n=t,void 0===e&&void 0===r||(e=e||0,r=r||n.byteLength-e),{buffer:n,byteOffset:e,byteSize:r}}_getVaryingInfo(t){return this.configuration&&this.configuration.getVaryingInfo(t)}_getVaryingIndex(t){if(this.configuration)return this.configuration.getVaryingInfo(t).location;const e=Number(t);return Number.isFinite(e)?e:-1}_bindBuffers(){if(this.bindOnUse)for(const t in this.buffers){const{buffer:e,byteSize:r,byteOffset:n}=this._getBufferParams(this.buffers[t]);this._bindBuffer(t,e,n,r)}}_unbindBuffers(){if(this.bindOnUse)for(const t in this.buffers)this._bindBuffer(t,null)}_bindBuffer(t,e,r=0,n){const a=e&&e.handle;return a&&void 0!==n?this.gl.bindBufferRange(p.a.TRANSFORM_FEEDBACK_BUFFER,t,a,r,n):this.gl.bindBufferBase(p.a.TRANSFORM_FEEDBACK_BUFFER,t,a),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(t){this.gl.bindTransformFeedback(p.a.TRANSFORM_FEEDBACK,this.handle)}}let Dr=null;function yr(t,e){var r;return new t((r=t.BYTES_PER_ELEMENT*e,(!Dr||Dr.byteLength<r)&&(Dr=new ArrayBuffer(r)),Dr),0,e)}var Gr=r(18);const vr="OES_vertex_array_object",wr="elements must be GL.ELEMENT_ARRAY_BUFFER";class xr extends Ft{static isSupported(t,e={}){return e.constantAttributeZero?ct(t)||"Chrome"===function(t){if(!t&&!Object(_.a)())return"Node";if(Object(Gr.a)(t))return"Electron";var e="undefined"!=typeof navigator?navigator:{},r=t||e.userAgent||"";if(r.indexOf("Edge")>-1)return"Edge";var n=-1!==r.indexOf("MSIE "),a=-1!==r.indexOf("Trident/");return n||a?"IE":R.b.chrome?"Chrome":R.b.safari?"Safari":R.b.mozInnerScreenX?"Firefox":"Unknown"}():ct(t)||t.getExtension(vr)}static getDefaultArray(t){return t.luma=t.luma||{},t.luma.defaultVertexArray||(t.luma.defaultVertexArray=new xr(t,{handle:null,isDefaultArray:!0})),t.luma.defaultVertexArray}static getMaxAttributes(t){return xr.MAX_ATTRIBUTES=xr.MAX_ATTRIBUTES||t.getParameter(t.MAX_VERTEX_ATTRIBS),xr.MAX_ATTRIBUTES}static setConstant(t,e,r){switch(r.constructor){case Float32Array:xr._setConstantFloatArray(t,e,r);break;case Int32Array:xr._setConstantIntArray(t,e,r);break;case Uint32Array:xr._setConstantUintArray(t,e,r);break;default:$(!1)}}constructor(t,e={}){const r=e.id||e.program&&e.program.id;super(t,Object.assign({},e,{id:r})),this.hasVertexArrays=xr.isSupported(t),this.buffer=null,this.bufferValue=null,this.initialize(e),Object.seal(this)}delete(){super.delete(),this.buffer&&this.buffer.delete()}get MAX_ATTRIBUTES(){return xr.getMaxAttributes(this.gl)}initialize(t={}){return this.setProps(t)}setProps(t){return this}setElementBuffer(t=null,e={}){return $(!t||t.target===p.a.ELEMENT_ARRAY_BUFFER,wr),this.bind(()=>{this.gl.bindBuffer(p.a.ELEMENT_ARRAY_BUFFER,t?t.handle:null)}),this}setBuffer(t,e,r){if(e.target===p.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(e,r);const{size:n,type:a,stride:i,offset:s,normalized:o,integer:E,divisor:u}=r,{gl:_}=this;return t=Number(t),this.bind(()=>{_.bindBuffer(_.ARRAY_BUFFER,e.handle),E?($(ct(_)),_.vertexAttribIPointer(t,n,a,i,s)):_.vertexAttribPointer(t,n,a,o,i,s),_.enableVertexAttribArray(t),_.vertexAttribDivisor(t,u||0)}),this}enable(t,e=!0){return!e&&0===t&&!xr.isSupported(this.gl,{constantAttributeZero:!0})||(t=Number(t),this.bind(()=>e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t))),this}getConstantBuffer(t,e,r){const n=this._normalizeConstantArrayValue(e,r),a=n.byteLength*t,i=n.length*t;let s=!this.buffer;if(this.buffer=this.buffer||new yt(this.gl,a),s=(s=s||this.buffer.reallocate(a))||!this._compareConstantArrayValues(n,this.bufferValue)){const t=yr(e.constructor,i);!function({target:t,source:e,start:r=0,count:n=1}){const a=e.length,i=n*a;let s=0;for(let n=r;s<a;s++)t[n++]=e[s];for(;s<i;)s<i-s?(t.copyWithin(r+s,r,r+s),s*=2):(t.copyWithin(r+s,r,r+i-s),s=i)}({target:t,source:n,start:0,count:i}),this.buffer.subData(t),this.bufferValue=e}return this.buffer}_normalizeConstantArrayValue(t,e){return Array.isArray(t)?new Float32Array(t):t}_compareConstantArrayValues(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}static _setConstantFloatArray(t,e,r){switch(r.length){case 1:t.vertexAttrib1fv(e,r);break;case 2:t.vertexAttrib2fv(e,r);break;case 3:t.vertexAttrib3fv(e,r);break;case 4:t.vertexAttrib4fv(e,r);break;default:$(!1)}}static _setConstantIntArray(t,e,r){switch($(ct(t)),r.length){case 1:t.vertexAttribI1iv(e,r);break;case 2:t.vertexAttribI2iv(e,r);break;case 3:t.vertexAttribI3iv(e,r);break;case 4:t.vertexAttribI4iv(e,r);break;default:$(!1)}}static _setConstantUintArray(t,e,r){switch($(ct(t)),r.length){case 1:t.vertexAttribI1uiv(e,r);break;case 2:t.vertexAttribI2uiv(e,r);break;case 3:t.vertexAttribI3uiv(e,r);break;case 4:t.vertexAttribI4uiv(e,r);break;default:$(!1)}}_createHandle(){return this.hasVertexArrays=xr.isSupported(this.gl),this.hasVertexArrays?this.gl.createVertexArray():null}_deleteHandle(t){return this.hasVertexArrays&&this.gl.deleteVertexArray(t),[this.elements]}_bindHandle(t){this.hasVertexArrays&&this.gl.bindVertexArray(t)}_getParameter(t,{location:e}){return $(Number.isFinite(e)),this.bind(()=>{switch(t){case p.a.VERTEX_ATTRIB_ARRAY_POINTER:return this.gl.getVertexAttribOffset(e,t);default:return this.gl.getVertexAttrib(e,t)}})}}const Hr="VertexArray: attributes must be Buffers or constants (i.e. typed array)",Xr=/^(.+)__LOCATION_([0-9]+)$/,Vr=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class Wr{constructor(t,e={}){const r=e.id||e.program&&e.program.id;this.id=r,this.gl=t,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=xr.isSupported(t)?new xr(t):xr.getDefaultArray(t),Nt(this,"VertexArray","v6.0",Vr),this.initialize(e),Object.seal(this)}delete(){this.buffer&&this.buffer.delete()}initialize(t={}){return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(t)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:t}=this.vertexArrayObject;return this.values=new Array(t).fill(null),this.accessors=new Array(t).fill(null),this.unused={},this.drawParams=null,this}setProps(t){return"program"in t&&(this.configuration=t.program&&t.program.configuration),"configuration"in t&&(this.configuration=t.configuration),"attributes"in t&&this.setAttributes(t.attributes),"elements"in t&&this.setElementBuffer(t.elements),"bindOnUse"in t&&(t=t.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(t){return this.drawParams=this.drawParams||this._updateDrawParams(),Object.assign({},this.drawParams,t)}setAttributes(t){return Object.assign(this.attributes,t),this.vertexArrayObject.bind(()=>{for(const e in t){const r=t[e];this._setAttribute(e,r)}this.gl.bindBuffer(p.a.ARRAY_BUFFER,null)}),this}setElementBuffer(t=null,e={}){return this.elements=t,this.elementsAccessor=e,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setElementBuffer(t,e),this}setBuffer(t,e,r={}){if(e.target===p.a.ELEMENT_ARRAY_BUFFER)return this.setElementBuffer(e,r);const{location:n,accessor:a}=this._resolveLocationAndAccessor(t,e,e.accessor,r);return n>=0&&(this.values[n]=e,this.accessors[n]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setBuffer(n,e,a)),this}setConstant(t,e,r={}){const{location:n,accessor:a}=this._resolveLocationAndAccessor(t,e,Object.assign({size:e.length},r));return n>=0&&(e=this.vertexArrayObject._normalizeConstantArrayValue(e,a),this.values[n]=e,this.accessors[n]=a,this.clearDrawParams(),this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.enable(n,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&(this.vertexArrayObject.isDefaultArray||this.vertexArrayObject.setElementBuffer(null)),this.buffer=this.buffer||new yt(this.gl,{accessor:{size:4}});for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)this.values[t]instanceof yt&&(this.gl.disableVertexAttribArray(t),this.gl.bindBuffer(p.a.ARRAY_BUFFER,this.buffer.handle),this.gl.vertexAttribPointer(t,1,p.a.FLOAT,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let t=0;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++){const e=this.values[t];e instanceof yt&&this.setBuffer(t,e)}}),this}bindForDraw(t,e,r){let n;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(t,e),this.vertexArrayObject.hasVertexArrays||this.bindBuffers(),n=r(),this.vertexArrayObject.hasVertexArrays||this.unbindBuffers()}),n}_resolveLocationAndAccessor(t,e,r,n){const{location:a,name:i}=this._getAttributeIndex(t);if(!Number.isFinite(a)||a<0)return this.unused[t]=e,O.once(3,()=>`unused value ${t} in ${this.id}`)(),this;const s=this._getAttributeInfo(i||a);if(!s)return{location:-1,accessor:null};const o=Mt.resolve(s.accessor,r,n),{size:E,type:u}=o;return $(Number.isFinite(E)&&Number.isFinite(u)),{location:a,accessor:o}}_getAttributeInfo(t){return this.configuration&&this.configuration.getAttributeInfo(t)}_getAttributeIndex(t){const e=Number(t);if(Number.isFinite(e))return{location:e};const r=Xr.exec(t),n=r?r[1]:t,a=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(n)+a,name:n}:{location:-1}}_setAttribute(t,e){if(e instanceof yt)this.setBuffer(t,e);else if(Array.isArray(e)&&e.length&&e[0]instanceof yt){const r=e[0],n=e[1];this.setBuffer(t,r,n)}else if(ArrayBuffer.isView(e)||Array.isArray(e)){const r=e;this.setConstant(t,r)}else{if(!(e.buffer instanceof yt))throw new Error(Hr);{const r=e;this.setBuffer(t,r.buffer,r)}}}_setConstantAttributes(t,e){const r=Math.max(0|t,0|e);let n=this.values[0];ArrayBuffer.isView(n)&&this._setConstantAttributeZero(n,r);for(let t=1;t<this.vertexArrayObject.MAX_ATTRIBUTES;t++)n=this.values[t],ArrayBuffer.isView(n)&&this._setConstantAttribute(t,n)}_setConstantAttributeZero(t,e){if(xr.isSupported(this.gl,{constantAttributeZero:!0}))return void this._setConstantAttribute(0,t);const r=this.vertexArrayObject.getConstantBuffer(e,t);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(t,e){xr.setConstant(this.gl,t,e),this.vertexArrayObject.isDefaultArray&&this.vertexArrayObject.enable(t,!1)}_updateDrawParams(){const t={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this._updateDrawParamsForLocation(t,e);return this.elements&&(t.elementCount=this.elements.getElementCount(this.elements.accessor),t.isIndexed=!0,t.indexType=this.elementsAccessor.type||this.elements.accessor.type,t.indexOffset=this.elementsAccessor.offset||0),t.indexCount===1/0&&(t.indexCount=0),t.vertexCount===1/0&&(t.vertexCount=0),t.instanceCount===1/0&&(t.instanceCount=0),t}_updateDrawParamsForLocation(t,e){const r=this.values[e],n=this.accessors[e];if(!r)return;const{divisor:a}=n,i=a>0;if(t.isInstanced=t.isInstanced||i,r instanceof yt){const e=r;if(i){const r=e.getVertexCount(n);t.instanceCount=Math.min(t.instanceCount,r)}else{const r=e.getVertexCount(n);t.vertexCount=Math.min(t.vertexCount,r)}}}setElements(t=null,e={}){return O.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(t,e)}}const kr="UniformBufferLayout illegal argument",Kr=5126,Yr=5124,jr=5125;class $r{constructor(t){this.layout={},this.size=0;for(const e in t)this._addUniform(e,t[e]);this.size+=(4-this.size%4)%4;const e=new Float32Array(this.size);this.typedArray={[Kr]:e,[Yr]:new Int32Array(e.buffer),[jr]:new Uint32Array(e.buffer)}}getBytes(){return 4*this.size}getData(){return this.typedArray[Kr]}getSubData(t){let e,r;if(void 0===t)e=this.data,r=0;else{const n=this.offsets[t],a=n+this.sizes[t];e=this.data.subarray(n,a),r=4*n}return{data:e,offset:r}}setUniforms(t){for(const e in t)this._setValue(e,t[e]);return this}_setValue(t,e){const r=this.layout[t];$(r,"UniformLayoutStd140 illegal argument");const n=this.typedArray[r.type];1===r.size?n[r.offset]=e:n.set(e,r.offset)}_addUniform(t,e){const r=Rr(e);$(r,kr);const{type:n,components:a}=r;this.size=this._alignTo(this.size,a);const i=this.size;this.size+=a,this.layout[t]={type:n,size:a,offset:i}}_alignTo(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}}function zr(t){let e=100;const r=t.match(/[^\s]+/g);if(r.length>=2&&"#version"===r[0]){const t=parseInt(r[1],10);Number.isFinite(t)&&(e=t)}return e}function Zr(t,e={}){const{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e){const{maxElts:r=16,size:n=1}=e;let a="[";for(let i=0;i<t.length&&i<r;++i)i>0&&(a+=`,${i%n==0?" ":""}`),a+=Zr(t[i],e);return`${a}${t.length>r?"...":"]"}`}(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<1e-16)return r?"0":"0.";if(r)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const n=t.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function Qr({header:t="Uniforms",program:e,uniforms:r,undefinedOnly:n=!1}={}){$(e);const a=e._uniformSetters,i={},s=Object.keys(a).sort();let o=0;for(const e of s)e.match(".*_.*")||e.match(".*Matrix")||qr({table:i,header:t,uniforms:r,uniformName:e,undefinedOnly:n})&&o++;for(const e of s)e.match(".*Matrix")&&qr({table:i,header:t,uniforms:r,uniformName:e,undefinedOnly:n})&&o++;for(const e of s)i[e]||qr({table:i,header:t,uniforms:r,uniformName:e,undefinedOnly:n})&&o++;let E=0;const u={};if(!n)for(const e in r){const n=r[e];i[e]||(E++,u[e]={Type:`NOT USED: ${n}`,[t]:Zr(n)})}return{table:i,count:o,unusedTable:u,unusedCount:E}}function qr({table:t,header:e,uniforms:r,uniformName:n,undefinedOnly:a}){const i=r[n],s=function(t){return null!=t}(i);return(!a||!s)&&(t[n]={[e]:s?Zr(i):"N/A","Uniform Type":s?i:"NOT PROVIDED"},!0)}function Jr({vertexArray:t,header:e="Attributes"}={}){if(!t.configuration)return{};const r={};t.elements&&(r.ELEMENT_ARRAY_BUFFER=tn(t,t.elements,null,e));const n=t.values;for(const a in n){const i=t._getAttributeInfo(a);if(i){let s=`${a}: ${i.name}`;const o=t.accessors[i.location];o&&(s=`${a}: ${en(i.name,o)}`),r[s]=tn(t,n[a],o,e)}}return r}function tn(t,e,r,n){const{gl:a}=t;if(!e)return{[n]:"null","Format ":"N/A"};let i,s,o,E="NOT PROVIDED",u="N/A",_="N/A",c="N/A";if(r&&(E=r.type,u=r.size,i=-1!==(E=String(E).replace("Array","")).indexOf("nt")),e instanceof yt){const t=e,{data:l,modified:h}=t.getDebugData();let f;if(s=h?"*":"",o=l,_=(c=t.byteLength)/l.BYTES_PER_ELEMENT/u,r){f=`${r.divisor>0?"I ":"P "} ${_} (x${u}=${c} bytes ${At(a,E)})`}else i=!0,f=`${c} bytes`;return{[n]:`${s}${Zr(o,{size:u,isInteger:i})}`,"Format ":f}}return{[n]:`${Zr(o=e,{size:u=e.length,isInteger:i=-1!==(E=String(e.constructor.name).replace("Array","")).indexOf("nt")})} (constant)`,"Format ":`${u}x${E} (constant)`}}function en(t,e){const{type:r,size:n}=e,a=gr(r,n);return a?`${t} (${a.name})`:t}function rn(t){const e={},r=`Accessors for ${t.id}`;for(const n of t.attributeInfos)if(n){e[`in ${nn(n)}`]={[r]:JSON.stringify(n.accessor)}}for(const n of t.varyingInfos)if(n){e[`out ${nn(n)}`]={[r]:JSON.stringify(n.accessor)}}return e}function nn(t){const{type:e,size:r}=t.accessor,n=gr(e,r);return n?`${n.name} ${t.name}`:t.name}r.d(e,"lumaStats",function(){return C}),r.d(e,"resetParameters",function(){return B.d}),r.d(e,"getParameter",function(){return B.b}),r.d(e,"getParameters",function(){return B.c}),r.d(e,"setParameter",function(){return B.e}),r.d(e,"setParameters",function(){return D}),r.d(e,"withParameters",function(){return w}),r.d(e,"getModifiedParameters",function(){return B.a}),r.d(e,"Image",function(){return x.a}),r.d(e,"WebGLRenderingContext",function(){return x.h}),r.d(e,"WebGLProgram",function(){return x.f}),r.d(e,"WebGLShader",function(){return x.i}),r.d(e,"WebGLBuffer",function(){return x.d}),r.d(e,"WebGLFramebuffer",function(){return x.e}),r.d(e,"WebGLRenderbuffer",function(){return x.g}),r.d(e,"WebGLTexture",function(){return x.k}),r.d(e,"WebGLUniformLocation",function(){return x.l}),r.d(e,"WebGLActiveInfo",function(){return x.c}),r.d(e,"WebGLShaderPrecisionFormat",function(){return x.j}),r.d(e,"WebGL2RenderingContext",function(){return x.b}),r.d(e,"webGLTypesAvailable",function(){return x.n}),r.d(e,"createGLContext",function(){return rt}),r.d(e,"destroyGLContext",function(){return at}),r.d(e,"resizeGLContext",function(){return it}),r.d(e,"instrumentGLContext",function(){return nt}),r.d(e,"setGLContextDefaults",function(){return et}),r.d(e,"getCanvas",function(){return Y}),r.d(e,"getPageLoadPromise",function(){return K}),r.d(e,"requestAnimationFrame",function(){return st}),r.d(e,"cancelAnimationFrame",function(){return ot}),r.d(e,"isWebGL",function(){return _t}),r.d(e,"isWebGL2",function(){return ct}),r.d(e,"cloneTextureFrom",function(){return be}),r.d(e,"getKeyValue",function(){return ft}),r.d(e,"getKey",function(){return At}),r.d(e,"getContextInfo",function(){return Ue}),r.d(e,"getGLContextInfo",function(){return pe}),r.d(e,"getContextLimits",function(){return Me}),r.d(e,"getContextDebugInfo",function(){return j}),r.d(e,"FEATURES",function(){return Te}),r.d(e,"hasFeature",function(){return Ne}),r.d(e,"hasFeatures",function(){return me}),r.d(e,"getFeatures",function(){return Fe}),r.d(e,"canCompileGLGSExtension",function(){return De}),r.d(e,"Accessor",function(){return Mt}),r.d(e,"Buffer",function(){return yt}),r.d(e,"Shader",function(){return Ve}),r.d(e,"VertexShader",function(){return We}),r.d(e,"FragmentShader",function(){return ke}),r.d(e,"Program",function(){return Sr}),r.d(e,"Framebuffer",function(){return Oe}),r.d(e,"Renderbuffer",function(){return Qt}),r.d(e,"Texture2D",function(){return Kt}),r.d(e,"TextureCube",function(){return jt}),r.d(e,"clear",function(){return se}),r.d(e,"clearBuffer",function(){return oe}),r.d(e,"readPixelsToArray",function(){return ue}),r.d(e,"readPixelsToBuffer",function(){return _e}),r.d(e,"copyToDataUrl",function(){return ce}),r.d(e,"copyToImage",function(){return le}),r.d(e,"copyToTexture",function(){return he}),r.d(e,"blit",function(){return fe}),r.d(e,"Query",function(){return Ur}),r.d(e,"Texture3D",function(){return $t}),r.d(e,"TransformFeedback",function(){return Pr}),r.d(e,"VertexArrayObject",function(){return xr}),r.d(e,"VertexArray",function(){return Wr}),r.d(e,"UniformBufferLayout",function(){return $r}),r.d(e,"setPathPrefix",function(){return Vt}),r.d(e,"loadFile",function(){return Wt}),r.d(e,"loadImage",function(){return kt}),r.d(e,"getShaderName",function(){return ye}),r.d(e,"getShaderVersion",function(){return zr}),r.d(e,"log",function(){return O}),r.d(e,"assert",function(){return $}),r.d(e,"uid",function(){return dt}),r.d(e,"isObjectEmpty",function(){return gt}),r.d(e,"self",function(){return a.c}),r.d(e,"window",function(){return a.d}),r.d(e,"global",function(){return a.b}),r.d(e,"document",function(){return a.a}),r.d(e,"isBrowser",function(){return n.a}),r.d(e,"cssToDeviceRatio",function(){return z}),r.d(e,"cssToDevicePixels",function(){return Z}),r.d(e,"parseUniformName",function(){return tr}),r.d(e,"getUniformSetter",function(){return er}),r.d(e,"getDebugTableForUniforms",function(){return Qr}),r.d(e,"getDebugTableForVertexArray",function(){return Jr}),r.d(e,"getDebugTableForProgramConfiguration",function(){return rn})},function(t,e,r){"use strict";function n(t){for(const e in t)return!1;return!0}function a(t){return Boolean(t&&2===t._version)}r.d(e,"a",function(){return n}),r.d(e,"b",function(){return a})}])});