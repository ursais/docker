{"version":3,"sources":["../../../src/features/features.js"],"names":["WEBGL_FEATURES","isWebGL2","assert","log","LOG_UNSUPPORTED_FEATURE","hasFeature","gl","feature","hasFeatures","features","Array","isArray","every","isFeatureSupported","getFeatures","luma","caps","webgl2","cap","featureDefinition","isSupported","extension","Boolean","getExtension"],"mappings":"AAKA,OAAOA,cAAP,MAA2B,wBAA3B;AACA,SAAQC,QAAR,QAAuB,gBAAvB;AACA,SAAQC,MAAR,EAAgBC,GAAhB,QAA0B,UAA1B;AAEA,IAAMC,uBAAuB,GAAG,CAAhC;AAGA,OAAO,SAASC,UAAT,CAAoBC,EAApB,EAAwBC,OAAxB,EAAiC;AACtC,SAAOC,WAAW,CAACF,EAAD,EAAKC,OAAL,CAAlB;AACD;AAGD,OAAO,SAASC,WAAT,CAAqBF,EAArB,EAAyBG,QAAzB,EAAmC;AACxCA,EAAAA,QAAQ,GAAGC,KAAK,CAACC,OAAN,CAAcF,QAAd,IAA0BA,QAA1B,GAAqC,CAACA,QAAD,CAAhD;AACA,SAAOA,QAAQ,CAACG,KAAT,CAAe,UAAAL,OAAO,EAAI;AAC/B,WAAOM,kBAAkB,CAACP,EAAD,EAAKC,OAAL,CAAzB;AACD,GAFM,CAAP;AAGD;AAGD,OAAO,SAASO,WAAT,CAAqBR,EAArB,EAAyB;AAC9BA,EAAAA,EAAE,CAACS,IAAH,GAAUT,EAAE,CAACS,IAAH,IAAW,EAArB;;AACA,MAAI,CAACT,EAAE,CAACS,IAAH,CAAQC,IAAb,EAAmB;AACjBV,IAAAA,EAAE,CAACS,IAAH,CAAQC,IAAR,GAAe,EAAf;AACAV,IAAAA,EAAE,CAACS,IAAH,CAAQC,IAAR,CAAaC,MAAb,GAAsBhB,QAAQ,CAACK,EAAD,CAA9B;;AACA,SAAK,IAAMY,GAAX,IAAkBlB,cAAlB,EAAkC;AAChCM,MAAAA,EAAE,CAACS,IAAH,CAAQC,IAAR,CAAaE,GAAb,IAAoBL,kBAAkB,CAACP,EAAD,EAAKY,GAAL,CAAtC;AACD;AACF;;AACD,SAAOZ,EAAE,CAACS,IAAH,CAAQC,IAAf;AACD;;AAGD,SAASH,kBAAT,CAA4BP,EAA5B,EAAgCY,GAAhC,EAAqC;AACnC,MAAMX,OAAO,GAAGP,cAAc,CAACkB,GAAD,CAA9B;AACAhB,EAAAA,MAAM,CAACK,OAAD,EAAUW,GAAV,CAAN;AAGA,MAAMC,iBAAiB,GAAGlB,QAAQ,CAACK,EAAD,CAAR,GAAeC,OAAO,CAAC,CAAD,CAAP,IAAcA,OAAO,CAAC,CAAD,CAApC,GAA0CA,OAAO,CAAC,CAAD,CAA3E;AAEA,MAAIa,WAAJ;;AAGA,MAAI,OAAOD,iBAAP,KAA6B,UAAjC,EAA6C;AAC3CC,IAAAA,WAAW,GAAGD,iBAAiB,CAACb,EAAD,CAA/B;AACD,GAFD,MAEO,IAAII,KAAK,CAACC,OAAN,CAAcQ,iBAAd,CAAJ,EAAsC;AAC3CC,IAAAA,WAAW,GAAG,IAAd;AAD2C;AAAA;AAAA;;AAAA;AAE3C,2BAAwBD,iBAAxB,8HAA2C;AAAA,YAAhCE,SAAgC;AACzCD,QAAAA,WAAW,GAAGA,WAAW,IAAIE,OAAO,CAAChB,EAAE,CAACiB,YAAH,CAAgBF,SAAhB,CAAD,CAApC;AACD;AAJ0C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAK5C,GALM,MAKA,IAAI,OAAOF,iBAAP,KAA6B,QAAjC,EAA2C;AAChDC,IAAAA,WAAW,GAAGE,OAAO,CAAChB,EAAE,CAACiB,YAAH,CAAgBJ,iBAAhB,CAAD,CAArB;AACD,GAFM,MAEA,IAAI,OAAOA,iBAAP,KAA6B,SAAjC,EAA4C;AACjDC,IAAAA,WAAW,GAAGD,iBAAd;AACD,GAFM,MAEA;AACLjB,IAAAA,MAAM,CAAC,KAAD,CAAN;AACD;;AAED,MAAI,CAACkB,WAAL,EAAkB;AAChBjB,IAAAA,GAAG,CAACA,GAAJ,CAAQC,uBAAR,qBAA6Cc,GAA7C;AACD;;AAED,SAAOE,WAAP;AACD","sourcesContent":["// Feature detection for WebGL\n//\n// Provides a function that enables simple checking of which WebGL features are\n// available in an WebGL1 or WebGL2 environment.\n\nimport WEBGL_FEATURES from './webgl-features-table';\nimport {isWebGL2} from '../webgl-utils';\nimport {assert, log} from '../utils';\n\nconst LOG_UNSUPPORTED_FEATURE = 2;\n\n// Check one feature\nexport function hasFeature(gl, feature) {\n  return hasFeatures(gl, feature);\n}\n\n// Check one or more features\nexport function hasFeatures(gl, features) {\n  features = Array.isArray(features) ? features : [features];\n  return features.every(feature => {\n    return isFeatureSupported(gl, feature);\n  });\n}\n\n// Return a list of supported features\nexport function getFeatures(gl) {\n  gl.luma = gl.luma || {};\n  if (!gl.luma.caps) {\n    gl.luma.caps = {};\n    gl.luma.caps.webgl2 = isWebGL2(gl);\n    for (const cap in WEBGL_FEATURES) {\n      gl.luma.caps[cap] = isFeatureSupported(gl, cap);\n    }\n  }\n  return gl.luma.caps;\n}\n\n// TODO - cache the value\nfunction isFeatureSupported(gl, cap) {\n  const feature = WEBGL_FEATURES[cap];\n  assert(feature, cap);\n\n  // Get extension name from table\n  const featureDefinition = isWebGL2(gl) ? feature[1] || feature[0] : feature[0];\n\n  let isSupported;\n\n  // Check if the value is dependent on checking one or more extensions\n  if (typeof featureDefinition === 'function') {\n    isSupported = featureDefinition(gl);\n  } else if (Array.isArray(featureDefinition)) {\n    isSupported = true;\n    for (const extension of featureDefinition) {\n      isSupported = isSupported && Boolean(gl.getExtension(extension));\n    }\n  } else if (typeof featureDefinition === 'string') {\n    isSupported = Boolean(gl.getExtension(featureDefinition));\n  } else if (typeof featureDefinition === 'boolean') {\n    isSupported = featureDefinition;\n  } else {\n    assert(false);\n  }\n\n  if (!isSupported) {\n    log.log(LOG_UNSUPPORTED_FEATURE, `Feature: ${cap} not supported`)();\n  }\n\n  return isSupported;\n}\n"],"file":"features.js"}