{"version":3,"sources":["../../src/init.js"],"names":["isBrowser","global","log","Stats","VERSION","STARTUP_MESSAGE","StatsManager","constructor","stats","Map","get","name","has","set","id","lumaStats","luma","Error","version","globals","modules","nodeIO"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,oBAAtB;AACA,SAAQC,MAAR,QAAqB,iBAArB;AACA,OAAOC,GAAP,MAAgB,aAAhB;AACA,SAAQC,KAAR,QAAoB,UAApB;AAIA,OAAO,0BAAP;AAIA,MAAMC,OAAO,GAAG,mBAAuB,WAAvB,aAAmD,qBAAnE;AAEA,MAAMC,eAAe,GAAG,wDAAxB;;AAKA,MAAMC,YAAN,CAAmB;AACjBC,EAAAA,WAAW,GAAG;AACZ,SAAKC,KAAL,GAAa,IAAIC,GAAJ,EAAb;AACD;;AAEDC,EAAAA,GAAG,CAACC,IAAD,EAAO;AACR,QAAI,CAAC,KAAKH,KAAL,CAAWI,GAAX,CAAeD,IAAf,CAAL,EAA2B;AACzB,WAAKH,KAAL,CAAWK,GAAX,CAAeF,IAAf,EAAqB,IAAIR,KAAJ,CAAU;AAACW,QAAAA,EAAE,EAAEH;AAAL,OAAV,CAArB;AACD;;AAED,WAAO,KAAKH,KAAL,CAAWE,GAAX,CAAeC,IAAf,CAAP;AACD;;AAXgB;;AAcnB,MAAMI,SAAS,GAAG,IAAIT,YAAJ,EAAlB;;AAEA,IAAIL,MAAM,CAACe,IAAP,IAAef,MAAM,CAACe,IAAP,CAAYZ,OAAZ,KAAwBA,OAA3C,EAAoD;AAClD,QAAM,IAAIa,KAAJ,iDAAmDhB,MAAM,CAACe,IAAP,CAAYZ,OAA/D,iBAA6EA,OAA7E,EAAN;AACD;;AAED,IAAI,CAACH,MAAM,CAACe,IAAZ,EAAkB;AAChB,MAAIhB,SAAJ,EAAe;AACbE,IAAAA,GAAG,CAACA,GAAJ,CAAQ,CAAR,oBAAsBE,OAAtB,gBAAmCC,eAAnC;AACD;;AAEDJ,EAAAA,MAAM,CAACe,IAAP,GAAcf,MAAM,CAACe,IAAP,IAAe;AAC3BZ,IAAAA,OAD2B;AAE3Bc,IAAAA,OAAO,EAAEd,OAFkB;AAG3BF,IAAAA,GAH2B;AAO3BM,IAAAA,KAAK,EAAEO,SAPoB;AAc3BI,IAAAA,OAAO,EAAE;AACPC,MAAAA,OAAO,EAAE,EADF;AAEPC,MAAAA,MAAM,EAAE;AAFD;AAdkB,GAA7B;AAmBD;;AAED,SAAQpB,MAAR;AACA,SAAQc,SAAR;AACA,eAAed,MAAM,CAACe,IAAtB","sourcesContent":["import isBrowser from './utils/is-browser';\nimport {global} from './utils/globals';\nimport log from './utils/log';\nimport {Stats} from 'probe.gl';\n\n// TODO - when webgl2 gets ubiquitous, remove default support for webgl1 by dropping next line\n// Can be installed by applications\nimport '@luma.gl/webgl2-polyfill';\n\n// Version detection using babel plugin\n/* global __VERSION__ */\nconst VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'untranspiled source';\n\nconst STARTUP_MESSAGE = 'set luma.log.priority=1 (or higher) to trace rendering';\n// Assign luma.log.priority in console to control logging: \\\n// 0: none, 1: minimal, 2: verbose, 3: attribute/uniforms, 4: gl logs\n// luma.log.break[], set to gl funcs, luma.log.profile[] set to model names`;\n\nclass StatsManager {\n  constructor() {\n    this.stats = new Map();\n  }\n\n  get(name) {\n    if (!this.stats.has(name)) {\n      this.stats.set(name, new Stats({id: name}));\n    }\n\n    return this.stats.get(name);\n  }\n}\n\nconst lumaStats = new StatsManager();\n\nif (global.luma && global.luma.VERSION !== VERSION) {\n  throw new Error(`luma.gl - multiple VERSIONs detected: ${global.luma.VERSION} vs ${VERSION}`);\n}\n\nif (!global.luma) {\n  if (isBrowser) {\n    log.log(1, `luma.gl ${VERSION} - ${STARTUP_MESSAGE}`)();\n  }\n\n  global.luma = global.luma || {\n    VERSION,\n    version: VERSION,\n    log,\n\n    // A global stats object that various components can add information to\n    // E.g. see webgl/resource.js\n    stats: lumaStats,\n\n    // Keep some luma globals in a sub-object\n    // This allows us to dynamically detect if certain modules have been\n    // included (such as IO and headless) and enable related functionality,\n    // without unconditionally requiring and thus bundling big dependencies\n    // into the app.\n    globals: {\n      modules: {},\n      nodeIO: {}\n    }\n  };\n}\n\nexport {global};\nexport {lumaStats};\nexport default global.luma;\n"],"file":"init.js"}