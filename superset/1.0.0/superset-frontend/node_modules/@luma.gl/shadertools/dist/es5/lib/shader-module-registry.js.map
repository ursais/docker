{"version":3,"sources":["../../../src/lib/shader-module-registry.js"],"names":["ShaderModuleRegistry","shaderModules","defaultShaderModules","modules","resolveModules","shaderModuleList","ignoreMultipleRegistrations","shaderModule","_registerShaderModule","moduleOrName","ShaderModule","module","map","getShaderModule","name","dependencies","Error"],"mappings":";;;;;;;;;;;;;AAAA;;AACA;;IAEqBA,oB;AACnB,kCAAc;AAAA;AACZ,SAAKC,aAAL,GAAqB,EAArB;AACA,SAAKC,oBAAL,GAA4B,EAA5B;AACD;;;;4CAEuBC,O,EAAS;AAC/B,WAAKD,oBAAL,GAA4B,KAAKE,cAAL,CAAoBD,OAApB,CAA5B;AACD;;;8CAEyB;AACxB,aAAO,KAAKD,oBAAZ;AACD;;;0CAEqBG,gB,EAA8D;AAAA,qFAAJ,EAAI;AAAA,uCAA3CC,2BAA2C;AAAA,UAA3CA,2BAA2C,sCAAb,KAAa;;AAAA;AAAA;AAAA;;AAAA;AAClF,6BAA2BD,gBAA3B,8HAA6C;AAAA,cAAlCE,YAAkC;;AAC3C,eAAKC,qBAAL,CAA2BD,YAA3B,EAAyCD,2BAAzC;AACD;AAHiF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAInF;;;oCAEeG,Y,EAAc;AAE5B,UAAIA,YAAY,YAAYC,wBAA5B,EAA0C;AACxC,eAAOD,YAAP;AACD;;AAGD,UAAI,OAAOA,YAAP,KAAwB,QAA5B,EAAsC;AACpC,eAAO,KAAKD,qBAAL,CAA2BC,YAA3B,EAAyC,IAAzC,CAAP;AACD;;AAGD,UAAME,MAAM,GAAG,KAAKV,aAAL,CAAmBQ,YAAnB,CAAf;;AACA,UAAI,CAACE,MAAL,EAAa;AACX,2BAAO,KAAP,kCAAuCF,YAAvC;AACD;;AACD,aAAOE,MAAP;AACD;;;mCAIcR,O,EAAS;AAAA;;AACtB,aAAOA,OAAO,CAACS,GAAR,CAAY,UAAAH,YAAY;AAAA,eAAI,KAAI,CAACI,eAAL,CAAqBJ,YAArB,CAAJ;AAAA,OAAxB,CAAP;AACD;;;0CAIqBE,M,EAA6C;AAAA,UAArCL,2BAAqC,uEAAP,KAAO;;AAEjE,UAAIK,MAAM,YAAYD,wBAAtB,EAAoC;AAClC,eAAOC,MAAP;AACD;;AAED,yBAAOA,MAAM,CAACG,IAAd,EAAoB,2BAApB;;AAEA,UAAI,CAAC,KAAKb,aAAL,CAAmBU,MAAM,CAACG,IAA1B,CAAD,IAAoCR,2BAAxC,EAAqE;AAEnEK,QAAAA,MAAM,GAAG,IAAID,wBAAJ,CAAiBC,MAAjB,CAAT;AACAA,QAAAA,MAAM,CAACI,YAAP,GAAsB,KAAKX,cAAL,CAAoBO,MAAM,CAACI,YAA3B,CAAtB;AACA,aAAKd,aAAL,CAAmBU,MAAM,CAACG,IAA1B,IAAkCH,MAAlC;AACD,OALD,MAKO;AAEL,cAAM,IAAIK,KAAJ,yBAA2BL,MAAM,CAACG,IAAlC,yBAAN;AACD;;AAED,aAAO,KAAKb,aAAL,CAAmBU,MAAM,CAACG,IAA1B,CAAP;AACD","sourcesContent":["import ShaderModule from './shader-module';\nimport {assert} from '../utils';\n\nexport default class ShaderModuleRegistry {\n  constructor() {\n    this.shaderModules = {};\n    this.defaultShaderModules = [];\n  }\n\n  setDefaultShaderModules(modules) {\n    this.defaultShaderModules = this.resolveModules(modules);\n  }\n\n  getDefaultShaderModules() {\n    return this.defaultShaderModules;\n  }\n\n  registerShaderModules(shaderModuleList, {ignoreMultipleRegistrations = false} = {}) {\n    for (const shaderModule of shaderModuleList) {\n      this._registerShaderModule(shaderModule, ignoreMultipleRegistrations);\n    }\n  }\n\n  getShaderModule(moduleOrName) {\n    // Check if \"inline\" module, return it\n    if (moduleOrName instanceof ShaderModule) {\n      return moduleOrName;\n    }\n\n    // Check if module descriptor\n    if (typeof moduleOrName !== 'string') {\n      return this._registerShaderModule(moduleOrName, true);\n    }\n\n    // Module name - Look up module\n    const module = this.shaderModules[moduleOrName];\n    if (!module) {\n      assert(false, `Unknown shader module ${moduleOrName}`);\n    }\n    return module;\n  }\n\n  // registers any supplied modules, resolves any names into modules\n  // returns a list of modules\n  resolveModules(modules) {\n    return modules.map(moduleOrName => this.getShaderModule(moduleOrName));\n  }\n\n  // PRIVATE API\n\n  _registerShaderModule(module, ignoreMultipleRegistrations = false) {\n    // Check if \"inline\" module, return it\n    if (module instanceof ShaderModule) {\n      return module;\n    }\n\n    assert(module.name, 'shader module has no name');\n\n    if (!this.shaderModules[module.name] || ignoreMultipleRegistrations) {\n      // if ignoreMultipleRegistrations = true, we allow module to be re-registered\n      module = new ShaderModule(module);\n      module.dependencies = this.resolveModules(module.dependencies);\n      this.shaderModules[module.name] = module;\n    } else {\n      // TODO - instead verify that definition is not changing...\n      throw new Error(`shader module ${module.name} already registered`);\n    }\n\n    return this.shaderModules[module.name];\n  }\n}\n"],"file":"shader-module-registry.js"}