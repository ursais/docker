{"version":3,"sources":["../../../src/unified-parameter-api/unified-parameter-api.js"],"names":["GL_PARAMETER_DEFAULTS","GL_PARAMETER_SETTERS","GL_COMPOSITE_PARAMETER_SETTERS","GL_PARAMETER_GETTERS","deepArrayEqual","assert","setParameter","gl","key","value","getter","prevValue","Number","getParameter","setter","setParameters","values","compositeSetters","glConstant","cache","state","mergedValues","Object","assign","compositeSetter","getParameters","parameters","parameterKeys","Array","isArray","keys","getDefaultParameters","resetParameters","getModifiedParameters","modified"],"mappings":"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","sourcesContent":["// Provides a unified API for getting and setting any WebGL parameter\n// Also knows default values of all parameters, enabling fast cache initialization\n// Provides base functionality for the state caching.\nimport {\n  GL_PARAMETER_DEFAULTS,\n  GL_PARAMETER_SETTERS,\n  GL_COMPOSITE_PARAMETER_SETTERS,\n  GL_PARAMETER_GETTERS\n} from './webgl-parameter-tables';\n\nimport deepArrayEqual from '../utils/deep-array-equal';\nimport {assert} from '../utils';\n\n// PUBLIC METHODS\n\n// Sets any single GL parameter regardless of function (gl.getParameter/gl.isEnabled...)\n// Returns the previous value\n// Note: limited to parameter values\nexport function setParameter(gl, key, value) {\n  const getter = GL_PARAMETER_GETTERS[key];\n  const prevValue = getter ? getter(gl, Number(key)) : gl.getParameter(Number(key));\n  const setter = GL_PARAMETER_SETTERS[key];\n  assert(typeof setter === 'function');\n  setter(gl, value, Number(key));\n  return prevValue;\n}\n\n// Sets any GL parameter regardless of function (gl.blendMode, ...)\n// Note: requires a `cache` object to be set on the context (gl.state.cache)\n// This object is used to fill in any missing values for composite setter functions\nexport function setParameters(gl, values) {\n  const compositeSetters = {};\n\n  // HANDLE PRIMITIVE SETTERS (and make note of any composite setters)\n\n  for (const key in values) {\n    const glConstant = Number(key);\n    const setter = GL_PARAMETER_SETTERS[key];\n    if (setter) {\n      // Composite setters should only be called once, so save them\n      if (typeof setter === 'string') {\n        compositeSetters[setter] = true;\n      } else {\n        // if (gl[glConstant] !== undefined) {\n        // TODO - added above check since this is being called on WebGL2 values in WebGL1...\n        // TODO - deep equal on values? only call setter if value has changed?\n        // NOTE - the setter will automatically update this.state\n        setter(gl, values[key], glConstant);\n      }\n    }\n  }\n\n  // HANDLE COMPOSITE SETTERS\n\n  // NOTE: any non-provided values needed by composite setters are filled in from state cache\n  // The cache parameter is automatically retrieved from the context\n  // This depends on `trackContextState`, which is technically a \"circular\" dependency.\n  // But it is too inconvenient to always require a cache parameter here.\n  // This is the ONLY external dependency in this module/\n  const cache = gl.state && gl.state.cache;\n  if (cache) {\n    const mergedValues = Object.assign({}, cache, values);\n\n    for (const key in compositeSetters) {\n      // TODO - avoid calling composite setters if values have not changed.\n      const compositeSetter = GL_COMPOSITE_PARAMETER_SETTERS[key];\n      // Note - if `trackContextState` has been called,\n      // the setter will automatically update this.state.cache\n      compositeSetter(gl, mergedValues);\n    }\n  }\n  // Add a log for the else case?\n}\n\n// Queries any single GL parameter regardless of function (gl.getParameter/gl.isEnabled...)\nexport function getParameter(gl, key) {\n  const getter = GL_PARAMETER_GETTERS[key];\n  return getter ? getter(gl, Number(key)) : gl.getParameter(Number(key));\n}\n\n// Copies the state from a context (gl.getParameter should not be overriden)\n// Reads the entire WebGL state from a context\n// Caveat: This generates a huge amount of synchronous driver roundtrips and should be\n// considered a very slow operation, to be used only if/when a context already manipulated\n// by external code needs to be synchronized for the first time\n// @return {Object} - a newly created map, with values keyed by GL parameters\nexport function getParameters(gl, parameters) {\n  // default to querying all parameters\n  parameters = parameters || GL_PARAMETER_DEFAULTS;\n  // support both arrays of parameters and objects (keys represent parameters)\n  const parameterKeys = Array.isArray(parameters) ? parameters : Object.keys(parameters);\n\n  const state = {};\n  for (const key of parameterKeys) {\n    state[key] = getParameter(gl, key);\n  }\n  return state;\n}\n\nexport function getDefaultParameters(gl) {\n  // TODO - Query GL.VIEWPORT and GL.SCISSOR_BOX since these are dynamic\n  return Object.assign({}, GL_PARAMETER_DEFAULTS, {\n    // TODO: For viewport and scissor default values are set at the time of\n    // context creation based on canvas size, we can query them here but it will\n    // not match with what we have in GL_PARAMETER_DEFAULTS table, we should revisit.\n    // [GL.VIEWPORT]: gl.constructor.prototype.getParameter.call(gl, GL.VIEWPORT),\n    // [GL.SCISSOR_BOX]: gl.constructor.prototype.getParameter.call(gl, GL.SCISSOR_BOX)\n  });\n}\n\n// Reset all parameters to a pure context state\nexport function resetParameters(gl) {\n  setParameters(gl, getDefaultParameters(gl));\n}\n\n// Get all parameters that have been modified from a pure context state\nexport function getModifiedParameters(gl) {\n  const values = getParameters(gl, Object.keys(GL_PARAMETER_DEFAULTS));\n  const modified = {};\n  for (const key in GL_PARAMETER_DEFAULTS) {\n    if (!deepArrayEqual(values[key], GL_PARAMETER_DEFAULTS[key])) {\n      modified[key] = values[key];\n    }\n  }\n  return modified;\n}\n"],"file":"unified-parameter-api.js"}