{"version":3,"sources":["../../src/google-maps-overlay.js"],"names":["createDeckInstance","destroyDeckInstance","getViewState","HIDE_ALL_LAYERS","GoogleMapsOverlay","props","_map","overlay","google","maps","OverlayView","onAdd","_onAdd","bind","onRemove","_onRemove","draw","_draw","_overlay","setProps","map","setMap","Object","assign","_deck","params","pickObject","pickMultipleObjects","pickObjects","layerFilter","deck","width","height","left","top","zoom","pitch","latitude","longitude","canSyncWithGoogleMaps","canvas","style","viewState","redraw"],"mappings":"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","sourcesContent":["/* global google */\nimport {createDeckInstance, destroyDeckInstance, getViewState} from './utils';\n\nconst HIDE_ALL_LAYERS = () => false;\n\nexport default class GoogleMapsOverlay {\n  constructor(props) {\n    this.props = {};\n\n    this._map = null;\n\n    const overlay = new google.maps.OverlayView();\n    overlay.onAdd = this._onAdd.bind(this);\n    overlay.onRemove = this._onRemove.bind(this);\n    overlay.draw = this._draw.bind(this);\n    this._overlay = overlay;\n\n    this.setProps(props);\n  }\n\n  /* Public API */\n\n  setMap(map) {\n    if (map === this._map) {\n      return;\n    }\n    if (this._map) {\n      this._overlay.setMap(null);\n      this._map = null;\n    }\n    if (map) {\n      this._map = map;\n      this._overlay.setMap(map);\n    }\n  }\n\n  setProps(props) {\n    Object.assign(this.props, props);\n    if (this._deck) {\n      this._deck.setProps(this.props);\n    }\n  }\n\n  pickObject(params) {\n    return this._deck && this._deck.pickObject(params);\n  }\n\n  pickMultipleObjects(params) {\n    return this._deck && this._deck.pickMultipleObjects(params);\n  }\n\n  pickObjects(params) {\n    return this._deck && this._deck.pickObjects(params);\n  }\n\n  finalize() {\n    this.setMap(null);\n    if (this._deck) {\n      destroyDeckInstance(this._deck);\n      this._deck = null;\n    }\n  }\n\n  /* Private API */\n  _onAdd() {\n    this._deck = createDeckInstance(this._map, this._overlay, this._deck);\n    this._deck.setProps(this.props);\n  }\n\n  _onRemove() {\n    // Clear deck canvas\n    this._deck.setProps({layerFilter: HIDE_ALL_LAYERS});\n  }\n\n  _draw() {\n    const deck = this._deck;\n    const {width, height, left, top, zoom, pitch, latitude, longitude} = getViewState(\n      this._map,\n      this._overlay\n    );\n\n    const canSyncWithGoogleMaps = zoom >= 0 && pitch === 0;\n\n    deck.canvas.style.left = `${left}px`;\n    deck.canvas.style.top = `${top}px`;\n\n    deck.setProps({\n      width,\n      height,\n      viewState: {latitude, longitude, zoom},\n      // deck.gl cannot sync with the base map with zoom < 0 and/or tilt\n      layerFilter: canSyncWithGoogleMaps ? this.props.layerFilter : HIDE_ALL_LAYERS\n    });\n    // Deck is initialized\n    deck.redraw();\n  }\n}\n"],"file":"google-maps-overlay.js"}