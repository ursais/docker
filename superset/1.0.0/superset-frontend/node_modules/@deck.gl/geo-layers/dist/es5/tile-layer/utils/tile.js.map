{"version":3,"sources":["../../../../src/tile-layer/utils/tile.js"],"names":["tile2latLng","x","y","z","lng","Math","pow","n","PI","lat","atan","exp","tile2boundingBox","west","north","east","south","Tile","getTileData","onTileError","bbox","isVisible","_data","_isLoaded","_loader","_loadData","getTileDataPromise","then","buffers","catch","err","tile","m","floor","Promise","resolve"],"mappings":"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","sourcesContent":["// https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#Lon..2Flat._to_tile_numbers_2\nexport function tile2latLng(x, y, z) {\n  const lng = (x / Math.pow(2, z)) * 360 - 180;\n  const n = Math.PI - (2 * Math.PI * y) / Math.pow(2, z);\n  const lat = (180 / Math.PI) * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n  return [lng, lat];\n}\n\nexport function tile2boundingBox(x, y, z) {\n  const [west, north] = tile2latLng(x, y, z);\n  const [east, south] = tile2latLng(x + 1, y + 1, z);\n  return {west, north, east, south};\n}\n\nexport default class Tile {\n  constructor({getTileData, x, y, z, onTileError}) {\n    this.x = x;\n    this.y = y;\n    this.z = z;\n    this.bbox = tile2boundingBox(this.x, this.y, this.z);\n    this.isVisible = true;\n    this.getTileData = getTileData;\n    this._data = null;\n    this._isLoaded = false;\n    this._loader = this._loadData();\n    this.onTileError = onTileError;\n  }\n\n  get data() {\n    if (this._data) {\n      return Promise.resolve(this._data);\n    }\n    return this._loader;\n  }\n\n  get isLoaded() {\n    return this._isLoaded;\n  }\n\n  _loadData() {\n    const {x, y, z, bbox} = this;\n    if (!this.getTileData) {\n      return null;\n    }\n    const getTileDataPromise = this.getTileData({x, y, z, bbox});\n    return getTileDataPromise\n      .then(buffers => {\n        this._data = buffers;\n        this._isLoaded = true;\n        return buffers;\n      })\n      .catch(err => {\n        this._isLoaded = true;\n        this.onTileError(err);\n      });\n  }\n\n  isOverlapped(tile) {\n    const {x, y, z} = this;\n    const m = Math.pow(2, tile.z - z);\n    return Math.floor(tile.x / m) === x && Math.floor(tile.y / m) === y;\n  }\n}\n"],"file":"tile.js"}