!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("deck"),require("h3"),require("S2"));else if("function"==typeof define&&define.amd)define(["deck","h3","S2"],e);else{var n="object"==typeof exports?e(require("deck"),require("h3"),require("S2")):e(t.deck,t.h3,t.S2);for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(window,function(t,e,n){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=12)}([function(e,n){e.exports=t},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}t.exports=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}},function(t,e,n){var i=n(17),r=n(18),o=n(19);t.exports=function(t,e){return i(t)||r(t,e)||o()}},function(t,n){t.exports=e},function(t,e,n){var i=n(10),r=n(14);t.exports=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?r(t):e}},function(t,e,n){var i=n(16);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}},function(t,e,n){n(1);var i=n(15);function r(e,n,o){return"undefined"!=typeof Reflect&&Reflect.get?t.exports=r=Reflect.get:t.exports=r=function(t,e,n){var r=i(t,e);if(r){var o=Object.getOwnPropertyDescriptor(r,e);return o.get?o.get.call(n):o.value}},r(e,n,o||e)}t.exports=r},function(t,e){t.exports=n},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(e){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?t.exports=i=function(t){return n(t)}:t.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":n(t)},i(e)}t.exports=i},function(t,e,n){var i,r,o;
/**
 * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/long.js for details
 */r=[],void 0===(o="function"==typeof(i=function(){"use strict";function t(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var n={},i={};function r(t,e){var r,o,s;return e?(s=0<=(t>>>=0)&&t<256)&&(o=i[t])?o:(r=a(t,(0|t)<0?-1:0,!0),s&&(i[t]=r),r):(s=-128<=(t|=0)&&t<128)&&(o=n[t])?o:(r=a(t,t<0?-1:0,!1),s&&(n[t]=r),r)}function o(t,e){if(isNaN(t)||!isFinite(t))return e?p:d;if(e){if(t<0)return p;if(t>=h)return b}else{if(t<=-f)return w;if(t+1>=f)return x}return t<0?o(-t,e).neg():a(t%c|0,t/c|0,e)}function a(e,n,i){return new t(e,n,i)}t.fromInt=r,t.fromNumber=o,t.fromBits=a;var s=Math.pow;function u(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return d;if("number"==typeof e?(n=e,e=!1):e=!!e,(n=n||10)<2||36<n)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return u(t.substring(1),e,n).neg();for(var r=o(s(n,8)),a=d,l=0;l<t.length;l+=8){var c=Math.min(8,t.length-l),h=parseInt(t.substring(l,l+c),n);if(c<8){var f=o(s(n,c));a=a.mul(f).add(o(h))}else a=(a=a.mul(r)).add(o(h))}return a.unsigned=e,a}function l(e){return e instanceof t?e:"number"==typeof e?o(e):"string"==typeof e?u(e):a(e.low,e.high,e.unsigned)}t.fromString=u,t.fromValue=l;var c=4294967296,h=c*c,f=h/2,g=r(1<<24),d=r(0);t.ZERO=d;var p=r(0,!0);t.UZERO=p;var v=r(1);t.ONE=v;var y=r(1,!0);t.UONE=y;var m=r(-1);t.NEG_ONE=m;var x=a(-1,2147483647,!1);t.MAX_VALUE=x;var b=a(-1,-1,!0);t.MAX_UNSIGNED_VALUE=b;var w=a(0,-2147483648,!1);t.MIN_VALUE=w;var _=t.prototype;return _.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*c+(this.low>>>0):this.high*c+(this.low>>>0)},_.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(w)){var e=o(t),n=this.div(e),i=n.mul(e).sub(this);return n.toString(t)+i.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var r=o(s(t,6),this.unsigned),a=this,u="";;){var l=a.div(r),c=(a.sub(l.mul(r)).toInt()>>>0).toString(t);if((a=l).isZero())return c+u;for(;c.length<6;)c="0"+c;u=""+c+u}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},_.isZero=function(){return 0===this.high&&0===this.low},_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return 1==(1&this.low)},_.isEven=function(){return 0==(1&this.low)},_.equals=function(t){return e(t)||(t=l(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},_.eq=_.equals,_.notEquals=function(t){return!this.eq(t)},_.neq=_.notEquals,_.lessThan=function(t){return this.comp(t)<0},_.lt=_.lessThan,_.lessThanOrEqual=function(t){return this.comp(t)<=0},_.lte=_.lessThanOrEqual,_.greaterThan=function(t){return this.comp(t)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(t){return this.comp(t)>=0},_.gte=_.greaterThanOrEqual,_.compare=function(t){if(e(t)||(t=l(t)),this.eq(t))return 0;var n=this.isNegative(),i=t.isNegative();return n&&!i?-1:!n&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(v)},_.neg=_.negate,_.add=function(t){e(t)||(t=l(t));var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,o=65535&this.low,s=t.high>>>16,u=65535&t.high,c=t.low>>>16,h=0,f=0,g=0,d=0;return g+=(d+=o+(65535&t.low))>>>16,f+=(g+=r+c)>>>16,h+=(f+=i+u)>>>16,h+=n+s,a((g&=65535)<<16|(d&=65535),(h&=65535)<<16|(f&=65535),this.unsigned)},_.subtract=function(t){return e(t)||(t=l(t)),this.add(t.neg())},_.sub=_.subtract,_.multiply=function(t){if(this.isZero())return d;if(e(t)||(t=l(t)),t.isZero())return d;if(this.eq(w))return t.isOdd()?w:d;if(t.eq(w))return this.isOdd()?w:d;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(g)&&t.lt(g))return o(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,i=65535&this.high,r=this.low>>>16,s=65535&this.low,u=t.high>>>16,c=65535&t.high,h=t.low>>>16,f=65535&t.low,p=0,v=0,y=0,m=0;return y+=(m+=s*f)>>>16,v+=(y+=r*f)>>>16,y&=65535,v+=(y+=s*h)>>>16,p+=(v+=i*f)>>>16,v&=65535,p+=(v+=r*h)>>>16,v&=65535,p+=(v+=s*c)>>>16,p+=n*f+i*h+r*c+s*u,a((y&=65535)<<16|(m&=65535),(p&=65535)<<16|(v&=65535),this.unsigned)},_.mul=_.multiply,_.divide=function(t){if(e(t)||(t=l(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?p:d;var n,i,r;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return p;if(t.gt(this.shru(1)))return y;r=p}else{if(this.eq(w))return t.eq(v)||t.eq(m)?w:t.eq(w)?v:(n=this.shr(1).div(t).shl(1)).eq(d)?t.isNegative()?v:m:(i=this.sub(t.mul(n)),r=n.add(i.div(t)));if(t.eq(w))return this.unsigned?p:d;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=d}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),u=a<=48?1:s(2,a-48),c=o(n),h=c.mul(t);h.isNegative()||h.gt(i);)h=(c=o(n-=u,this.unsigned)).mul(t);c.isZero()&&(c=v),r=r.add(c),i=i.sub(h)}return r},_.div=_.divide,_.modulo=function(t){return e(t)||(t=l(t)),this.sub(this.div(t).mul(t))},_.mod=_.modulo,_.not=function(){return a(~this.low,~this.high,this.unsigned)},_.and=function(t){return e(t)||(t=l(t)),a(this.low&t.low,this.high&t.high,this.unsigned)},_.or=function(t){return e(t)||(t=l(t)),a(this.low|t.low,this.high|t.high,this.unsigned)},_.xor=function(t){return e(t)||(t=l(t)),a(this.low^t.low,this.high^t.high,this.unsigned)},_.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):a(0,this.low<<t-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):a(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0==(t&=63))return this;var n=this.high;return t<32?a(this.low>>>t|n<<32-t,n>>>t,this.unsigned):a(32===t?n:n>>>t-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},_.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},_.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t})?i.apply(e,r):i)||(t.exports=o)},function(t,e,n){(function(e){const i=n(20),r=("undefined"==typeof window?e:window).deck||{};if(!r.LineLayer)throw new Error("@deck.gl/layers is not found");t.exports=Object.assign(r,i)}).call(this,n(13))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,n){var i=n(1);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=i(t)););return t}},function(t,e){function n(e,i){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,i)}t.exports=n},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}},function(t,e,n){"use strict";n.r(e);var i=n(2),r=n.n(i),o=n(3),a=n.n(o),s=n(6),u=n.n(s),l=n(1),c=n.n(l),h=n(8),f=n.n(h),g=n(7),d=n.n(g),p=n(0),v=function(t){function e(){return r()(this,e),u()(this,c()(e).apply(this,arguments))}return d()(e,t),a()(e,[{key:"getShaders",value:function(){return Object.assign({},f()(c()(e.prototype),"getShaders",this).call(this),{vs:"#define SHADER_NAME great-circle-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  if(abs(angularDist - PI) < 0.001) {\n    return (1.0 - t) * source + t * target;\n  }\n\n  float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n  float b = sin(t * angularDist) / sin(angularDist);\n  vec2 sin_source = sin(source);\n  vec2 cos_source = cos(source);\n  vec2 sin_target = sin(target);\n  vec2 cos_target = cos(target);\n\n  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n  float z = a * sin_source.y + b * sin_target.y;\n  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n}\n\nvoid main(void) {\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  \n  vec2 source = radians(instancePositions.xy);\n  vec2 target = radians(instancePositions.zw);\n  \n  float angularDist = getAngularDist(source, target);\n\n  vec3 currPos = vec3(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0);\n  vec3 nextPos = vec3(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0);\n\n  vec2 currPos64Low = mix(instancePositions64Low.xy, instancePositions64Low.zw, segmentRatio);\n  vec2 nextPos64Low = mix(instancePositions64Low.xy, instancePositions64Low.zw, nextSegmentRatio);\n\n  vec4 curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0));\n  vec4 next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.0;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",modules:["picking","project32"]})}}]),e}(p.ArcLayer);v.layerName="GreatCircleLayer";var y=n(4),m=n.n(y),x=n(9),b=n(11),w=n.n(b);var _=180/Math.PI,L=100;function P(t){if("string"==typeof t){if(t.indexOf("/")>0)return t;t=function(t){var e=t.padEnd(16,"0");return w.a.fromString(e,16)}(t)}return x.S2.S2Cell.toHilbertQuadkey(t.toString())}function S(t){var e=P(t);return function(t){for(var e,n,i,r,o,a,s=t.face,u=t.ij,l=t.level,c=[],h=[[0,0],[0,1],[1,1],[1,0],[0,0]],f=Math.max(1,L*Math.pow(2,-l)),g=0;g<4;g++)for(var d=h[g].slice(0),p=h[g+1],v=(p[0]-d[0])/f,y=(p[1]-d[1])/f,b=0;b<f;b++){d[0]+=v,d[1]+=y;var w=x.S2.IJToST(u,l,d),P=x.S2.STToUV(w),S=x.S2.FaceUVToXYZ(s,P);c.push((e=S,n=void 0,i=void 0,r=void 0,o=void 0,a=void 0,n=m()(e,3),i=n[0],r=n[1],o=n[2],a=Math.atan2(o,Math.sqrt(i*i+r*r)),[Math.atan2(r,i)*_,a*_]))}return c}(x.S2.S2Cell.FromHilbertQuadKey(e))}var T=Object.assign({getS2Token:{type:"accessor",value:function(t){return t.token}}},p.PolygonLayer.defaultProps),M=function(t){function e(){return r()(this,e),u()(this,c()(e).apply(this,arguments))}return d()(e,t),a()(e,[{key:"renderLayers",value:function(){var t=this.props,e=t.data,n=t.getS2Token,i=this.props,r=i.elevationScale,o=i.extruded,a=i.wireframe,s=i.filled,u=i.stroked,l=i.lineWidthUnits,c=i.lineWidthScale,h=i.lineWidthMinPixels,f=i.lineWidthMaxPixels,g=i.lineJointRounded,d=i.lineMiterLimit,v=i.lineDashJustified,y=i.fp64,m=i.getElevation,x=i.getFillColor,b=i.getLineColor,w=i.getLineWidth,_=i.getLineDashArray,L=this.props,P=L.updateTriggers,T=L.material;return new(this.getSubLayerClass("cell",p.PolygonLayer))({fp64:y,filled:s,wireframe:a,extruded:o,elevationScale:r,stroked:u,lineWidthUnits:l,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:f,lineJointRounded:g,lineMiterLimit:d,lineDashJustified:v,material:T,getElevation:m,getFillColor:x,getLineColor:b,getLineWidth:w,getLineDashArray:_},this.getSubLayerProps({id:"cell",updateTriggers:{getElevation:P.getElevation,getFillColor:P.getFillColor,getLineColor:P.getLineColor,getLineWidth:P.getLineWidth,getLineDashArray:P.getLineDashArray}}),{data:e,getPolygon:function(t){return S(n(t))}})}}]),e}(p.CompositeLayer);function j(t,e,n){var i=t/Math.pow(2,n)*360-180,r=Math.PI-2*Math.PI*e/Math.pow(2,n);return[i,180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))]}M.layerName="S2Layer",M.defaultProps=T;var C=function(){function t(e){var n=e.getTileData,i=e.x,o=e.y,a=e.z,s=e.onTileError;r()(this,t),this.x=i,this.y=o,this.z=a,this.bbox=function(t,e,n){var i=j(t,e,n),r=m()(i,2),o=r[0],a=r[1],s=j(t+1,e+1,n),u=m()(s,2);return{west:o,north:a,east:u[0],south:u[1]}}(this.x,this.y,this.z),this.isVisible=!0,this.getTileData=n,this._data=null,this._isLoaded=!1,this._loader=this._loadData(),this.onTileError=s}return a()(t,[{key:"_loadData",value:function(){var t=this,e=this.x,n=this.y,i=this.z,r=this.bbox;return this.getTileData?this.getTileData({x:e,y:n,z:i,bbox:r}).then(function(e){return t._data=e,t._isLoaded=!0,e}).catch(function(e){t._isLoaded=!0,t.onTileError(e)}):null}},{key:"isOverlapped",value:function(t){var e=this.x,n=this.y,i=this.z,r=Math.pow(2,t.z-i);return Math.floor(t.x/r)===e&&Math.floor(t.y/r)===n}},{key:"data",get:function(){return this._data?Promise.resolve(this._data):this._loader}},{key:"isLoaded",get:function(){return this._isLoaded}}]),t}();function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var O="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;var k,z;k=new O(4),O!=Float32Array&&(k[0]=0,k[1]=0,k[2]=0,k[3]=0),z=k;!function(){var t,e=(t=new O(2),O!=Float32Array&&(t[0]=0,t[1]=0),t)}();!function(){var t,e=(t=new O(3),O!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t)}();function I(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var D=Math.PI,N=D/4,A=D/180,F=512;function W(t,e){var n=E(t,2),i=n[0],r=n[1];I(Number.isFinite(i)&&Number.isFinite(e)),I(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");var o=r*A;return[(e*=F)*(i*A+D)/(2*D),e*(D-Math.log(Math.tan(N+.5*o)))/(2*D)]}var R=512;function Z(t){return t/R}function q(t,e){var n=t.x,i=t.y,r=t.z,o=Math.pow(2,r-e);return{x:Math.floor(n/o),y:Math.floor(i/o),z:e}}var H=function(){function t(e){var n=e.getTileData,i=e.maxSize,o=e.maxZoom,a=e.minZoom,s=e.onTileError;r()(this,t),this._getTileData=n,this._maxSize=i,this.onTileError=s,this._cache=new Map,o&&parseInt(o,10)===o&&(this._maxZoom=o),a&&parseInt(a,10)===a&&(this._minZoom=a)}return a()(t,[{key:"finalize",value:function(){this._cache.clear()}},{key:"update",value:function(t,e){var n=this._cache,i=this._getTileData,r=this._maxSize,o=this._maxZoom,a=this._minZoom;this._markOldTiles();var s=function(t,e,n){var i=Math.floor(t.zoom);if(n&&i<n)return[];var r=function(t){var e=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])];return[e.reduce(function(t,e){return t<e[0]?t:e[0]},180),e.reduce(function(t,e){return t<e[1]?t:e[1]},90),e.reduce(function(t,e){return t>e[0]?t:e[0]},-180),e.reduce(function(t,e){return t>e[1]?t:e[1]},-90)]}(t=new t.constructor(Object.assign({},t,{zoom:i}))),o=W([r[0],r[3]],t.scale).map(Z),a=m()(o,2),s=a[0],u=a[1],l=W([r[2],r[1]],t.scale).map(Z),c=m()(l,2),h=c[0],f=c[1];s=Math.max(0,Math.floor(s)),h=Math.min(t.scale,Math.ceil(h)),u=Math.max(0,Math.floor(u)),f=Math.min(t.scale,Math.ceil(f));for(var g=[],d=s;d<h;d++)for(var p=u;p<f;p++)e&&i>e?g.push(q({x:d,y:p,z:i},e)):g.push({x:d,y:p,z:i});return g}(t,o,a);if(s&&0!==s.length){var u=new Set;n.forEach(function(t){s.some(function(e){return t.isOverlapped(e)})&&(t.isVisible=!0,u.add(t))});for(var l=0;l<s.length;l++){var c=s[l],h=c.x,f=c.y,g=c.z,d=this._getTile(h,f,g);d||(d=new C({getTileData:i,x:h,y:f,z:g,onTileError:this.onTileError}));var p=this._getTileId(h,f,g);n.set(p,d),u.add(d)}this._resizeCache(r||5*s.length),e(Array.from(u).sort(function(t,e){return t.z-e.z}))}else e(s)}},{key:"_resizeCache",value:function(t){var e=this._cache;if(e.size>t){var n=e[Symbol.iterator](),i=!0,r=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value;if(e.size<=t)break;var l=u[0];u[1].isVisible||e.delete(l)}}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}}}},{key:"_markOldTiles",value:function(){this._cache.forEach(function(t){t.isVisible=!1})}},{key:"_getTile",value:function(t,e,n){var i=this._getTileId(t,e,n);return this._cache.get(i)}},{key:"_getTileId",value:function(t,e,n){return"".concat(n,"-").concat(t,"-").concat(e)}}]),t}(),U={renderSubLayers:{type:"function",value:function(t){return new p.GeoJsonLayer(t)}},getTileData:{type:"function",value:function(t){t.x,t.y,t.z;return Promise.resolve(null)}},onViewportLoaded:{type:"function",value:function(){}},onTileError:{type:"function",value:function(t){return console.error(t)}},maxZoom:null,minZoom:0,maxCacheSize:null},B=function(t){function e(){return r()(this,e),u()(this,c()(e).apply(this,arguments))}return d()(e,t),a()(e,[{key:"initializeState",value:function(){var t=this.props,e=t.maxZoom,n=t.minZoom,i=t.getTileData,r=t.onTileError;this.state={tiles:[],tileCache:new H({getTileData:i,maxZoom:e,minZoom:n,onTileError:r}),isLoaded:!1}}},{key:"shouldUpdateState",value:function(t){return t.changeFlags.somethingChanged}},{key:"updateState",value:function(t){var e=this,n=t.props,i=(t.oldProps,t.context),r=t.changeFlags,o=n.onViewportLoaded,a=n.onTileError;if(r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getTileData)){var s=n.getTileData,u=n.maxZoom,l=n.minZoom,c=n.maxCacheSize;this.state.tileCache.finalize(),this.setState({tileCache:new H({getTileData:s,maxSize:c,maxZoom:u,minZoom:l,onTileError:a})})}if(r.viewportChanged){var h=i.viewport,f=this.getLayerZoomLevel();"DEFAULT-INITIAL-VIEWPORT"!==h.id&&this.state.tileCache.update(h,function(t){var n=t.filter(function(t){return t.z===f}),i=n.every(function(t){return t.isLoaded});e.setState({tiles:t,isLoaded:i}),i?o(n.filter(function(t){return t._data}).map(function(t){return t._data})):Promise.all(n.map(function(t){return t.data})).then(function(){e.setState({isLoaded:!0}),o(n.filter(function(t){return t._data}).map(function(t){return t._data}))})})}}},{key:"getPickingInfo",value:function(t){var e=t.info,n=t.sourceLayer;return e.sourceLayer=n,e.tile=n.props.tile,e}},{key:"getLayerZoomLevel",value:function(){var t=Math.floor(this.context.viewport.zoom),e=this.props,n=e.maxZoom,i=e.minZoom;return n&&parseInt(n,10)===n&&t>n?n:i&&parseInt(i,10)===i&&t<i?i:t}},{key:"renderLayers",value:function(){var t=this,e=this.props,n=e.renderSubLayers,i=e.visible,r=this.getLayerZoomLevel();return this.state.tiles.map(function(e){return n(Object.assign({},t.props,{id:"".concat(t.id,"-").concat(e.x,"-").concat(e.y,"-").concat(e.z),data:e.data,visible:i&&(!t.state.isLoaded||e.z===r),tile:e}))})}}]),e}(p.CompositeLayer);B.layerName="TileLayer",B.defaultProps=U;var V=function(t){function e(){return r()(this,e),u()(this,c()(e).apply(this,arguments))}return d()(e,t),a()(e,[{key:"getShaders",value:function(){var t=f()(c()(e.prototype),"getShaders",this).call(this);return t.inject={"vs:#decl":"uniform float trailLength;\nuniform bool isPath3D;\nattribute vec2 instanceTimestamps;\nvarying float vTime;\n","vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);":"vec2 timestamps = instanceTimestamps;\nif (!isPath3D) {\n  prevPosition.z = 0.0;\n  currPosition.z = 0.0;\n  nextPosition.z = 0.0;\n  timestamps.x = instanceStartPositions.z;\n  timestamps.y = instanceEndPositions.z;\n}\n","vs:#main-end":"float shiftZ = sin(timestamps.x) * 1e-4;\ngl_Position.z += shiftZ;\nvTime = timestamps.x + (timestamps.y - timestamps.x) * vPathPosition.y / vPathLength;\n","fs:#decl":"uniform float trailLength;\nuniform float currentTime;\nvarying float vTime;\n","fs:#main-start":"if(vTime > currentTime || vTime < currentTime - trailLength) {\n  discard;\n}\n","gl_FragColor = vColor;":"gl_FragColor.a *= 1.0 - (currentTime - vTime) / trailLength;"},t}},{key:"initializeState",value:function(t){f()(c()(e.prototype),"initializeState",this).call(this,t),this.getAttributeManager().addInstanced({instanceTimestamps:{size:2,update:this.calculateInstanceTimestamps}})}},{key:"draw",value:function(t){var n=this.props,i=n.trailLength,r=n.currentTime,o=n.getTimestamps;t.uniforms=Object.assign({},t.uniforms,{trailLength:i,currentTime:r,isPath3D:Boolean(o)}),f()(c()(e.prototype),"draw",this).call(this,t)}},{key:"calculateInstanceTimestamps",value:function(t,e){var n=e.startRow,i=e.endRow,r=this.props,o=r.data,a=r.getTimestamps;if(!a)return t.constant=!0,void(t.value=new Float32Array(2));for(var s=this.state.pathTesselator,u=s.bufferLayout,l=s.instanceCount,c=new Float32Array(2*l),h=Object(p.createIterable)(o,n,i),f=h.iterable,g=h.objectInfo,d=0,v=0;v<n;v++)d+=2*u[v];var y=!0,m=!1,x=void 0;try{for(var b,w=f[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var _=b.value;g.index++;for(var L=u[g.index],P=a(_,g),S=0;S<L;S++)c[d++]=P[S],c[d++]=P[S+1]}}catch(t){m=!0,x=t}finally{try{y||null==w.return||w.return()}finally{if(m)throw x}}t.constant=!1,t.value=c}}]),e}(p.PathLayer);V.layerName="TripsLayer",V.defaultProps={trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:null}};var G=n(5),J=Object.assign({getHexagons:{type:"accessor",value:function(t){return t.hexagons}}},p.PolygonLayer.defaultProps),K=function(t){function e(){return r()(this,e),u()(this,c()(e).apply(this,arguments))}return d()(e,t),a()(e,[{key:"updateState",value:function(t){var e=t.props,n=(t.oldProps,t.changeFlags);if(n.dataChanged||n.updateTriggers&&n.updateTriggers.getHexagons){var i=e.data,r=e.getHexagons,o=[],a=Object(p.createIterable)(i),s=a.iterable,u=a.objectInfo,l=!0,c=!1,h=void 0;try{for(var f,g=s[Symbol.iterator]();!(l=(f=g.next()).done);l=!0){var d=f.value;u.index++;var v=r(d,u),y=Object(G.h3SetToMultiPolygon)(v,!0),m=!0,x=!1,b=void 0;try{for(var w,_=y[Symbol.iterator]();!(m=(w=_.next()).done);m=!0){var L=w.value;o.push({polygon:L,_obj:d,_idx:u.index})}}catch(t){x=!0,b=t}finally{try{m||null==_.return||_.return()}finally{if(x)throw b}}}}catch(t){c=!0,h=t}finally{try{l||null==g.return||g.return()}finally{if(c)throw h}}this.setState({polygons:o})}}},{key:"getPickingInfo",value:function(t){var e=t.info;return Object.assign(e,{object:e.object&&e.object._obj,index:e.object&&e.object._idx})}},{key:"getSubLayerAccessor",value:function(t){return"function"!=typeof t?t:function(e,n){return t(e._obj,n)}}},{key:"renderLayers",value:function(){var t=this.props,e=t.elevationScale,n=t.extruded,i=t.wireframe,r=t.filled,o=t.stroked,a=t.lineWidthScale,s=t.lineWidthMinPixels,u=t.lineWidthMaxPixels,l=t.lineJointRounded,c=t.lineMiterLimit,h=t.lineDashJustified,f=t.fp64,g=t.material,d=t.getFillColor,v=t.getLineColor,y=t.getLineWidth,m=t.getLineDashArray,x=t.getElevation,b=t.updateTriggers;return new(this.getSubLayerClass("cluster-region",p.PolygonLayer))({fp64:f,filled:r,wireframe:i,extruded:n,elevationScale:e,stroked:o,lineWidthScale:a,lineWidthMinPixels:s,lineWidthMaxPixels:u,lineJointRounded:l,lineMiterLimit:c,lineDashJustified:h,material:g,getFillColor:this.getSubLayerAccessor(d),getLineColor:this.getSubLayerAccessor(v),getLineWidth:this.getSubLayerAccessor(y),getLineDashArray:this.getSubLayerAccessor(m),getElevation:this.getSubLayerAccessor(x)},this.getSubLayerProps({id:"cluster-region",updateTriggers:b}),{data:this.state.polygons,getPolygon:function(t){return t.polygon}})}}]),e}(p.CompositeLayer);K.defaultProps=J,K.layerName="H3ClusterLayer";var X=n(10),Q=n.n(X),Y={};function $(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&void 0!==t.length}function tt(t,e,n){return $(t)?t.map(function(t,i){return tt(t,e[i],n)}):n*e+(1-n)*t}Y.EPSILON=1e-12,Y.debug=!0,Y.precision=4,Y.printTypes=!1,Y.printDegrees=!1,Y.printRowMajor=!0;function et(t,e){e=void 0===e?t[0][0]:e;var n=!0,i=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=s[0]-e;u>180?s[0]-=360:u<-180&&(s[0]+=360)}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}function nt(t,e,n){var i=t(e,n),r=Object(G.h3ToGeo)(i),o=m()(r,2),a=o[0];return[o[1],a]}function it(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=Object(G.h3ToGeoBoundary)(t,!0);return 1!==e?function(t,e,n){var i=Object(G.h3ToGeo)(t),r=m()(i,2),o=r[0],a=r[1],s=e.length;et(e,a);for(var u=e[0]===e[s-1]?s-1:s,l=0;l<u;l++)e[l][0]=tt(a,e[l][0],n),e[l][1]=tt(o,e[l][1],n)}(t,n,e):et(n),n}var rt=Object.assign({},p.PolygonLayer.defaultProps,{highPrecision:!1,coverage:{type:"number",min:0,max:1,value:1},getHexagon:{type:"accessor",value:function(t){return t.hexagon}},extruded:!0,getColor:null}),ot=function(t){function e(){return r()(this,e),u()(this,c()(e).apply(this,arguments))}return d()(e,t),a()(e,[{key:"shouldUpdateState",value:function(t){var e=t.changeFlags;return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}},{key:"updateState",value:function(t){var e=t.props,n=(t.oldProps,t.changeFlags);if(n.dataChanged||n.updateTriggers&&n.updateTriggers.getHexagon){var i=-1,r=!1,o=Object(p.createIterable)(e.data),a=o.iterable,s=o.objectInfo,u=!0,l=!1,c=void 0;try{for(var h,f=a[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var g=h.value;s.index++;var d=e.getHexagon(g,s);if(i=i<0?Object(G.h3GetResolution)(d):i,Object(G.h3IsPentagon)(d)){r=!0;break}}}catch(t){l=!0,c=t}finally{try{u||null==f.return||f.return()}finally{if(l)throw c}}this.setState({resolution:i,edgeLengthKM:i>=0?Object(G.edgeLength)(i,G.UNITS.km):0,hasPentagon:r})}this._updateVertices(this.context.viewport)}},{key:"_shouldUseHighPrecision",value:function(){var t=this.state,e=t.resolution,n=t.hasPentagon;return this.props.highPrecision||n||e>=0&&e<=5}},{key:"_updateVertices",value:function(t){if(!this._shouldUseHighPrecision()){var e=this.state,n=e.resolution,i=e.edgeLengthKM,r=e.centerHex;if(!(n<0)){var o=Object(G.geoToH3)(t.latitude,t.longitude,n);if(!(r===o||r&&Object(G.h3Distance)(r,o)*i<10)){var a=t.distanceScales.pixelsPerMeter,s=it(o),u=Object(G.h3ToGeo)(o),l=m()(u,2),c=l[0],h=l[1],f=t.projectFlat([h,c]),g=m()(f,2),d=g[0],p=g[1];s=s.map(function(e){var n=t.projectFlat(e);return n[0]=(n[0]-d)/a[0],n[1]=(n[1]-p)/a[1],n}),this.setState({centerHex:o,vertices:s})}}}}},{key:"renderLayers",value:function(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}},{key:"_getForwardProps",value:function(){var t=this.props,e=t.elevationScale,n=t.fp64,i=t.material,r=t.coverage,o=t.extruded,a=t.wireframe,s=t.stroked,u=t.filled,l=t.lineWidthUnits,c=t.lineWidthScale,h=t.lineWidthMinPixels,f=t.lineWidthMaxPixels,g=t.getColor,d=t.getFillColor,p=t.getElevation,v=t.getLineColor,y=t.getLineWidth,m=t.updateTriggers;return{elevationScale:e,fp64:n,extruded:o,coverage:r,wireframe:a,stroked:s,filled:u,lineWidthUnits:l,lineWidthScale:c,lineWidthMinPixels:h,lineWidthMaxPixels:f,material:i,getElevation:p,getFillColor:g||d,getLineColor:v,getLineWidth:y,updateTriggers:{getFillColor:m.getColor||m.getFillColor,getElevation:m.getElevation,getLineColor:m.getLineColor,getLineWidth:m.getLineWidth}}}},{key:"_renderPolygonLayer",value:function(){var t=this.props,e=t.data,n=t.getHexagon,i=t.updateTriggers,r=t.coverage,o=this.getSubLayerClass("hexagon-cell-hifi",p.PolygonLayer),a=this._getForwardProps();return a.updateTriggers.getPolygon=function(t,e){return null==t?e:"object"===Q()(t)?Object.assign({},t,{coverage:e}):{getHexagon:t,coverage:e}}(i.getHexagon,r),new o(a,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:a.updateTriggers}),{data:e,getPolygon:function(t,e){return it(n(t,e),r)}})}},{key:"_renderColumnLayer",value:function(){var t=this.props,e=t.data,n=t.getHexagon,i=t.updateTriggers,r=this.getSubLayerClass("hexagon-cell",p.ColumnLayer),o=this._getForwardProps();return o.updateTriggers.getPosition=i.getHexagon,new r(o,this.getSubLayerProps({id:"hexagon-cell",updateTriggers:o.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:nt.bind(null,n)})}}]),e}(p.CompositeLayer);ot.defaultProps=rt,ot.layerName="H3HexagonLayer",n.d(e,"GreatCircleLayer",function(){return v}),n.d(e,"S2Layer",function(){return M}),n.d(e,"TileLayer",function(){return B}),n.d(e,"TripsLayer",function(){return V}),n.d(e,"H3ClusterLayer",function(){return K}),n.d(e,"H3HexagonLayer",function(){return ot})}])});