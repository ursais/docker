{"version":3,"sources":["../../../src/column-layer/column-geometry.js"],"names":["log","Geometry","uid","ColumnGeometry","constructor","props","id","tesselateColumn","indices","attributes","radius","height","nradial","vertices","assert","length","vertsAroundEdge","numVertices","stepAngle","Math","PI","Uint16Array","positions","Float32Array","normals","i","j","a","vertex","nextVertex","sin","cos","k","v","floor","sign","index","POSITION","size","value","NORMAL"],"mappings":"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","sourcesContent":["import {log} from '@deck.gl/core';\nimport {Geometry, uid} from '@luma.gl/core';\n\nexport default class ColumnGeometry extends Geometry {\n  constructor(props = {}) {\n    const {id = uid('column-geometry')} = props;\n    const {indices, attributes} = tesselateColumn(props);\n    super({\n      ...props,\n      id,\n      indices,\n      attributes\n    });\n  }\n}\n\n/* eslint-disable max-statements, complexity */\nfunction tesselateColumn(props) {\n  const {radius, height = 1, nradial = 10, vertices} = props;\n  log.assert(!vertices || vertices.length >= nradial);\n\n  const vertsAroundEdge = nradial + 1; // loop\n  const numVertices = vertsAroundEdge * 3; // top, side top edge, side bottom edge\n\n  const stepAngle = (Math.PI * 2) / nradial;\n\n  // Used for wireframe\n  const indices = new Uint16Array(nradial * 3 * 2); // top loop, side vertical, bottom loop\n\n  const positions = new Float32Array(numVertices * 3);\n  const normals = new Float32Array(numVertices * 3);\n\n  let i = 0;\n\n  // side tesselation: 0, 1, 2, 3, 4, 5, ...\n  //\n  // 0 - 2 - 4  ... top\n  // | / | / |\n  // 1 - 3 - 5  ... bottom\n  //\n  for (let j = 0; j < vertsAroundEdge; j++) {\n    const a = j * stepAngle;\n    const vertex = vertices && vertices[j % nradial];\n    const nextVertex = vertices && vertices[(j + 1) % nradial];\n    const sin = Math.sin(a);\n    const cos = Math.cos(a);\n\n    for (let k = 0; k < 2; k++) {\n      positions[i + 0] = vertex ? vertex[0] : cos * radius;\n      positions[i + 1] = vertex ? vertex[1] : sin * radius;\n      positions[i + 2] = (1 / 2 - k) * height;\n\n      normals[i + 0] = vertex ? nextVertex[0] - vertex[0] : cos;\n      normals[i + 1] = vertex ? nextVertex[1] - vertex[1] : sin;\n\n      i += 3;\n    }\n  }\n\n  // top tesselation: 0, -1, 1, -2, 2, -3, 3, ...\n  //\n  //    0 -- 1\n  //   /      \\\n  // -1        2\n  //  |        |\n  // -2        3\n  //   \\      /\n  //   -3 -- 4\n  //\n  for (let j = 0; j < vertsAroundEdge; j++) {\n    const v = Math.floor(j / 2) * Math.sign((j % 2) - 0.5);\n    const a = v * stepAngle;\n    const vertex = vertices && vertices[(v + nradial) % nradial];\n    const sin = Math.sin(a);\n    const cos = Math.cos(a);\n\n    positions[i + 0] = vertex ? vertex[0] : cos * radius;\n    positions[i + 1] = vertex ? vertex[1] : sin * radius;\n    positions[i + 2] = height / 2;\n\n    normals[i + 2] = 1;\n\n    i += 3;\n  }\n\n  let index = 0;\n  for (let j = 0; j < nradial; j++) {\n    // top loop\n    indices[index++] = j * 2 + 0;\n    indices[index++] = j * 2 + 2;\n    // side vertical\n    indices[index++] = j * 2 + 0;\n    indices[index++] = j * 2 + 1;\n    // bottom loop\n    indices[index++] = j * 2 + 1;\n    indices[index++] = j * 2 + 3;\n  }\n\n  return {\n    indices,\n    attributes: {\n      POSITION: {size: 3, value: positions},\n      NORMAL: {size: 3, value: normals}\n    }\n  };\n}\n"],"file":"column-geometry.js"}