!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("luma"),require("deck"));else if("function"==typeof define&&define.amd)define(["luma","deck"],t);else{var n="object"==typeof exports?t(require("luma"),require("deck")):t(e.luma,e.deck);for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(window,function(e,t){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.exports=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}},function(e,t,n){var i=n(18),o=n(19);e.exports=function(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?o(e):t}},function(e,t,n){var i=n(21);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}},function(e,t,n){n(2);var i=n(20);function o(t,n,r){return"undefined"!=typeof Reflect&&Reflect.get?e.exports=o=Reflect.get:e.exports=o=function(e,t,n){var o=i(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}},o(t,n,r||t)}e.exports=o},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){e.exports=n(22)},function(e,t){},function(e,t){},function(e,t,n){var i=n(8);e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){i(e,t,n[t])})}return e}},function(e,t,n){"use strict";function i(e,t,n){n=n||2;var i,s,l,c,u,d,g,v=t&&t.length,y=v?t[0]*n:e.length,x=o(e,0,y,n,!0),m=[];if(!x)return m;if(v&&(x=function(e,t,n,i){var a,s,l,c,u,d=[];for(a=0,s=t.length;a<s;a++)l=t[a]*i,c=a<s-1?t[a+1]*i:e.length,(u=o(e,l,c,i,!1))===u.next&&(u.steiner=!0),d.push(h(u));for(d.sort(f),a=0;a<d.length;a++)p(d[a],n),n=r(n,n.next);return n}(e,t,x,n)),e.length>80*n){i=l=e[0],s=c=e[1];for(var P=n;P<y;P+=n)(u=e[P])<i&&(i=u),(d=e[P+1])<s&&(s=d),u>l&&(l=u),d>c&&(c=d);g=0!==(g=Math.max(l-i,c-s))?1/g:0}return a(x,m,n,i,s,g),m}function o(e,t,n,i,o){var r,a;if(o===C(e,t,n,i)>0)for(r=t;r<n;r+=i)a=b(r,e[r],e[r+1],a);else for(r=n-i;r>=t;r-=i)a=b(r,e[r],e[r+1],a);return a&&x(a,a.next)&&(w(a),a=a.next),a}function r(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!x(i,i.next)&&0!==y(i.prev,i,i.next))i=i.next;else{if(w(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function a(e,t,n,i,o,f,p){if(e){!p&&f&&function(e,t,n,i){var o=e;do{null===o.z&&(o.z=d(o.x,o.y,t,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,n,i,o,r,a,s,l,c=1;do{for(n=e,e=null,r=null,a=0;n;){for(a++,i=n,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(o=n,n=n.nextZ,s--):(o=i,i=i.nextZ,l--),r?r.nextZ=o:e=o,o.prevZ=r,r=o;n=i}r.nextZ=null,c*=2}while(a>1)}(o)}(e,i,o,f);for(var h,g,v=e;e.prev!==e.next;)if(h=e.prev,g=e.next,f?l(e,i,o,f):s(e))t.push(h.i/n),t.push(e.i/n),t.push(g.i/n),w(e),e=g.next,v=g.next;else if((e=g)===v){p?1===p?a(e=c(e,t,n),t,n,i,o,f,2):2===p&&u(e,t,n,i,o,f):a(r(e),t,n,i,o,f,1);break}}}function s(e){var t=e.prev,n=e,i=e.next;if(y(t,n,i)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(g(t.x,t.y,n.x,n.y,i.x,i.y,o.x,o.y)&&y(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function l(e,t,n,i){var o=e.prev,r=e,a=e.next;if(y(o,r,a)>=0)return!1;for(var s=o.x<r.x?o.x<a.x?o.x:a.x:r.x<a.x?r.x:a.x,l=o.y<r.y?o.y<a.y?o.y:a.y:r.y<a.y?r.y:a.y,c=o.x>r.x?o.x>a.x?o.x:a.x:r.x>a.x?r.x:a.x,u=o.y>r.y?o.y>a.y?o.y:a.y:r.y>a.y?r.y:a.y,f=d(s,l,t,n,i),p=d(c,u,t,n,i),h=e.prevZ,v=e.nextZ;h&&h.z>=f&&v&&v.z<=p;){if(h!==e.prev&&h!==e.next&&g(o.x,o.y,r.x,r.y,a.x,a.y,h.x,h.y)&&y(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,v!==e.prev&&v!==e.next&&g(o.x,o.y,r.x,r.y,a.x,a.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;h&&h.z>=f;){if(h!==e.prev&&h!==e.next&&g(o.x,o.y,r.x,r.y,a.x,a.y,h.x,h.y)&&y(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;v&&v.z<=p;){if(v!==e.prev&&v!==e.next&&g(o.x,o.y,r.x,r.y,a.x,a.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function c(e,t,n){var i=e;do{var o=i.prev,r=i.next.next;!x(o,r)&&m(o,i,i.next,r)&&P(o,r)&&P(r,o)&&(t.push(o.i/n),t.push(i.i/n),t.push(r.i/n),w(i),w(i.next),i=e=r),i=i.next}while(i!==e);return i}function u(e,t,n,i,o,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&v(l,c)){var u=_(l,c);return l=r(l,l.next),u=r(u,u.next),a(l,t,n,i,o,s),void a(u,t,n,i,o,s)}c=c.next}l=l.next}while(l!==e)}function f(e,t){return e.x-t.x}function p(e,t){if(t=function(e,t){var n,i=t,o=e.x,r=e.y,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var s=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=o&&s>a){if(a=s,s===o){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(o===a)return n.prev;var l,c=n,u=n.x,f=n.y,p=1/0;i=n.next;for(;i!==c;)o>=i.x&&i.x>=u&&o!==i.x&&g(r<f?o:a,r,u,f,r<f?a:o,r,i.x,i.y)&&((l=Math.abs(r-i.y)/(o-i.x))<p||l===p&&i.x>n.x)&&P(i,e)&&(n=i,p=l),i=i.next;return n}(e,t)){var n=_(t,e);r(n,n.next)}}function d(e,t,n,i,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function h(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}function g(e,t,n,i,o,r,a,s){return(o-a)*(t-s)-(e-a)*(r-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(r-s)-(o-a)*(i-s)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&m(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&P(e,t)&&P(t,e)&&function(e,t){var n=e,i=!1,o=(e.x+t.x)/2,r=(e.y+t.y)/2;do{n.y>r!=n.next.y>r&&n.next.y!==n.y&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)}function y(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function m(e,t,n,i){return!!(x(e,t)&&x(n,i)||x(e,i)&&x(n,t))||y(e,t,n)>0!=y(e,t,i)>0&&y(n,i,e)>0!=y(n,i,t)>0}function P(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function _(e,t){var n=new S(e.i,e.x,e.y),i=new S(t.i,t.x,t.y),o=e.next,r=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function b(e,t,n,i){var o=new S(e,t,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function w(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,n,i){for(var o=0,r=t,a=n-i;r<n;r+=i)o+=(e[a]-e[r])*(e[r+1]+e[a+1]),a=r;return o}e.exports=i,e.exports.default=i,i.deviation=function(e,t,n,i){var o=t&&t.length,r=o?t[0]*n:e.length,a=Math.abs(C(e,0,r,n));if(o)for(var s=0,l=t.length;s<l;s++){var c=t[s]*n,u=s<l-1?t[s+1]*n:e.length;a-=Math.abs(C(e,c,u,n))}var f=0;for(s=0;s<i.length;s+=3){var p=i[s]*n,d=i[s+1]*n,h=i[s+2]*n;f+=Math.abs((e[p]-e[h])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[h+1]-e[p+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},i.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,o=0;o<e.length;o++){for(var r=0;r<e[o].length;r++)for(var a=0;a<t;a++)n.vertices.push(e[o][r][a]);o>0&&(i+=e[o-1].length,n.holes.push(i))}return n}},function(e,t,n){"use strict";e.exports=o;var i=1e20;function o(e,t,n,i,o,r){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=i||.25,this.fontFamily=o||"sans-serif",this.fontWeight=r||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(e,t,n,i,o,r,s){for(var l=0;l<t;l++){for(var c=0;c<n;c++)i[c]=e[c*t+l];for(a(i,o,r,s,n),c=0;c<n;c++)e[c*t+l]=o[c]}for(c=0;c<n;c++){for(l=0;l<t;l++)i[l]=e[c*t+l];for(a(i,o,r,s,t),l=0;l<t;l++)e[c*t+l]=Math.sqrt(o[l])}}function a(e,t,n,o,r){n[0]=0,o[0]=-i,o[1]=+i;for(var a=1,s=0;a<r;a++){for(var l=(e[a]+a*a-(e[n[s]]+n[s]*n[s]))/(2*a-2*n[s]);l<=o[s];)s--,l=(e[a]+a*a-(e[n[s]]+n[s]*n[s]))/(2*a-2*n[s]);n[++s]=a,o[s]=l,o[s+1]=+i}for(a=0,s=0;a<r;a++){for(;o[s+1]<a;)s++;t[a]=(a-n[s])*(a-n[s])+e[n[s]]}}o.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),o=0;o<this.size*this.size;o++){var a=t.data[4*o+3]/255;this.gridOuter[o]=1===a?0:0===a?i:Math.pow(Math.max(0,.5-a),2),this.gridInner[o]=1===a?i:0===a?0:Math.pow(Math.max(0,a-.5),2)}for(r(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),r(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),o=0;o<this.size*this.size;o++){var s=this.gridOuter[o]-this.gridInner[o];n[o]=Math.max(0,Math.min(255,Math.round(255-255*(s/this.radius+this.cutoff))))}return n}},function(e,t,n){(function(t){const i=n(24),o=("undefined"==typeof window?t:window).deck||{};if(!o.Layer)throw new Error("@deck.gl/core is not found");e.exports=Object.assign(o,i)}).call(this,n(17))},,function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=i=function(e){return n(e)}:e.exports=i=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},i(t)}e.exports=i},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var i=n(2);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););return e}},function(e,t){function n(t,i){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,i)}e.exports=n},function(e,t,n){var i=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,r=o&&i.regeneratorRuntime;if(i.regeneratorRuntime=void 0,e.exports=n(23),o)i.regeneratorRuntime=r;else try{delete i.regeneratorRuntime}catch(e){i.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n,i=Object.prototype,o=i.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=P;var f="suspendedStart",p="suspendedYield",d="executing",h="completed",g={},v={};v[a]=function(){return this};var y=Object.getPrototypeOf,x=y&&y(y(E([])));x&&x!==i&&o.call(x,a)&&(v=x);var m=S.prototype=b.prototype=Object.create(v);w.prototype=m.constructor=S,S.constructor=w,S[l]=w.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(m),e},u.awrap=function(e){return{__await:e}},C(L.prototype),L.prototype[s]=function(){return this},u.AsyncIterator=L,u.async=function(e,t,n,i){var o=new L(P(e,t,n,i));return u.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},C(m),m[l]="Generator",m[a]=function(){return this},m.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},u.values=E,z.prototype={constructor:z,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(M),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,o){return s.type="throw",s.arg=e,t.next=i,o&&(t.method="next",t.arg=n),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;M(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:E(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=n),g}}}function P(e,t,n,i){var o=t&&t.prototype instanceof b?t:b,r=Object.create(o.prototype),a=new z(i||[]);return r._invoke=function(e,t,n){var i=f;return function(o,r){if(i===d)throw new Error("Generator is already running");if(i===h){if("throw"===o)throw r;return F()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=A(a,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===f)throw i=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=d;var l=_(e,t,n);if("normal"===l.type){if(i=n.done?h:p,l.arg===g)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=h,n.method="throw",n.arg=l.arg)}}}(e,n,a),r}function _(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function b(){}function w(){}function S(){}function C(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function L(e){var t;this._invoke=function(n,i){function r(){return new Promise(function(t,r){!function t(n,i,r,a){var s=_(e[n],e,i);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,r,a)},function(e){t("throw",e,r,a)}):Promise.resolve(c).then(function(e){l.value=e,r(l)},function(e){return t("throw",e,r,a)})}a(s.arg)}(n,i,t,r)})}return t=t?t.then(r,r):r()}}function A(e,t){var i=e.iterator[t.method];if(i===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,A(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var o=_(i,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,g;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,g):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(o.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=n,t.done=!0,t};return r.next=r}}return{next:F}}function F(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var i=n(3),o=n.n(i),r=n(4),a=n.n(r),s=n(5),l=n.n(s),c=n(2),u=n.n(c),f=n(7),p=n.n(f),d=n(6),h=n.n(d),g=n(1),v=n(0),y="#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",x=v.fp64.fp64LowPart,m=[0,0,0,255],P={fp64:!1,getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getSourceColor:{type:"accessor",value:m},getTargetColor:{type:"accessor",value:m},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0},getStrokeWidth:{deprecatedFor:"getWidth"}},_=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return this.use64bitProjection()?{vs:"#define SHADER_NAME arc-layer-vertex-shader-64\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\n\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\n\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\n\nvec2 paraboloid_fp64(vec2 source[2], vec2 target[2], float ratio) {\n\n  vec2 x[2];\n  vec2_mix_fp64(source, target, ratio, x);\n  vec2 center[2];\n  vec2_mix_fp64(source, target, 0.5, center);\n\n  vec2 dSourceCenter = vec2_distance_fp64(source, center);\n  vec2 dXCenter = vec2_distance_fp64(x, center);\n  return mul_fp64(sum_fp64(dSourceCenter, dXCenter), sub_fp64(dSourceCenter, dXCenter));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvoid get_pos_fp64(vec2 source[2], vec2 target[2], float segmentRatio, out vec2 position[4]) {\n\n  vec2 vertex_height = paraboloid_fp64(source, target, segmentRatio);\n\n  vec2 position_temp[2];\n\n  vec2_mix_fp64(source, target, segmentRatio, position_temp);\n\n  position[0] = position_temp[0];\n  position[1] = position_temp[1];\n\n  if (vertex_height.x < 0.0 || (vertex_height.x == 0.0 && vertex_height.y <= 0.0)) {\n    vertex_height = vec2(0.0, 0.0);\n  }\n\n  position[2] = sqrt_fp64(vertex_height);\n  position[3] = vec2(1.0, 0.0);\n}\n\nvoid main(void) {\n  vec2 projected_source_coord[2];\n  vec2 projected_target_coord[2];\n\n  project_position_fp64(instancePositions.xy, instancePositions64Low.xy, projected_source_coord);\n  project_position_fp64(instancePositions.zw, instancePositions64Low.zw, projected_target_coord);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 curr_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, segmentRatio,\n    curr_pos_modelspace);\n\n  vec2 next_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, nextSegmentRatio,\n    next_pos_modelspace);\n\n  vec4 curr_pos_clipspace = project_common_position_to_clipspace_fp64(curr_pos_modelspace);\n  vec4 next_pos_clipspace = project_common_position_to_clipspace_fp64(next_pos_modelspace);\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n\n  vec2 offset = getExtrusionOffset(next_pos_clipspace.xy - curr_pos_clipspace.xy, positions.y, widthPixels);\n\n  gl_Position = curr_pos_clipspace + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:y,modules:["project64","picking"]}:{vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertexHeight = sqrt(max(0.0, paraboloid(source, target, segmentRatio))) * instanceHeights;\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target - source);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * vertexHeight * sin(tiltAngle);\n\n  return vec3(\n    mix(source, target, segmentRatio) + tilt,\n    vertexHeight * cos(tiltAngle)\n  );\n}\n\nvoid main(void) {\n  vec2 source = project_position(vec3(instancePositions.xy, 0.0), instancePositions64Low.xy).xy;\n  vec2 target = project_position(vec3(instancePositions.zw, 0.0), instancePositions64Low.zw).xy;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec3 currPos = getPos(source, target, segmentRatio);\n  vec3 nextPos = getPos(source, target, nextSegmentRatio);\n  vec4 curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n  vec4 next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:y,modules:["picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:4,transition:!0,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions},instancePositions64Low:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions64Low},instanceSourceColors:{size:4,type:5121,transition:!0,accessor:"getSourceColor",defaultValue:m},instanceTargetColors:{size:4,type:5121,transition:!0,accessor:"getTargetColor",defaultValue:m},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o}),n.fp64!==i.fp64){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.widthUnits,r=i.widthScale,a=i.widthMinPixels,s=i.widthMaxPixels,l="pixels"===o?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{widthScale:r*l,widthMinPixels:a,widthMaxPixels:s})).draw()}},{key:"_getModel",value:function(e){for(var t=[],n=0;n<50;n++)t=t.concat([n,-1,0,n,1,0]);var i=new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:5,attributes:{positions:new Float32Array(t)}}),isInstanced:!0,shaderCache:this.context.shaderCache}));return i.setUniforms({numSegments:50}),i}},{key:"calculateInstancePositions",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.props,r=o.data,a=o.getSourcePosition,s=o.getTargetPosition,l=e.value,c=n*e.size,u=Object(g.createIterable)(r,n,i),f=u.iterable,p=u.objectInfo,d=!0,h=!1,v=void 0;try{for(var y,x=f[Symbol.iterator]();!(d=(y=x.next()).done);d=!0){var m=y.value;p.index++;var P=a(m,p);l[c++]=P[0],l[c++]=P[1];var _=s(m,p);l[c++]=_[0],l[c++]=_[1]}}catch(e){h=!0,v=e}finally{try{d||null==x.return||x.return()}finally{if(h)throw v}}}},{key:"calculateInstancePositions64Low",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var r=this.props,a=r.data,s=r.getSourcePosition,l=r.getTargetPosition,c=e.value,u=n*e.size,f=Object(g.createIterable)(a,n,i),p=f.iterable,d=f.objectInfo,h=!0,v=!1,y=void 0;try{for(var m,P=p[Symbol.iterator]();!(h=(m=P.next()).done);h=!0){var _=m.value;d.index++;var b=s(_,d);c[u++]=x(b[0]),c[u++]=x(b[1]);var w=l(_,d);c[u++]=x(w[0]),c[u++]=x(w[1])}}catch(e){v=!0,y=e}finally{try{h||null==P.return||P.return()}finally{if(v)throw y}}}else e.value=new Float32Array(4)}}]),t}(g.Layer);_.layerName="ArcLayer",_.defaultProps=P;var b=n(8),w=n.n(b),S=n(9),C=n.n(S);function L(e,t,n,i,o,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,o)}function A(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){var r=e.apply(t,n);function a(e){L(r,i,o,a,s,"next",e)}function s(e){L(r,i,o,a,s,"throw",e)}a(void 0)})}}var k=n(10),M=n.n(k),z=n(11),E=n.n(z);function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function O(e){return Buffer.isBuffer(e)?new Uint8Array(e).buffer:e}var j=!1,I=!0,T=new Map([["image/png",function(e){var t=D(e);if(t.byteLength<24||2303741511!==t.getUint32(0,j))return null;return{width:t.getUint32(16,j),height:t.getUint32(20,j)}}],["image/jpeg",function(e){var t=D(e);if(t.byteLength<2||65496!==t.getUint16(0,j))return null;var n=function(){for(var e=new Set([65499,65476,65484,65501,65534]),t=65504;t<65520;++t)e.add(t);var n=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:n}}(),i=n.tableMarkers,o=n.sofMarkers,r=2;for(;r<t.byteLength;){var a=t.getUint16(r,j);if(o.has(a))return{height:t.getUint16(r+5,j),width:t.getUint16(r+7,j)};if(!i.has(a))return null;r+=2,r+=t.getUint16(r,j)}return null}],["image/gif",function(e){var t=D(e);if(t.byteLength<10||1195984440!==t.getUint32(0,j))return null;return{width:t.getUint16(6,I),height:t.getUint16(8,I)}}],["image/bmp",function(e){var t=D(e);if(16973!==t.getUint16(0,j))return null;return{width:t.getUint32(18,I),height:t.getUint32(22,I)}}]]),R="Invalid MIME type. Supported MIME types are: ".concat(Array.from(T.keys()).join(", "));function W(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){var n=T.get(t);if(!n)throw new Error(R);var i=n(e);if(!i)throw new Error("invalid image data for type: ".concat(t));return i}var o=N(e,t);if(!o)throw new Error(R);return o}function N(e,t){var n=!0,i=!1,o=void 0;try{for(var r,a=T.entries()[Symbol.iterator]();!(n=(r=a.next()).done);n=!0){var s=F(r.value,2),l=s[0],c=(0,s[1])(e);if(c)return c.mimeType=l,c}}catch(e){i=!0,o=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw o}}return null}function D(e){if(O&&(e=O(e)),e instanceof ArrayBuffer||ArrayBuffer.isView(e))return new DataView(e.buffer||e);throw new Error("toDataView")}function U(e,t){return B.apply(this,arguments)}function B(){return(B=A(C.a.mark(function e(t,n){var i,o,r,a,s;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=E.a.promisify(M.a),o=W(t),r=o.mimeType,a=t instanceof Buffer?t:Buffer.from(t),e.next=5,i(a,r);case 5:return s=e.sent,e.abrupt("return",{width:s.shape[0],height:s.shape[1],data:s.data});case 7:case"end":return e.stop()}},e)}))).apply(this,arguments)}function V(e,t){return U?U(e,t):function(e){if("undefined"==typeof createImageBitmap)throw new Error("parseImage");var t=new Blob([new Uint8Array(e)]);return createImageBitmap(t)}(e)}function H(e,t){return G.apply(this,arguments)}function G(){return(G=A(C.a.mark(function e(t,n){var i,o;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof Image){e.next=8;break}return e.next=3,fetch(t,n);case 3:return i=e.sent,e.next=6,i.arrayBuffer();case 6:return o=e.sent,e.abrupt("return",V(o));case 8:return e.next=10,X(t,n);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}},e)}))).apply(this,arguments)}function X(e,t){return J.apply(this,arguments)}function J(){return(J=A(C.a.mark(function e(t,n){var i,o,r;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!/\.svg((\?|#).*)?$/.test(t)){e.next=10;break}return e.next=3,fetch(t,n);case 3:return o=e.sent,e.next=6,o.text();case 6:r=e.sent,i="data:image/svg+xml;base64,".concat(btoa(r)),e.next=13;break;case 10:return e.next=12,t;case 12:i=e.sent;case 13:return e.next=15,new Promise(function(e,o){try{var r=new Image;r.onload=function(){return e(r)},r.onerror=function(e){return o(new Error("Could not load image ".concat(t,": ").concat(e)))},r.crossOrigin=n&&n.crossOrigin||"anonymous",r.src=i}catch(e){o(e)}});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Z,Y=v.fp64.fp64LowPart,q=(Z={},w()(Z,10241,9987),w()(Z,10240,9729),w()(Z,10242,33071),w()(Z,10243,33071),Z),Q=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME bitmap-layer-vertex-shader\n\nattribute vec2 texCoords;\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 instancePickingColors;\n\nvarying vec2 vTexCoord;\n\nvoid main(void) {\n  gl_Position = project_position_to_clipspace(positions, positions64xyLow, vec3(0.0));\n \n  vTexCoord = texCoords;\n \n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"\n#define SHADER_NAME bitmap-layer-fragment-shader\n\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D bitmapTexture;\n\nvarying vec2 vTexCoord;\n\nuniform float desaturate;\nuniform vec4 transparentColor;\nuniform vec3 tintColor;\nuniform float opacity;\n\n// apply desaturation\nvec3 color_desaturate(vec3 color) {\n  float luminance = (color.r + color.g + color.b) * 0.333333333;\n  return mix(color, vec3(luminance), desaturate);\n}\n\n// apply tint\nvec3 color_tint(vec3 color) {\n  return color * tintColor / 255.0;\n}\n\n// blend with background color\nvec4 apply_opacity(vec3 color, float alpha) {\n  return mix(transparentColor / 255.0, vec4(color, 1.0), alpha);\n}\n\nvoid main(void) {\n  vec4 bitmapColor = texture2D(bitmapTexture, vTexCoord);\n\n  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);\n\n  // use highlight color if this fragment belongs to the selected object.\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n\n  // use picking color if rendering to picking FBO.\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().add({positions:{size:3,update:this.calculatePositions,value:new Float32Array(12)},positions64xyLow:{size:3,update:this.calculatePositions64xyLow,value:new Float32Array(12)}}),this.setState({numInstances:4})}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps;e.changeFlags;if(t.fp64!==n.fp64){var i=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(i)}),this.getAttributeManager().invalidateAll()}t.image!==n.image&&this.loadTexture(t.image);var o=this.getAttributeManager();t.bounds!==n.bounds&&(this.setState({positions:this._getPositionsFromBounds(t.bounds)}),o.invalidate("positions"),o.invalidate("positions64xyLow"))}},{key:"finalizeState",value:function(){p()(u()(t.prototype),"finalizeState",this).call(this),this.state.bitmapTexture&&this.state.bitmapTexture.delete()}},{key:"_getPositionsFromBounds",value:function(e){var t=new Array(12);if(Number.isFinite(e[0]))t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[0],t[4]=e[3],t[5]=0,t[6]=e[2],t[7]=e[3],t[8]=0,t[9]=e[2],t[10]=e[1],t[11]=0;else for(var n=0;n<e.length;n++)t[3*n+0]=e[n][0],t[3*n+1]=e[n][1],t[3*n+2]=e[n][2]||0;return t}},{key:"_getModel",value:function(e){return e?new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,shaderCache:this.context.shaderCache,geometry:new v.Geometry({drawMode:6,vertexCount:4,attributes:{texCoords:new Float32Array([0,0,0,1,1,1,1,0])}}),isInstanced:!1})):null}},{key:"draw",value:function(e){var t=e.uniforms,n=this.state,i=n.bitmapTexture,o=n.model,r=this.props,a=r.desaturate,s=r.transparentColor,l=r.tintColor;i&&o&&o.setUniforms(Object.assign({},t,{bitmapTexture:i,desaturate:a,transparentColor:s,tintColor:l})).draw()}},{key:"loadTexture",value:function(e){var t=this;if("string"==typeof e&&(e=H(e)),e instanceof Promise)e.then(function(e){return t.loadTexture(e)});else{var n=this.context.gl;this.state.bitmapTexture&&this.state.bitmapTexture.delete(),e instanceof v.Texture2D?this.setState({bitmapTexture:e}):(e instanceof Image||e instanceof HTMLCanvasElement)&&this.setState({bitmapTexture:new v.Texture2D(n,{data:e,parameters:q})})}}},{key:"calculatePositions",value:function(e){var t=e.value,n=this.state.positions;t.set(n)}},{key:"calculatePositions64xyLow",value:function(e){var t=this.use64bitPositions();(e.constant=!t,t)?e.value.set(this.state.positions.map(Y)):e.value=new Float32Array(4)}}]),t}(g.Layer);Q.layerName="BitmapLayer",Q.defaultProps={image:null,bounds:{type:"array",value:[1,0,0,1],compare:!0},fp64:!1,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]}};var K,$=1024,ee=4,te=function(){},ne=(K={},w()(K,10241,9987),w()(K,10240,9729),K);function ie(e){return e&&(e.id||e.url)}function oe(e,t,n){for(var i=0;i<t.length;i++){var o=t[i],r=o.icon,a=o.xOffset;e[ie(r)]=Object.assign({},r,{x:a,y:n})}}var re=function(){function e(t,n){var i=n.onUpdate,r=void 0===i?te:i;o()(this,e),this.gl=t,this.onUpdate=r,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._buffer=ee,this._canvasWidth=$,this._canvasHeight=0,this._canvas=null}return a()(e,[{key:"finalize",value:function(){this._texture&&this._texture.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(e,t){var n=this._getIcon(e,t),i=this._autoPacking?ie(n):n;return this._mapping[i]||{}}},{key:"setProps",value:function(e){var t=e.autoPacking,n=e.iconAtlas,i=e.iconMapping,o=e.data,r=e.getIcon;void 0!==t&&(this._autoPacking=t),r&&(this._getIcon=r),i&&(this._mapping=i),n&&this._updateIconAtlas(n),this._autoPacking&&(o||r)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(o))}},{key:"_updateIconAtlas",value:function(e){var t=this;this._texture&&(this._texture.delete(),this._texture=null),e instanceof v.Texture2D?(e.setParameters(ne),this._externalTexture=e,this.onUpdate()):"string"==typeof e&&H(e).then(function(e){t._texture=new v.Texture2D(t.gl,{data:e,parameters:ne}),t.onUpdate()})}},{key:"_updateAutoPacking",value:function(e){var t,n,i,o,r,a,s=Object.values(function(e,t,n){if(!e||!t)return null;n=n||{};var i={},o=Object(g.createIterable)(e),r=o.iterable,a=o.objectInfo,s=!0,l=!1,c=void 0;try{for(var u,f=r[Symbol.iterator]();!(s=(u=f.next()).done);s=!0){var p=u.value;a.index++;var d=t(p,a),h=ie(d);if(!d)throw new Error("Icon is missing.");if(!d.url)throw new Error("Icon url is missing.");i[h]||n[h]&&d.url===n[h].url||(i[h]=d)}}catch(e){l=!0,c=e}finally{try{s||null==f.return||f.return()}finally{if(l)throw c}}return i}(e,this._getIcon,this._mapping)||{});if(s.length>0){var l=function(e){for(var t,n=e.icons,i=e.buffer,o=e.mapping,r=void 0===o?{}:o,a=e.xOffset,s=void 0===a?0:a,l=e.yOffset,c=void 0===l?0:l,u=e.canvasWidth,f=0,p=[],d=0;d<n.length;d++){var h=n[d];if(!r[ie(h)]){var g=h.height,v=h.width;s+v+i>u&&(oe(r,p,c),s=0,c=f+c+i,f=0,p=[]),p.push({icon:h,xOffset:s}),s=s+v+i,f=Math.max(f,g)}}return p.length>0&&oe(r,p,c),{mapping:r,xOffset:s,yOffset:c,canvasWidth:u,canvasHeight:(t=f+c+i,Math.pow(2,Math.ceil(Math.log2(t))))}}({icons:s,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,xOffset:this._xOffset,yOffset:this._yOffset}),c=l.mapping,u=l.xOffset,f=l.yOffset,p=l.canvasHeight;this._mapping=c,this._xOffset=u,this._yOffset=f,this._canvasHeight=p,this._texture||(this._texture=new v.Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:ne})),this._texture.height!==this._canvasHeight&&(t=this._texture,n=this._canvasWidth,i=this._canvasHeight,o=t.width,r=t.height,a=Object(v.readPixelsToBuffer)(t,{}),t.resize({width:n,height:i}),t.setSubImageData({data:a,x:0,y:i-r,width:o,height:r,parameters:ne}),t.generateMipmap(),a.delete()),this.onUpdate(),this._loadIcons(s)}}},{key:"_loadIcons",value:function(e){var t=this,n=this._canvas.getContext("2d"),i=this._texture.height,o=!0,r=!1,a=void 0;try{for(var s,l=function(){var e=s.value;H(e.url).then(function(o){var r=ie(e),a=t._mapping[r],s=a.x,l=a.y,c=a.width,u=a.height,f=function(e,t,n,i){var o=t.naturalWidth,r=t.naturalHeight;return n===o&&i===r?t:(e.canvas.height=i,e.canvas.width=n,e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0,o,r,0,0,n,i),e.canvas)}(n,o,c,u);t._texture.setSubImageData({data:f,x:s,y:i-l-u,width:c,height:u,parameters:Object.assign({},ne,w()({},37440,!0))}),t._texture.generateMipmap(),t.onUpdate()})},c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0)l()}catch(e){r=!0,a=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw a}}}}]),e}(),ae=v.fp64.fp64LowPart,se=[0,0,0,255],le={iconAtlas:null,iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},fp64:!1,billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:function(e){return e.position}},getIcon:{type:"accessor",value:function(e){return e.icon}},getColor:{type:"accessor",value:se},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0}},ce=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n\n  if (billboard)  {\n    pixelOffset.y *= -1.0;\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.0)); \n    gl_Position.xy += project_pixel_size_to_clipspace(pixelOffset);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset_common); \n  }\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vColor = instanceColors / 255.;\n\n  vColorMode = instanceColorModes;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\n\nconst float MIN_ALPHA = 0.05;\n\nvoid main(void) {\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < MIN_ALPHA) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){var e=this;this.state={iconManager:new re(this.context.gl,{onUpdate:function(){return e._onUpdate()}})},this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",update:this.calculateInstanceOffsets},instanceIconFrames:{size:4,accessor:"getIcon",update:this.calculateInstanceIconFrames},instanceColorModes:{size:1,type:5121,accessor:"getIcon",update:this.calculateInstanceColorMode},instanceColors:{size:4,type:5121,transition:!0,accessor:"getColor",defaultValue:se},instanceAngles:{size:1,transition:!0,accessor:"getAngle",defaultValue:0}})}},{key:"updateState",value:function(e){var n=e.oldProps,i=e.props,o=e.changeFlags;p()(u()(t.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:o});var r=this.getAttributeManager(),a=this.state.iconManager,s=i.iconAtlas,l=i.iconMapping,c=i.data,f=i.getIcon,d=!1;if(s?(n.iconAtlas!==i.iconAtlas&&a.setProps({iconAtlas:s,autoPacking:!1}),n.iconMapping!==i.iconMapping&&(a.setProps({iconMapping:l}),d=!0)):a.setProps({autoPacking:!0}),(o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getIcon))&&(a.setProps({data:c,getIcon:f}),d=!0),d&&(r.invalidate("instanceOffsets"),r.invalidate("instanceIconFrames"),r.invalidate("instanceColorModes")),i.fp64!==n.fp64){var h=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(h)}),r.invalidateAll()}}},{key:"finalizeState",value:function(){p()(u()(t.prototype),"finalizeState",this).call(this),this.state.iconManager.finalize()}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.sizeScale,o=n.sizeMinPixels,r=n.sizeMaxPixels,a=n.sizeUnits,s=n.billboard,l=this.state.iconManager,c=this.context.viewport,u=l.getTexture();u&&this.state.model.setUniforms(Object.assign({},t,{iconsTexture:u,iconsTextureDim:[u.width,u.height],sizeScale:i*("pixels"===a?c.distanceScales.metersPerPixel[2]:1),sizeMinPixels:o,sizeMaxPixels:r,billboard:s})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:6,attributes:{positions:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"calculateInstancePositions64xyLow",value:function(e){var t=this.use64bitPositions();if(e.constant=!t,t){var n=this.props,i=n.data,o=n.getPosition,r=e.value,a=0,s=Object(g.createIterable)(i),l=s.iterable,c=s.objectInfo,u=!0,f=!1,p=void 0;try{for(var d,h=l[Symbol.iterator]();!(u=(d=h.next()).done);u=!0){var v=d.value;c.index++;var y=o(v,c);r[a++]=ae(y[0]),r[a++]=ae(y[1])}}catch(e){f=!0,p=e}finally{try{u||null==h.return||h.return()}finally{if(f)throw p}}}else e.value=new Float32Array(2)}},{key:"calculateInstanceOffsets",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.props.data,r=this.state.iconManager,a=e.value,s=n*e.size,l=Object(g.createIterable)(o,n,i),c=l.iterable,u=l.objectInfo,f=!0,p=!1,d=void 0;try{for(var h,v=c[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var y=h.value;u.index++;var x=r.getIconMapping(y,u);a[s++]=x.width/2-x.anchorX||0,a[s++]=x.height/2-x.anchorY||0}}catch(e){p=!0,d=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw d}}}},{key:"calculateInstanceColorMode",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.props.data,r=this.state.iconManager,a=e.value,s=n*e.size,l=Object(g.createIterable)(o,n,i),c=l.iterable,u=l.objectInfo,f=!0,p=!1,d=void 0;try{for(var h,v=c[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var y=h.value;u.index++;var x=r.getIconMapping(y,u).mask;a[s++]=x?1:0}}catch(e){p=!0,d=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw d}}}},{key:"calculateInstanceIconFrames",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.props.data,r=this.state.iconManager,a=e.value,s=n*e.size,l=Object(g.createIterable)(o,n,i),c=l.iterable,u=l.objectInfo,f=!0,p=!1,d=void 0;try{for(var h,v=c[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var y=h.value;u.index++;var x=r.getIconMapping(y,u);a[s++]=x.x||0,a[s++]=x.y||0,a[s++]=x.width||0,a[s++]=x.height||0}}catch(e){p=!0,d=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw d}}}}]),t}(g.Layer);ce.layerName="IconLayer",ce.defaultProps=le;var ue=v.fp64.fp64LowPart,fe={fp64:!1,getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getColor:{type:"accessor",value:[0,0,0,255]},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0},getStrokeWidth:{deprecatedFor:"getWidth"}},pe=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return{vs:"#define SHADER_NAME line-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceSourcePositions;\nattribute vec3 instanceTargetPositions;\nattribute vec4 instanceSourceTargetPositions64xyLow;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nvoid main(void) {\n  vec4 source = project_position_to_clipspace(instanceSourcePositions, instanceSourceTargetPositions64xyLow.xy, vec3(0.));\n  vec4 target = project_position_to_clipspace(instanceTargetPositions, instanceSourceTargetPositions64xyLow.zw, vec3(0.));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  float segmentIndex = positions.x;\n  vec4 p = mix(source, target, segmentIndex);\n  vec2 offset = getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels);\n  gl_Position = p + vec4(offset, 0.0, 0.0);\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME line-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,transition:!0,accessor:"getTargetPosition"},instanceSourceTargetPositions64xyLow:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstanceSourceTargetPositions64xyLow},instanceColors:{size:4,type:5121,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o}),n.fp64!==i.fp64){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.widthUnits,r=i.widthScale,a=i.widthMinPixels,s=i.widthMaxPixels,l="pixels"===o?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{widthScale:r*l,widthMinPixels:a,widthMaxPixels:s})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:5,attributes:{positions:new Float32Array([0,-1,0,0,1,0,1,-1,0,1,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstanceSourceTargetPositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var r=this.props,a=r.data,s=r.getSourcePosition,l=r.getTargetPosition,c=e.value,u=n*e.size,f=Object(g.createIterable)(a,n,i),p=f.iterable,d=f.objectInfo,h=!0,v=!1,y=void 0;try{for(var x,m=p[Symbol.iterator]();!(h=(x=m.next()).done);h=!0){var P=x.value;d.index++;var _=s(P,d),b=l(P,d);c[u++]=ue(_[0]),c[u++]=ue(_[1]),c[u++]=ue(b[0]),c[u++]=ue(b[1])}}catch(e){v=!0,y=e}finally{try{h||null==m.return||m.return()}finally{if(v)throw y}}}else e.value=new Float32Array(4)}}]),t}(g.Layer);pe.layerName="LineLayer",pe.defaultProps=fe;var de=v.fp64.fp64LowPart,he=[0,0,0,255],ge=[0,0,1],ve=new v.PhongMaterial,ye={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},fp64:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getNormal:{type:"accessor",value:ge},getColor:{type:"accessor",value:he},material:ve,radiusPixels:{deprecatedFor:"pointSize"}},xe=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(e){return{vs:"#define SHADER_NAME point-cloud-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 instanceNormals;\nattribute vec4 instanceColors;\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusPixels;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n  unitPosition = positions.xy;\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.), position_commonspace);\n  gl_Position.xy += project_pixel_size_to_clipspace(positions.xy * radiusPixels);\n  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, position_commonspace.xyz, project_normal(instanceNormals));\n  vColor = vec4(lightColor, instanceColors.a * opacity) / 255.0;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME point-cloud-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying vec2 unitPosition;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:ge},instanceColors:{size:4,type:5121,transition:!0,accessor:"getColor",defaultValue:he}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o}),n.fp64!==i.fp64){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.pointSize,r="meters"===i.sizeUnits?n.distanceScales.pixelsPerMeter[2]:1;this.state.model.setUniforms(Object.assign({},t,{radiusPixels:o*r})).draw()}},{key:"_getModel",value:function(e){for(var t=[],n=0;n<3;n++){var i=n/3*Math.PI*2;t.push(2*Math.cos(i),2*Math.sin(i),0)}return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:4,attributes:{positions:new Float32Array(t)}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var r=this.props,a=r.data,s=r.getPosition,l=e.value,c=n*e.size,u=Object(g.createIterable)(a,n,i),f=u.iterable,p=u.objectInfo,d=!0,h=!1,v=void 0;try{for(var y,x=f[Symbol.iterator]();!(d=(y=x.next()).done);d=!0){var m=y.value;p.index++;var P=s(m,p);l[c++]=de(P[0]),l[c++]=de(P[1])}}catch(e){h=!0,v=e}finally{try{d||null==x.return||x.return()}finally{if(h)throw v}}}else e.value=new Float32Array(2)}}]),t}(g.Layer);xe.layerName="PointCloudLayer",xe.defaultProps=ye;var me=v.fp64.fp64LowPart,Pe=[0,0,0,255],_e={radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,fp64:!1,filled:!0,getPosition:{type:"accessor",value:function(e){return e.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Pe},getLineColor:{type:"accessor",value:Pe},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},be=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(e){return{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  float outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity) / 255.;\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  } \n  if (distToCenter > innerUnitRadius) {\n    gl_FragColor = vLineColor;\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:4,transition:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;if(p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o}),n.fp64!==i.fp64){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.radiusScale,r=i.radiusMinPixels,a=i.radiusMaxPixels,s=i.stroked,l=i.filled,c=i.lineWidthUnits,u=i.lineWidthScale,f=i.lineWidthMinPixels,p=i.lineWidthMaxPixels,d="pixels"===c?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{stroked:s?1:0,filled:l,radiusScale:o,radiusMinPixels:r,radiusMaxPixels:a,lineWidthScale:u*d,lineWidthMinPixels:f,lineWidthMaxPixels:p})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var r=this.props,a=r.data,s=r.getPosition,l=e.value,c=n*e.size,u=Object(g.createIterable)(a,n,i),f=u.iterable,p=u.objectInfo,d=!0,h=!1,v=void 0;try{for(var y,x=f[Symbol.iterator]();!(d=(y=x.next()).done);d=!0){var m=y.value;p.index++;var P=s(m,p);l[c++]=me(P[0]),l[c++]=me(P[1])}}catch(e){h=!0,v=e}finally{try{d||null==x.return||x.return()}finally{if(h)throw v}}}else e.value=new Float32Array(2)}}]),t}(g.Layer);be.layerName="ScatterplotLayer",be.defaultProps=_e;var we=n(12),Se=n.n(we),Ce=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var n=e.id,i=void 0===n?Object(v.uid)("column-geometry"):n,r=function(e){var t=e.radius,n=e.height,i=void 0===n?1:n,o=e.nradial,r=void 0===o?10:o,a=e.vertices;g.log.assert(!a||a.length>=r);for(var s=r+1,l=3*s,c=2*Math.PI/r,u=new Uint16Array(3*r*2),f=new Float32Array(3*l),p=new Float32Array(3*l),d=0,h=0;h<s;h++)for(var v=h*c,y=a&&a[h%r],x=a&&a[(h+1)%r],m=Math.sin(v),P=Math.cos(v),_=0;_<2;_++)f[d+0]=y?y[0]:P*t,f[d+1]=y?y[1]:m*t,f[d+2]=(.5-_)*i,p[d+0]=y?x[0]-y[0]:P,p[d+1]=y?x[1]-y[1]:m,d+=3;for(var b=0;b<s;b++){var w=Math.floor(b/2)*Math.sign(b%2-.5),S=w*c,C=a&&a[(w+r)%r],L=Math.sin(S),A=Math.cos(S);f[d+0]=C?C[0]:A*t,f[d+1]=C?C[1]:L*t,f[d+2]=i/2,p[d+2]=1,d+=3}for(var k=0,M=0;M<r;M++)u[k++]=2*M+0,u[k++]=2*M+2,u[k++]=2*M+0,u[k++]=2*M+1,u[k++]=2*M+1,u[k++]=2*M+3;return{indices:u,attributes:{POSITION:{size:3,value:f},NORMAL:{size:3,value:p}}}}(e),a=r.indices,s=r.attributes;return l()(this,u()(t).call(this,Se()({},e,{id:i,indices:a,attributes:s})))}return h()(t,e),t}(v.Geometry);var Le=v.fp64.fp64LowPart,Ae=new v.PhongMaterial,ke=[0,0,0,255],Me={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,fp64:!1,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:ke},getLineColor:{type:"accessor",value:ke},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:Ae,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},ze=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  \n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceFillColors:{size:4,type:5121,transition:!0,accessor:"getFillColor",defaultValue:ke},instanceLineColors:{size:4,type:5121,transition:!0,accessor:"getLineColor",defaultValue:ke},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;p()(u()(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o});var r=n.fp64!==i.fp64;if(r){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}(r||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(e,t){var n=new Ce({radius:1,height:2,vertices:t,nradial:e}),i=0;if(t)for(var o=0;o<e;o++){var r=t[o];i+=Math.sqrt(r[0]*r[0]+r[1]*r[1])/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),n}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,n=e.vertices,i=this.getGeometry(t,n);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3,wireframeVertexCount:i.indices.value.length}),this.state.model.setProps({geometry:i})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.lineWidthUnits,r=i.lineWidthScale,a=i.lineWidthMinPixels,s=i.lineWidthMaxPixels,l=i.elevationScale,c=i.extruded,u=i.filled,f=i.stroked,p=i.wireframe,d=i.offset,h=i.coverage,g=i.radius,v=i.angle,y=this.state,x=y.model,m=y.fillVertexCount,P=y.wireframeVertexCount,_=y.edgeDistance,b="pixels"===o?n.distanceScales.metersPerPixel[2]:1;x.setUniforms(Object.assign({},t,{radius:g,angle:v/180*Math.PI,offset:d,extruded:c,coverage:h,elevationScale:l,edgeDistance:_,widthScale:r*b,widthMinPixels:a,widthMaxPixels:s})),c&&p&&(x.setProps({isIndexed:!0}),x.setVertexCount(P).setDrawMode(1).setUniforms({isStroke:!0}).draw()),u&&(x.setProps({isIndexed:!1}),x.setVertexCount(m).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!c&&f&&(x.setProps({isIndexed:!1}),x.setVertexCount(2*m/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var r=this.props,a=r.data,s=r.getPosition,l=e.value,c=n*e.size,u=Object(g.createIterable)(a,n,i),f=u.iterable,p=u.objectInfo,d=!0,h=!1,v=void 0;try{for(var y,x=f[Symbol.iterator]();!(d=(y=x.next()).done);d=!0){var m=y.value;p.index++;var P=s(m,p);l[c++]=Le(P[0]),l[c++]=Le(P[1])}}catch(e){h=!0,v=e}finally{try{d||null==x.return||x.return()}finally{if(h)throw v}}}else e.value=new Float32Array(2)}}]),t}(g.Layer);ze.layerName="ColumnLayer",ze.defaultProps=Me;var Ee=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getGeometry",value:function(e){return new v.CubeGeometry}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.elevationScale,o=n.extruded,r=n.offset,a=n.coverage,s=n.cellSize,l=n.angle;this.state.model.setUniforms(Object.assign({},t,{radius:s/2,angle:l,offset:r,extruded:o,coverage:a,elevationScale:i,edgeDistance:1,isWireframe:!1})).draw()}}]),t}(ze);Ee.layerName="GridCellLayer",Ee.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var Fe=g.experimental.Tesselator,Oe=v.fp64.fp64LowPart,je=function(e){function t(e){var n=e.data,i=e.getGeometry,r=e.positionFormat,a=e.fp64;return o()(this,t),l()(this,u()(t).call(this,{data:n,getGeometry:i,fp64:a,positionFormat:r,attributes:{startPositions:{size:3},endPositions:{size:3},leftPositions:{size:3},rightPositions:{size:3},startEndPositions64XyLow:{size:4,fp64Only:!0},neighborPositions64XyLow:{size:4,fp64Only:!0}}}))}return h()(t,e),a()(t,[{key:"get",value:function(e){return this.attributes[e]}},{key:"getGeometrySize",value:function(e){return Math.max(0,this.getPathLength(e)-1)}},{key:"updateGeometryAttributes",value:function(e,t){var n=this.attributes,i=n.startPositions,o=n.endPositions,r=n.leftPositions,a=n.rightPositions,s=n.startEndPositions64XyLow,l=n.neighborPositions64XyLow,c=this.fp64,u=t.geometrySize+1;if(!(u<2))for(var f,p=this.isClosed(e),d=this.getPointOnPath(e,0),h=this.getPointOnPath(e,1),g=p?this.getPointOnPath(e,u-2):d,v=t.vertexStart,y=1;y<u;v++,y++)f=y+1<u?this.getPointOnPath(e,y+1):p?this.getPointOnPath(e,1):h,i[3*v]=d[0],i[3*v+1]=d[1],i[3*v+2]=d[2]||0,o[3*v]=h[0],o[3*v+1]=h[1],o[3*v+2]=h[2]||0,r[3*v]=g[0],r[3*v+1]=g[1],r[3*v+2]=g[2]||0,a[3*v]=f[0],a[3*v+1]=f[1],a[3*v+2]=f[2]||0,c&&(s[4*v]=Oe(d[0]),s[4*v+1]=Oe(d[1]),s[4*v+2]=Oe(h[0]),s[4*v+3]=Oe(h[1]),l[4*v]=Oe(g[0]),l[4*v+1]=Oe(g[1]),l[4*v+2]=Oe(f[0]),l[4*v+3]=Oe(f[1])),g=d,d=h,h=f}},{key:"getPathLength",value:function(e){return Number.isFinite(e[0])?e.length/this.positionSize:e.length}},{key:"getPointOnPath",value:function(e,t){if(Number.isFinite(e[0])){var n=this.positionSize;return[e[t*n],e[t*n+1],3===n?e[t*n+2]:0]}return e[t]}},{key:"isClosed",value:function(e){var t=this.getPathLength(e),n=this.getPointOnPath(e,0),i=this.getPointOnPath(e,t-1);return n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]}}]),t}(Fe),Ie="#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\nuniform float alignMode;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nfloat mod2(float a, float b) {\n  return a - floor(a / b) * b;\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\nbool dash_isFragInGap() {\n  float solidLength = vDashArray.x;\n  float gapLength = vDashArray.y;\n\n  float unitLength = solidLength + gapLength;\n\n  if (unitLength == 0.0) {\n    return false;\n  }\n\n  unitLength = mix(\n    unitLength,\n    vPathLength / round(vPathLength / unitLength),\n    alignMode\n  );\n\n  float offset = alignMode * solidLength / 2.0;\n\n  return gapLength > 0.0 &&\n    vPathPosition.y >= 0.0 &&\n    vPathPosition.y <= vPathLength &&\n    mod2(vPathPosition.y + offset, unitLength) > solidLength;\n}\n\nvoid main(void) {\n  if (jointType > 0.0 && vMiterLength > 0.0 && length(vCornerOffset) > 1.0) {\n    discard;\n  }\n  if (jointType == 0.0 && vMiterLength > miterLimit) {\n    discard;\n  }\n  if (vColor.a == 0.0 || dash_isFragInGap()) {\n    discard;\n  }\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",Te=[0,0,0,255],Re={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},fp64:!1,dashJustified:!1,billboard:!1,getPath:{type:"accessor",value:function(e){return e.path}},getColor:{type:"accessor",value:Te},getWidth:{type:"accessor",value:1},getDashArray:{type:"accessor",value:[0,0]}},We={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},Ne=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return this.use64bitProjection()?{vs:"\n#define SHADER_NAME path-layer-vertex-shader-64\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\nvec3 lineJoin(vec2 prevPoint64[2], vec2 currPoint64[2], vec2 nextPoint64[2]) {\n\n  float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n  float width = project_pixel_size(widthPixels);\n\n  vec2 deltaA64[2];\n  vec2 deltaB64[2];\n\n  vec2_sub_fp64(currPoint64, prevPoint64, deltaA64);\n  vec2_sub_fp64(nextPoint64, currPoint64, deltaB64);\n\n  vec2 lengthA64 = vec2_length_fp64(deltaA64);\n  vec2 lengthB64 = vec2_length_fp64(deltaB64);\n\n  vec2 deltaA = vec2(deltaA64[0].x, deltaA64[1].x);\n  vec2 deltaB = vec2(deltaB64[0].x, deltaB64[1].x);\n\n  float lenA = lengthA64.x;\n  float lenB = lengthB64.x;\n\n  vec2 offsetVec;\n  float offsetScale;\n  float offsetDirection;\n  lenA = lenA / width > EPSILON ? lenA : 0.0;\n  lenB = lenB / width > EPSILON ? lenB : 0.0;\n  vec2 dirA = lenA > 0. ? deltaA / lenA : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? deltaB / lenB : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = mix(perpB, perpA, positions.x);\n  float L = mix(lenB, lenA, positions.x);\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n  float cornerPosition = mix(\n    flipIfTrue(turnsRight == (positions.y > 0.0)),\n    0.0,\n    positions.z\n  );\n\n  offsetScale = 1.0 / max(sinHalfA, EPSILON);\n  cornerPosition *= float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n  offsetScale = mix(\n    offsetScale,\n    min(offsetScale, L / width / max(cosHalfA, EPSILON)),\n    float(cornerPosition < 0.0)\n  );\n\n  vMiterLength = mix(\n    offsetScale * cornerPosition,\n    mix(offsetScale, 0.0, cornerPosition),\n    step(0.0, cornerPosition)\n  ) - sinHalfA * jointType;\n  offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n  offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  float isStartCap = step(lenA, 1.0e-5);\n  float isEndCap = step(lenB, 1.0e-5);\n  float isCap = max(isStartCap, isEndCap);\n  cornerPosition = isCap * (1.0 - positions.z);\n  offsetVec = mix(offsetVec, mix(dirB, perpB, cornerPosition), isStartCap);\n  offsetVec = mix(offsetVec, mix(dirA, perpA, cornerPosition), isEndCap);\n  offsetScale = mix(\n    offsetScale,\n    mix(4.0 * jointType, 1.0, cornerPosition),\n    isCap\n  );\n  vMiterLength = mix(vMiterLength, 1.0 - cornerPosition, isCap);\n\n  offsetDirection = mix(\n    offsetDirection,\n    mix(flipIfTrue(isStartCap > 0.), positions.y, cornerPosition),\n    isCap\n  );\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L / width;\n  float isEnd = positions.x;\n  vec2 offsetFromStartOfPath = mix(vCornerOffset, vCornerOffset + deltaA / width, isEnd);\n  vec2 dir = mix(dirB, dirA, isEnd);\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return vec3(vCornerOffset * width, 0.0);\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n  vec2 projected_curr_position[2];\n  project_position_fp64(currPosition.xy, currPosition64xyLow, projected_curr_position);\n  float projected_curr_position_z = project_size(currPosition.z);\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec2 projected_prev_position[2];\n  project_position_fp64(prevPosition.xy, prevPosition64xyLow, projected_prev_position);\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  vec2 projected_next_position[2];\n  project_position_fp64(nextPosition.xy, nextPosition64xyLow, projected_next_position);\n\n  vec3 pos = lineJoin(projected_prev_position, projected_curr_position, projected_next_position);\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = sum_fp64(vec2(pos.x, 0.0), projected_curr_position[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vec2(pos.y, 0.0), projected_curr_position[1]);\n  vertex_pos_modelspace[2] = vec2(pos.z + projected_curr_position_z, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_common_position_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",fs:Ie,modules:["project64","picking"]}:{vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  float relativePosition, bool isEnd, bool isJoint,\n  vec2 width\n) {\n  vec2 deltaA = (currPoint.xy - prevPoint.xy) / width;\n  vec2 deltaB = (nextPoint.xy - currPoint.xy) / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n  lenA = lenA > EPSILON ? lenA : 0.0;\n  lenB = lenB > EPSILON ? lenB : 0.0;\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  float offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  float cornerPosition = isJoint ?\n    0.0 :\n    flipIfTrue(turnsRight == (relativePosition > 0.0));\n  cornerPosition *=\n    float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) * cosHalfA);\n  if (cornerPosition < 0.0) {\n    offsetScale = min(offsetScale, L / max(cosHalfA, EPSILON));\n  }\n\n  vMiterLength = cornerPosition >= 0.0 ?\n    mix(offsetScale, 0.0, cornerPosition) :\n    offsetScale * cornerPosition;\n  vMiterLength -= sinHalfA * jointType;\n\n  float offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  bool isStartCap = step(0.0, -lenA) > 0.5;\n  bool isEndCap = step(0.0, -lenB) > 0.5;\n  bool isCap = isStartCap || isEndCap;\n  cornerPosition = isCap ? (1.0 - positions.z) : 0.;\n  if (isStartCap) {\n    offsetVec = mix(dirB, perpB, cornerPosition);\n  }\n  if (isEndCap) {\n    offsetVec = mix(dirA, perpA, cornerPosition);\n  }\n  if (isCap) {\n    offsetScale = mix(4.0 * jointType, 1.0, cornerPosition);\n    vMiterLength = 1.0 - cornerPosition;\n    offsetDirection = mix(flipIfTrue(isStartCap), positions.y, cornerPosition);\n  }\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L;\n  vec2 offsetFromStartOfPath = vCornerOffset;\n  if (isEnd) {\n    offsetFromStartOfPath += deltaA;\n  }\n  vec2 dir = isEnd ? dirA : dirB;\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return currPoint + vec3(vCornerOffset * width, 0.0);\n}\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  float relativePosition = positions.y;\n  bool isEnd = positions.x > EPSILON;\n  bool isJoint = positions.z > EPSILON;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n\n  return lineJoin(\n    prevPoint, currPoint, nextPoint,\n    relativePosition, isEnd, isJoint,\n    billboard ? project_pixel_size_to_clipspace(widthPixels) : project_pixel_size(widthPixels)\n  );\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64xyLow, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64xyLow, ZERO_OFFSET);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64xyLow, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64xyLow);\n    currPosition = project_position(currPosition, currPosition64xyLow);\n    nextPosition = project_position(nextPosition, nextPosition64xyLow);\n\n    vec3 pos = lineJoin(prevPosition, currPosition, nextPosition);\n    gl_Position = project_common_position_to_clipspace(vec4(pos, 1.0));\n  }\n}\n",fs:Ie,modules:["project32","picking"]}}},{key:"initializeState",value:function(){var e=this;this.getAttributeManager().addInstanced({instanceStartPositions:{size:3,transition:We,accessor:"getPath",update:this.calculateStartPositions,noAlloc:!0},instanceEndPositions:{size:3,transition:We,accessor:"getPath",update:this.calculateEndPositions,noAlloc:!0},instanceStartEndPositions64xyLow:{size:4,update:this.calculateInstanceStartEndPositions64xyLow,noAlloc:!0},instanceLeftPositions:{size:3,accessor:"getPath",update:this.calculateLeftPositions,noAlloc:!0},instanceRightPositions:{size:3,accessor:"getPath",update:this.calculateRightPositions,noAlloc:!0},instanceNeighborPositions64xyLow:{size:4,update:this.calculateInstanceNeighborPositions64xyLow,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:We,defaultValue:1},instanceDashArrays:{size:2,accessor:"getDashArray"},instanceColors:{size:4,type:5121,accessor:"getColor",transition:We,defaultValue:Te},instancePickingColors:{size:3,type:5121,accessor:function(t,n){var i=n.index,o=n.target;return e.encodePickingColor(i,o)}}}),this.setState({pathTesselator:new je({})})}},{key:"updateState",value:function(e){var n=e.oldProps,i=e.props,o=e.changeFlags;p()(u()(t.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:o});var r=this.getAttributeManager();if(o.dataChanged||i.fp64!==n.fp64||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getPath)){var a=this.state.pathTesselator;a.updateGeometry({data:i.data,getGeometry:i.getPath,positionFormat:i.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:a.instanceCount,bufferLayout:a.bufferLayout}),r.invalidateAll()}if(i.fp64!==n.fp64){var s=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(s)}),r.invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.rounded,r=i.billboard,a=i.miterLimit,s=i.widthUnits,l=i.widthScale,c=i.widthMinPixels,u=i.widthMaxPixels,f=i.dashJustified,p="pixels"===s?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{jointType:Number(o),billboard:r,alignMode:Number(f),widthScale:l*p,miterLimit:a,widthMinPixels:c,widthMaxPixels:u})).draw()}},{key:"_getModel",value:function(e){return new v.Model(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.Geometry({drawMode:4,attributes:{indices:new Uint16Array([0,2,1,1,2,4,1,4,3,3,4,5]),positions:new Float32Array([0,0,1,0,-1,0,0,1,0,1,-1,0,1,1,0,1,0,1])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateStartPositions",value:function(e){var t=this.state.pathTesselator;e.bufferLayout=t.bufferLayout,e.value=t.get("startPositions")}},{key:"calculateEndPositions",value:function(e){var t=this.state.pathTesselator;e.bufferLayout=t.bufferLayout,e.value=t.get("endPositions")}},{key:"calculateInstanceStartEndPositions64xyLow",value:function(e){var t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.pathTesselator.get("startEndPositions64XyLow"):new Float32Array(4)}},{key:"calculateLeftPositions",value:function(e){var t=this.state.pathTesselator;e.value=t.get("leftPositions")}},{key:"calculateRightPositions",value:function(e){var t=this.state.pathTesselator;e.value=t.get("rightPositions")}},{key:"calculateInstanceNeighborPositions64xyLow",value:function(e){var t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.pathTesselator.get("neighborPositions64XyLow"):new Float32Array(4)}},{key:"clearPickingColor",value:function(e){for(var t=this.decodePickingColor(e),n=this.state.pathTesselator.bufferLayout,i=n[t],o=0,r=0;r<t;r++)o+=n[r];var a=this.getAttributeManager().attributes.instancePickingColors,s=a.value,l=o+i;s.fill(0,3*o,3*l),a.update({value:s})}}]),t}(g.Layer);Ne.layerName="PathLayer",Ne.defaultProps=Re;var De=n(13),Ue=n.n(De);function Be(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function Ve(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function He(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function Ge(e,t,n,i){for(var o=0;o<t;o++)if(e[n+o]!==e[i-t+o])return!1;return!0}function Xe(e,t,n,i){for(var o=t,r=n.length,a=0;a<r;a++)for(var s=0;s<i;s++)e[o++]=n[a][s]||0;if(!He(n))for(var l=0;l<i;l++)e[o++]=n[0][l]||0;return o}function Je(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5?arguments[5]:void 0,a=(r=r||n.length)-o;if(a<=0)return t;for(var s=t,l=0;l<a;l++)e[s++]=n[o+l];if(!Ge(n,i,o,r))for(var c=0;c<i;c++)e[s++]=n[o+c];return s}function Ze(e){return(He(e)?0:1)+e.length}function Ye(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;return n>=(i=i||e.length)?0:(Ge(e,t,n,i)?0:1)+(i-n)/t}function qe(e,t){if(Be(e),e.positions){var n=e,i=n.positions,o=n.holeIndices;if(o){for(var r=0,a=0;a<=o.length;a++)r+=Ye(e.positions,t,o[a-1],o[a]);return r}e=i}if(Number.isFinite(e[0]))return Ye(e,t);if(!Ve(e)){var s=0,l=!0,c=!1,u=void 0;try{for(var f,p=e[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){s+=Ze(f.value)}}catch(e){c=!0,u=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw u}}return s}return Ze(e)}function Qe(e,t,n){Be(e),n=n||qe(e,t);var i=new Float64Array(n*t),o=[];if(e.positions){var r=e,a=r.positions,s=r.holeIndices;if(s){for(var l=0,c=0;c<=s.length;c++)l=Je(i,l,a,t,s[c-1],s[c]),o.push(l);return o.pop(),{positions:i,holeIndices:o}}e=a}if(Number.isFinite(e[0]))return Je(i,0,e,t),{positions:i,holeIndices:null};if(!Ve(e)){var u=0,f=!0,p=!1,d=void 0;try{for(var h,g=e[Symbol.iterator]();!(f=(h=g.next()).done);f=!0){u=Xe(i,u,h.value,t),o.push(u)}}catch(e){p=!0,d=e}finally{try{f||null==g.return||g.return()}finally{if(p)throw d}}return o.pop(),{positions:i,holeIndices:o}}return Xe(i,0,e,t),{positions:i,holeIndices:null}}var Ke=g.experimental.Tesselator,$e=v.fp64.fp64LowPart,et=function(e){function t(e){var n=e.data,i=e.getGeometry,r=e.fp64,a=e.positionFormat,s=e.IndexType,c=void 0===s?Uint32Array:s;return o()(this,t),l()(this,u()(t).call(this,{data:n,getGeometry:i,fp64:r,positionFormat:a,attributes:{positions:{size:3},positions64xyLow:{size:2,fp64Only:!0},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:c,size:1}}}))}return h()(t,e),a()(t,[{key:"get",value:function(e){return"indices"===e?this.attributes.indices.subarray(0,this.vertexCount):this.attributes[e]}},{key:"getGeometrySize",value:function(e){return qe(e,this.positionSize)}},{key:"updateGeometryAttributes",value:function(e,t){e=Qe(e,this.positionSize,t.geometrySize),this._updateIndices(e,t),this._updatePositions(e,t)}},{key:"_updateIndices",value:function(e,t){var n,i,o,r=t.geometryIndex,a=t.vertexStart,s=t.indexStart,l=this.attributes,c=this.indexLayout,u=this.typedArrayManager,f=l.indices,p=f.length,d=s,h=(n=e,i=this.positionSize,o=null,n.holeIndices&&(o=n.holeIndices.map(function(e){return e/i})),Ue()(n.positions,o,i));p<d+h.length&&(p=2*(d+h.length),f=u.allocate(f,p,{type:f.constructor,size:1,copy:!0}));for(var g=0;g<h.length;g++)f[d++]=h[g]+a;c[r]=h.length,l.indices=f}},{key:"_updatePositions",value:function(e,t){for(var n=t.vertexStart,i=t.geometrySize,o=this.attributes,r=o.positions,a=o.positions64xyLow,s=o.vertexValid,l=this.fp64,c=this.positionSize,u=n,f=e.positions,p=e.holeIndices,d=0;d<i;d++){var h=f[d*c],g=f[d*c+1],v=c>2?f[d*c+2]:0;r[3*u]=h,r[3*u+1]=g,r[3*u+2]=v,l&&(a[2*u]=$e(h),a[2*u+1]=$e(g)),s[u]=1,u++}if(p)for(var y=0;y<p.length;y++)s[n+p[y]/c-1]=0;s[n+i-1]=0}}]),t}(Ke),tt="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec2 positions64xyLow;\n  vec2 nextPositions64xyLow;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n  vec3 pos;\n  vec2 pos64xyLow;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64xyLow = mix(props.positions64xyLow, props.nextPositions64xyLow, vertexPositions.x);\n  isValid = vertexValid;\n#else\n  pos = props.positions;\n  pos64xyLow = props.positions64xyLow;\n  isValid = 1.0;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n  }\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(pos, pos64xyLow, vec3(0.), position_commonspace);\n\n  if (extruded) {\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(props.positions.y - props.nextPositions.y, props.nextPositions.x - props.positions.x, 0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, position_commonspace.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(props.pickingColors);\n}\n",nt="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(tt,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64xyLow = positions64xyLow;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),it="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 nextPositions;\nattribute vec2 nextPositions64xyLow;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(tt,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = instancePositions;\n  props.positions64xyLow = instancePositions64xyLow;\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n  props.nextPositions = nextPositions;\n  props.nextPositions64xyLow = nextPositions64xyLow;\n\n  calculatePosition(props);\n}\n"),ot=[0,0,0,255],rt=new v.PhongMaterial,at={filled:!0,extruded:!1,wireframe:!1,fp64:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(e){return e.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:ot},getLineColor:{type:"accessor",value:ot},material:rt},st={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},lt=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(e){return{vs:e,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",defines:{},modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){var e=this,t=this.context.gl;this.setState({numInstances:0,polygonTesselator:new et({IndexType:!t||Object(v.hasFeature)(t,v.FEATURES.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var n=this.getAttributeManager();n.remove(["instancePickingColors"]),n.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,transition:st,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{offset:0,divisor:0},instancePositions:{offset:0,divisor:1},nextPositions:{offset:12,divisor:1}}},positions64xyLow:{size:2,update:this.calculatePositionsLow,noAlloc:!0,shaderAttributes:{positions64xyLow:{offset:0,divisor:0},instancePositions64xyLow:{offset:0,divisor:1},nextPositions64xyLow:{offset:8,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:st,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:4,type:5121,transition:st,accessor:"getFillColor",defaultValue:ot,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:4,type:5121,transition:st,accessor:"getLineColor",defaultValue:ot,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(t,n){var i=n.index,o=n.target;return e.encodePickingColor(i,o)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.extruded,o=n.filled,r=n.wireframe,a=n.elevationScale,s=this.state,l=s.topModel,c=s.sideModel,u=s.polygonTesselator,f=Object.assign({},t,{extruded:Boolean(i),elevationScale:a});c&&(c.setInstanceCount(u.instanceCount-1),c.setUniforms(f),r&&(c.setDrawMode(3),c.setUniforms({isWireframe:!0}).draw()),o&&(c.setDrawMode(6),c.setUniforms({isWireframe:!1}).draw())),l&&(l.setVertexCount(u.get("indices").length),l.setUniforms(f).draw())}},{key:"updateState",value:function(e){p()(u()(t.prototype),"updateState",this).call(this,e),this.updateGeometry(e);var n=e.props,i=e.oldProps,o=this.getAttributeManager();(n.fp64!==i.fp64||n.filled!==i.filled||n.extruded!==i.extruded)&&(this.state.models&&this.state.models.forEach(function(e){return e.delete()}),this.setState(this._getModels(this.context.gl)),o.invalidateAll())}},{key:"updateGeometry",value:function(e){var t=e.props,n=e.oldProps,i=e.changeFlags;if(i.dataChanged||t.fp64!==n.fp64||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){var o=this.state.polygonTesselator;o.updateGeometry({data:t.data,getGeometry:t.getPolygon,positionFormat:t.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:o.instanceCount,bufferLayout:o.bufferLayout}),this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(e){var t,n,i=this.props,o=i.id,r=i.filled,a=i.extruded;if(r){var s=this.getShaders(nt);s.defines.NON_INSTANCED_MODEL=1,t=new v.Model(e,Object.assign({},s,{id:"".concat(o,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0,shaderCache:this.context.shaderCache}))}return a&&((n=new v.Model(e,Object.assign({},this.getShaders(it),{id:"".concat(o,"-side"),geometry:new v.Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,1,0,1,0,0,1,0])}}}),instanceCount:0,isInstanced:1,shaderCache:this.context.shaderCache}))).userData.excludeAttributes={indices:!0}),{models:[n,t].filter(Boolean),topModel:t,sideModel:n}}},{key:"calculateIndices",value:function(e){var t=this.state.polygonTesselator;e.bufferLayout=t.indexLayout,e.value=t.get("indices")}},{key:"calculatePositions",value:function(e){var t=this.state.polygonTesselator;e.bufferLayout=t.bufferLayout,e.value=t.get("positions")}},{key:"calculatePositionsLow",value:function(e){var t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.polygonTesselator.get("positions64xyLow"):new Float32Array(2)}},{key:"calculateVertexValid",value:function(e){e.value=this.state.polygonTesselator.get("vertexValid")}},{key:"clearPickingColor",value:function(e){for(var t=this.decodePickingColor(e),n=this.state.polygonTesselator.bufferLayout,i=n[t],o=0,r=0;r<t;r++)o+=n[r];var a=this.getAttributeManager().attributes.pickingColors,s=a.value,l=o+i;s.fill(0,3*o,3*l),a.update({value:s})}}]),t}(g.Layer);lt.layerName="SolidPolygonLayer",lt.defaultProps=at;var ct=new v.PhongMaterial,ut={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,lineDashJustified:!1,fp64:!1,getPolygon:{type:"accessor",value:function(e){return e.polygon}},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},material:ct},ft=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"initializeState",value:function(){this.state={paths:[]}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props,n=e.changeFlags;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon))&&(this.state.paths=this._getPaths(t))}},{key:"getPickingInfo",value:function(e){var t=e.info;return Object.assign(t,{object:t.object&&t.object.object||t.object})}},{key:"_getPaths",value:function(e){var t=e.data,n=e.getPolygon,i=[],o="XY"===e.positionFormat?2:3,r=Object(g.createIterable)(t),a=r.iterable,s=r.objectInfo,l=!0,c=!1,u=void 0;try{for(var f,p=a[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var d=f.value;s.index++;var h=Qe(n(d,s),o),v=h.positions,y=h.holeIndices;if(y)for(var x=0;x<=y.length;x++){var m=v.subarray(y[x-1]||0,y[x]||v.length);i.push({path:m,object:d})}else i.push({path:v,object:d})}}catch(e){c=!0,u=e}finally{try{l||null==p.return||p.return()}finally{if(c)throw u}}return i}},{key:"_getAccessor",value:function(e){return"function"==typeof e?function(t){return e(t.object)}:e}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.stroked,i=e.filled,o=e.extruded,r=e.wireframe,a=e.elevationScale,s=e.transitions,l=this.props,c=l.lineWidthUnits,u=l.lineWidthScale,f=l.lineWidthMinPixels,p=l.lineWidthMaxPixels,d=l.lineJointRounded,h=l.lineMiterLimit,g=l.lineDashJustified,v=l.fp64,y=this.props,x=y.getFillColor,m=y.getLineColor,P=y.getLineWidth,_=y.getLineDashArray,b=y.getElevation,w=y.getPolygon,S=y.updateTriggers,C=y.material,L=this.state.paths,A=this.getSubLayerClass("fill",lt),k=this.getSubLayerClass("stroke",Ne),M=this.shouldRenderSubLayer("fill",L)&&new A({extruded:o,elevationScale:a,fp64:v,filled:i,wireframe:r,getElevation:b,getFillColor:x,getLineColor:m,material:C,transitions:s},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:S.getPolygon,getElevation:S.getElevation,getFillColor:S.getFillColor,getLineColor:S.getLineColor}}),{data:t,getPolygon:w});return[!o&&M,!o&&n&&this.shouldRenderSubLayer("stroke",L)&&new k({fp64:v,widthUnits:c,widthScale:u,widthMinPixels:f,widthMaxPixels:p,rounded:d,miterLimit:h,dashJustified:g,transitions:s&&{getWidth:s.getLineWidth,getColor:s.getLineColor,getPath:s.getPolygon},getColor:this._getAccessor(m),getWidth:this._getAccessor(P),getDashArray:this._getAccessor(_)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:S.getLineWidth,getColor:S.getLineColor,getDashArray:S.getLineDashArray}}),{data:L,getPath:function(e){return e.path}}),o&&M]}}]),t}(g.CompositeLayer);function pt(e,t,n){var i=e.type,o=e.coordinates,r=t.pointFeatures,a=t.lineFeatures,s=t.polygonFeatures,l=t.polygonOutlineFeatures;if(function(e,t){var n=ht[e];g.log.assert(n,"Unknown GeoJSON type ".concat(e));for(;t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(i,o))switch(i){case"Point":r.push({geometry:e,sourceFeature:n});break;case"MultiPoint":o.forEach(function(e){r.push({geometry:{type:"Point",coordinates:e},sourceFeature:n})});break;case"LineString":a.push({geometry:e,sourceFeature:n});break;case"MultiLineString":o.forEach(function(e){a.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})});break;case"Polygon":s.push({geometry:e,sourceFeature:n}),o.forEach(function(e){l.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})});break;case"MultiPolygon":o.forEach(function(e){s.push({geometry:{type:"Polygon",coordinates:e},sourceFeature:n}),e.forEach(function(e){l.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})})})}else g.log.warn("".concat(i," coordinates are malformed"))()}function dt(e){return e.sourceFeature.feature}ft.layerName="PolygonLayer",ft.defaultProps=ut;var ht={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};var gt=new v.PhongMaterial,vt={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,lineDashJustified:!1,fp64:!1,getLineColor:{type:"accessor",value:[0,0,0,255]},getFillColor:{type:"accessor",value:[0,0,0,255]},getRadius:{type:"accessor",value:1},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},material:gt};function yt(e){return e.geometry.coordinates}function xt(e){return"function"!=typeof e?e:function(t){return e(dt(t))}}var mt=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"initializeState",value:function(){this.state={features:{}}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props;if(e.changeFlags.dataChanged){var n=function(e){if(Array.isArray(e))return e;switch(g.log.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return g.log.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(t.data);this.state.features=function(e){for(var t={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},n=0;n<e.length;n++){var i=e[n];g.log.assert(i&&i.geometry,"GeoJSON does not have geometry");var o=i.geometry,r={feature:i,index:n};if("GeometryCollection"===o.type){g.log.assert(Array.isArray(o.geometries),"GeoJSON does not have geometries array");for(var a=o.geometries,s=0;s<a.length;s++)pt(a[s],t,r)}else pt(o,t,r)}return t}(n)}}},{key:"getPickingInfo",value:function(e){var t,n=e.info;e.sourceLayer;return Object.assign(n,{object:n.object?dt(n.object):n.object,index:n.object?(t=n.object,t.sourceFeature.index):n.index})}},{key:"renderLayers",value:function(){var e=this.state.features,t=e.pointFeatures,n=e.lineFeatures,i=e.polygonFeatures,o=e.polygonOutlineFeatures,r=this.props,a=r.stroked,s=r.filled,l=r.extruded,c=r.wireframe,u=r.material,f=r.transitions,p=this.props,d=p.lineWidthUnits,h=p.lineWidthScale,g=p.lineWidthMinPixels,v=p.lineWidthMaxPixels,y=p.lineJointRounded,x=p.lineMiterLimit,m=p.pointRadiusScale,P=p.pointRadiusMinPixels,_=p.pointRadiusMaxPixels,b=p.elevationScale,w=p.lineDashJustified,S=p.fp64,C=this.props,L=C.getLineColor,A=C.getFillColor,k=C.getRadius,M=C.getLineWidth,z=C.getLineDashArray,E=C.getElevation,F=C.updateTriggers,O=this.getSubLayerClass("polygons-fill",lt),j=this.getSubLayerClass("polygons-stroke",Ne),I=this.getSubLayerClass("line-strings",Ne),T=this.getSubLayerClass("points",be),R=this.shouldRenderSubLayer("polygons-fill",i)&&new O({fp64:S,extruded:l,elevationScale:b,filled:s,wireframe:c,material:u,getElevation:xt(E),getFillColor:xt(A),getLineColor:xt(L),transitions:f&&{getPolygon:f.geometry,getElevation:f.getElevation,getFillColor:f.getFillColor,getLineColor:f.getLineColor}},this.getSubLayerProps({id:"polygons-fill",updateTriggers:{getElevation:F.getElevation,getFillColor:F.getFillColor,getLineColor:F.getLineColor}}),{data:i,getPolygon:yt});return[!l&&R,!l&&a&&this.shouldRenderSubLayer("polygons-stroke",o)&&new j({fp64:S,widthUnits:d,widthScale:h,widthMinPixels:g,widthMaxPixels:v,rounded:y,miterLimit:x,dashJustified:w,getColor:xt(L),getWidth:xt(M),getDashArray:xt(z),transitions:f&&{getPath:f.geometry,getColor:f.getLineColor,getWidth:f.getLineWidth}},this.getSubLayerProps({id:"polygons-stroke",updateTriggers:{getColor:F.getLineColor,getWidth:F.getLineWidth,getDashArray:F.getLineDashArray}}),{data:o,getPath:yt}),this.shouldRenderSubLayer("linestrings",n)&&new I({fp64:S,widthUnits:d,widthScale:h,widthMinPixels:g,widthMaxPixels:v,rounded:y,miterLimit:x,dashJustified:w,getColor:xt(L),getWidth:xt(M),getDashArray:xt(z),transitions:f&&{getPath:f.geometry,getColor:f.getLineColor,getWidth:f.getLineWidth}},this.getSubLayerProps({id:"line-strings",updateTriggers:{getColor:F.getLineColor,getWidth:F.getLineWidth,getDashArray:F.getLineDashArray}}),{data:n,getPath:yt}),this.shouldRenderSubLayer("points",t)&&new T({fp64:S,stroked:a,filled:s,radiusScale:m,radiusMinPixels:P,radiusMaxPixels:_,lineWidthUnits:d,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:v,getFillColor:xt(A),getLineColor:xt(L),getRadius:xt(k),getLineWidth:xt(M),transitions:f&&{getPosition:f.geometry,getFillColor:f.getFillColor,getLineColor:f.getLineColor,getRadius:f.getRadius,getLineWidth:f.getLineWidth}},this.getSubLayerProps({id:"points",updateTriggers:{getFillColor:F.getFillColor,getLineColor:F.getLineColor,getRadius:F.getRadius,getLineWidth:F.getLineWidth}}),{data:t,getPosition:yt}),l&&R]}}]),t}(g.CompositeLayer);mt.layerName="GeoJsonLayer",mt.defaultProps=vt;var Pt=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"getShaders",value:function(){return Object.assign({},p()(u()(t.prototype),"getShaders",this).call(this),{vs:"#define SHADER_NAME multi-icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform vec2 iconsTextureDim;\nuniform float gamma;\nuniform float opacity;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying float vGamma;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale),\n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  \n  if (billboard)  {\n    pixelOffset.y *= -1.0;\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, vec3(0.0)); \n    gl_Position.xy += project_pixel_size_to_clipspace(pixelOffset);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset_common); \n  }\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vTextureCoords.y = 1.0 - vTextureCoords.y;\n\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  vGamma = gamma / (sizeScale * iconSize.y);\n}\n",fs:"#define SHADER_NAME multi-icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform sampler2D iconsTexture;\nuniform float buffer;\nuniform bool sdf;\n\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying float vGamma;\n\nconst float MIN_ALPHA = 0.05;\n\nvoid main(void) {\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  \n  float alpha = texColor.a;\n  if (sdf) {\n    float distance = texture2D(iconsTexture, vTextureCoords).a;\n    alpha = smoothstep(buffer - vGamma, buffer + vGamma, distance);\n  }\n  float a = alpha * vColor.a;\n\n  if (a < MIN_ALPHA) {\n    discard;\n  }\n\n  gl_FragColor = vec4(vColor.rgb, a);\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n"})}},{key:"initializeState",value:function(){p()(u()(t.prototype),"initializeState",this).call(this),this.getAttributeManager().addInstanced({instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(e){p()(u()(t.prototype),"updateState",this).call(this,e);var n=e.changeFlags;n.updateTriggersChanged&&(n.updateTriggersChanged.getAnchorX||n.updateTriggersChanged.getAnchorY)&&this.getAttributeManager().invalidate("instanceOffsets")}},{key:"draw",value:function(e){var n=e.uniforms,i=this.props.sdf;p()(u()(t.prototype),"draw",this).call(this,{uniforms:Object.assign({},n,{buffer:.75,gamma:.2,sdf:Boolean(i)})})}},{key:"calculateInstanceOffsets",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.props,r=o.data,a=o.iconMapping,s=o.getIcon,l=o.getAnchorX,c=o.getAnchorY,u=o.getLengthOfQueue,f=o.getShiftInQueue,p=e.value,d=n*e.size,h=Object(g.createIterable)(r,n,i).iterable,v=!0,y=!1,x=void 0;try{for(var m,P=h[Symbol.iterator]();!(v=(m=P.next()).done);v=!0){var _=m.value,b=a[s(_)]||{},w=u(_),S=f(_);p[d++]=(l(_)-1)*w/2+b.width/2+S||0,p[d++]=b.height/2*c(_)||0}}catch(e){y=!0,x=e}finally{try{v||null==P.return||P.return()}finally{if(y)throw x}}}},{key:"calculateInstancePickingColors",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.props,r=o.data,a=o.getPickingIndex,s=e.value,l=n*e.size,c=[],u=Object(g.createIterable)(r,n,i).iterable,f=!0,p=!1,d=void 0;try{for(var h,v=u[Symbol.iterator]();!(f=(h=v.next()).done);f=!0){var y=a(h.value);this.encodePickingColor(y,c),s[l++]=c[0],s[l++]=c[1],s[l++]=c[2]}}catch(e){p=!0,d=e}finally{try{f||null==v.return||v.return()}finally{if(p)throw d}}}}]),t}(ce);Pt.layerName="MultiIconLayer",Pt.defaultProps={getShiftInQueue:{type:"accessor",value:function(e){return e.shift||0}},getLengthOfQueue:{type:"accessor",value:function(e){return e.len||1}},getAnchorX:{type:"accessor",value:function(e){return e.anchorX||0}},getAnchorY:{type:"accessor",value:function(e){return e.anchorY||0}},getPixelOffset:{type:"accessor",value:[0,0]},getPickingIndex:{type:"accessor",value:function(e){return e.objectIndex}}};var _t=n(14),bt=n.n(_t);var wt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;o()(this,e),this.limit=t,this.clear()}return a()(e,[{key:"clear",value:function(){this._cache={},this._order=[]}},{key:"get",value:function(e){var t=this._cache[e];return t&&(this._deleteOrder(e),this._appendOrder(e)),t}},{key:"set",value:function(e,t){this._cache[e]?(this.delete(e),this._cache[e]=t,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=t,this._appendOrder(e))}},{key:"delete",value:function(e){this._cache[e]&&(this._deleteCache(e),this._deleteOrder(e))}},{key:"_deleteCache",value:function(e){delete this._cache[e]}},{key:"_deleteOrder",value:function(e){var t=this._order.findIndex(function(t){return t===e});t>=0&&this._order.splice(t,1)}},{key:"_appendOrder",value:function(e){this._order.push(e)}}]),e}();var St=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}(),Ct="Monaco, monospace",Lt="normal",At=64,kt=2,Mt=.25,zt=3,Et=new wt(3),Ft=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function Ot(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}function jt(e,t,n,i){e.font="".concat(i," ").concat(n,"px ").concat(t),e.fillStyle="#000",e.textBaseline="baseline",e.textAlign="left"}var It=function(){function e(t){o()(this,e),this.gl=t,this.props={fontFamily:Ct,fontWeight:Lt,characterSet:St,fontSize:At,buffer:kt,sdf:!1,cutoff:Mt,radius:zt},this._key=null,this._texture=new v.Texture2D(this.gl)}return a()(e,[{key:"finalize",value:function(){this._texture.delete()}},{key:"setProps",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ft.forEach(function(n){n in t&&(e.props[n]=t[n])});var n=this._key;this._key=this._getKey();var i=function(e,t){var n=Et.get(e);if(!n)return t;var i=[],o=n.mapping,r=Object.keys(o);r=new Set(r);var a=t;return a instanceof Array&&(a=new Set(a)),a.forEach(function(e){r.has(e)||i.push(e)}),i}(this._key,this.props.characterSet),o=Et.get(this._key);if(o&&0===i.length)this._key!==n&&this._updateTexture(o);else{var r=this._generateFontAtlas(this._key,i,o);this._updateTexture(r),Et.set(this._key,r)}}},{key:"_updateTexture",value:function(e){var t,n=e.data,i=e.width,o=e.height;this._texture.width===i&&this._texture.height===o||this._texture.resize({width:i,height:o}),this._texture.setImageData({data:n,width:i,height:o,parameters:(t={},w()(t,10242,33071),w()(t,10243,33071),w()(t,37440,!0),t)}),this._texture.generateMipmap()}},{key:"_generateFontAtlas",value:function(e,t,n){var i=this.props,o=i.fontFamily,r=i.fontWeight,a=i.fontSize,s=i.buffer,l=i.sdf,c=i.radius,u=i.cutoff,f=n&&n.data;f||((f=document.createElement("canvas")).width=1024);var p=f.getContext("2d");jt(p,o,a,r);var d=function(e){var t=e.characterSet,n=e.getFontWidth,i=e.fontHeight,o=e.buffer,r=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,l=e.xOffset,c=void 0===l?0:l,u=e.yOffset,f=void 0===u?0:u,p=0,d=c;Array.from(t).forEach(function(e,t){if(!s[e]){var a=n(e,t);d+a+2*o>r&&(d=0,p++),s[e]={x:d+o,y:f+p*(i+2*o)+o,width:a,height:i,mask:!0},d+=a+2*o}});var h,g=i+2*o;return{mapping:s,xOffset:d,yOffset:f+p*g,canvasHeight:(h=f+(p+1)*g,Math.pow(2,Math.ceil(Math.log2(h))))}}(Object.assign({getFontWidth:function(e){return p.measureText(e).width},fontHeight:1.2*a,buffer:s,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),h=d.mapping,g=d.canvasHeight,v=d.xOffset,y=d.yOffset;if(f.height!==g){var x=p.getImageData(0,0,f.width,f.height);f.height=g,p.putImageData(x,0,0)}if(jt(p,o,a,r),l){var m=new bt.a(a,s,c,u,o,r),P=p.getImageData(0,0,m.size,m.size),_=!0,b=!1,w=void 0;try{for(var S,C=t[Symbol.iterator]();!(_=(S=C.next()).done);_=!0){var L=S.value;Ot(m.draw(L),P),p.putImageData(P,h[L].x-s,h[L].y-s)}}catch(e){b=!0,w=e}finally{try{_||null==C.return||C.return()}finally{if(b)throw w}}}else{var A=!0,k=!1,M=void 0;try{for(var z,E=t[Symbol.iterator]();!(A=(z=E.next()).done);A=!0){var F=z.value;p.fillText(F,h[F].x,h[F].y+.9*a)}}catch(e){k=!0,M=e}finally{try{A||null==E.return||E.return()}finally{if(k)throw M}}}return{xOffset:v,yOffset:y,mapping:h,data:f,width:f.width,height:f.height}}},{key:"_getKey",value:function(){var e=this.props,t=e.gl,n=e.fontFamily,i=e.fontWeight,o=e.fontSize,r=e.buffer,a=e.sdf,s=e.radius,l=e.cutoff;return a?"".concat(t," ").concat(n," ").concat(i," ").concat(o," ").concat(r," ").concat(s," ").concat(l):"".concat(t," ").concat(n," ").concat(i," ").concat(o," ").concat(r)}},{key:"texture",get:function(){return this._texture}},{key:"mapping",get:function(){var e=Et.get(this._key);return e&&e.mapping}},{key:"scale",get:function(){return 1.2}}]),e}(),Tt={fontSize:At,buffer:kt,sdf:!1,radius:zt,cutoff:Mt},Rt={start:1,middle:0,end:-1},Wt={top:1,center:0,bottom:-1},Nt=["fontSize","buffer","sdf","radius","cutoff"],Dt={fp64:!1,billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,characterSet:St,fontFamily:Ct,fontWeight:Lt,fontSettings:{},getText:{type:"accessor",value:function(e){return e.text}},getPosition:{type:"accessor",value:function(e){return e.position}},getColor:{type:"accessor",value:[0,0,0,255]},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]}},Ut=function(e){function t(){return o()(this,t),l()(this,u()(t).apply(this,arguments))}return h()(t,e),a()(t,[{key:"initializeState",value:function(){this.state={fontAtlasManager:new It(this.context.gl)}}},{key:"updateState",value:function(e){var t=e.props,n=e.oldProps,i=e.changeFlags,o=this.fontChanged(n,t);o&&this.updateFontAtlas({oldProps:n,props:t}),(i.dataChanged||o||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this.transformStringToLetters()}},{key:"finalizeState",value:function(){p()(u()(t.prototype),"finalizeState",this).call(this),this.state.fontAtlasManager.finalize()}},{key:"updateFontAtlas",value:function(e){e.oldProps;var t=e.props,n=t.characterSet,i=t.fontSettings,o=t.fontFamily,r=t.fontWeight,a=this.state.fontAtlasManager;a.setProps(Object.assign({},Tt,i,{characterSet:n,fontFamily:o,fontWeight:r}));var s=a.scale,l=a.texture,c=a.mapping;this.setState({scale:s,iconAtlas:l,iconMapping:c}),this.setNeedsRedraw(!0)}},{key:"fontChanged",value:function(e,t){if(e.fontFamily!==t.fontFamily||e.characterSet!==t.characterSet||e.fontWeight!==t.fontWeight)return!0;if(e.fontSettings===t.fontSettings)return!1;var n=e.fontSettings||{},i=t.fontSettings||{};return Nt.some(function(e){return n[e]!==i[e]})}},{key:"getPickingInfo",value:function(e){var t=e.info;return Object.assign(t,{object:t.index>=0?this.props.data[t.index]:null})}},{key:"transformStringToLetters",value:function(){var e=this.props,t=e.data,n=e.getText,i=this.state.iconMapping,o=[],r=Object(g.createIterable)(t),a=r.iterable,s=r.objectInfo,l=!0,c=!1,u=void 0;try{for(var f,p=function(){var e=f.value;s.index++;var t=n(e,s);if(t){var r=Array.from(t),a=[0],l=0;r.forEach(function(n,r){var c={text:n,index:r,offsets:a,len:t.length,object:e,objectIndex:s.index},u=i[n];u?l+=u.width:(g.log.warn("Missing character: ".concat(n))(),l+=32),a.push(l),o.push(c)})}},d=a[Symbol.iterator]();!(l=(f=d.next()).done);l=!0)p()}catch(e){c=!0,u=e}finally{try{l||null==d.return||d.return()}finally{if(c)throw u}}this.setState({data:o})}},{key:"getLetterOffset",value:function(e){return e.offsets[e.index]}},{key:"getTextLength",value:function(e){return e.offsets[e.offsets.length-1]}},{key:"_getAccessor",value:function(e){return"function"==typeof e?function(t){return e(t.object)}:e}},{key:"getAnchorXFromTextAnchor",value:function(e){return function(t){var n="function"==typeof e?e(t.object):e;if(!Rt.hasOwnProperty(n))throw new Error("Invalid text anchor parameter: ".concat(n));return Rt[n]}}},{key:"getAnchorYFromAlignmentBaseline",value:function(e){return function(t){var n="function"==typeof e?e(t.object):e;if(!Wt.hasOwnProperty(n))throw new Error("Invalid alignment baseline parameter: ".concat(n));return Wt[n]}}},{key:"renderLayers",value:function(){var e=this,t=this.state,n=t.data,i=t.scale,o=t.iconAtlas,r=t.iconMapping,a=this.props,s=a.getPosition,l=a.getColor,c=a.getSize,u=a.getAngle,f=a.getTextAnchor,p=a.getAlignmentBaseline,d=a.getPixelOffset,h=a.fp64,g=a.billboard,v=a.sdf,y=a.sizeScale,x=a.sizeUnits,m=a.sizeMinPixels,P=a.sizeMaxPixels,_=a.transitions,b=a.updateTriggers;return new(this.getSubLayerClass("characters",Pt))({sdf:v,iconAtlas:o,iconMapping:r,getPosition:function(e){return s(e.object)},getColor:this._getAccessor(l),getSize:this._getAccessor(c),getAngle:this._getAccessor(u),getAnchorX:this.getAnchorXFromTextAnchor(f),getAnchorY:this.getAnchorYFromAlignmentBaseline(p),getPixelOffset:this._getAccessor(d),fp64:h,billboard:g,sizeScale:y*i,sizeUnits:x,sizeMinPixels:m*i,sizeMaxPixels:P*i,transitions:_&&{getPosition:_.getPosition,getAngle:_.getAngle,getColor:_.getColor,getSize:_.getSize,getPixelOffset:b.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getPosition:b.getPosition,getAngle:b.getAngle,getColor:b.getColor,getSize:b.getSize,getPixelOffset:b.getPixelOffset,getAnchorX:b.getTextAnchor,getAnchorY:b.getAlignmentBaseline}}),{data:n,getIcon:function(e){return e.text},getShiftInQueue:function(t){return e.getLetterOffset(t)},getLengthOfQueue:function(t){return e.getTextLength(t)}})}}]),t}(g.CompositeLayer);Ut.layerName="TextLayer",Ut.defaultProps=Dt,n.d(t,"ArcLayer",function(){return _}),n.d(t,"BitmapLayer",function(){return Q}),n.d(t,"IconLayer",function(){return ce}),n.d(t,"LineLayer",function(){return pe}),n.d(t,"PointCloudLayer",function(){return xe}),n.d(t,"ScatterplotLayer",function(){return be}),n.d(t,"ColumnLayer",function(){return ze}),n.d(t,"GridCellLayer",function(){return Ee}),n.d(t,"PathLayer",function(){return Ne}),n.d(t,"PolygonLayer",function(){return ft}),n.d(t,"GeoJsonLayer",function(){return mt}),n.d(t,"TextLayer",function(){return Ut}),n.d(t,"SolidPolygonLayer",function(){return lt}),n.d(t,"_MultiIconLayer",function(){return Pt})}])});