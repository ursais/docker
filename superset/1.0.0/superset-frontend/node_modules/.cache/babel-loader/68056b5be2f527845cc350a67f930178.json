{"ast":null,"code":"import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col } from 'src/common/components';\nimport { t } from '@superset-ui/core';\n\nimport Label from 'src/components/Label';\nimport Popover from 'src/components/Popover';\nimport PopoverSection from 'src/components/PopoverSection';\nimport Checkbox from 'src/components/Checkbox';\nimport ControlHeader from '../ControlHeader';\nimport SelectControl from './SelectControl';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst spatialTypes = {\n  latlong: 'latlong',\n  delimited: 'delimited',\n  geohash: 'geohash' };\n\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  animation: PropTypes.bool,\n  choices: PropTypes.array };\n\n\nconst defaultProps = {\n  onChange: () => {},\n  animation: true,\n  choices: [] };\n\n\nexport default class SpatialControl extends React.Component {\n  constructor(props) {var _context, _context2, _context3;\n    super(props);\n    const v = props.value || {};\n    let defaultCol;\n    if (props.choices.length > 0) {\n      defaultCol = props.choices[0][0];\n    }\n    this.state = {\n      type: v.type || spatialTypes.latlong,\n      delimiter: v.delimiter || ',',\n      latCol: v.latCol || defaultCol,\n      lonCol: v.lonCol || defaultCol,\n      lonlatCol: v.lonlatCol || defaultCol,\n      reverseCheckbox: v.reverseCheckbox || false,\n      geohashCol: v.geohashCol || defaultCol,\n      value: null,\n      errors: [] };\n\n    this.toggleCheckbox = _bindInstanceProperty(_context = this.toggleCheckbox).call(_context, this);\n    this.onChange = _bindInstanceProperty(_context2 = this.onChange).call(_context2, this);\n    this.renderReverseCheckbox = _bindInstanceProperty(_context3 = this.renderReverseCheckbox).call(_context3, this);\n  }\n\n  componentDidMount() {\n    this.onChange();\n  }\n\n  onChange() {\n    const { type } = this.state;\n    const value = { type };\n    const errors = [];\n    const errMsg = t('Invalid lat/long configuration.');\n    if (type === spatialTypes.latlong) {\n      value.latCol = this.state.latCol;\n      value.lonCol = this.state.lonCol;\n      if (!value.lonCol || !value.latCol) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.delimited) {\n      value.lonlatCol = this.state.lonlatCol;\n      value.delimiter = this.state.delimiter;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.lonlatCol || !value.delimiter) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.geohash) {\n      value.geohashCol = this.state.geohashCol;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.geohashCol) {\n        errors.push(errMsg);\n      }\n    }\n    this.setState({ value, errors });\n    this.props.onChange(value, errors);\n  }\n\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n\n  toggleCheckbox() {\n    this.setState(\n    prevState => ({ reverseCheckbox: !prevState.reverseCheckbox }),\n    this.onChange);\n\n  }\n\n  renderLabelContent() {\n    if (this.state.errors.length > 0) {\n      return 'N/A';\n    }\n    if (this.state.type === spatialTypes.latlong) {\n      return `${this.state.lonCol} | ${this.state.latCol}`;\n    }\n    if (this.state.type === spatialTypes.delimited) {\n      return `${this.state.lonlatCol}`;\n    }\n    if (this.state.type === spatialTypes.geohash) {\n      return `${this.state.geohashCol}`;\n    }\n    return null;\n  }\n\n  renderSelect(name, type) {\n    return (\n      ___EmotionJSX(SelectControl, {\n        name: name,\n        choices: this.props.choices,\n        value: this.state[name],\n        clearable: false,\n        onFocus: () => {\n          this.setType(type);\n        },\n        onChange: value => {\n          this.setState({ [name]: value }, this.onChange);\n        } }));\n\n\n  }\n\n  renderReverseCheckbox() {\n    return (\n      ___EmotionJSX(\"span\", null,\n      t('Reverse lat/long '),\n      ___EmotionJSX(Checkbox, {\n        checked: this.state.reverseCheckbox,\n        onChange: this.toggleCheckbox })));\n\n\n\n  }\n\n  renderPopoverContent() {var _context4, _context5, _context6;\n    return (\n      ___EmotionJSX(\"div\", { style: { width: '300px' } },\n      ___EmotionJSX(PopoverSection, {\n        title: t('Longitude & Latitude columns'),\n        isSelected: this.state.type === spatialTypes.latlong,\n        onSelect: _bindInstanceProperty(_context4 = this.setType).call(_context4, this, spatialTypes.latlong) },\n\n      ___EmotionJSX(Row, { gutter: 16 },\n      ___EmotionJSX(Col, { xs: 24, md: 12 }, \"Longitude\",\n\n      this.renderSelect('lonCol', spatialTypes.latlong)),\n\n      ___EmotionJSX(Col, { xs: 24, md: 12 }, \"Latitude\",\n\n      this.renderSelect('latCol', spatialTypes.latlong)))),\n\n\n\n      ___EmotionJSX(PopoverSection, {\n        title: t('Delimited long & lat single column'),\n        info: t(\n        'Multiple formats accepted, look the geopy.points ' +\n        'Python library for more details'),\n\n        isSelected: this.state.type === spatialTypes.delimited,\n        onSelect: _bindInstanceProperty(_context5 = this.setType).call(_context5, this, spatialTypes.delimited) },\n\n      ___EmotionJSX(Row, { gutter: 16 },\n      ___EmotionJSX(Col, { xs: 24, md: 12 },\n      t('Column'),\n      this.renderSelect('lonlatCol', spatialTypes.delimited)),\n\n      ___EmotionJSX(Col, { xs: 24, md: 12 },\n      this.renderReverseCheckbox()))),\n\n\n\n      ___EmotionJSX(PopoverSection, {\n        title: t('Geohash'),\n        isSelected: this.state.type === spatialTypes.geohash,\n        onSelect: _bindInstanceProperty(_context6 = this.setType).call(_context6, this, spatialTypes.geohash) },\n\n      ___EmotionJSX(Row, { gutter: 16 },\n      ___EmotionJSX(Col, { xs: 24, md: 12 }, \"Column\",\n\n      this.renderSelect('geohashCol', spatialTypes.geohash)),\n\n      ___EmotionJSX(Col, { xs: 24, md: 12 },\n      this.renderReverseCheckbox())))));\n\n\n\n\n\n  }\n\n  render() {\n    return (\n      ___EmotionJSX(\"div\", null,\n      ___EmotionJSX(ControlHeader, this.props),\n      ___EmotionJSX(Popover, {\n        content: this.renderPopoverContent(),\n        placement: \"topLeft\" // so that popover doesn't move when label changes\n        , trigger: \"click\" },\n\n      ___EmotionJSX(Label, { className: \"pointer\" }, this.renderLabelContent()))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nSpatialControl.propTypes = propTypes;\nSpatialControl.defaultProps = defaultProps;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(spatialTypes, \"spatialTypes\", \"/app/superset-frontend/src/explore/components/controls/SpatialControl.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/controls/SpatialControl.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/explore/components/controls/SpatialControl.jsx\");reactHotLoader.register(SpatialControl, \"SpatialControl\", \"/app/superset-frontend/src/explore/components/controls/SpatialControl.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/SpatialControl.jsx"],"names":["React","PropTypes","Row","Col","t","Label","Popover","PopoverSection","Checkbox","ControlHeader","SelectControl","spatialTypes","latlong","delimited","geohash","propTypes","onChange","func","value","object","animation","bool","choices","array","defaultProps","SpatialControl","Component","constructor","props","v","defaultCol","length","state","type","delimiter","latCol","lonCol","lonlatCol","reverseCheckbox","geohashCol","errors","toggleCheckbox","renderReverseCheckbox","componentDidMount","errMsg","push","setState","setType","prevState","renderLabelContent","renderSelect","name","renderPopoverContent","width","render"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col } from 'src/common/components';\nimport { t } from '@superset-ui/core';\n\nimport Label from 'src/components/Label';\nimport Popover from 'src/components/Popover';\nimport PopoverSection from 'src/components/PopoverSection';\nimport Checkbox from 'src/components/Checkbox';\nimport ControlHeader from '../ControlHeader';\nimport SelectControl from './SelectControl';\n\nconst spatialTypes = {\n  latlong: 'latlong',\n  delimited: 'delimited',\n  geohash: 'geohash',\n};\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  animation: PropTypes.bool,\n  choices: PropTypes.array,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  animation: true,\n  choices: [],\n};\n\nexport default class SpatialControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const v = props.value || {};\n    let defaultCol;\n    if (props.choices.length > 0) {\n      defaultCol = props.choices[0][0];\n    }\n    this.state = {\n      type: v.type || spatialTypes.latlong,\n      delimiter: v.delimiter || ',',\n      latCol: v.latCol || defaultCol,\n      lonCol: v.lonCol || defaultCol,\n      lonlatCol: v.lonlatCol || defaultCol,\n      reverseCheckbox: v.reverseCheckbox || false,\n      geohashCol: v.geohashCol || defaultCol,\n      value: null,\n      errors: [],\n    };\n    this.toggleCheckbox = this.toggleCheckbox.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.renderReverseCheckbox = this.renderReverseCheckbox.bind(this);\n  }\n\n  componentDidMount() {\n    this.onChange();\n  }\n\n  onChange() {\n    const { type } = this.state;\n    const value = { type };\n    const errors = [];\n    const errMsg = t('Invalid lat/long configuration.');\n    if (type === spatialTypes.latlong) {\n      value.latCol = this.state.latCol;\n      value.lonCol = this.state.lonCol;\n      if (!value.lonCol || !value.latCol) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.delimited) {\n      value.lonlatCol = this.state.lonlatCol;\n      value.delimiter = this.state.delimiter;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.lonlatCol || !value.delimiter) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.geohash) {\n      value.geohashCol = this.state.geohashCol;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.geohashCol) {\n        errors.push(errMsg);\n      }\n    }\n    this.setState({ value, errors });\n    this.props.onChange(value, errors);\n  }\n\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n\n  toggleCheckbox() {\n    this.setState(\n      prevState => ({ reverseCheckbox: !prevState.reverseCheckbox }),\n      this.onChange,\n    );\n  }\n\n  renderLabelContent() {\n    if (this.state.errors.length > 0) {\n      return 'N/A';\n    }\n    if (this.state.type === spatialTypes.latlong) {\n      return `${this.state.lonCol} | ${this.state.latCol}`;\n    }\n    if (this.state.type === spatialTypes.delimited) {\n      return `${this.state.lonlatCol}`;\n    }\n    if (this.state.type === spatialTypes.geohash) {\n      return `${this.state.geohashCol}`;\n    }\n    return null;\n  }\n\n  renderSelect(name, type) {\n    return (\n      <SelectControl\n        name={name}\n        choices={this.props.choices}\n        value={this.state[name]}\n        clearable={false}\n        onFocus={() => {\n          this.setType(type);\n        }}\n        onChange={value => {\n          this.setState({ [name]: value }, this.onChange);\n        }}\n      />\n    );\n  }\n\n  renderReverseCheckbox() {\n    return (\n      <span>\n        {t('Reverse lat/long ')}\n        <Checkbox\n          checked={this.state.reverseCheckbox}\n          onChange={this.toggleCheckbox}\n        />\n      </span>\n    );\n  }\n\n  renderPopoverContent() {\n    return (\n      <div style={{ width: '300px' }}>\n        <PopoverSection\n          title={t('Longitude & Latitude columns')}\n          isSelected={this.state.type === spatialTypes.latlong}\n          onSelect={this.setType.bind(this, spatialTypes.latlong)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              Longitude\n              {this.renderSelect('lonCol', spatialTypes.latlong)}\n            </Col>\n            <Col xs={24} md={12}>\n              Latitude\n              {this.renderSelect('latCol', spatialTypes.latlong)}\n            </Col>\n          </Row>\n        </PopoverSection>\n        <PopoverSection\n          title={t('Delimited long & lat single column')}\n          info={t(\n            'Multiple formats accepted, look the geopy.points ' +\n              'Python library for more details',\n          )}\n          isSelected={this.state.type === spatialTypes.delimited}\n          onSelect={this.setType.bind(this, spatialTypes.delimited)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              {t('Column')}\n              {this.renderSelect('lonlatCol', spatialTypes.delimited)}\n            </Col>\n            <Col xs={24} md={12}>\n              {this.renderReverseCheckbox()}\n            </Col>\n          </Row>\n        </PopoverSection>\n        <PopoverSection\n          title={t('Geohash')}\n          isSelected={this.state.type === spatialTypes.geohash}\n          onSelect={this.setType.bind(this, spatialTypes.geohash)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              Column\n              {this.renderSelect('geohashCol', spatialTypes.geohash)}\n            </Col>\n            <Col xs={24} md={12}>\n              {this.renderReverseCheckbox()}\n            </Col>\n          </Row>\n        </PopoverSection>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          content={this.renderPopoverContent()}\n          placement=\"topLeft\" // so that popover doesn't move when label changes\n          trigger=\"click\"\n        >\n          <Label className=\"pointer\">{this.renderLabelContent()}</Label>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nSpatialControl.propTypes = propTypes;\nSpatialControl.defaultProps = defaultProps;\n"]},"metadata":{},"sourceType":"module"}