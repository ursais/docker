{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _Object$entries from \"@babel/runtime-corejs3/core-js-stable/object/entries\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _Array$isArray from \"@babel/runtime-corejs3/core-js-stable/array/is-array\";import _isEmpty from \"lodash/isEmpty\";import _isEqual from \"lodash/isEqual\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { t } from '@superset-ui/core';\nimport getControlsForVizType from 'src/utils/getControlsForVizType';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { Tooltip } from 'src/components/Tooltip';\nimport ModalTrigger from '../ModalTrigger';\nimport TableView from '../TableView';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  origFormData: PropTypes.object.isRequired,\n  currentFormData: PropTypes.object.isRequired };\n\n\nfunction alterForComparison(value) {\n  // Considering `[]`, `{}`, `null` and `undefined` as identical\n  // for this purpose\n  if (value === undefined || value === null || value === '') {\n    return null;\n  }\n  if (typeof value === 'object') {\n    if (_Array$isArray(value) && value.length === 0) {\n      return null;\n    }\n    const keys = _Object$keys(value);\n    if (keys && keys.length === 0) {\n      return null;\n    }\n  }\n  return value;\n}\n\nexport default class AlteredSliceTag extends React.Component {\n  constructor(props) {\n    super(props);\n    const diffs = this.getDiffs(props);\n    const controlsMap = getControlsForVizType(this.props.origFormData.viz_type);\n    const rows = this.getRowsFromDiffs(diffs, controlsMap);\n\n    this.state = { rows, hasDiffs: !_isEmpty(diffs), controlsMap };\n  }\n\n  UNSAFE_componentWillReceiveProps(newProps) {\n    // Update differences if need be\n    if (_isEqual(this.props, newProps)) {\n      return;\n    }\n    const diffs = this.getDiffs(newProps);\n    this.setState(prevState => ({\n      rows: this.getRowsFromDiffs(diffs, prevState.controlsMap),\n      hasDiffs: !_isEmpty(diffs) }));\n\n  }\n\n  getRowsFromDiffs(diffs, controlsMap) {var _context;\n    return _mapInstanceProperty(_context = _Object$entries(diffs)).call(_context, ([key, diff]) => ({\n      control: controlsMap[key] && controlsMap[key].label || key,\n      before: this.formatValue(diff.before, key, controlsMap),\n      after: this.formatValue(diff.after, key, controlsMap) }));\n\n  }\n\n  getDiffs(props) {\n    // Returns all properties that differ in the\n    // current form data and the saved form data\n    const ofd = props.origFormData;\n    const cfd = props.currentFormData;\n\n    const fdKeys = _Object$keys(cfd);\n    const diffs = {};\n    _forEachInstanceProperty(fdKeys).call(fdKeys, fdKey => {var _context2;\n      if (!ofd[fdKey] && !cfd[fdKey]) {\n        return;\n      }\n      if (_includesInstanceProperty(_context2 = ['filters', 'having', 'having_filters', 'where']).call(_context2, fdKey)) {\n        return;\n      }\n      if (!this.isEqualish(ofd[fdKey], cfd[fdKey])) {\n        diffs[fdKey] = { before: ofd[fdKey], after: cfd[fdKey] };\n      }\n    });\n    return diffs;\n  }\n\n  isEqualish(val1, val2) {\n    return _isEqual(alterForComparison(val1), alterForComparison(val2));\n  }\n\n  formatValue(value, key, controlsMap) {var _controlsMap$key, _controlsMap$key2, _controlsMap$key3;\n    // Format display value based on the control type\n    // or the value type\n    if (value === undefined) {\n      return 'N/A';\n    }\n    if (value === null) {\n      return 'null';\n    }\n    if (((_controlsMap$key = controlsMap[key]) == null ? void 0 : _controlsMap$key.type) === 'AdhocFilterControl') {\n      if (!value.length) {\n        return '[]';\n      }\n      return _mapInstanceProperty(value).call(value,\n      v => {\n        const filterVal =\n        v.comparator && v.comparator.constructor === Array ?\n        `[${v.comparator.join(', ')}]` :\n        v.comparator;\n        return `${v.subject} ${v.operator} ${filterVal}`;\n      }).\n      join(', ');\n    }\n    if (((_controlsMap$key2 = controlsMap[key]) == null ? void 0 : _controlsMap$key2.type) === 'BoundsControl') {\n      return `Min: ${value[0]}, Max: ${value[1]}`;\n    }\n    if (((_controlsMap$key3 = controlsMap[key]) == null ? void 0 : _controlsMap$key3.type) === 'CollectionControl') {\n      return _mapInstanceProperty(value).call(value, v => safeStringify(v)).join(', ');\n    }\n    if (typeof value === 'boolean') {\n      return value ? 'true' : 'false';\n    }\n    if (value.constructor === Array) {\n      return value.length ? value.join(', ') : '[]';\n    }\n    if (typeof value === 'string' || typeof value === 'number') {\n      return value;\n    }\n    return safeStringify(value);\n  }\n\n  renderModalBody() {\n    const columns = [\n    {\n      accessor: 'control',\n      Header: 'Control' },\n\n    {\n      accessor: 'before',\n      Header: 'Before' },\n\n    {\n      accessor: 'after',\n      Header: 'After' }];\n\n\n\n    return (\n      ___EmotionJSX(TableView, {\n        columns: columns,\n        data: this.state.rows,\n        pageSize: 50,\n        className: \"table-condensed\" }));\n\n\n  }\n\n  renderTriggerNode() {\n    return (\n      ___EmotionJSX(Tooltip, { id: \"difference-tooltip\", title: t('Click to see difference') },\n      ___EmotionJSX(\"span\", {\n        className: \"label label-warning m-l-5\",\n        style: { fontSize: '12px' } },\n\n      t('Altered'))));\n\n\n\n  }\n\n  render() {\n    // Return nothing if there are no differences\n    if (!this.state.hasDiffs) {\n      return null;\n    }\n    // Render the label-warning 'Altered' tag which the user may\n    // click to open a modal containing a table summarizing the\n    // differences in the slice\n    return (\n      ___EmotionJSX(ModalTrigger, {\n        triggerNode: this.renderTriggerNode(),\n        modalTitle: t('Chart changes'),\n        modalBody: this.renderModalBody(),\n        responsive: true }));\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nAlteredSliceTag.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/components/AlteredSliceTag/index.jsx\");reactHotLoader.register(alterForComparison, \"alterForComparison\", \"/app/superset-frontend/src/components/AlteredSliceTag/index.jsx\");reactHotLoader.register(AlteredSliceTag, \"AlteredSliceTag\", \"/app/superset-frontend/src/components/AlteredSliceTag/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/components/AlteredSliceTag/index.jsx"],"names":["React","PropTypes","t","getControlsForVizType","safeStringify","Tooltip","ModalTrigger","TableView","propTypes","origFormData","object","isRequired","currentFormData","alterForComparison","value","undefined","length","keys","AlteredSliceTag","Component","constructor","props","diffs","getDiffs","controlsMap","viz_type","rows","getRowsFromDiffs","state","hasDiffs","UNSAFE_componentWillReceiveProps","newProps","setState","prevState","key","diff","control","label","before","formatValue","after","ofd","cfd","fdKeys","fdKey","isEqualish","val1","val2","type","v","filterVal","comparator","Array","join","subject","operator","renderModalBody","columns","accessor","Header","renderTriggerNode","fontSize","render"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { isEqual, isEmpty } from 'lodash';\nimport { t } from '@superset-ui/core';\nimport getControlsForVizType from 'src/utils/getControlsForVizType';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { Tooltip } from 'src/components/Tooltip';\nimport ModalTrigger from '../ModalTrigger';\nimport TableView from '../TableView';\n\nconst propTypes = {\n  origFormData: PropTypes.object.isRequired,\n  currentFormData: PropTypes.object.isRequired,\n};\n\nfunction alterForComparison(value) {\n  // Considering `[]`, `{}`, `null` and `undefined` as identical\n  // for this purpose\n  if (value === undefined || value === null || value === '') {\n    return null;\n  }\n  if (typeof value === 'object') {\n    if (Array.isArray(value) && value.length === 0) {\n      return null;\n    }\n    const keys = Object.keys(value);\n    if (keys && keys.length === 0) {\n      return null;\n    }\n  }\n  return value;\n}\n\nexport default class AlteredSliceTag extends React.Component {\n  constructor(props) {\n    super(props);\n    const diffs = this.getDiffs(props);\n    const controlsMap = getControlsForVizType(this.props.origFormData.viz_type);\n    const rows = this.getRowsFromDiffs(diffs, controlsMap);\n\n    this.state = { rows, hasDiffs: !isEmpty(diffs), controlsMap };\n  }\n\n  UNSAFE_componentWillReceiveProps(newProps) {\n    // Update differences if need be\n    if (isEqual(this.props, newProps)) {\n      return;\n    }\n    const diffs = this.getDiffs(newProps);\n    this.setState(prevState => ({\n      rows: this.getRowsFromDiffs(diffs, prevState.controlsMap),\n      hasDiffs: !isEmpty(diffs),\n    }));\n  }\n\n  getRowsFromDiffs(diffs, controlsMap) {\n    return Object.entries(diffs).map(([key, diff]) => ({\n      control: (controlsMap[key] && controlsMap[key].label) || key,\n      before: this.formatValue(diff.before, key, controlsMap),\n      after: this.formatValue(diff.after, key, controlsMap),\n    }));\n  }\n\n  getDiffs(props) {\n    // Returns all properties that differ in the\n    // current form data and the saved form data\n    const ofd = props.origFormData;\n    const cfd = props.currentFormData;\n\n    const fdKeys = Object.keys(cfd);\n    const diffs = {};\n    fdKeys.forEach(fdKey => {\n      if (!ofd[fdKey] && !cfd[fdKey]) {\n        return;\n      }\n      if (['filters', 'having', 'having_filters', 'where'].includes(fdKey)) {\n        return;\n      }\n      if (!this.isEqualish(ofd[fdKey], cfd[fdKey])) {\n        diffs[fdKey] = { before: ofd[fdKey], after: cfd[fdKey] };\n      }\n    });\n    return diffs;\n  }\n\n  isEqualish(val1, val2) {\n    return isEqual(alterForComparison(val1), alterForComparison(val2));\n  }\n\n  formatValue(value, key, controlsMap) {\n    // Format display value based on the control type\n    // or the value type\n    if (value === undefined) {\n      return 'N/A';\n    }\n    if (value === null) {\n      return 'null';\n    }\n    if (controlsMap[key]?.type === 'AdhocFilterControl') {\n      if (!value.length) {\n        return '[]';\n      }\n      return value\n        .map(v => {\n          const filterVal =\n            v.comparator && v.comparator.constructor === Array\n              ? `[${v.comparator.join(', ')}]`\n              : v.comparator;\n          return `${v.subject} ${v.operator} ${filterVal}`;\n        })\n        .join(', ');\n    }\n    if (controlsMap[key]?.type === 'BoundsControl') {\n      return `Min: ${value[0]}, Max: ${value[1]}`;\n    }\n    if (controlsMap[key]?.type === 'CollectionControl') {\n      return value.map(v => safeStringify(v)).join(', ');\n    }\n    if (typeof value === 'boolean') {\n      return value ? 'true' : 'false';\n    }\n    if (value.constructor === Array) {\n      return value.length ? value.join(', ') : '[]';\n    }\n    if (typeof value === 'string' || typeof value === 'number') {\n      return value;\n    }\n    return safeStringify(value);\n  }\n\n  renderModalBody() {\n    const columns = [\n      {\n        accessor: 'control',\n        Header: 'Control',\n      },\n      {\n        accessor: 'before',\n        Header: 'Before',\n      },\n      {\n        accessor: 'after',\n        Header: 'After',\n      },\n    ];\n\n    return (\n      <TableView\n        columns={columns}\n        data={this.state.rows}\n        pageSize={50}\n        className=\"table-condensed\"\n      />\n    );\n  }\n\n  renderTriggerNode() {\n    return (\n      <Tooltip id=\"difference-tooltip\" title={t('Click to see difference')}>\n        <span\n          className=\"label label-warning m-l-5\"\n          style={{ fontSize: '12px' }}\n        >\n          {t('Altered')}\n        </span>\n      </Tooltip>\n    );\n  }\n\n  render() {\n    // Return nothing if there are no differences\n    if (!this.state.hasDiffs) {\n      return null;\n    }\n    // Render the label-warning 'Altered' tag which the user may\n    // click to open a modal containing a table summarizing the\n    // differences in the slice\n    return (\n      <ModalTrigger\n        triggerNode={this.renderTriggerNode()}\n        modalTitle={t('Chart changes')}\n        modalBody={this.renderModalBody()}\n        responsive\n      />\n    );\n  }\n}\n\nAlteredSliceTag.propTypes = propTypes;\n"]},"metadata":{},"sourceType":"module"}