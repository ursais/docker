{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _parseInt from \"@babel/runtime-corejs3/core-js-stable/parse-int\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _findInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";import _Promise from \"@babel/runtime-corejs3/core-js-stable/promise\";import _Object$assign from \"@babel/runtime-corejs3/core-js-stable/object/assign\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport JSONbig from 'json-bigint';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport invert from 'lodash/invert';\nimport mapKeys from 'lodash/mapKeys';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\n\nimport { now } from '../../modules/dates';\nimport {\naddDangerToast as addDangerToastAction,\naddInfoToast as addInfoToastAction,\naddSuccessToast as addSuccessToastAction,\naddWarningToast as addWarningToastAction } from\n'../../messageToasts/actions/index';\nimport { getClientErrorObject } from '../../utils/getClientErrorObject';\nimport COMMON_ERR_MESSAGES from '../../utils/errorMessages';\n\nexport const RESET_STATE = 'RESET_STATE';\nexport const ADD_QUERY_EDITOR = 'ADD_QUERY_EDITOR';\nexport const UPDATE_QUERY_EDITOR = 'UPDATE_QUERY_EDITOR';\nexport const QUERY_EDITOR_SAVED = 'QUERY_EDITOR_SAVED';\nexport const CLONE_QUERY_TO_NEW_TAB = 'CLONE_QUERY_TO_NEW_TAB';\nexport const REMOVE_QUERY_EDITOR = 'REMOVE_QUERY_EDITOR';\nexport const MERGE_TABLE = 'MERGE_TABLE';\nexport const REMOVE_TABLE = 'REMOVE_TABLE';\nexport const END_QUERY = 'END_QUERY';\nexport const REMOVE_QUERY = 'REMOVE_QUERY';\nexport const EXPAND_TABLE = 'EXPAND_TABLE';\nexport const COLLAPSE_TABLE = 'COLLAPSE_TABLE';\nexport const QUERY_EDITOR_SETDB = 'QUERY_EDITOR_SETDB';\nexport const QUERY_EDITOR_SET_SCHEMA = 'QUERY_EDITOR_SET_SCHEMA';\nexport const QUERY_EDITOR_SET_SCHEMA_OPTIONS =\n'QUERY_EDITOR_SET_SCHEMA_OPTIONS';\nexport const QUERY_EDITOR_SET_TABLE_OPTIONS = 'QUERY_EDITOR_SET_TABLE_OPTIONS';\nexport const QUERY_EDITOR_SET_TITLE = 'QUERY_EDITOR_SET_TITLE';\nexport const QUERY_EDITOR_SET_AUTORUN = 'QUERY_EDITOR_SET_AUTORUN';\nexport const QUERY_EDITOR_SET_SQL = 'QUERY_EDITOR_SET_SQL';\nexport const QUERY_EDITOR_SET_QUERY_LIMIT = 'QUERY_EDITOR_SET_QUERY_LIMIT';\nexport const QUERY_EDITOR_SET_TEMPLATE_PARAMS =\n'QUERY_EDITOR_SET_TEMPLATE_PARAMS';\nexport const QUERY_EDITOR_SET_SELECTED_TEXT = 'QUERY_EDITOR_SET_SELECTED_TEXT';\nexport const QUERY_EDITOR_SET_FUNCTION_NAMES =\n'QUERY_EDITOR_SET_FUNCTION_NAMES';\nexport const QUERY_EDITOR_PERSIST_HEIGHT = 'QUERY_EDITOR_PERSIST_HEIGHT';\nexport const QUERY_EDITOR_TOGGLE_LEFT_BAR = 'QUERY_EDITOR_TOGGLE_LEFT_BAR';\nexport const MIGRATE_QUERY_EDITOR = 'MIGRATE_QUERY_EDITOR';\nexport const MIGRATE_TAB_HISTORY = 'MIGRATE_TAB_HISTORY';\nexport const MIGRATE_TABLE = 'MIGRATE_TABLE';\nexport const MIGRATE_QUERY = 'MIGRATE_QUERY';\n\nexport const SET_DATABASES = 'SET_DATABASES';\nexport const SET_ACTIVE_QUERY_EDITOR = 'SET_ACTIVE_QUERY_EDITOR';\nexport const LOAD_QUERY_EDITOR = 'LOAD_QUERY_EDITOR';\nexport const SET_TABLES = 'SET_TABLES';\nexport const SET_ACTIVE_SOUTHPANE_TAB = 'SET_ACTIVE_SOUTHPANE_TAB';\nexport const REFRESH_QUERIES = 'REFRESH_QUERIES';\nexport const SET_USER_OFFLINE = 'SET_USER_OFFLINE';\nexport const RUN_QUERY = 'RUN_QUERY';\nexport const START_QUERY = 'START_QUERY';\nexport const STOP_QUERY = 'STOP_QUERY';\nexport const REQUEST_QUERY_RESULTS = 'REQUEST_QUERY_RESULTS';\nexport const QUERY_SUCCESS = 'QUERY_SUCCESS';\nexport const QUERY_FAILED = 'QUERY_FAILED';\nexport const CLEAR_QUERY_RESULTS = 'CLEAR_QUERY_RESULTS';\nexport const REMOVE_DATA_PREVIEW = 'REMOVE_DATA_PREVIEW';\nexport const CHANGE_DATA_PREVIEW_ID = 'CHANGE_DATA_PREVIEW_ID';\n\nexport const START_QUERY_VALIDATION = 'START_QUERY_VALIDATION';\nexport const QUERY_VALIDATION_RETURNED = 'QUERY_VALIDATION_RETURNED';\nexport const QUERY_VALIDATION_FAILED = 'QUERY_VALIDATION_FAILED';\nexport const COST_ESTIMATE_STARTED = 'COST_ESTIMATE_STARTED';\nexport const COST_ESTIMATE_RETURNED = 'COST_ESTIMATE_RETURNED';\nexport const COST_ESTIMATE_FAILED = 'COST_ESTIMATE_FAILED';\n\nexport const CREATE_DATASOURCE_STARTED = 'CREATE_DATASOURCE_STARTED';\nexport const CREATE_DATASOURCE_SUCCESS = 'CREATE_DATASOURCE_SUCCESS';\nexport const CREATE_DATASOURCE_FAILED = 'CREATE_DATASOURCE_FAILED';\n\nexport const addInfoToast = addInfoToastAction;\nexport const addSuccessToast = addSuccessToastAction;\nexport const addDangerToast = addDangerToastAction;\nexport const addWarningToast = addWarningToastAction;\n\nexport const CtasEnum = {\n  TABLE: 'TABLE',\n  VIEW: 'VIEW' };\n\nconst ERR_MSG_CANT_LOAD_QUERY = t(\"The query couldn't be loaded\");\n\n// a map of SavedQuery field names to the different names used client-side,\n// because for now making the names consistent is too complicated\n// so it might as well only happen in one place\nconst queryClientMapping = {\n  id: 'remoteId',\n  db_id: 'dbId',\n  client_id: 'id',\n  label: 'title' };\n\nconst queryServerMapping = invert(queryClientMapping);\n\n// uses a mapping like those above to convert object key names to another style\nconst fieldConverter = mapping => (obj) =>\nmapKeys(obj, (value, key) => key in mapping ? mapping[key] : key);\n\nconst convertQueryToServer = fieldConverter(queryServerMapping);\nconst convertQueryToClient = fieldConverter(queryClientMapping);\n\nexport function resetState() {\n  return { type: RESET_STATE };\n}\n\nexport function startQueryValidation(query) {\n  _Object$assign(query, {\n    id: query.id ? query.id : shortid.generate() });\n\n  return { type: START_QUERY_VALIDATION, query };\n}\n\nexport function queryValidationReturned(query, results) {\n  return { type: QUERY_VALIDATION_RETURNED, query, results };\n}\n\nexport function queryValidationFailed(query, message, error) {\n  return { type: QUERY_VALIDATION_FAILED, query, message, error };\n}\n\nexport function updateQueryEditor(alterations) {\n  return { type: UPDATE_QUERY_EDITOR, alterations };\n}\n\nexport function scheduleQuery(query) {\n  return (dispatch) =>\n  SupersetClient.post({\n    endpoint: '/savedqueryviewapi/api/create',\n    postPayload: query,\n    stringify: false }).\n\n  then(() =>\n  dispatch(\n  addSuccessToast(\n  t(\n  'Your query has been scheduled. To see details of your query, navigate to Saved queries')))).\n\n\n\n\n  catch(() =>\n  dispatch(addDangerToast(t('Your query could not be scheduled'))));\n\n}\n\nexport function estimateQueryCost(query) {\n  const { dbId, schema, sql, templateParams } = query;\n  const endpoint =\n  schema === null ?\n  `/superset/estimate_query_cost/${dbId}/` :\n  `/superset/estimate_query_cost/${dbId}/${schema}/`;\n  return (dispatch) =>\n  _Promise.all([\n  dispatch({ type: COST_ESTIMATE_STARTED, query }),\n  SupersetClient.post({\n    endpoint,\n    postPayload: {\n      sql,\n      templateParams: JSON.parse(templateParams || '{}') } }).\n\n\n  then(({ json }) =>\n  dispatch({ type: COST_ESTIMATE_RETURNED, query, json })).\n\n  catch((response) =>\n  getClientErrorObject(response).then(error => {\n    const message =\n    error.error ||\n    error.statusText ||\n    t('Failed at retrieving results');\n    return dispatch({\n      type: COST_ESTIMATE_FAILED,\n      query,\n      error: message });\n\n  }))]);\n\n\n}\n\nexport function startQuery(query) {\n  _Object$assign(query, {\n    id: query.id ? query.id : shortid.generate(),\n    progress: 0,\n    startDttm: now(),\n    state: query.runAsync ? 'pending' : 'running',\n    cached: false });\n\n  return { type: START_QUERY, query };\n}\n\nexport function querySuccess(query, results) {\n  return function (dispatch) {\n    const sync =\n    !query.isDataPreview &&\n    isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${results.query.sqlEditorId}`),\n      postPayload: { latest_query_id: query.id } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: QUERY_SUCCESS, query, results })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while storing the latest query id in the backend. ' +\n    'Please contact your administrator if this problem persists.'))));\n\n\n\n\n  };\n}\n\nexport function queryFailed(query, msg, link, errors) {\n  return function (dispatch) {\n    const sync =\n    !query.isDataPreview &&\n    isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${query.sqlEditorId}`),\n      postPayload: { latest_query_id: query.id } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: QUERY_FAILED, query, msg, link, errors })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while storing the latest query id in the backend. ' +\n    'Please contact your administrator if this problem persists.'))));\n\n\n\n\n  };\n}\n\nexport function stopQuery(query) {\n  return { type: STOP_QUERY, query };\n}\n\nexport function clearQueryResults(query) {\n  return { type: CLEAR_QUERY_RESULTS, query };\n}\n\nexport function removeDataPreview(table) {\n  return { type: REMOVE_DATA_PREVIEW, table };\n}\n\nexport function requestQueryResults(query) {\n  return { type: REQUEST_QUERY_RESULTS, query };\n}\n\nexport function fetchQueryResults(query, displayLimit) {\n  return function (dispatch) {\n    dispatch(requestQueryResults(query));\n\n    return SupersetClient.get({\n      endpoint: `/superset/results/${query.resultsKey}/?rows=${displayLimit}`,\n      parseMethod: 'text' }).\n\n    then(({ text = '{}' }) => {\n      const bigIntJson = JSONbig.parse(text);\n      return dispatch(querySuccess(query, bigIntJson));\n    }).\n    catch((response) =>\n    getClientErrorObject(response).then(error => {\n      const message =\n      error.error ||\n      error.statusText ||\n      t('Failed at retrieving results');\n\n      return dispatch(\n      queryFailed(query, message, error.link, error.errors));\n\n    }));\n\n  };\n}\n\nexport function runQuery(query) {\n  return function (dispatch) {\n    dispatch(startQuery(query));\n    const postPayload = {\n      client_id: query.id,\n      database_id: query.dbId,\n      json: true,\n      runAsync: query.runAsync,\n      schema: query.schema,\n      sql: query.sql,\n      sql_editor_id: query.sqlEditorId,\n      tab: query.tab,\n      tmp_table_name: query.tempTable,\n      select_as_cta: query.ctas,\n      ctas_method: query.ctas_method,\n      templateParams: query.templateParams,\n      queryLimit: query.queryLimit,\n      expand_data: true };\n\n\n    return SupersetClient.post({\n      endpoint: '/superset/sql_json/',\n      body: _JSON$stringify(postPayload),\n      headers: { 'Content-Type': 'application/json' },\n      parseMethod: 'text' }).\n\n    then(({ text = '{}' }) => {\n      if (!query.runAsync) {\n        const bigIntJson = JSONbig.parse(text);\n        dispatch(querySuccess(query, bigIntJson));\n      }\n    }).\n    catch((response) =>\n    getClientErrorObject(response).then(error => {\n      let message = error.error || error.statusText || t('Unknown error');\n      if (_includesInstanceProperty(message).call(message, 'CSRF token')) {\n        message = t(COMMON_ERR_MESSAGES.SESSION_TIMED_OUT);\n      }\n      dispatch(queryFailed(query, message, error.link, error.errors));\n    }));\n\n  };\n}\n\nexport function reRunQuery(query) {\n  // run Query with a new id\n  return function (dispatch) {\n    dispatch(runQuery({ ...query, id: shortid.generate() }));\n  };\n}\n\nexport function validateQuery(query) {\n  return function (dispatch) {\n    dispatch(startQueryValidation(query));\n\n    const postPayload = {\n      client_id: query.id,\n      database_id: query.dbId,\n      json: true,\n      schema: query.schema,\n      sql: query.sql,\n      sql_editor_id: query.sqlEditorId,\n      templateParams: query.templateParams,\n      validate_only: true };\n\n\n    return SupersetClient.post({\n      endpoint: `/superset/validate_sql_json/${window.location.search}`,\n      postPayload,\n      stringify: false }).\n\n    then(({ json }) => dispatch(queryValidationReturned(query, json))).\n    catch((response) =>\n    getClientErrorObject(response).then(error => {\n      let message = error.error || error.statusText || t('Unknown error');\n      if (_includesInstanceProperty(message).call(message, 'CSRF token')) {\n        message = t(COMMON_ERR_MESSAGES.SESSION_TIMED_OUT);\n      }\n      dispatch(queryValidationFailed(query, message, error));\n    }));\n\n  };\n}\n\nexport function postStopQuery(query) {\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/superset/stop_query/',\n      postPayload: { client_id: query.id },\n      stringify: false }).\n\n    then(() => dispatch(stopQuery(query))).\n    then(() => dispatch(addSuccessToast(t('Query was stopped.')))).\n    catch(() =>\n    dispatch(\n    addDangerToast(`${t('Failed at stopping query. ')}'${query.id}'`)));\n\n\n  };\n}\n\nexport function setDatabases(databases) {\n  return { type: SET_DATABASES, databases };\n}\n\nfunction migrateTable(table, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI('/tableschemaview/'),\n    postPayload: { table: { ...table, queryEditorId } } }).\n\n  then(({ json }) => {\n    const newTable = {\n      ...table,\n      id: json.id,\n      queryEditorId };\n\n    return dispatch({ type: MIGRATE_TABLE, oldTable: table, newTable });\n  }).\n  catch(() =>\n  dispatch(\n  addWarningToast(\n  t(\n  'Unable to migrate table schema state to backend. Superset will retry ' +\n  'later. Please contact your administrator if this problem persists.'))));\n\n\n\n\n}\n\nfunction migrateQuery(queryId, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI(`/tabstateview/${queryEditorId}/migrate_query`),\n    postPayload: { queryId } }).\n\n  then(() => dispatch({ type: MIGRATE_QUERY, queryId, queryEditorId })).\n  catch(() =>\n  dispatch(\n  addWarningToast(\n  t(\n  'Unable to migrate query state to backend. Superset will retry later. ' +\n  'Please contact your administrator if this problem persists.'))));\n\n\n\n\n}\n\nexport function migrateQueryEditorFromLocalStorage(\nqueryEditor,\ntables,\nqueries)\n{\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/tabstateview/',\n      postPayload: { queryEditor } }).\n\n    then(({ json }) => {\n      const newQueryEditor = {\n        ...queryEditor,\n        id: json.id.toString() };\n\n      dispatch({\n        type: MIGRATE_QUERY_EDITOR,\n        oldQueryEditor: queryEditor,\n        newQueryEditor });\n\n      dispatch({\n        type: MIGRATE_TAB_HISTORY,\n        oldId: queryEditor.id,\n        newId: newQueryEditor.id });\n\n      return _Promise.all([\n      ..._mapInstanceProperty(tables).call(tables, (table) =>\n      migrateTable(table, newQueryEditor.id, dispatch)),\n\n      ..._mapInstanceProperty(queries).call(queries, (query) =>\n      migrateQuery(query.id, newQueryEditor.id, dispatch))]);\n\n\n    }).\n    catch(() =>\n    dispatch(\n    addWarningToast(\n    t(\n    'Unable to migrate query editor state to backend. Superset will retry ' +\n    'later. Please contact your administrator if this problem persists.'))));\n\n\n\n\n  };\n}\n\nexport function addQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.post({\n      endpoint: '/tabstateview/',\n      postPayload: { queryEditor } }) :\n\n    _Promise.resolve({ json: { id: shortid.generate() } });\n\n    return sync.\n    then(({ json }) => {\n      const newQueryEditor = {\n        ...queryEditor,\n        id: json.id.toString() };\n\n      return dispatch({\n        type: ADD_QUERY_EDITOR,\n        queryEditor: newQueryEditor });\n\n    }).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'Unable to add a new tab to the backend. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function cloneQueryToNewTab(query, autorun) {\n  return function (dispatch, getState) {\n    const state = getState();\n    const { queryEditors, tabHistory } = state.sqlLab;\n    const sourceQueryEditor = _findInstanceProperty(queryEditors).call(queryEditors,\n    qe => qe.id === tabHistory[tabHistory.length - 1]);\n\n    const queryEditor = {\n      title: t('Copy of %s', sourceQueryEditor.title),\n      dbId: query.dbId ? query.dbId : null,\n      schema: query.schema ? query.schema : null,\n      autorun,\n      sql: query.sql,\n      queryLimit: sourceQueryEditor.queryLimit,\n      maxRow: sourceQueryEditor.maxRow,\n      templateParams: sourceQueryEditor.templateParams };\n\n    return dispatch(addQueryEditor(queryEditor));\n  };\n}\n\nexport function setActiveQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.post({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}/activate`) }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: SET_ACTIVE_QUERY_EDITOR, queryEditor })).\n    catch(response => {\n      if (response.status !== 404) {\n        return dispatch(\n        addDangerToast(\n        t(\n        'An error occurred while setting the active tab. Please contact ' +\n        'your administrator.')));\n\n\n\n      }\n      return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n    });\n  };\n}\n\nexport function loadQueryEditor(queryEditor) {\n  return { type: LOAD_QUERY_EDITOR, queryEditor };\n}\n\nexport function setTables(tableSchemas) {var _context;\n  const tables = _mapInstanceProperty(_context = _filterInstanceProperty(tableSchemas).call(tableSchemas,\n  tableSchema => tableSchema.description !== null)).call(_context,\n  tableSchema => {\n    const {\n      columns,\n      selectStar,\n      primaryKey,\n      foreignKeys,\n      indexes,\n      dataPreviewQueryId } =\n    tableSchema.description;\n    return {\n      dbId: tableSchema.database_id,\n      queryEditorId: tableSchema.tab_state_id.toString(),\n      schema: tableSchema.schema,\n      name: tableSchema.table,\n      expanded: tableSchema.expanded,\n      id: tableSchema.id,\n      dataPreviewQueryId,\n      columns,\n      selectStar,\n      primaryKey,\n      foreignKeys,\n      indexes,\n      isMetadataLoading: false,\n      isExtraMetadataLoading: false };\n\n  });\n  return { type: SET_TABLES, tables };\n}\n\nexport function switchQueryEditor(queryEditor, displayLimit) {\n  return function (dispatch) {\n    if (\n    isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n    !queryEditor.loaded)\n    {\n      SupersetClient.get({\n        endpoint: encodeURI(`/tabstateview/${queryEditor.id}`) }).\n\n      then(({ json }) => {\n        const loadedQueryEditor = {\n          id: json.id.toString(),\n          loaded: true,\n          title: json.label,\n          sql: json.sql,\n          selectedText: null,\n          latestQueryId: json.latest_query ? json.latest_query.id : null,\n          autorun: json.autorun,\n          dbId: json.database_id,\n          templateParams: json.template_params,\n          schema: json.schema,\n          queryLimit: json.query_limit,\n          validationResult: {\n            id: null,\n            errors: [],\n            completed: false },\n\n          hideLeftBar: json.hide_left_bar };\n\n        dispatch(loadQueryEditor(loadedQueryEditor));\n        dispatch(setTables(json.table_schemas || []));\n        dispatch(setActiveQueryEditor(loadedQueryEditor));\n        if (json.latest_query && json.latest_query.resultsKey) {\n          dispatch(fetchQueryResults(json.latest_query, displayLimit));\n        }\n      }).\n      catch(response => {\n        if (response.status !== 404) {\n          return dispatch(\n          addDangerToast(t('An error occurred while fetching tab state')));\n\n        }\n        return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n      });\n    } else {\n      dispatch(setActiveQueryEditor(queryEditor));\n    }\n  };\n}\n\nexport function setActiveSouthPaneTab(tabId) {\n  return { type: SET_ACTIVE_SOUTHPANE_TAB, tabId };\n}\n\nexport function toggleLeftBar(queryEditor) {\n  const hideLeftBar = !queryEditor.hideLeftBar;\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { hide_left_bar: hideLeftBar } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({\n      type: QUERY_EDITOR_TOGGLE_LEFT_BAR,\n      queryEditor,\n      hideLeftBar })).\n\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while hiding the left bar. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function removeQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.delete({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`) }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while removing tab. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function removeQuery(query) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.delete({\n      endpoint: encodeURI(\n      `/tabstateview/${query.sqlEditorId}/query/${query.id}`) }) :\n\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: REMOVE_QUERY, query })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while removing query. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetDb(queryEditor, dbId) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { database_id: dbId } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: QUERY_EDITOR_SETDB, queryEditor, dbId })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab database ID. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetSchema(queryEditor, schema) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { schema } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({ type: QUERY_EDITOR_SET_SCHEMA, queryEditor, schema })).\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab schema. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetSchemaOptions(queryEditor, options) {\n  return { type: QUERY_EDITOR_SET_SCHEMA_OPTIONS, queryEditor, options };\n}\n\nexport function queryEditorSetTableOptions(queryEditor, options) {\n  return { type: QUERY_EDITOR_SET_TABLE_OPTIONS, queryEditor, options };\n}\n\nexport function queryEditorSetAutorun(queryEditor, autorun) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { autorun } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({ type: QUERY_EDITOR_SET_AUTORUN, queryEditor, autorun })).\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab autorun. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetTitle(queryEditor, title) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { label: title } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({ type: QUERY_EDITOR_SET_TITLE, queryEditor, title })).\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab title. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function saveQuery(query) {\n  return (dispatch) =>\n  SupersetClient.post({\n    endpoint: '/savedqueryviewapi/api/create',\n    postPayload: convertQueryToServer(query),\n    stringify: false }).\n\n  then(result => {\n    dispatch({\n      type: QUERY_EDITOR_SAVED,\n      query,\n      result: convertQueryToClient(result.json.item) });\n\n    dispatch(addSuccessToast(t('Your query was saved')));\n    dispatch(queryEditorSetTitle(query, query.title));\n  }).\n  catch(() =>\n  dispatch(addDangerToast(t('Your query could not be saved'))));\n\n}\n\nexport function updateSavedQuery(query) {\n  return (dispatch) =>\n  SupersetClient.put({\n    endpoint: `/savedqueryviewapi/api/update/${query.remoteId}`,\n    postPayload: convertQueryToServer(query),\n    stringify: false }).\n\n  then(() => {\n    dispatch(addSuccessToast(t('Your query was updated')));\n    dispatch(queryEditorSetTitle(query, query.title));\n  }).\n  catch(() =>\n  dispatch(addDangerToast(t('Your query could not be updated')))).\n\n  then(() => dispatch(updateQueryEditor(query)));\n}\n\nexport function queryEditorSetSql(queryEditor, sql) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { sql, latest_query_id: queryEditor.latestQueryId } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: QUERY_EDITOR_SET_SQL, queryEditor, sql })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while storing your query in the backend. To ' +\n    'avoid losing your changes, please save your query using the ' +\n    '\"Save Query\" button.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetQueryLimit(queryEditor, queryLimit) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { query_limit: queryLimit } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({\n      type: QUERY_EDITOR_SET_QUERY_LIMIT,\n      queryEditor,\n      queryLimit })).\n\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab title. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetTemplateParams(queryEditor, templateParams) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { template_params: templateParams } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({\n      type: QUERY_EDITOR_SET_TEMPLATE_PARAMS,\n      queryEditor,\n      templateParams })).\n\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab template parameters. ' +\n    'Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetSelectedText(queryEditor, sql) {\n  return { type: QUERY_EDITOR_SET_SELECTED_TEXT, queryEditor, sql };\n}\n\nexport function mergeTable(table, query) {\n  return { type: MERGE_TABLE, table, query };\n}\n\nfunction getTableMetadata(table, query, dispatch) {\n  return SupersetClient.get({\n    endpoint: encodeURI(\n    `/api/v1/database/${query.dbId}/table/${encodeURIComponent(\n    table.name)\n    }/${encodeURIComponent(table.schema)}/`) }).\n\n\n  then(({ json }) => {\n    const dataPreviewQuery = {\n      id: shortid.generate(),\n      dbId: query.dbId,\n      sql: json.selectStar,\n      tableName: table.name,\n      sqlEditorId: null,\n      tab: '',\n      runAsync: false,\n      ctas: false,\n      isDataPreview: true };\n\n    const newTable = {\n      ...table,\n      ...json,\n      expanded: true,\n      isMetadataLoading: false,\n      dataPreviewQueryId: dataPreviewQuery.id };\n\n    _Promise.all([\n    dispatch(mergeTable(newTable, dataPreviewQuery)), // Merge table to tables in state\n    dispatch(runQuery(dataPreviewQuery)) // Run query to get preview data for table\n    ]);\n    return newTable;\n  }).\n  catch(() =>\n  _Promise.all([\n  dispatch(\n  mergeTable({\n    ...table,\n    isMetadataLoading: false })),\n\n\n  dispatch(\n  addDangerToast(t('An error occurred while fetching table metadata')))]));\n\n\n\n}\n\nfunction getTableExtendedMetadata(table, query, dispatch) {\n  return SupersetClient.get({\n    endpoint: encodeURI(\n    `/superset/extra_table_metadata/${query.dbId}/` +\n    `${encodeURIComponent(table.name)}/${encodeURIComponent(\n    table.schema)\n    }/`) }).\n\n\n  then(({ json }) => {\n    dispatch(\n    mergeTable({ ...table, ...json, isExtraMetadataLoading: false }));\n\n    return json;\n  }).\n  catch(() =>\n  _Promise.all([\n  dispatch(mergeTable({ ...table, isExtraMetadataLoading: false })),\n  dispatch(\n  addDangerToast(t('An error occurred while fetching table metadata')))]));\n\n\n\n}\n\nexport function addTable(query, tableName, schemaName) {\n  return function (dispatch) {\n    const table = {\n      dbId: query.dbId,\n      queryEditorId: query.id,\n      schema: schemaName,\n      name: tableName };\n\n    dispatch(\n    mergeTable({\n      ...table,\n      isMetadataLoading: true,\n      isExtraMetadataLoading: true,\n      expanded: true }));\n\n\n\n    return _Promise.all([\n    getTableMetadata(table, query, dispatch),\n    getTableExtendedMetadata(table, query, dispatch)]).\n    then(([newTable, json]) => {\n      const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n      SupersetClient.post({\n        endpoint: encodeURI('/tableschemaview/'),\n        postPayload: { table: { ...newTable, ...json } } }) :\n\n      _Promise.resolve({ json: { id: shortid.generate() } });\n\n      return sync.\n      then(({ json: resultJson }) =>\n      dispatch(mergeTable({ ...table, id: resultJson.id }))).\n\n      catch(() =>\n      dispatch(\n      addDangerToast(\n      t(\n      'An error occurred while fetching table metadata. ' +\n      'Please contact your administrator.'))));\n\n\n\n\n    });\n  };\n}\n\nexport function changeDataPreviewId(oldQueryId, newQuery) {\n  return { type: CHANGE_DATA_PREVIEW_ID, oldQueryId, newQuery };\n}\n\nexport function reFetchQueryResults(query) {\n  return function (dispatch) {\n    const newQuery = {\n      id: shortid.generate(),\n      dbId: query.dbId,\n      sql: query.sql,\n      tableName: query.tableName,\n      sqlEditorId: null,\n      tab: '',\n      runAsync: false,\n      ctas: false,\n      queryLimit: query.queryLimit,\n      isDataPreview: query.isDataPreview };\n\n    dispatch(runQuery(newQuery));\n    dispatch(changeDataPreviewId(query.id, newQuery));\n  };\n}\n\nexport function expandTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.post({\n      endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n      postPayload: { expanded: true } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: EXPAND_TABLE, table })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while expanding the table schema. ' +\n    'Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function collapseTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.post({\n      endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n      postPayload: { expanded: false } }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: COLLAPSE_TABLE, table })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while collapsing the table schema. ' +\n    'Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function removeTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.delete({\n      endpoint: encodeURI(`/tableschemaview/${table.id}`) }) :\n\n    _Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: REMOVE_TABLE, table })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while removing the table schema. ' +\n    'Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function refreshQueries(alteredQueries) {\n  return { type: REFRESH_QUERIES, alteredQueries };\n}\n\nexport function setUserOffline(offline) {\n  return { type: SET_USER_OFFLINE, offline };\n}\n\nexport function persistEditorHeight(queryEditor, northPercent, southPercent) {\n  return {\n    type: QUERY_EDITOR_PERSIST_HEIGHT,\n    queryEditor,\n    northPercent,\n    southPercent };\n\n}\n\nexport function popStoredQuery(urlId) {\n  return function (dispatch) {\n    return SupersetClient.get({ endpoint: `/kv/${urlId}` }).\n    then(({ json }) =>\n    dispatch(\n    addQueryEditor({\n      title: json.title ? json.title : t('Shared query'),\n      dbId: json.dbId ? _parseInt(json.dbId, 10) : null,\n      schema: json.schema ? json.schema : null,\n      autorun: json.autorun ? json.autorun : false,\n      sql: json.sql ? json.sql : 'SELECT ...' }))).\n\n\n\n    catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popSavedQuery(saveQueryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/savedqueryviewapi/api/get/${saveQueryId}` }).\n\n    then(({ json }) => {\n      const queryEditorProps = {\n        ...convertQueryToClient(json.result),\n        autorun: false };\n\n      return dispatch(addQueryEditor(queryEditorProps));\n    }).\n    catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popQuery(queryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/query/${queryId}` }).\n\n    then(({ json }) => {\n      const queryData = json.result;\n      const queryEditorProps = {\n        dbId: queryData.database.id,\n        schema: queryData.schema,\n        sql: queryData.sql,\n        title: `Copy of ${queryData.tab_name}`,\n        autorun: false };\n\n      return dispatch(addQueryEditor(queryEditorProps));\n    }).\n    catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popDatasourceQuery(datasourceKey, sql) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/superset/fetch_datasource_metadata?datasourceKey=${datasourceKey}` }).\n\n    then(({ json }) =>\n    dispatch(\n    addQueryEditor({\n      title: `Query ${json.name}`,\n      dbId: json.database.id,\n      schema: json.schema,\n      autorun: sql !== undefined,\n      sql: sql || json.select_star }))).\n\n\n\n    catch(() =>\n    dispatch(addDangerToast(t(\"The datasource couldn't be loaded\"))));\n\n  };\n}\nexport function createDatasourceStarted() {\n  return { type: CREATE_DATASOURCE_STARTED };\n}\nexport function createDatasourceSuccess(data) {\n  const datasource = `${data.table_id}__table`;\n  return { type: CREATE_DATASOURCE_SUCCESS, datasource };\n}\nexport function createDatasourceFailed(err) {\n  return { type: CREATE_DATASOURCE_FAILED, err };\n}\n\nexport function createDatasource(vizOptions) {\n  return dispatch => {\n    dispatch(createDatasourceStarted());\n    return SupersetClient.post({\n      endpoint: '/superset/sqllab_viz/',\n      postPayload: { data: vizOptions } }).\n\n    then(({ json }) => {\n      dispatch(createDatasourceSuccess(json));\n\n      return _Promise.resolve(json);\n    }).\n    catch(() => {\n      dispatch(\n      createDatasourceFailed(\n      t('An error occurred while creating the data source')));\n\n\n\n      return _Promise.reject();\n    });\n  };\n}\n\nexport function createCtasDatasource(vizOptions) {\n  return dispatch => {\n    dispatch(createDatasourceStarted());\n    return SupersetClient.post({\n      endpoint: '/superset/get_or_create_table/',\n      postPayload: { data: vizOptions } }).\n\n    then(({ json }) => {\n      dispatch(createDatasourceSuccess(json));\n\n      return json;\n    }).\n    catch(() => {\n      const errorMsg = t('An error occurred while creating the data source');\n      dispatch(createDatasourceFailed(errorMsg));\n      return _Promise.reject(new Error(errorMsg));\n    });\n  };\n}\n\nexport function queryEditorSetFunctionNames(queryEditor, dbId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: encodeURI(`/api/v1/database/${dbId}/function_names/`) }).\n\n    then(({ json }) =>\n    dispatch({\n      type: QUERY_EDITOR_SET_FUNCTION_NAMES,\n      queryEditor,\n      functionNames: json.function_names })).\n\n\n    catch(() =>\n    dispatch(\n    addDangerToast(t('An error occurred while fetching function names.'))));\n\n\n  };\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(RESET_STATE, \"RESET_STATE\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(ADD_QUERY_EDITOR, \"ADD_QUERY_EDITOR\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(UPDATE_QUERY_EDITOR, \"UPDATE_QUERY_EDITOR\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SAVED, \"QUERY_EDITOR_SAVED\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(CLONE_QUERY_TO_NEW_TAB, \"CLONE_QUERY_TO_NEW_TAB\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(REMOVE_QUERY_EDITOR, \"REMOVE_QUERY_EDITOR\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(MERGE_TABLE, \"MERGE_TABLE\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(REMOVE_TABLE, \"REMOVE_TABLE\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(END_QUERY, \"END_QUERY\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(REMOVE_QUERY, \"REMOVE_QUERY\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(EXPAND_TABLE, \"EXPAND_TABLE\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(COLLAPSE_TABLE, \"COLLAPSE_TABLE\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SETDB, \"QUERY_EDITOR_SETDB\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_SCHEMA, \"QUERY_EDITOR_SET_SCHEMA\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_SCHEMA_OPTIONS, \"QUERY_EDITOR_SET_SCHEMA_OPTIONS\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_TABLE_OPTIONS, \"QUERY_EDITOR_SET_TABLE_OPTIONS\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_TITLE, \"QUERY_EDITOR_SET_TITLE\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_AUTORUN, \"QUERY_EDITOR_SET_AUTORUN\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_SQL, \"QUERY_EDITOR_SET_SQL\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_QUERY_LIMIT, \"QUERY_EDITOR_SET_QUERY_LIMIT\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_TEMPLATE_PARAMS, \"QUERY_EDITOR_SET_TEMPLATE_PARAMS\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_SELECTED_TEXT, \"QUERY_EDITOR_SET_SELECTED_TEXT\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_SET_FUNCTION_NAMES, \"QUERY_EDITOR_SET_FUNCTION_NAMES\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_PERSIST_HEIGHT, \"QUERY_EDITOR_PERSIST_HEIGHT\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_EDITOR_TOGGLE_LEFT_BAR, \"QUERY_EDITOR_TOGGLE_LEFT_BAR\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(MIGRATE_QUERY_EDITOR, \"MIGRATE_QUERY_EDITOR\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(MIGRATE_TAB_HISTORY, \"MIGRATE_TAB_HISTORY\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(MIGRATE_TABLE, \"MIGRATE_TABLE\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(MIGRATE_QUERY, \"MIGRATE_QUERY\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(SET_DATABASES, \"SET_DATABASES\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(SET_ACTIVE_QUERY_EDITOR, \"SET_ACTIVE_QUERY_EDITOR\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(LOAD_QUERY_EDITOR, \"LOAD_QUERY_EDITOR\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(SET_TABLES, \"SET_TABLES\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(SET_ACTIVE_SOUTHPANE_TAB, \"SET_ACTIVE_SOUTHPANE_TAB\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(REFRESH_QUERIES, \"REFRESH_QUERIES\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(SET_USER_OFFLINE, \"SET_USER_OFFLINE\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(RUN_QUERY, \"RUN_QUERY\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(START_QUERY, \"START_QUERY\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(STOP_QUERY, \"STOP_QUERY\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(REQUEST_QUERY_RESULTS, \"REQUEST_QUERY_RESULTS\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_SUCCESS, \"QUERY_SUCCESS\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_FAILED, \"QUERY_FAILED\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(CLEAR_QUERY_RESULTS, \"CLEAR_QUERY_RESULTS\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(REMOVE_DATA_PREVIEW, \"REMOVE_DATA_PREVIEW\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(CHANGE_DATA_PREVIEW_ID, \"CHANGE_DATA_PREVIEW_ID\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(START_QUERY_VALIDATION, \"START_QUERY_VALIDATION\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_VALIDATION_RETURNED, \"QUERY_VALIDATION_RETURNED\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(QUERY_VALIDATION_FAILED, \"QUERY_VALIDATION_FAILED\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(COST_ESTIMATE_STARTED, \"COST_ESTIMATE_STARTED\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(COST_ESTIMATE_RETURNED, \"COST_ESTIMATE_RETURNED\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(COST_ESTIMATE_FAILED, \"COST_ESTIMATE_FAILED\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(CREATE_DATASOURCE_STARTED, \"CREATE_DATASOURCE_STARTED\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(CREATE_DATASOURCE_SUCCESS, \"CREATE_DATASOURCE_SUCCESS\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(CREATE_DATASOURCE_FAILED, \"CREATE_DATASOURCE_FAILED\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(addInfoToast, \"addInfoToast\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(addSuccessToast, \"addSuccessToast\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(addDangerToast, \"addDangerToast\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(addWarningToast, \"addWarningToast\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(CtasEnum, \"CtasEnum\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(ERR_MSG_CANT_LOAD_QUERY, \"ERR_MSG_CANT_LOAD_QUERY\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryClientMapping, \"queryClientMapping\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryServerMapping, \"queryServerMapping\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(fieldConverter, \"fieldConverter\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(convertQueryToServer, \"convertQueryToServer\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(convertQueryToClient, \"convertQueryToClient\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(resetState, \"resetState\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(startQueryValidation, \"startQueryValidation\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryValidationReturned, \"queryValidationReturned\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryValidationFailed, \"queryValidationFailed\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(updateQueryEditor, \"updateQueryEditor\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(scheduleQuery, \"scheduleQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(estimateQueryCost, \"estimateQueryCost\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(startQuery, \"startQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(querySuccess, \"querySuccess\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryFailed, \"queryFailed\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(stopQuery, \"stopQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(clearQueryResults, \"clearQueryResults\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(removeDataPreview, \"removeDataPreview\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(requestQueryResults, \"requestQueryResults\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(fetchQueryResults, \"fetchQueryResults\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(runQuery, \"runQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(reRunQuery, \"reRunQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(validateQuery, \"validateQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(postStopQuery, \"postStopQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(setDatabases, \"setDatabases\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(migrateTable, \"migrateTable\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(migrateQuery, \"migrateQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(migrateQueryEditorFromLocalStorage, \"migrateQueryEditorFromLocalStorage\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(addQueryEditor, \"addQueryEditor\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(cloneQueryToNewTab, \"cloneQueryToNewTab\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(setActiveQueryEditor, \"setActiveQueryEditor\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(loadQueryEditor, \"loadQueryEditor\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(setTables, \"setTables\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(switchQueryEditor, \"switchQueryEditor\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(setActiveSouthPaneTab, \"setActiveSouthPaneTab\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(toggleLeftBar, \"toggleLeftBar\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(removeQueryEditor, \"removeQueryEditor\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(removeQuery, \"removeQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetDb, \"queryEditorSetDb\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetSchema, \"queryEditorSetSchema\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetSchemaOptions, \"queryEditorSetSchemaOptions\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetTableOptions, \"queryEditorSetTableOptions\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetAutorun, \"queryEditorSetAutorun\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetTitle, \"queryEditorSetTitle\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(saveQuery, \"saveQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(updateSavedQuery, \"updateSavedQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetSql, \"queryEditorSetSql\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetQueryLimit, \"queryEditorSetQueryLimit\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetTemplateParams, \"queryEditorSetTemplateParams\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetSelectedText, \"queryEditorSetSelectedText\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(mergeTable, \"mergeTable\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(getTableMetadata, \"getTableMetadata\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(getTableExtendedMetadata, \"getTableExtendedMetadata\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(addTable, \"addTable\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(changeDataPreviewId, \"changeDataPreviewId\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(reFetchQueryResults, \"reFetchQueryResults\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(expandTable, \"expandTable\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(collapseTable, \"collapseTable\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(removeTable, \"removeTable\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(refreshQueries, \"refreshQueries\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(setUserOffline, \"setUserOffline\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(persistEditorHeight, \"persistEditorHeight\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(popStoredQuery, \"popStoredQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(popSavedQuery, \"popSavedQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(popQuery, \"popQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(popDatasourceQuery, \"popDatasourceQuery\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(createDatasourceStarted, \"createDatasourceStarted\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(createDatasourceSuccess, \"createDatasourceSuccess\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(createDatasourceFailed, \"createDatasourceFailed\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(createDatasource, \"createDatasource\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(createCtasDatasource, \"createCtasDatasource\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");reactHotLoader.register(queryEditorSetFunctionNames, \"queryEditorSetFunctionNames\", \"/app/superset-frontend/src/SqlLab/actions/sqlLab.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/SqlLab/actions/sqlLab.js"],"names":["shortid","JSONbig","t","SupersetClient","invert","mapKeys","isFeatureEnabled","FeatureFlag","now","addDangerToast","addDangerToastAction","addInfoToast","addInfoToastAction","addSuccessToast","addSuccessToastAction","addWarningToast","addWarningToastAction","getClientErrorObject","COMMON_ERR_MESSAGES","RESET_STATE","ADD_QUERY_EDITOR","UPDATE_QUERY_EDITOR","QUERY_EDITOR_SAVED","CLONE_QUERY_TO_NEW_TAB","REMOVE_QUERY_EDITOR","MERGE_TABLE","REMOVE_TABLE","END_QUERY","REMOVE_QUERY","EXPAND_TABLE","COLLAPSE_TABLE","QUERY_EDITOR_SETDB","QUERY_EDITOR_SET_SCHEMA","QUERY_EDITOR_SET_SCHEMA_OPTIONS","QUERY_EDITOR_SET_TABLE_OPTIONS","QUERY_EDITOR_SET_TITLE","QUERY_EDITOR_SET_AUTORUN","QUERY_EDITOR_SET_SQL","QUERY_EDITOR_SET_QUERY_LIMIT","QUERY_EDITOR_SET_TEMPLATE_PARAMS","QUERY_EDITOR_SET_SELECTED_TEXT","QUERY_EDITOR_SET_FUNCTION_NAMES","QUERY_EDITOR_PERSIST_HEIGHT","QUERY_EDITOR_TOGGLE_LEFT_BAR","MIGRATE_QUERY_EDITOR","MIGRATE_TAB_HISTORY","MIGRATE_TABLE","MIGRATE_QUERY","SET_DATABASES","SET_ACTIVE_QUERY_EDITOR","LOAD_QUERY_EDITOR","SET_TABLES","SET_ACTIVE_SOUTHPANE_TAB","REFRESH_QUERIES","SET_USER_OFFLINE","RUN_QUERY","START_QUERY","STOP_QUERY","REQUEST_QUERY_RESULTS","QUERY_SUCCESS","QUERY_FAILED","CLEAR_QUERY_RESULTS","REMOVE_DATA_PREVIEW","CHANGE_DATA_PREVIEW_ID","START_QUERY_VALIDATION","QUERY_VALIDATION_RETURNED","QUERY_VALIDATION_FAILED","COST_ESTIMATE_STARTED","COST_ESTIMATE_RETURNED","COST_ESTIMATE_FAILED","CREATE_DATASOURCE_STARTED","CREATE_DATASOURCE_SUCCESS","CREATE_DATASOURCE_FAILED","CtasEnum","TABLE","VIEW","ERR_MSG_CANT_LOAD_QUERY","queryClientMapping","id","db_id","client_id","label","queryServerMapping","fieldConverter","mapping","obj","value","key","convertQueryToServer","convertQueryToClient","resetState","type","startQueryValidation","query","generate","queryValidationReturned","results","queryValidationFailed","message","error","updateQueryEditor","alterations","scheduleQuery","dispatch","post","endpoint","postPayload","stringify","then","catch","estimateQueryCost","dbId","schema","sql","templateParams","all","JSON","parse","json","response","statusText","startQuery","progress","startDttm","state","runAsync","cached","querySuccess","sync","isDataPreview","SQLLAB_BACKEND_PERSISTENCE","put","encodeURI","sqlEditorId","latest_query_id","resolve","queryFailed","msg","link","errors","stopQuery","clearQueryResults","removeDataPreview","table","requestQueryResults","fetchQueryResults","displayLimit","get","resultsKey","parseMethod","text","bigIntJson","runQuery","database_id","sql_editor_id","tab","tmp_table_name","tempTable","select_as_cta","ctas","ctas_method","queryLimit","expand_data","body","headers","SESSION_TIMED_OUT","reRunQuery","validateQuery","validate_only","window","location","search","postStopQuery","setDatabases","databases","migrateTable","queryEditorId","newTable","oldTable","migrateQuery","queryId","migrateQueryEditorFromLocalStorage","queryEditor","tables","queries","newQueryEditor","toString","oldQueryEditor","oldId","newId","addQueryEditor","cloneQueryToNewTab","autorun","getState","queryEditors","tabHistory","sqlLab","sourceQueryEditor","qe","length","title","maxRow","setActiveQueryEditor","status","loadQueryEditor","setTables","tableSchemas","tableSchema","description","columns","selectStar","primaryKey","foreignKeys","indexes","dataPreviewQueryId","tab_state_id","name","expanded","isMetadataLoading","isExtraMetadataLoading","switchQueryEditor","loaded","loadedQueryEditor","selectedText","latestQueryId","latest_query","template_params","query_limit","validationResult","completed","hideLeftBar","hide_left_bar","table_schemas","setActiveSouthPaneTab","tabId","toggleLeftBar","removeQueryEditor","delete","removeQuery","queryEditorSetDb","queryEditorSetSchema","queryEditorSetSchemaOptions","options","queryEditorSetTableOptions","queryEditorSetAutorun","queryEditorSetTitle","saveQuery","result","item","updateSavedQuery","remoteId","queryEditorSetSql","queryEditorSetQueryLimit","queryEditorSetTemplateParams","queryEditorSetSelectedText","mergeTable","getTableMetadata","encodeURIComponent","dataPreviewQuery","tableName","getTableExtendedMetadata","addTable","schemaName","resultJson","changeDataPreviewId","oldQueryId","newQuery","reFetchQueryResults","expandTable","collapseTable","removeTable","refreshQueries","alteredQueries","setUserOffline","offline","persistEditorHeight","northPercent","southPercent","popStoredQuery","urlId","popSavedQuery","saveQueryId","queryEditorProps","popQuery","queryData","database","tab_name","popDatasourceQuery","datasourceKey","undefined","select_star","createDatasourceStarted","createDatasourceSuccess","data","datasource","table_id","createDatasourceFailed","err","createDatasource","vizOptions","reject","createCtasDatasource","errorMsg","Error","queryEditorSetFunctionNames","functionNames","function_names"],"mappings":"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GACAC,Y,iGACAC,S,8FACAC,Y,iGACAC,Y,iGACAC,c,mGACAC,kB,uGACAC,uB,4GACAC,+B,oHAEAC,8B,mHACAC,sB,2GACAC,wB,6GACAC,oB,yGACAC,4B,iHACAC,gC,qHAEAC,8B,mHACAC,+B,oHAEAC,2B,gHACAC,4B,iHACAC,oB,yGACAC,mB,wGACAC,a,kGACAC,a,kGAEAC,a,kGACAC,uB,4GACAC,iB,sGACAC,U,+FACAC,wB,6GACAC,e,oGACAC,gB,qGACAC,S,8FACAC,W,gGACAC,U,+FACAC,qB,0GACAC,a,kGACAC,Y,iGACAC,mB,wGACAC,mB,wGACAC,sB,2GAEAC,sB,2GACAC,yB,8GACAC,uB,4GACAC,qB,0GACAC,sB,2GACAC,oB,yGAEAC,yB,8GACAC,yB,8GACAC,wB,6GAEA7D,Y,iGACAE,e,oGACAJ,c,mGACAM,e,oGAEA0D,Q,6FAIPG,uB,4GAKAC,kB,uGAMAK,kB,uGAGAC,c,mGAGAK,oB,yGACAC,oB,yGAEUC,U,+FAIAE,oB,yGAOAG,uB,4GAIAE,qB,0GAIAG,iB,sGAIAE,a,kGAqBAQ,iB,sGAmCAW,U,+FAWAM,Y,iGA0BAS,W,gGA0BAI,S,8FAIAC,iB,sGAIAC,iB,sGAIAE,mB,wGAIAC,iB,sGA2BAO,Q,6FA4CAc,U,+FAOAC,a,kGAiCAK,a,kGAiBAC,Y,iGAIPE,Y,iGAyBAI,Y,iGAkBOE,kC,uHA+CAS,c,mGAgCAC,kB,uGAqBAW,oB,yGA0BAE,e,oGAIAC,S,8FAgCAe,iB,sGAkDAa,qB,0GAIAE,a,kGA8BAC,iB,sGAsBAE,W,gGAwBAC,gB,qGAuBAC,oB,yGAyBAC,2B,gHAIAE,0B,+GAIAC,qB,0GAyBAC,mB,wGAyBAC,S,8FAqBAG,gB,qGAiBAE,iB,sGAyBAC,wB,6GA6BAC,4B,iHA8BAC,0B,+GAIAC,U,+FAIPC,gB,qGAgDAI,wB,6GAyBOC,Q,6FA8CAG,mB,wGAIAG,mB,wGAmBAC,W,gGAwBAC,a,kGAwBAC,W,gGAuBAC,c,mGAIAE,c,mGAIAE,mB,wGASAG,c,mGAiBAE,a,kGAeAG,Q,6FAmBAI,kB,uGAqBAI,uB,4GAGAC,uB,4GAIAI,sB,2GAIAE,gB,qGAwBAG,oB,yGAoBAG,2B","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport JSONbig from 'json-bigint';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport invert from 'lodash/invert';\nimport mapKeys from 'lodash/mapKeys';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\n\nimport { now } from '../../modules/dates';\nimport {\n  addDangerToast as addDangerToastAction,\n  addInfoToast as addInfoToastAction,\n  addSuccessToast as addSuccessToastAction,\n  addWarningToast as addWarningToastAction,\n} from '../../messageToasts/actions/index';\nimport { getClientErrorObject } from '../../utils/getClientErrorObject';\nimport COMMON_ERR_MESSAGES from '../../utils/errorMessages';\n\nexport const RESET_STATE = 'RESET_STATE';\nexport const ADD_QUERY_EDITOR = 'ADD_QUERY_EDITOR';\nexport const UPDATE_QUERY_EDITOR = 'UPDATE_QUERY_EDITOR';\nexport const QUERY_EDITOR_SAVED = 'QUERY_EDITOR_SAVED';\nexport const CLONE_QUERY_TO_NEW_TAB = 'CLONE_QUERY_TO_NEW_TAB';\nexport const REMOVE_QUERY_EDITOR = 'REMOVE_QUERY_EDITOR';\nexport const MERGE_TABLE = 'MERGE_TABLE';\nexport const REMOVE_TABLE = 'REMOVE_TABLE';\nexport const END_QUERY = 'END_QUERY';\nexport const REMOVE_QUERY = 'REMOVE_QUERY';\nexport const EXPAND_TABLE = 'EXPAND_TABLE';\nexport const COLLAPSE_TABLE = 'COLLAPSE_TABLE';\nexport const QUERY_EDITOR_SETDB = 'QUERY_EDITOR_SETDB';\nexport const QUERY_EDITOR_SET_SCHEMA = 'QUERY_EDITOR_SET_SCHEMA';\nexport const QUERY_EDITOR_SET_SCHEMA_OPTIONS =\n  'QUERY_EDITOR_SET_SCHEMA_OPTIONS';\nexport const QUERY_EDITOR_SET_TABLE_OPTIONS = 'QUERY_EDITOR_SET_TABLE_OPTIONS';\nexport const QUERY_EDITOR_SET_TITLE = 'QUERY_EDITOR_SET_TITLE';\nexport const QUERY_EDITOR_SET_AUTORUN = 'QUERY_EDITOR_SET_AUTORUN';\nexport const QUERY_EDITOR_SET_SQL = 'QUERY_EDITOR_SET_SQL';\nexport const QUERY_EDITOR_SET_QUERY_LIMIT = 'QUERY_EDITOR_SET_QUERY_LIMIT';\nexport const QUERY_EDITOR_SET_TEMPLATE_PARAMS =\n  'QUERY_EDITOR_SET_TEMPLATE_PARAMS';\nexport const QUERY_EDITOR_SET_SELECTED_TEXT = 'QUERY_EDITOR_SET_SELECTED_TEXT';\nexport const QUERY_EDITOR_SET_FUNCTION_NAMES =\n  'QUERY_EDITOR_SET_FUNCTION_NAMES';\nexport const QUERY_EDITOR_PERSIST_HEIGHT = 'QUERY_EDITOR_PERSIST_HEIGHT';\nexport const QUERY_EDITOR_TOGGLE_LEFT_BAR = 'QUERY_EDITOR_TOGGLE_LEFT_BAR';\nexport const MIGRATE_QUERY_EDITOR = 'MIGRATE_QUERY_EDITOR';\nexport const MIGRATE_TAB_HISTORY = 'MIGRATE_TAB_HISTORY';\nexport const MIGRATE_TABLE = 'MIGRATE_TABLE';\nexport const MIGRATE_QUERY = 'MIGRATE_QUERY';\n\nexport const SET_DATABASES = 'SET_DATABASES';\nexport const SET_ACTIVE_QUERY_EDITOR = 'SET_ACTIVE_QUERY_EDITOR';\nexport const LOAD_QUERY_EDITOR = 'LOAD_QUERY_EDITOR';\nexport const SET_TABLES = 'SET_TABLES';\nexport const SET_ACTIVE_SOUTHPANE_TAB = 'SET_ACTIVE_SOUTHPANE_TAB';\nexport const REFRESH_QUERIES = 'REFRESH_QUERIES';\nexport const SET_USER_OFFLINE = 'SET_USER_OFFLINE';\nexport const RUN_QUERY = 'RUN_QUERY';\nexport const START_QUERY = 'START_QUERY';\nexport const STOP_QUERY = 'STOP_QUERY';\nexport const REQUEST_QUERY_RESULTS = 'REQUEST_QUERY_RESULTS';\nexport const QUERY_SUCCESS = 'QUERY_SUCCESS';\nexport const QUERY_FAILED = 'QUERY_FAILED';\nexport const CLEAR_QUERY_RESULTS = 'CLEAR_QUERY_RESULTS';\nexport const REMOVE_DATA_PREVIEW = 'REMOVE_DATA_PREVIEW';\nexport const CHANGE_DATA_PREVIEW_ID = 'CHANGE_DATA_PREVIEW_ID';\n\nexport const START_QUERY_VALIDATION = 'START_QUERY_VALIDATION';\nexport const QUERY_VALIDATION_RETURNED = 'QUERY_VALIDATION_RETURNED';\nexport const QUERY_VALIDATION_FAILED = 'QUERY_VALIDATION_FAILED';\nexport const COST_ESTIMATE_STARTED = 'COST_ESTIMATE_STARTED';\nexport const COST_ESTIMATE_RETURNED = 'COST_ESTIMATE_RETURNED';\nexport const COST_ESTIMATE_FAILED = 'COST_ESTIMATE_FAILED';\n\nexport const CREATE_DATASOURCE_STARTED = 'CREATE_DATASOURCE_STARTED';\nexport const CREATE_DATASOURCE_SUCCESS = 'CREATE_DATASOURCE_SUCCESS';\nexport const CREATE_DATASOURCE_FAILED = 'CREATE_DATASOURCE_FAILED';\n\nexport const addInfoToast = addInfoToastAction;\nexport const addSuccessToast = addSuccessToastAction;\nexport const addDangerToast = addDangerToastAction;\nexport const addWarningToast = addWarningToastAction;\n\nexport const CtasEnum = {\n  TABLE: 'TABLE',\n  VIEW: 'VIEW',\n};\nconst ERR_MSG_CANT_LOAD_QUERY = t(\"The query couldn't be loaded\");\n\n// a map of SavedQuery field names to the different names used client-side,\n// because for now making the names consistent is too complicated\n// so it might as well only happen in one place\nconst queryClientMapping = {\n  id: 'remoteId',\n  db_id: 'dbId',\n  client_id: 'id',\n  label: 'title',\n};\nconst queryServerMapping = invert(queryClientMapping);\n\n// uses a mapping like those above to convert object key names to another style\nconst fieldConverter = mapping => obj =>\n  mapKeys(obj, (value, key) => (key in mapping ? mapping[key] : key));\n\nconst convertQueryToServer = fieldConverter(queryServerMapping);\nconst convertQueryToClient = fieldConverter(queryClientMapping);\n\nexport function resetState() {\n  return { type: RESET_STATE };\n}\n\nexport function startQueryValidation(query) {\n  Object.assign(query, {\n    id: query.id ? query.id : shortid.generate(),\n  });\n  return { type: START_QUERY_VALIDATION, query };\n}\n\nexport function queryValidationReturned(query, results) {\n  return { type: QUERY_VALIDATION_RETURNED, query, results };\n}\n\nexport function queryValidationFailed(query, message, error) {\n  return { type: QUERY_VALIDATION_FAILED, query, message, error };\n}\n\nexport function updateQueryEditor(alterations) {\n  return { type: UPDATE_QUERY_EDITOR, alterations };\n}\n\nexport function scheduleQuery(query) {\n  return dispatch =>\n    SupersetClient.post({\n      endpoint: '/savedqueryviewapi/api/create',\n      postPayload: query,\n      stringify: false,\n    })\n      .then(() =>\n        dispatch(\n          addSuccessToast(\n            t(\n              'Your query has been scheduled. To see details of your query, navigate to Saved queries',\n            ),\n          ),\n        ),\n      )\n      .catch(() =>\n        dispatch(addDangerToast(t('Your query could not be scheduled'))),\n      );\n}\n\nexport function estimateQueryCost(query) {\n  const { dbId, schema, sql, templateParams } = query;\n  const endpoint =\n    schema === null\n      ? `/superset/estimate_query_cost/${dbId}/`\n      : `/superset/estimate_query_cost/${dbId}/${schema}/`;\n  return dispatch =>\n    Promise.all([\n      dispatch({ type: COST_ESTIMATE_STARTED, query }),\n      SupersetClient.post({\n        endpoint,\n        postPayload: {\n          sql,\n          templateParams: JSON.parse(templateParams || '{}'),\n        },\n      })\n        .then(({ json }) =>\n          dispatch({ type: COST_ESTIMATE_RETURNED, query, json }),\n        )\n        .catch(response =>\n          getClientErrorObject(response).then(error => {\n            const message =\n              error.error ||\n              error.statusText ||\n              t('Failed at retrieving results');\n            return dispatch({\n              type: COST_ESTIMATE_FAILED,\n              query,\n              error: message,\n            });\n          }),\n        ),\n    ]);\n}\n\nexport function startQuery(query) {\n  Object.assign(query, {\n    id: query.id ? query.id : shortid.generate(),\n    progress: 0,\n    startDttm: now(),\n    state: query.runAsync ? 'pending' : 'running',\n    cached: false,\n  });\n  return { type: START_QUERY, query };\n}\n\nexport function querySuccess(query, results) {\n  return function (dispatch) {\n    const sync =\n      !query.isDataPreview &&\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n        ? SupersetClient.put({\n            endpoint: encodeURI(`/tabstateview/${results.query.sqlEditorId}`),\n            postPayload: { latest_query_id: query.id },\n          })\n        : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: QUERY_SUCCESS, query, results }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while storing the latest query id in the backend. ' +\n                'Please contact your administrator if this problem persists.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryFailed(query, msg, link, errors) {\n  return function (dispatch) {\n    const sync =\n      !query.isDataPreview &&\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n        ? SupersetClient.put({\n            endpoint: encodeURI(`/tabstateview/${query.sqlEditorId}`),\n            postPayload: { latest_query_id: query.id },\n          })\n        : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: QUERY_FAILED, query, msg, link, errors }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while storing the latest query id in the backend. ' +\n                'Please contact your administrator if this problem persists.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function stopQuery(query) {\n  return { type: STOP_QUERY, query };\n}\n\nexport function clearQueryResults(query) {\n  return { type: CLEAR_QUERY_RESULTS, query };\n}\n\nexport function removeDataPreview(table) {\n  return { type: REMOVE_DATA_PREVIEW, table };\n}\n\nexport function requestQueryResults(query) {\n  return { type: REQUEST_QUERY_RESULTS, query };\n}\n\nexport function fetchQueryResults(query, displayLimit) {\n  return function (dispatch) {\n    dispatch(requestQueryResults(query));\n\n    return SupersetClient.get({\n      endpoint: `/superset/results/${query.resultsKey}/?rows=${displayLimit}`,\n      parseMethod: 'text',\n    })\n      .then(({ text = '{}' }) => {\n        const bigIntJson = JSONbig.parse(text);\n        return dispatch(querySuccess(query, bigIntJson));\n      })\n      .catch(response =>\n        getClientErrorObject(response).then(error => {\n          const message =\n            error.error ||\n            error.statusText ||\n            t('Failed at retrieving results');\n\n          return dispatch(\n            queryFailed(query, message, error.link, error.errors),\n          );\n        }),\n      );\n  };\n}\n\nexport function runQuery(query) {\n  return function (dispatch) {\n    dispatch(startQuery(query));\n    const postPayload = {\n      client_id: query.id,\n      database_id: query.dbId,\n      json: true,\n      runAsync: query.runAsync,\n      schema: query.schema,\n      sql: query.sql,\n      sql_editor_id: query.sqlEditorId,\n      tab: query.tab,\n      tmp_table_name: query.tempTable,\n      select_as_cta: query.ctas,\n      ctas_method: query.ctas_method,\n      templateParams: query.templateParams,\n      queryLimit: query.queryLimit,\n      expand_data: true,\n    };\n\n    return SupersetClient.post({\n      endpoint: '/superset/sql_json/',\n      body: JSON.stringify(postPayload),\n      headers: { 'Content-Type': 'application/json' },\n      parseMethod: 'text',\n    })\n      .then(({ text = '{}' }) => {\n        if (!query.runAsync) {\n          const bigIntJson = JSONbig.parse(text);\n          dispatch(querySuccess(query, bigIntJson));\n        }\n      })\n      .catch(response =>\n        getClientErrorObject(response).then(error => {\n          let message = error.error || error.statusText || t('Unknown error');\n          if (message.includes('CSRF token')) {\n            message = t(COMMON_ERR_MESSAGES.SESSION_TIMED_OUT);\n          }\n          dispatch(queryFailed(query, message, error.link, error.errors));\n        }),\n      );\n  };\n}\n\nexport function reRunQuery(query) {\n  // run Query with a new id\n  return function (dispatch) {\n    dispatch(runQuery({ ...query, id: shortid.generate() }));\n  };\n}\n\nexport function validateQuery(query) {\n  return function (dispatch) {\n    dispatch(startQueryValidation(query));\n\n    const postPayload = {\n      client_id: query.id,\n      database_id: query.dbId,\n      json: true,\n      schema: query.schema,\n      sql: query.sql,\n      sql_editor_id: query.sqlEditorId,\n      templateParams: query.templateParams,\n      validate_only: true,\n    };\n\n    return SupersetClient.post({\n      endpoint: `/superset/validate_sql_json/${window.location.search}`,\n      postPayload,\n      stringify: false,\n    })\n      .then(({ json }) => dispatch(queryValidationReturned(query, json)))\n      .catch(response =>\n        getClientErrorObject(response).then(error => {\n          let message = error.error || error.statusText || t('Unknown error');\n          if (message.includes('CSRF token')) {\n            message = t(COMMON_ERR_MESSAGES.SESSION_TIMED_OUT);\n          }\n          dispatch(queryValidationFailed(query, message, error));\n        }),\n      );\n  };\n}\n\nexport function postStopQuery(query) {\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/superset/stop_query/',\n      postPayload: { client_id: query.id },\n      stringify: false,\n    })\n      .then(() => dispatch(stopQuery(query)))\n      .then(() => dispatch(addSuccessToast(t('Query was stopped.'))))\n      .catch(() =>\n        dispatch(\n          addDangerToast(`${t('Failed at stopping query. ')}'${query.id}'`),\n        ),\n      );\n  };\n}\n\nexport function setDatabases(databases) {\n  return { type: SET_DATABASES, databases };\n}\n\nfunction migrateTable(table, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI('/tableschemaview/'),\n    postPayload: { table: { ...table, queryEditorId } },\n  })\n    .then(({ json }) => {\n      const newTable = {\n        ...table,\n        id: json.id,\n        queryEditorId,\n      };\n      return dispatch({ type: MIGRATE_TABLE, oldTable: table, newTable });\n    })\n    .catch(() =>\n      dispatch(\n        addWarningToast(\n          t(\n            'Unable to migrate table schema state to backend. Superset will retry ' +\n              'later. Please contact your administrator if this problem persists.',\n          ),\n        ),\n      ),\n    );\n}\n\nfunction migrateQuery(queryId, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI(`/tabstateview/${queryEditorId}/migrate_query`),\n    postPayload: { queryId },\n  })\n    .then(() => dispatch({ type: MIGRATE_QUERY, queryId, queryEditorId }))\n    .catch(() =>\n      dispatch(\n        addWarningToast(\n          t(\n            'Unable to migrate query state to backend. Superset will retry later. ' +\n              'Please contact your administrator if this problem persists.',\n          ),\n        ),\n      ),\n    );\n}\n\nexport function migrateQueryEditorFromLocalStorage(\n  queryEditor,\n  tables,\n  queries,\n) {\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/tabstateview/',\n      postPayload: { queryEditor },\n    })\n      .then(({ json }) => {\n        const newQueryEditor = {\n          ...queryEditor,\n          id: json.id.toString(),\n        };\n        dispatch({\n          type: MIGRATE_QUERY_EDITOR,\n          oldQueryEditor: queryEditor,\n          newQueryEditor,\n        });\n        dispatch({\n          type: MIGRATE_TAB_HISTORY,\n          oldId: queryEditor.id,\n          newId: newQueryEditor.id,\n        });\n        return Promise.all([\n          ...tables.map(table =>\n            migrateTable(table, newQueryEditor.id, dispatch),\n          ),\n          ...queries.map(query =>\n            migrateQuery(query.id, newQueryEditor.id, dispatch),\n          ),\n        ]);\n      })\n      .catch(() =>\n        dispatch(\n          addWarningToast(\n            t(\n              'Unable to migrate query editor state to backend. Superset will retry ' +\n                'later. Please contact your administrator if this problem persists.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function addQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: '/tabstateview/',\n          postPayload: { queryEditor },\n        })\n      : Promise.resolve({ json: { id: shortid.generate() } });\n\n    return sync\n      .then(({ json }) => {\n        const newQueryEditor = {\n          ...queryEditor,\n          id: json.id.toString(),\n        };\n        return dispatch({\n          type: ADD_QUERY_EDITOR,\n          queryEditor: newQueryEditor,\n        });\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'Unable to add a new tab to the backend. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function cloneQueryToNewTab(query, autorun) {\n  return function (dispatch, getState) {\n    const state = getState();\n    const { queryEditors, tabHistory } = state.sqlLab;\n    const sourceQueryEditor = queryEditors.find(\n      qe => qe.id === tabHistory[tabHistory.length - 1],\n    );\n    const queryEditor = {\n      title: t('Copy of %s', sourceQueryEditor.title),\n      dbId: query.dbId ? query.dbId : null,\n      schema: query.schema ? query.schema : null,\n      autorun,\n      sql: query.sql,\n      queryLimit: sourceQueryEditor.queryLimit,\n      maxRow: sourceQueryEditor.maxRow,\n      templateParams: sourceQueryEditor.templateParams,\n    };\n    return dispatch(addQueryEditor(queryEditor));\n  };\n}\n\nexport function setActiveQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}/activate`),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: SET_ACTIVE_QUERY_EDITOR, queryEditor }))\n      .catch(response => {\n        if (response.status !== 404) {\n          return dispatch(\n            addDangerToast(\n              t(\n                'An error occurred while setting the active tab. Please contact ' +\n                  'your administrator.',\n              ),\n            ),\n          );\n        }\n        return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n      });\n  };\n}\n\nexport function loadQueryEditor(queryEditor) {\n  return { type: LOAD_QUERY_EDITOR, queryEditor };\n}\n\nexport function setTables(tableSchemas) {\n  const tables = tableSchemas\n    .filter(tableSchema => tableSchema.description !== null)\n    .map(tableSchema => {\n      const {\n        columns,\n        selectStar,\n        primaryKey,\n        foreignKeys,\n        indexes,\n        dataPreviewQueryId,\n      } = tableSchema.description;\n      return {\n        dbId: tableSchema.database_id,\n        queryEditorId: tableSchema.tab_state_id.toString(),\n        schema: tableSchema.schema,\n        name: tableSchema.table,\n        expanded: tableSchema.expanded,\n        id: tableSchema.id,\n        dataPreviewQueryId,\n        columns,\n        selectStar,\n        primaryKey,\n        foreignKeys,\n        indexes,\n        isMetadataLoading: false,\n        isExtraMetadataLoading: false,\n      };\n    });\n  return { type: SET_TABLES, tables };\n}\n\nexport function switchQueryEditor(queryEditor, displayLimit) {\n  return function (dispatch) {\n    if (\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n      !queryEditor.loaded\n    ) {\n      SupersetClient.get({\n        endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      })\n        .then(({ json }) => {\n          const loadedQueryEditor = {\n            id: json.id.toString(),\n            loaded: true,\n            title: json.label,\n            sql: json.sql,\n            selectedText: null,\n            latestQueryId: json.latest_query ? json.latest_query.id : null,\n            autorun: json.autorun,\n            dbId: json.database_id,\n            templateParams: json.template_params,\n            schema: json.schema,\n            queryLimit: json.query_limit,\n            validationResult: {\n              id: null,\n              errors: [],\n              completed: false,\n            },\n            hideLeftBar: json.hide_left_bar,\n          };\n          dispatch(loadQueryEditor(loadedQueryEditor));\n          dispatch(setTables(json.table_schemas || []));\n          dispatch(setActiveQueryEditor(loadedQueryEditor));\n          if (json.latest_query && json.latest_query.resultsKey) {\n            dispatch(fetchQueryResults(json.latest_query, displayLimit));\n          }\n        })\n        .catch(response => {\n          if (response.status !== 404) {\n            return dispatch(\n              addDangerToast(t('An error occurred while fetching tab state')),\n            );\n          }\n          return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n        });\n    } else {\n      dispatch(setActiveQueryEditor(queryEditor));\n    }\n  };\n}\n\nexport function setActiveSouthPaneTab(tabId) {\n  return { type: SET_ACTIVE_SOUTHPANE_TAB, tabId };\n}\n\nexport function toggleLeftBar(queryEditor) {\n  const hideLeftBar = !queryEditor.hideLeftBar;\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { hide_left_bar: hideLeftBar },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_TOGGLE_LEFT_BAR,\n          queryEditor,\n          hideLeftBar,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while hiding the left bar. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function removeQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.delete({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while removing tab. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function removeQuery(query) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.delete({\n          endpoint: encodeURI(\n            `/tabstateview/${query.sqlEditorId}/query/${query.id}`,\n          ),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: REMOVE_QUERY, query }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while removing query. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetDb(queryEditor, dbId) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { database_id: dbId },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: QUERY_EDITOR_SETDB, queryEditor, dbId }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab database ID. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetSchema(queryEditor, schema) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { schema },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({ type: QUERY_EDITOR_SET_SCHEMA, queryEditor, schema }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab schema. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetSchemaOptions(queryEditor, options) {\n  return { type: QUERY_EDITOR_SET_SCHEMA_OPTIONS, queryEditor, options };\n}\n\nexport function queryEditorSetTableOptions(queryEditor, options) {\n  return { type: QUERY_EDITOR_SET_TABLE_OPTIONS, queryEditor, options };\n}\n\nexport function queryEditorSetAutorun(queryEditor, autorun) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { autorun },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({ type: QUERY_EDITOR_SET_AUTORUN, queryEditor, autorun }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab autorun. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetTitle(queryEditor, title) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { label: title },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({ type: QUERY_EDITOR_SET_TITLE, queryEditor, title }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab title. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function saveQuery(query) {\n  return dispatch =>\n    SupersetClient.post({\n      endpoint: '/savedqueryviewapi/api/create',\n      postPayload: convertQueryToServer(query),\n      stringify: false,\n    })\n      .then(result => {\n        dispatch({\n          type: QUERY_EDITOR_SAVED,\n          query,\n          result: convertQueryToClient(result.json.item),\n        });\n        dispatch(addSuccessToast(t('Your query was saved')));\n        dispatch(queryEditorSetTitle(query, query.title));\n      })\n      .catch(() =>\n        dispatch(addDangerToast(t('Your query could not be saved'))),\n      );\n}\n\nexport function updateSavedQuery(query) {\n  return dispatch =>\n    SupersetClient.put({\n      endpoint: `/savedqueryviewapi/api/update/${query.remoteId}`,\n      postPayload: convertQueryToServer(query),\n      stringify: false,\n    })\n      .then(() => {\n        dispatch(addSuccessToast(t('Your query was updated')));\n        dispatch(queryEditorSetTitle(query, query.title));\n      })\n      .catch(() =>\n        dispatch(addDangerToast(t('Your query could not be updated'))),\n      )\n      .then(() => dispatch(updateQueryEditor(query)));\n}\n\nexport function queryEditorSetSql(queryEditor, sql) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { sql, latest_query_id: queryEditor.latestQueryId },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: QUERY_EDITOR_SET_SQL, queryEditor, sql }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while storing your query in the backend. To ' +\n                'avoid losing your changes, please save your query using the ' +\n                '\"Save Query\" button.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetQueryLimit(queryEditor, queryLimit) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { query_limit: queryLimit },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_SET_QUERY_LIMIT,\n          queryEditor,\n          queryLimit,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab title. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetTemplateParams(queryEditor, templateParams) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { template_params: templateParams },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_SET_TEMPLATE_PARAMS,\n          queryEditor,\n          templateParams,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab template parameters. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetSelectedText(queryEditor, sql) {\n  return { type: QUERY_EDITOR_SET_SELECTED_TEXT, queryEditor, sql };\n}\n\nexport function mergeTable(table, query) {\n  return { type: MERGE_TABLE, table, query };\n}\n\nfunction getTableMetadata(table, query, dispatch) {\n  return SupersetClient.get({\n    endpoint: encodeURI(\n      `/api/v1/database/${query.dbId}/table/${encodeURIComponent(\n        table.name,\n      )}/${encodeURIComponent(table.schema)}/`,\n    ),\n  })\n    .then(({ json }) => {\n      const dataPreviewQuery = {\n        id: shortid.generate(),\n        dbId: query.dbId,\n        sql: json.selectStar,\n        tableName: table.name,\n        sqlEditorId: null,\n        tab: '',\n        runAsync: false,\n        ctas: false,\n        isDataPreview: true,\n      };\n      const newTable = {\n        ...table,\n        ...json,\n        expanded: true,\n        isMetadataLoading: false,\n        dataPreviewQueryId: dataPreviewQuery.id,\n      };\n      Promise.all([\n        dispatch(mergeTable(newTable, dataPreviewQuery)), // Merge table to tables in state\n        dispatch(runQuery(dataPreviewQuery)), // Run query to get preview data for table\n      ]);\n      return newTable;\n    })\n    .catch(() =>\n      Promise.all([\n        dispatch(\n          mergeTable({\n            ...table,\n            isMetadataLoading: false,\n          }),\n        ),\n        dispatch(\n          addDangerToast(t('An error occurred while fetching table metadata')),\n        ),\n      ]),\n    );\n}\n\nfunction getTableExtendedMetadata(table, query, dispatch) {\n  return SupersetClient.get({\n    endpoint: encodeURI(\n      `/superset/extra_table_metadata/${query.dbId}/` +\n        `${encodeURIComponent(table.name)}/${encodeURIComponent(\n          table.schema,\n        )}/`,\n    ),\n  })\n    .then(({ json }) => {\n      dispatch(\n        mergeTable({ ...table, ...json, isExtraMetadataLoading: false }),\n      );\n      return json;\n    })\n    .catch(() =>\n      Promise.all([\n        dispatch(mergeTable({ ...table, isExtraMetadataLoading: false })),\n        dispatch(\n          addDangerToast(t('An error occurred while fetching table metadata')),\n        ),\n      ]),\n    );\n}\n\nexport function addTable(query, tableName, schemaName) {\n  return function (dispatch) {\n    const table = {\n      dbId: query.dbId,\n      queryEditorId: query.id,\n      schema: schemaName,\n      name: tableName,\n    };\n    dispatch(\n      mergeTable({\n        ...table,\n        isMetadataLoading: true,\n        isExtraMetadataLoading: true,\n        expanded: true,\n      }),\n    );\n\n    return Promise.all([\n      getTableMetadata(table, query, dispatch),\n      getTableExtendedMetadata(table, query, dispatch),\n    ]).then(([newTable, json]) => {\n      const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n        ? SupersetClient.post({\n            endpoint: encodeURI('/tableschemaview/'),\n            postPayload: { table: { ...newTable, ...json } },\n          })\n        : Promise.resolve({ json: { id: shortid.generate() } });\n\n      return sync\n        .then(({ json: resultJson }) =>\n          dispatch(mergeTable({ ...table, id: resultJson.id })),\n        )\n        .catch(() =>\n          dispatch(\n            addDangerToast(\n              t(\n                'An error occurred while fetching table metadata. ' +\n                  'Please contact your administrator.',\n              ),\n            ),\n          ),\n        );\n    });\n  };\n}\n\nexport function changeDataPreviewId(oldQueryId, newQuery) {\n  return { type: CHANGE_DATA_PREVIEW_ID, oldQueryId, newQuery };\n}\n\nexport function reFetchQueryResults(query) {\n  return function (dispatch) {\n    const newQuery = {\n      id: shortid.generate(),\n      dbId: query.dbId,\n      sql: query.sql,\n      tableName: query.tableName,\n      sqlEditorId: null,\n      tab: '',\n      runAsync: false,\n      ctas: false,\n      queryLimit: query.queryLimit,\n      isDataPreview: query.isDataPreview,\n    };\n    dispatch(runQuery(newQuery));\n    dispatch(changeDataPreviewId(query.id, newQuery));\n  };\n}\n\nexport function expandTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n          postPayload: { expanded: true },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: EXPAND_TABLE, table }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while expanding the table schema. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function collapseTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n          postPayload: { expanded: false },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: COLLAPSE_TABLE, table }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while collapsing the table schema. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function removeTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.delete({\n          endpoint: encodeURI(`/tableschemaview/${table.id}`),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: REMOVE_TABLE, table }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while removing the table schema. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function refreshQueries(alteredQueries) {\n  return { type: REFRESH_QUERIES, alteredQueries };\n}\n\nexport function setUserOffline(offline) {\n  return { type: SET_USER_OFFLINE, offline };\n}\n\nexport function persistEditorHeight(queryEditor, northPercent, southPercent) {\n  return {\n    type: QUERY_EDITOR_PERSIST_HEIGHT,\n    queryEditor,\n    northPercent,\n    southPercent,\n  };\n}\n\nexport function popStoredQuery(urlId) {\n  return function (dispatch) {\n    return SupersetClient.get({ endpoint: `/kv/${urlId}` })\n      .then(({ json }) =>\n        dispatch(\n          addQueryEditor({\n            title: json.title ? json.title : t('Shared query'),\n            dbId: json.dbId ? parseInt(json.dbId, 10) : null,\n            schema: json.schema ? json.schema : null,\n            autorun: json.autorun ? json.autorun : false,\n            sql: json.sql ? json.sql : 'SELECT ...',\n          }),\n        ),\n      )\n      .catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popSavedQuery(saveQueryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/savedqueryviewapi/api/get/${saveQueryId}`,\n    })\n      .then(({ json }) => {\n        const queryEditorProps = {\n          ...convertQueryToClient(json.result),\n          autorun: false,\n        };\n        return dispatch(addQueryEditor(queryEditorProps));\n      })\n      .catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popQuery(queryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/query/${queryId}`,\n    })\n      .then(({ json }) => {\n        const queryData = json.result;\n        const queryEditorProps = {\n          dbId: queryData.database.id,\n          schema: queryData.schema,\n          sql: queryData.sql,\n          title: `Copy of ${queryData.tab_name}`,\n          autorun: false,\n        };\n        return dispatch(addQueryEditor(queryEditorProps));\n      })\n      .catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popDatasourceQuery(datasourceKey, sql) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/superset/fetch_datasource_metadata?datasourceKey=${datasourceKey}`,\n    })\n      .then(({ json }) =>\n        dispatch(\n          addQueryEditor({\n            title: `Query ${json.name}`,\n            dbId: json.database.id,\n            schema: json.schema,\n            autorun: sql !== undefined,\n            sql: sql || json.select_star,\n          }),\n        ),\n      )\n      .catch(() =>\n        dispatch(addDangerToast(t(\"The datasource couldn't be loaded\"))),\n      );\n  };\n}\nexport function createDatasourceStarted() {\n  return { type: CREATE_DATASOURCE_STARTED };\n}\nexport function createDatasourceSuccess(data) {\n  const datasource = `${data.table_id}__table`;\n  return { type: CREATE_DATASOURCE_SUCCESS, datasource };\n}\nexport function createDatasourceFailed(err) {\n  return { type: CREATE_DATASOURCE_FAILED, err };\n}\n\nexport function createDatasource(vizOptions) {\n  return dispatch => {\n    dispatch(createDatasourceStarted());\n    return SupersetClient.post({\n      endpoint: '/superset/sqllab_viz/',\n      postPayload: { data: vizOptions },\n    })\n      .then(({ json }) => {\n        dispatch(createDatasourceSuccess(json));\n\n        return Promise.resolve(json);\n      })\n      .catch(() => {\n        dispatch(\n          createDatasourceFailed(\n            t('An error occurred while creating the data source'),\n          ),\n        );\n\n        return Promise.reject();\n      });\n  };\n}\n\nexport function createCtasDatasource(vizOptions) {\n  return dispatch => {\n    dispatch(createDatasourceStarted());\n    return SupersetClient.post({\n      endpoint: '/superset/get_or_create_table/',\n      postPayload: { data: vizOptions },\n    })\n      .then(({ json }) => {\n        dispatch(createDatasourceSuccess(json));\n\n        return json;\n      })\n      .catch(() => {\n        const errorMsg = t('An error occurred while creating the data source');\n        dispatch(createDatasourceFailed(errorMsg));\n        return Promise.reject(new Error(errorMsg));\n      });\n  };\n}\n\nexport function queryEditorSetFunctionNames(queryEditor, dbId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: encodeURI(`/api/v1/database/${dbId}/function_names/`),\n    })\n      .then(({ json }) =>\n        dispatch({\n          type: QUERY_EDITOR_SET_FUNCTION_NAMES,\n          queryEditor,\n          functionNames: json.function_names,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(t('An error occurred while fetching function names.')),\n        ),\n      );\n  };\n}\n"]},"metadata":{},"sourceType":"module"}