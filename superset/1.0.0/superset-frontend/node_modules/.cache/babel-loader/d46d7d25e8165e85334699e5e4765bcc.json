{"ast":null,"code":"import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _parseFloat from \"@babel/runtime-corejs3/core-js-stable/parse-float\";import _parseInt from \"@babel/runtime-corejs3/core-js-stable/parse-int\";import _Number$isNaN from \"@babel/runtime-corejs3/core-js-stable/number/is-nan\";import _findInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nimport Popover from 'src/components/Popover';\nimport FormRow from 'src/components/FormRow';\nimport SelectControl from 'src/explore/components/controls/SelectControl';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport { FILTER_CONFIG_ATTRIBUTES } from 'src/explore/constants';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst INTEGRAL_TYPES = new _Set([\n'TINYINT',\n'SMALLINT',\n'INT',\n'INTEGER',\n'BIGINT',\n'LONG']);\n\nconst DECIMAL_TYPES = new _Set([\n'FLOAT',\n'DOUBLE',\n'REAL',\n'NUMERIC',\n'DECIMAL',\n'MONEY']);\n\n\nconst propTypes = {\n  datasource: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  asc: PropTypes.bool,\n  clearable: PropTypes.bool,\n  multiple: PropTypes.bool,\n  column: PropTypes.string,\n  label: PropTypes.string,\n  metric: PropTypes.string,\n  searchAllOptions: PropTypes.bool,\n  defaultValue: PropTypes.string };\n\n\nconst defaultProps = {\n  onChange: () => {},\n  asc: true,\n  clearable: true,\n  multiple: true,\n  searchAllOptions: false };\n\n\nconst STYLE_WIDTH = { width: 350 };\n\nexport default class FilterBoxItemControl extends React.Component {\n  constructor(props) {var _context, _context2;\n    super(props);\n    const {\n      column,\n      metric,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      label,\n      defaultValue } =\n    props;\n    this.state = {\n      column,\n      metric,\n      label,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      defaultValue };\n\n    this.onChange = _bindInstanceProperty(_context = this.onChange).call(_context, this);\n    this.onControlChange = _bindInstanceProperty(_context2 = this.onControlChange).call(_context2, this);\n  }\n\n  onChange() {\n    this.props.onChange(this.state);\n  }\n\n  onControlChange(attr, value) {\n    let typedValue = value;\n    const { column: selectedColumnName, multiple } = this.state;\n    if (value && !multiple && attr === FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE) {var _context3;\n      // if single value filter_box,\n      // convert input value string to the column's data type\n      const { datasource } = this.props;\n      const selectedColumn = _findInstanceProperty(_context3 = datasource.columns).call(_context3,\n      col => col.column_name === selectedColumnName);\n\n\n      if (selectedColumn && selectedColumn.type) {\n        const type = selectedColumn.type.toUpperCase();\n        if (type === 'BOOLEAN') {\n          typedValue = value === 'true';\n        } else if (INTEGRAL_TYPES.has(type)) {\n          typedValue = _Number$isNaN(Number(value)) ? null : _parseInt(value, 10);\n        } else if (DECIMAL_TYPES.has(type)) {\n          typedValue = _Number$isNaN(Number(value)) ? null : _parseFloat(value);\n        }\n      }\n    }\n    this.setState({ [attr]: typedValue }, this.onChange);\n  }\n\n  setType() {}\n\n  textSummary() {\n    return this.state.column || 'N/A';\n  }\n\n  renderForm() {var _context4, _context5, _context6, _context7, _context8, _context9;\n    return (\n      ___EmotionJSX(\"div\", null,\n      ___EmotionJSX(FormRow, {\n        label: t('Column'),\n        control:\n        ___EmotionJSX(SelectControl, {\n          value: this.state.column,\n          name: \"column\",\n          clearable: false,\n          options: _concatInstanceProperty(_context4 = _mapInstanceProperty(_context5 = _filterInstanceProperty(_context6 = this.props.datasource.columns).call(_context6,\n          col => col !== this.state.column)).call(_context5,\n          col => ({\n            value: col.column_name,\n            label: col.column_name }))).call(_context4,\n\n          [\n          { value: this.state.column, label: this.state.column }]),\n\n          onChange: v => this.onControlChange('column', v) }) }),\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Label'),\n        control:\n        ___EmotionJSX(TextControl, {\n          value: this.state.label,\n          name: \"label\",\n          onChange: v => this.onControlChange('label', v) }) }),\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Default'),\n        tooltip: t(\n        '(optional) default value for the filter, when using ' +\n        'the multiple option, you can use a semicolon-delimited list ' +\n        'of options.'),\n\n        control:\n        ___EmotionJSX(TextControl, {\n          value: this.state.defaultValue,\n          name: \"defaultValue\",\n          onChange: (v) =>\n          this.onControlChange(FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE, v) }) }),\n\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Sort metric'),\n        tooltip: t('Metric to sort the results by'),\n        control:\n        ___EmotionJSX(SelectControl, {\n          value: this.state.metric,\n          name: \"column\",\n          options: _concatInstanceProperty(_context7 = _mapInstanceProperty(_context8 = _filterInstanceProperty(_context9 = this.props.datasource.metrics).call(_context9,\n          metric => metric !== this.state.metric)).call(_context8,\n          m => ({\n            value: m.metric_name,\n            label: m.metric_name }))).call(_context7,\n\n          [\n          { value: this.state.metric, label: this.state.metric }]),\n\n          onChange: v => this.onControlChange('metric', v) }) }),\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Sort ascending'),\n        tooltip: t('Check for sorting ascending'),\n        isCheckbox: true,\n        control:\n        ___EmotionJSX(CheckboxControl, {\n          value: this.state.asc,\n          onChange: v => this.onControlChange('asc', v) }) }),\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Allow multiple selections'),\n        isCheckbox: true,\n        tooltip: t(\n        'Multiple selections allowed, otherwise filter ' +\n        'is limited to a single value'),\n\n        control:\n        ___EmotionJSX(CheckboxControl, {\n          value: this.state.multiple,\n          onChange: (v) =>\n          this.onControlChange(FILTER_CONFIG_ATTRIBUTES.MULTIPLE, v) }) }),\n\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Search all filter options'),\n        tooltip: t(\n        'By default, each filter loads at most 1000 choices at the initial page load. ' +\n        'Check this box if you have more than 1000 filter values and want to enable dynamically ' +\n        'searching that loads filter values as users type (may add stress to your database).'),\n\n        isCheckbox: true,\n        control:\n        ___EmotionJSX(CheckboxControl, {\n          value: this.state.searchAllOptions,\n          onChange: (v) =>\n          this.onControlChange(\n          FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS,\n          v) }) }),\n\n\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Required'),\n        tooltip: t('User must select a value for this filter'),\n        isCheckbox: true,\n        control:\n        ___EmotionJSX(CheckboxControl, {\n          value: !this.state.clearable,\n          onChange: v => this.onControlChange('clearable', !v) }) })));\n\n\n\n\n\n  }\n\n  renderPopover() {\n    return (\n      ___EmotionJSX(\"div\", { id: \"ts-col-popo\", style: STYLE_WIDTH },\n      this.renderForm()));\n\n\n  }\n\n  render() {\n    return (\n      ___EmotionJSX(\"span\", { \"data-test\": \"FilterBoxItemControl\" },\n      this.textSummary(), ' ',\n      ___EmotionJSX(Popover, {\n        trigger: \"click\",\n        placement: \"right\",\n        content: this.renderPopover(),\n        title: t('Filter configuration') },\n\n      ___EmotionJSX(InfoTooltipWithTrigger, {\n        icon: \"edit\",\n        className: \"text-primary\",\n        label: \"edit-ts-column\" }))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nFilterBoxItemControl.propTypes = propTypes;\nFilterBoxItemControl.defaultProps = defaultProps;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(INTEGRAL_TYPES, \"INTEGRAL_TYPES\", \"/app/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(DECIMAL_TYPES, \"DECIMAL_TYPES\", \"/app/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(STYLE_WIDTH, \"STYLE_WIDTH\", \"/app/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(FilterBoxItemControl, \"FilterBoxItemControl\", \"/app/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx"],"names":["React","PropTypes","t","InfoTooltipWithTrigger","Popover","FormRow","SelectControl","CheckboxControl","TextControl","FILTER_CONFIG_ATTRIBUTES","INTEGRAL_TYPES","DECIMAL_TYPES","propTypes","datasource","object","isRequired","onChange","func","asc","bool","clearable","multiple","column","string","label","metric","searchAllOptions","defaultValue","defaultProps","STYLE_WIDTH","width","FilterBoxItemControl","Component","constructor","props","state","onControlChange","attr","value","typedValue","selectedColumnName","DEFAULT_VALUE","selectedColumn","columns","col","column_name","type","toUpperCase","has","Number","setState","setType","textSummary","renderForm","v","metrics","m","metric_name","MULTIPLE","SEARCH_ALL_OPTIONS","renderPopover","render"],"mappings":"ugCAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,CAAT,QAAkB,mBAAlB;AACA,SAASC,sBAAT,QAAuC,6BAAvC;;AAEA,OAAOC,OAAP,MAAoB,wBAApB;AACA,OAAOC,OAAP,MAAoB,wBAApB;AACA,OAAOC,aAAP,MAA0B,+CAA1B;AACA,OAAOC,eAAP,MAA4B,iDAA5B;AACA,OAAOC,WAAP,MAAwB,6CAAxB;AACA,SAASC,wBAAT,QAAyC,uBAAzC,C;;AAEA,MAAMC,cAAc,GAAG,SAAQ;AAC7B,SAD6B;AAE7B,UAF6B;AAG7B,KAH6B;AAI7B,SAJ6B;AAK7B,QAL6B;AAM7B,MAN6B,CAAR,CAAvB;;AAQA,MAAMC,aAAa,GAAG,SAAQ;AAC5B,OAD4B;AAE5B,QAF4B;AAG5B,MAH4B;AAI5B,SAJ4B;AAK5B,SAL4B;AAM5B,OAN4B,CAAR,CAAtB;;;AASA,MAAMC,SAAS,GAAG;AAChBC,EAAAA,UAAU,EAAEZ,SAAS,CAACa,MAAV,CAAiBC,UADb;AAEhBC,EAAAA,QAAQ,EAAEf,SAAS,CAACgB,IAFJ;AAGhBC,EAAAA,GAAG,EAAEjB,SAAS,CAACkB,IAHC;AAIhBC,EAAAA,SAAS,EAAEnB,SAAS,CAACkB,IAJL;AAKhBE,EAAAA,QAAQ,EAAEpB,SAAS,CAACkB,IALJ;AAMhBG,EAAAA,MAAM,EAAErB,SAAS,CAACsB,MANF;AAOhBC,EAAAA,KAAK,EAAEvB,SAAS,CAACsB,MAPD;AAQhBE,EAAAA,MAAM,EAAExB,SAAS,CAACsB,MARF;AAShBG,EAAAA,gBAAgB,EAAEzB,SAAS,CAACkB,IATZ;AAUhBQ,EAAAA,YAAY,EAAE1B,SAAS,CAACsB,MAVR,EAAlB;;;AAaA,MAAMK,YAAY,GAAG;AACnBZ,EAAAA,QAAQ,EAAE,MAAM,CAAE,CADC;AAEnBE,EAAAA,GAAG,EAAE,IAFc;AAGnBE,EAAAA,SAAS,EAAE,IAHQ;AAInBC,EAAAA,QAAQ,EAAE,IAJS;AAKnBK,EAAAA,gBAAgB,EAAE,KALC,EAArB;;;AAQA,MAAMG,WAAW,GAAG,EAAEC,KAAK,EAAE,GAAT,EAApB;;AAEA,eAAe,MAAMC,oBAAN,SAAmC/B,KAAK,CAACgC,SAAzC,CAAmD;AAChEC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,UAAM;AACJZ,MAAAA,MADI;AAEJG,MAAAA,MAFI;AAGJP,MAAAA,GAHI;AAIJE,MAAAA,SAJI;AAKJC,MAAAA,QALI;AAMJK,MAAAA,gBANI;AAOJF,MAAAA,KAPI;AAQJG,MAAAA,YARI;AASFO,IAAAA,KATJ;AAUA,SAAKC,KAAL,GAAa;AACXb,MAAAA,MADW;AAEXG,MAAAA,MAFW;AAGXD,MAAAA,KAHW;AAIXN,MAAAA,GAJW;AAKXE,MAAAA,SALW;AAMXC,MAAAA,QANW;AAOXK,MAAAA,gBAPW;AAQXC,MAAAA,YARW,EAAb;;AAUA,SAAKX,QAAL,GAAgB,sCAAKA,QAAL,iBAAmB,IAAnB,CAAhB;AACA,SAAKoB,eAAL,GAAuB,uCAAKA,eAAL,kBAA0B,IAA1B,CAAvB;AACD;;AAEDpB,EAAAA,QAAQ,GAAG;AACT,SAAKkB,KAAL,CAAWlB,QAAX,CAAoB,KAAKmB,KAAzB;AACD;;AAEDC,EAAAA,eAAe,CAACC,IAAD,EAAOC,KAAP,EAAc;AAC3B,QAAIC,UAAU,GAAGD,KAAjB;AACA,UAAM,EAAEhB,MAAM,EAAEkB,kBAAV,EAA8BnB,QAA9B,KAA2C,KAAKc,KAAtD;AACA,QAAIG,KAAK,IAAI,CAACjB,QAAV,IAAsBgB,IAAI,KAAK5B,wBAAwB,CAACgC,aAA5D,EAA2E;AACzE;AACA;AACA,YAAM,EAAE5B,UAAF,KAAiB,KAAKqB,KAA5B;AACA,YAAMQ,cAAc,GAAG,kCAAA7B,UAAU,CAAC8B,OAAX;AACrBC,MAAAA,GAAG,IAAIA,GAAG,CAACC,WAAJ,KAAoBL,kBADN,CAAvB;;;AAIA,UAAIE,cAAc,IAAIA,cAAc,CAACI,IAArC,EAA2C;AACzC,cAAMA,IAAI,GAAGJ,cAAc,CAACI,IAAf,CAAoBC,WAApB,EAAb;AACA,YAAID,IAAI,KAAK,SAAb,EAAwB;AACtBP,UAAAA,UAAU,GAAGD,KAAK,KAAK,MAAvB;AACD,SAFD,MAEO,IAAI5B,cAAc,CAACsC,GAAf,CAAmBF,IAAnB,CAAJ,EAA8B;AACnCP,UAAAA,UAAU,GAAG,cAAaU,MAAM,CAACX,KAAD,CAAnB,IAA8B,IAA9B,GAAqC,UAASA,KAAT,EAAgB,EAAhB,CAAlD;AACD,SAFM,MAEA,IAAI3B,aAAa,CAACqC,GAAd,CAAkBF,IAAlB,CAAJ,EAA6B;AAClCP,UAAAA,UAAU,GAAG,cAAaU,MAAM,CAACX,KAAD,CAAnB,IAA8B,IAA9B,GAAqC,YAAWA,KAAX,CAAlD;AACD;AACF;AACF;AACD,SAAKY,QAAL,CAAc,EAAE,CAACb,IAAD,GAAQE,UAAV,EAAd,EAAsC,KAAKvB,QAA3C;AACD;;AAEDmC,EAAAA,OAAO,GAAG,CAAE;;AAEZC,EAAAA,WAAW,GAAG;AACZ,WAAO,KAAKjB,KAAL,CAAWb,MAAX,IAAqB,KAA5B;AACD;;AAED+B,EAAAA,UAAU,GAAG;AACX;AACE;AACE,oBAAC,OAAD;AACE,QAAA,KAAK,EAAEnD,CAAC,CAAC,QAAD,CADV;AAEE,QAAA,OAAO;AACL,sBAAC,aAAD;AACE,UAAA,KAAK,EAAE,KAAKiC,KAAL,CAAWb,MADpB;AAEE,UAAA,IAAI,EAAC,QAFP;AAGE,UAAA,SAAS,EAAE,KAHb;AAIE,UAAA,OAAO,EAAE,8GAAKY,KAAL,CAAWrB,UAAX,CAAsB8B,OAAtB;AACCC,UAAAA,GAAG,IAAIA,GAAG,KAAK,KAAKT,KAAL,CAAWb,MAD3B;AAEFsB,UAAAA,GAAG,KAAK;AACXN,YAAAA,KAAK,EAAEM,GAAG,CAACC,WADA;AAEXrB,YAAAA,KAAK,EAAEoB,GAAG,CAACC,WAFA,EAAL,CAFD;;AAMC;AACN,YAAEP,KAAK,EAAE,KAAKH,KAAL,CAAWb,MAApB,EAA4BE,KAAK,EAAE,KAAKW,KAAL,CAAWb,MAA9C,EADM,CAND,CAJX;;AAaE,UAAA,QAAQ,EAAEgC,CAAC,IAAI,KAAKlB,eAAL,CAAqB,QAArB,EAA+BkB,CAA/B,CAbjB,GAHJ,GADF;;;;AAqBE,oBAAC,OAAD;AACE,QAAA,KAAK,EAAEpD,CAAC,CAAC,OAAD,CADV;AAEE,QAAA,OAAO;AACL,sBAAC,WAAD;AACE,UAAA,KAAK,EAAE,KAAKiC,KAAL,CAAWX,KADpB;AAEE,UAAA,IAAI,EAAC,OAFP;AAGE,UAAA,QAAQ,EAAE8B,CAAC,IAAI,KAAKlB,eAAL,CAAqB,OAArB,EAA8BkB,CAA9B,CAHjB,GAHJ,GArBF;;;;AA+BE,oBAAC,OAAD;AACE,QAAA,KAAK,EAAEpD,CAAC,CAAC,SAAD,CADV;AAEE,QAAA,OAAO,EAAEA,CAAC;AACR;AACE,sEADF;AAEE,qBAHM,CAFZ;;AAOE,QAAA,OAAO;AACL,sBAAC,WAAD;AACE,UAAA,KAAK,EAAE,KAAKiC,KAAL,CAAWR,YADpB;AAEE,UAAA,IAAI,EAAC,cAFP;AAGE,UAAA,QAAQ,EAAE,CAAA2B,CAAC;AACT,eAAKlB,eAAL,CAAqB3B,wBAAwB,CAACgC,aAA9C,EAA6Da,CAA7D,CAJJ,GARJ,GA/BF;;;;;AAgDE,oBAAC,OAAD;AACE,QAAA,KAAK,EAAEpD,CAAC,CAAC,aAAD,CADV;AAEE,QAAA,OAAO,EAAEA,CAAC,CAAC,+BAAD,CAFZ;AAGE,QAAA,OAAO;AACL,sBAAC,aAAD;AACE,UAAA,KAAK,EAAE,KAAKiC,KAAL,CAAWV,MADpB;AAEE,UAAA,IAAI,EAAC,QAFP;AAGE,UAAA,OAAO,EAAE,8GAAKS,KAAL,CAAWrB,UAAX,CAAsB0C,OAAtB;AACC9B,UAAAA,MAAM,IAAIA,MAAM,KAAK,KAAKU,KAAL,CAAWV,MADjC;AAEF+B,UAAAA,CAAC,KAAK;AACTlB,YAAAA,KAAK,EAAEkB,CAAC,CAACC,WADA;AAETjC,YAAAA,KAAK,EAAEgC,CAAC,CAACC,WAFA,EAAL,CAFC;;AAMC;AACN,YAAEnB,KAAK,EAAE,KAAKH,KAAL,CAAWV,MAApB,EAA4BD,KAAK,EAAE,KAAKW,KAAL,CAAWV,MAA9C,EADM,CAND,CAHX;;AAYE,UAAA,QAAQ,EAAE6B,CAAC,IAAI,KAAKlB,eAAL,CAAqB,QAArB,EAA+BkB,CAA/B,CAZjB,GAJJ,GAhDF;;;;AAoEE,oBAAC,OAAD;AACE,QAAA,KAAK,EAAEpD,CAAC,CAAC,gBAAD,CADV;AAEE,QAAA,OAAO,EAAEA,CAAC,CAAC,6BAAD,CAFZ;AAGE,QAAA,UAAU,MAHZ;AAIE,QAAA,OAAO;AACL,sBAAC,eAAD;AACE,UAAA,KAAK,EAAE,KAAKiC,KAAL,CAAWjB,GADpB;AAEE,UAAA,QAAQ,EAAEoC,CAAC,IAAI,KAAKlB,eAAL,CAAqB,KAArB,EAA4BkB,CAA5B,CAFjB,GALJ,GApEF;;;;AA+EE,oBAAC,OAAD;AACE,QAAA,KAAK,EAAEpD,CAAC,CAAC,2BAAD,CADV;AAEE,QAAA,UAAU,MAFZ;AAGE,QAAA,OAAO,EAAEA,CAAC;AACR;AACE,sCAFM,CAHZ;;AAOE,QAAA,OAAO;AACL,sBAAC,eAAD;AACE,UAAA,KAAK,EAAE,KAAKiC,KAAL,CAAWd,QADpB;AAEE,UAAA,QAAQ,EAAE,CAAAiC,CAAC;AACT,eAAKlB,eAAL,CAAqB3B,wBAAwB,CAACiD,QAA9C,EAAwDJ,CAAxD,CAHJ,GARJ,GA/EF;;;;;AA+FE,oBAAC,OAAD;AACE,QAAA,KAAK,EAAEpD,CAAC,CAAC,2BAAD,CADV;AAEE,QAAA,OAAO,EAAEA,CAAC;AACR;AACE,iGADF;AAEE,6FAHM,CAFZ;;AAOE,QAAA,UAAU,MAPZ;AAQE,QAAA,OAAO;AACL,sBAAC,eAAD;AACE,UAAA,KAAK,EAAE,KAAKiC,KAAL,CAAWT,gBADpB;AAEE,UAAA,QAAQ,EAAE,CAAA4B,CAAC;AACT,eAAKlB,eAAL;AACE3B,UAAAA,wBAAwB,CAACkD,kBAD3B;AAEEL,UAAAA,CAFF,CAHJ,GATJ,GA/FF;;;;;;AAmHE,oBAAC,OAAD;AACE,QAAA,KAAK,EAAEpD,CAAC,CAAC,UAAD,CADV;AAEE,QAAA,OAAO,EAAEA,CAAC,CAAC,0CAAD,CAFZ;AAGE,QAAA,UAAU,MAHZ;AAIE,QAAA,OAAO;AACL,sBAAC,eAAD;AACE,UAAA,KAAK,EAAE,CAAC,KAAKiC,KAAL,CAAWf,SADrB;AAEE,UAAA,QAAQ,EAAEkC,CAAC,IAAI,KAAKlB,eAAL,CAAqB,WAArB,EAAkC,CAACkB,CAAnC,CAFjB,GALJ,GAnHF,CADF;;;;;;AAiID;;AAEDM,EAAAA,aAAa,GAAG;AACd;AACE,6BAAK,EAAE,EAAC,aAAR,EAAsB,KAAK,EAAE/B,WAA7B;AACG,WAAKwB,UAAL,EADH,CADF;;;AAKD;;AAEDQ,EAAAA,MAAM,GAAG;AACP;AACE,8BAAM,aAAU,sBAAhB;AACG,WAAKT,WAAL,EADH,EACuB,GADvB;AAEE,oBAAC,OAAD;AACE,QAAA,OAAO,EAAC,OADV;AAEE,QAAA,SAAS,EAAC,OAFZ;AAGE,QAAA,OAAO,EAAE,KAAKQ,aAAL,EAHX;AAIE,QAAA,KAAK,EAAE1D,CAAC,CAAC,sBAAD,CAJV;;AAME,oBAAC,sBAAD;AACE,QAAA,IAAI,EAAC,MADP;AAEE,QAAA,SAAS,EAAC,cAFZ;AAGE,QAAA,KAAK,EAAC,gBAHR,GANF,CAFF,CADF;;;;;AAiBD,GA5N+D;AAAA;AAAA;AA+NlE6B,oBAAoB,CAACnB,SAArB,GAAiCA,SAAjC;AACAmB,oBAAoB,CAACH,YAArB,GAAoCA,YAApC,C,iLAxQMlB,c,qIAQAC,a,oIASAC,S,gIAaAgB,Y,mIAQAC,W,kIAEeE,oB","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nimport Popover from 'src/components/Popover';\nimport FormRow from 'src/components/FormRow';\nimport SelectControl from 'src/explore/components/controls/SelectControl';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport { FILTER_CONFIG_ATTRIBUTES } from 'src/explore/constants';\n\nconst INTEGRAL_TYPES = new Set([\n  'TINYINT',\n  'SMALLINT',\n  'INT',\n  'INTEGER',\n  'BIGINT',\n  'LONG',\n]);\nconst DECIMAL_TYPES = new Set([\n  'FLOAT',\n  'DOUBLE',\n  'REAL',\n  'NUMERIC',\n  'DECIMAL',\n  'MONEY',\n]);\n\nconst propTypes = {\n  datasource: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  asc: PropTypes.bool,\n  clearable: PropTypes.bool,\n  multiple: PropTypes.bool,\n  column: PropTypes.string,\n  label: PropTypes.string,\n  metric: PropTypes.string,\n  searchAllOptions: PropTypes.bool,\n  defaultValue: PropTypes.string,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  asc: true,\n  clearable: true,\n  multiple: true,\n  searchAllOptions: false,\n};\n\nconst STYLE_WIDTH = { width: 350 };\n\nexport default class FilterBoxItemControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const {\n      column,\n      metric,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      label,\n      defaultValue,\n    } = props;\n    this.state = {\n      column,\n      metric,\n      label,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      defaultValue,\n    };\n    this.onChange = this.onChange.bind(this);\n    this.onControlChange = this.onControlChange.bind(this);\n  }\n\n  onChange() {\n    this.props.onChange(this.state);\n  }\n\n  onControlChange(attr, value) {\n    let typedValue = value;\n    const { column: selectedColumnName, multiple } = this.state;\n    if (value && !multiple && attr === FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE) {\n      // if single value filter_box,\n      // convert input value string to the column's data type\n      const { datasource } = this.props;\n      const selectedColumn = datasource.columns.find(\n        col => col.column_name === selectedColumnName,\n      );\n\n      if (selectedColumn && selectedColumn.type) {\n        const type = selectedColumn.type.toUpperCase();\n        if (type === 'BOOLEAN') {\n          typedValue = value === 'true';\n        } else if (INTEGRAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseInt(value, 10);\n        } else if (DECIMAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseFloat(value);\n        }\n      }\n    }\n    this.setState({ [attr]: typedValue }, this.onChange);\n  }\n\n  setType() {}\n\n  textSummary() {\n    return this.state.column || 'N/A';\n  }\n\n  renderForm() {\n    return (\n      <div>\n        <FormRow\n          label={t('Column')}\n          control={\n            <SelectControl\n              value={this.state.column}\n              name=\"column\"\n              clearable={false}\n              options={this.props.datasource.columns\n                .filter(col => col !== this.state.column)\n                .map(col => ({\n                  value: col.column_name,\n                  label: col.column_name,\n                }))\n                .concat([\n                  { value: this.state.column, label: this.state.column },\n                ])}\n              onChange={v => this.onControlChange('column', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Label')}\n          control={\n            <TextControl\n              value={this.state.label}\n              name=\"label\"\n              onChange={v => this.onControlChange('label', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Default')}\n          tooltip={t(\n            '(optional) default value for the filter, when using ' +\n              'the multiple option, you can use a semicolon-delimited list ' +\n              'of options.',\n          )}\n          control={\n            <TextControl\n              value={this.state.defaultValue}\n              name=\"defaultValue\"\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort metric')}\n          tooltip={t('Metric to sort the results by')}\n          control={\n            <SelectControl\n              value={this.state.metric}\n              name=\"column\"\n              options={this.props.datasource.metrics\n                .filter(metric => metric !== this.state.metric)\n                .map(m => ({\n                  value: m.metric_name,\n                  label: m.metric_name,\n                }))\n                .concat([\n                  { value: this.state.metric, label: this.state.metric },\n                ])}\n              onChange={v => this.onControlChange('metric', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort ascending')}\n          tooltip={t('Check for sorting ascending')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.asc}\n              onChange={v => this.onControlChange('asc', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Allow multiple selections')}\n          isCheckbox\n          tooltip={t(\n            'Multiple selections allowed, otherwise filter ' +\n              'is limited to a single value',\n          )}\n          control={\n            <CheckboxControl\n              value={this.state.multiple}\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.MULTIPLE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Search all filter options')}\n          tooltip={t(\n            'By default, each filter loads at most 1000 choices at the initial page load. ' +\n              'Check this box if you have more than 1000 filter values and want to enable dynamically ' +\n              'searching that loads filter values as users type (may add stress to your database).',\n          )}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.searchAllOptions}\n              onChange={v =>\n                this.onControlChange(\n                  FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS,\n                  v,\n                )\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Required')}\n          tooltip={t('User must select a value for this filter')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={!this.state.clearable}\n              onChange={v => this.onControlChange('clearable', !v)}\n            />\n          }\n        />\n      </div>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id=\"ts-col-popo\" style={STYLE_WIDTH}>\n        {this.renderForm()}\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <span data-test=\"FilterBoxItemControl\">\n        {this.textSummary()}{' '}\n        <Popover\n          trigger=\"click\"\n          placement=\"right\"\n          content={this.renderPopover()}\n          title={t('Filter configuration')}\n        >\n          <InfoTooltipWithTrigger\n            icon=\"edit\"\n            className=\"text-primary\"\n            label=\"edit-ts-column\"\n          />\n        </Popover>\n      </span>\n    );\n  }\n}\n\nFilterBoxItemControl.propTypes = propTypes;\nFilterBoxItemControl.defaultProps = defaultProps;\n"]},"metadata":{},"sourceType":"module"}