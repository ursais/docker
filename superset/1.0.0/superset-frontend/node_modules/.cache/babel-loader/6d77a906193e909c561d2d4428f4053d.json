{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _findIndexInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find-index\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport { css } from '@emotion/react';\nimport * as portals from 'react-reverse-portal';\nimport { Collapse } from 'src/common/components';\nimport CascadePopover from '../CascadeFilters/CascadePopover';\nimport { buildCascadeFiltersTree } from './utils';\nimport { useFilters } from '../state';\nimport { useDashboardHasTabs, useSelectFiltersInScope } from '../../state';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst Wrapper = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  &:hover {\n    cursor: pointer;\n  }\n`;\nconst FilterControls = ({ directPathToChild, dataMaskSelected, onFilterSelectionChange }) => {var _context;\n  const [visiblePopoverId, setVisiblePopoverId] = useState(null);\n  const filters = useFilters();\n  const filterValues = _Object$values(filters);\n  const portalNodes = React.useMemo(() => {\n    const nodes = new Array(filterValues.length);\n    for (let i = 0; i < filterValues.length; i += 1) {\n      nodes[i] = portals.createHtmlPortalNode();\n    }\n    return nodes;\n  }, [filterValues.length]);\n  const cascadeFilters = useMemo(() => {\n    const filtersWithValue = _mapInstanceProperty(filterValues).call(filterValues, filter => ({\n      ...filter,\n      dataMask: dataMaskSelected[filter.id] }));\n\n    return buildCascadeFiltersTree(filtersWithValue);\n  }, [filterValues, dataMaskSelected]);\n  const cascadeFilterIds = new _Set(_mapInstanceProperty(cascadeFilters).call(cascadeFilters, item => item.id));\n  const [filtersInScope, filtersOutOfScope] = useSelectFiltersInScope(cascadeFilters);\n  const dashboardHasTabs = useDashboardHasTabs();\n  const showCollapsePanel = dashboardHasTabs && cascadeFilters.length > 0;\n  return ___EmotionJSX(Wrapper, null,\n  _mapInstanceProperty(_context = _filterInstanceProperty(portalNodes).call(portalNodes,\n  (node, index) => cascadeFilterIds.has(filterValues[index].id))).call(_context,\n  (node, index) => ___EmotionJSX(portals.InPortal, { node: node },\n  ___EmotionJSX(CascadePopover, { \"data-test\": \"cascade-filters-control\", key: cascadeFilters[index].id, dataMaskSelected: dataMaskSelected, visible: visiblePopoverId === cascadeFilters[index].id, onVisibleChange: visible => setVisiblePopoverId(visible ? cascadeFilters[index].id : null), filter: cascadeFilters[index], onFilterSelectionChange: onFilterSelectionChange, directPathToChild: directPathToChild, inView: false }))),\n\n  _mapInstanceProperty(filtersInScope).call(filtersInScope, filter => {\n    const index = _findIndexInstanceProperty(filterValues).call(filterValues, f => f.id === filter.id);\n    return ___EmotionJSX(portals.OutPortal, { node: portalNodes[index], inView: true });\n  }),\n  showCollapsePanel && ___EmotionJSX(Collapse, { ghost: true, bordered: true, expandIconPosition: \"right\", collapsible: filtersOutOfScope.length === 0 ? 'disabled' : undefined, css: theme => /*#__PURE__*/css(\"&.ant-collapse{margin-top:\",\n\n    filtersInScope.length > 0 ?\n    theme.gridUnit * 6 :\n    0, \"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:\",\n\n\n\n    theme.gridUnit * 2, \"px;&>.ant-collapse-arrow{right:\",\n\n\n    theme.gridUnit, \"px;}}& .ant-collapse-content-box{padding:\",\n\n\n\n\n    theme.gridUnit * 4, \"px 0 0;}}}\" + (process.env.NODE_ENV === \"production\" ? \"\" : \";label:FilterControls;\"), process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL25hdGl2ZUZpbHRlcnMvRmlsdGVyQmFyL0ZpbHRlckNvbnRyb2xzL0ZpbHRlckNvbnRyb2xzLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpRXlLIiwiZmlsZSI6Ii9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL25hdGl2ZUZpbHRlcnMvRmlsdGVyQmFyL0ZpbHRlckNvbnRyb2xzL0ZpbHRlckNvbnRyb2xzLnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCBSZWFjdCwgeyB1c2VNZW1vLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHN0eWxlZCwgdCB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCB7IGNzcyB9IGZyb20gJ0BlbW90aW9uL3JlYWN0JztcbmltcG9ydCAqIGFzIHBvcnRhbHMgZnJvbSAncmVhY3QtcmV2ZXJzZS1wb3J0YWwnO1xuaW1wb3J0IHsgQ29sbGFwc2UgfSBmcm9tICdzcmMvY29tbW9uL2NvbXBvbmVudHMnO1xuaW1wb3J0IENhc2NhZGVQb3BvdmVyIGZyb20gJy4uL0Nhc2NhZGVGaWx0ZXJzL0Nhc2NhZGVQb3BvdmVyJztcbmltcG9ydCB7IGJ1aWxkQ2FzY2FkZUZpbHRlcnNUcmVlIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyB1c2VGaWx0ZXJzIH0gZnJvbSAnLi4vc3RhdGUnO1xuaW1wb3J0IHsgdXNlRGFzaGJvYXJkSGFzVGFicywgdXNlU2VsZWN0RmlsdGVyc0luU2NvcGUgfSBmcm9tICcuLi8uLi9zdGF0ZSc7XG5jb25zdCBXcmFwcGVyID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmc6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiA0fXB4O1xuICAmOmhvdmVyIHtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG4gIH1cbmA7XG5jb25zdCBGaWx0ZXJDb250cm9scyA9ICh7IGRpcmVjdFBhdGhUb0NoaWxkLCBkYXRhTWFza1NlbGVjdGVkLCBvbkZpbHRlclNlbGVjdGlvbkNoYW5nZSwgfSkgPT4ge1xuICAgIGNvbnN0IFt2aXNpYmxlUG9wb3ZlcklkLCBzZXRWaXNpYmxlUG9wb3ZlcklkXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIGNvbnN0IGZpbHRlcnMgPSB1c2VGaWx0ZXJzKCk7XG4gICAgY29uc3QgZmlsdGVyVmFsdWVzID0gT2JqZWN0LnZhbHVlcyhmaWx0ZXJzKTtcbiAgICBjb25zdCBwb3J0YWxOb2RlcyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4ge1xuICAgICAgICBjb25zdCBub2RlcyA9IG5ldyBBcnJheShmaWx0ZXJWYWx1ZXMubGVuZ3RoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWx0ZXJWYWx1ZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIG5vZGVzW2ldID0gcG9ydGFscy5jcmVhdGVIdG1sUG9ydGFsTm9kZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlcztcbiAgICB9LCBbZmlsdGVyVmFsdWVzLmxlbmd0aF0pO1xuICAgIGNvbnN0IGNhc2NhZGVGaWx0ZXJzID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpbHRlcnNXaXRoVmFsdWUgPSBmaWx0ZXJWYWx1ZXMubWFwKGZpbHRlciA9PiAoe1xuICAgICAgICAgICAgLi4uZmlsdGVyLFxuICAgICAgICAgICAgZGF0YU1hc2s6IGRhdGFNYXNrU2VsZWN0ZWRbZmlsdGVyLmlkXSxcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gYnVpbGRDYXNjYWRlRmlsdGVyc1RyZWUoZmlsdGVyc1dpdGhWYWx1ZSk7XG4gICAgfSwgW2ZpbHRlclZhbHVlcywgZGF0YU1hc2tTZWxlY3RlZF0pO1xuICAgIGNvbnN0IGNhc2NhZGVGaWx0ZXJJZHMgPSBuZXcgU2V0KGNhc2NhZGVGaWx0ZXJzLm1hcChpdGVtID0+IGl0ZW0uaWQpKTtcbiAgICBjb25zdCBbZmlsdGVyc0luU2NvcGUsIGZpbHRlcnNPdXRPZlNjb3BlXSA9IHVzZVNlbGVjdEZpbHRlcnNJblNjb3BlKGNhc2NhZGVGaWx0ZXJzKTtcbiAgICBjb25zdCBkYXNoYm9hcmRIYXNUYWJzID0gdXNlRGFzaGJvYXJkSGFzVGFicygpO1xuICAgIGNvbnN0IHNob3dDb2xsYXBzZVBhbmVsID0gZGFzaGJvYXJkSGFzVGFicyAmJiBjYXNjYWRlRmlsdGVycy5sZW5ndGggPiAwO1xuICAgIHJldHVybiAoPFdyYXBwZXI+XG4gICAgICB7cG9ydGFsTm9kZXNcbiAgICAgICAgLmZpbHRlcigobm9kZSwgaW5kZXgpID0+IGNhc2NhZGVGaWx0ZXJJZHMuaGFzKGZpbHRlclZhbHVlc1tpbmRleF0uaWQpKVxuICAgICAgICAubWFwKChub2RlLCBpbmRleCkgPT4gKDxwb3J0YWxzLkluUG9ydGFsIG5vZGU9e25vZGV9PlxuICAgICAgICAgICAgPENhc2NhZGVQb3BvdmVyIGRhdGEtdGVzdD1cImNhc2NhZGUtZmlsdGVycy1jb250cm9sXCIga2V5PXtjYXNjYWRlRmlsdGVyc1tpbmRleF0uaWR9IGRhdGFNYXNrU2VsZWN0ZWQ9e2RhdGFNYXNrU2VsZWN0ZWR9IHZpc2libGU9e3Zpc2libGVQb3BvdmVySWQgPT09IGNhc2NhZGVGaWx0ZXJzW2luZGV4XS5pZH0gb25WaXNpYmxlQ2hhbmdlPXt2aXNpYmxlID0+IHNldFZpc2libGVQb3BvdmVySWQodmlzaWJsZSA/IGNhc2NhZGVGaWx0ZXJzW2luZGV4XS5pZCA6IG51bGwpfSBmaWx0ZXI9e2Nhc2NhZGVGaWx0ZXJzW2luZGV4XX0gb25GaWx0ZXJTZWxlY3Rpb25DaGFuZ2U9e29uRmlsdGVyU2VsZWN0aW9uQ2hhbmdlfSBkaXJlY3RQYXRoVG9DaGlsZD17ZGlyZWN0UGF0aFRvQ2hpbGR9IGluVmlldz17ZmFsc2V9Lz5cbiAgICAgICAgICA8L3BvcnRhbHMuSW5Qb3J0YWw+KSl9XG4gICAgICB7ZmlsdGVyc0luU2NvcGUubWFwKGZpbHRlciA9PiB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gZmlsdGVyVmFsdWVzLmZpbmRJbmRleChmID0+IGYuaWQgPT09IGZpbHRlci5pZCk7XG4gICAgICAgIHJldHVybiA8cG9ydGFscy5PdXRQb3J0YWwgbm9kZT17cG9ydGFsTm9kZXNbaW5kZXhdfSBpblZpZXcvPjtcbiAgICB9KX1cbiAgICAgIHtzaG93Q29sbGFwc2VQYW5lbCAmJiAoPENvbGxhcHNlIGdob3N0IGJvcmRlcmVkIGV4cGFuZEljb25Qb3NpdGlvbj1cInJpZ2h0XCIgY29sbGFwc2libGU9e2ZpbHRlcnNPdXRPZlNjb3BlLmxlbmd0aCA9PT0gMCA/ICdkaXNhYmxlZCcgOiB1bmRlZmluZWR9IGNzcz17dGhlbWUgPT4gY3NzIGBcbiAgICAgICAgICAgICYuYW50LWNvbGxhcHNlIHtcbiAgICAgICAgICAgICAgbWFyZ2luLXRvcDogJHtmaWx0ZXJzSW5TY29wZS5sZW5ndGggPiAwXG4gICAgICAgID8gdGhlbWUuZ3JpZFVuaXQgKiA2XG4gICAgICAgIDogMH1weDtcbiAgICAgICAgICAgICAgJiA+IC5hbnQtY29sbGFwc2UtaXRlbSB7XG4gICAgICAgICAgICAgICAgJiA+IC5hbnQtY29sbGFwc2UtaGVhZGVyIHtcbiAgICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogMDtcbiAgICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAke3RoZW1lLmdyaWRVbml0ICogMn1weDtcblxuICAgICAgICAgICAgICAgICAgJiA+IC5hbnQtY29sbGFwc2UtYXJyb3cge1xuICAgICAgICAgICAgICAgICAgICByaWdodDogJHt0aGVtZS5ncmlkVW5pdH1weDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAmIC5hbnQtY29sbGFwc2UtY29udGVudC1ib3gge1xuICAgICAgICAgICAgICAgICAgcGFkZGluZzogJHt0aGVtZS5ncmlkVW5pdCAqIDR9cHggMCAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIGB9PlxuICAgICAgICAgIDxDb2xsYXBzZS5QYW5lbCBoZWFkZXI9e2Ake3QoJ0ZpbHRlcnMgb3V0IG9mIHNjb3BlJyl9ICgke2ZpbHRlcnNPdXRPZlNjb3BlLmxlbmd0aH0pYH0ga2V5PVwiMVwiPlxuICAgICAgICAgICAge2ZpbHRlcnNPdXRPZlNjb3BlLm1hcChmaWx0ZXIgPT4ge1xuICAgICAgICBjb25zdCBpbmRleCA9IGNhc2NhZGVGaWx0ZXJzLmZpbmRJbmRleChmID0+IGYuaWQgPT09IGZpbHRlci5pZCk7XG4gICAgICAgIHJldHVybiA8cG9ydGFscy5PdXRQb3J0YWwgbm9kZT17cG9ydGFsTm9kZXNbaW5kZXhdfSBpblZpZXcvPjtcbiAgICB9KX1cbiAgICAgICAgICA8L0NvbGxhcHNlLlBhbmVsPlxuICAgICAgICA8L0NvbGxhcHNlPil9XG4gICAgPC9XcmFwcGVyPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgRmlsdGVyQ29udHJvbHM7XG4iXX0= */\") },\n\n\n\n\n  ___EmotionJSX(Collapse.Panel, { header: `${t('Filters out of scope')} (${filtersOutOfScope.length})`, key: \"1\" },\n  _mapInstanceProperty(filtersOutOfScope).call(filtersOutOfScope, filter => {\n    const index = _findIndexInstanceProperty(cascadeFilters).call(cascadeFilters, f => f.id === filter.id);\n    return ___EmotionJSX(portals.OutPortal, { node: portalNodes[index], inView: true });\n  }))));\n\n\n\n};__signature__(FilterControls, \"useState{[visiblePopoverId, setVisiblePopoverId](null)}\\nuseFilters{filters}\\nuseMemo{portalNodes}\\nuseMemo{cascadeFilters}\\nuseSelectFiltersInScope{[filtersInScope, filtersOutOfScope]}\\nuseDashboardHasTabs{dashboardHasTabs}\", () => [useFilters, useSelectFiltersInScope, useDashboardHasTabs]);const _default =\nFilterControls;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(Wrapper, \"Wrapper\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\");reactHotLoader.register(FilterControls, \"FilterControls\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FC, useMemo, useState } from 'react';\nimport { DataMask, styled, t } from '@superset-ui/core';\nimport { css } from '@emotion/react';\nimport * as portals from 'react-reverse-portal';\nimport { DataMaskStateWithId } from 'src/dataMask/types';\nimport { Collapse } from 'src/common/components';\nimport CascadePopover from '../CascadeFilters/CascadePopover';\nimport { buildCascadeFiltersTree } from './utils';\nimport { useFilters } from '../state';\nimport { Filter } from '../../types';\nimport { useDashboardHasTabs, useSelectFiltersInScope } from '../../state';\n\nconst Wrapper = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  &:hover {\n    cursor: pointer;\n  }\n`;\n\ntype FilterControlsProps = {\n  directPathToChild?: string[];\n  dataMaskSelected: DataMaskStateWithId;\n  onFilterSelectionChange: (filter: Filter, dataMask: DataMask) => void;\n};\n\nconst FilterControls: FC<FilterControlsProps> = ({\n  directPathToChild,\n  dataMaskSelected,\n  onFilterSelectionChange,\n}) => {\n  const [visiblePopoverId, setVisiblePopoverId] = useState<string | null>(null);\n  const filters = useFilters();\n  const filterValues = Object.values<Filter>(filters);\n  const portalNodes = React.useMemo(() => {\n    const nodes = new Array(filterValues.length);\n    for (let i = 0; i < filterValues.length; i += 1) {\n      nodes[i] = portals.createHtmlPortalNode();\n    }\n    return nodes;\n  }, [filterValues.length]);\n\n  const cascadeFilters = useMemo(() => {\n    const filtersWithValue = filterValues.map(filter => ({\n      ...filter,\n      dataMask: dataMaskSelected[filter.id],\n    }));\n    return buildCascadeFiltersTree(filtersWithValue);\n  }, [filterValues, dataMaskSelected]);\n  const cascadeFilterIds = new Set(cascadeFilters.map(item => item.id));\n\n  const [filtersInScope, filtersOutOfScope] = useSelectFiltersInScope(\n    cascadeFilters,\n  );\n  const dashboardHasTabs = useDashboardHasTabs();\n  const showCollapsePanel = dashboardHasTabs && cascadeFilters.length > 0;\n\n  return (\n    <Wrapper>\n      {portalNodes\n        .filter((node, index) => cascadeFilterIds.has(filterValues[index].id))\n        .map((node, index) => (\n          <portals.InPortal node={node}>\n            <CascadePopover\n              data-test=\"cascade-filters-control\"\n              key={cascadeFilters[index].id}\n              dataMaskSelected={dataMaskSelected}\n              visible={visiblePopoverId === cascadeFilters[index].id}\n              onVisibleChange={visible =>\n                setVisiblePopoverId(visible ? cascadeFilters[index].id : null)\n              }\n              filter={cascadeFilters[index]}\n              onFilterSelectionChange={onFilterSelectionChange}\n              directPathToChild={directPathToChild}\n              inView={false}\n            />\n          </portals.InPortal>\n        ))}\n      {filtersInScope.map(filter => {\n        const index = filterValues.findIndex(f => f.id === filter.id);\n        return <portals.OutPortal node={portalNodes[index]} inView />;\n      })}\n      {showCollapsePanel && (\n        <Collapse\n          ghost\n          bordered\n          expandIconPosition=\"right\"\n          collapsible={filtersOutOfScope.length === 0 ? 'disabled' : undefined}\n          css={theme => css`\n            &.ant-collapse {\n              margin-top: ${filtersInScope.length > 0\n                ? theme.gridUnit * 6\n                : 0}px;\n              & > .ant-collapse-item {\n                & > .ant-collapse-header {\n                  padding-left: 0;\n                  padding-bottom: ${theme.gridUnit * 2}px;\n\n                  & > .ant-collapse-arrow {\n                    right: ${theme.gridUnit}px;\n                  }\n                }\n\n                & .ant-collapse-content-box {\n                  padding: ${theme.gridUnit * 4}px 0 0;\n                }\n              }\n            }\n          `}\n        >\n          <Collapse.Panel\n            header={`${t('Filters out of scope')} (${\n              filtersOutOfScope.length\n            })`}\n            key=\"1\"\n          >\n            {filtersOutOfScope.map(filter => {\n              const index = cascadeFilters.findIndex(f => f.id === filter.id);\n              return <portals.OutPortal node={portalNodes[index]} inView />;\n            })}\n          </Collapse.Panel>\n        </Collapse>\n      )}\n    </Wrapper>\n  );\n};\n\nexport default FilterControls;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}