{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _Object$entries from \"@babel/runtime-corejs3/core-js-stable/object/entries\";import _reduceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/reduce\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport {\nFILTER_CONFIG_ATTRIBUTES,\nTIME_FILTER_LABELS,\nTIME_FILTER_MAP } from\n'src/explore/constants';\n\nexport default function getFilterConfigsFromFormdata(form_data = {}) {\n  const {\n    date_filter,\n    filter_configs = [],\n    show_druid_time_granularity,\n    show_druid_time_origin,\n    show_sqla_time_column,\n    show_sqla_time_granularity } =\n  form_data;\n  let configs = _reduceInstanceProperty(filter_configs).call(filter_configs,\n  ({ columns, labels }, config) => {\n    let defaultValues = config[FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE];\n\n    // treat empty string as null (no default value)\n    if (defaultValues === '') {\n      defaultValues = null;\n    }\n\n    // defaultValue could be ; separated values,\n    // could be null or ''\n    if (defaultValues && config[FILTER_CONFIG_ATTRIBUTES.MULTIPLE]) {\n      defaultValues = config.defaultValue.split(';');\n    }\n\n    const updatedColumns = {\n      ...columns,\n      [config.column]: config.vals || defaultValues };\n\n    const updatedLabels = {\n      ...labels,\n      [config.column]: config.label };\n\n\n    return {\n      columns: updatedColumns,\n      labels: updatedLabels };\n\n  },\n  { columns: {}, labels: {} });\n\n\n  if (date_filter) {var _context;\n    let updatedColumns = {\n      ...configs.columns,\n      [TIME_FILTER_MAP.time_range]: form_data.time_range };\n\n    const updatedLabels = {\n      ...configs.labels,\n      ..._reduceInstanceProperty(_context = _Object$entries(TIME_FILTER_MAP)).call(_context,\n      (map, [key, value]) => ({\n        ...map,\n        [value]: TIME_FILTER_LABELS[key] }),\n\n      {}) };\n\n\n\n    if (show_sqla_time_granularity) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.time_grain_sqla]: form_data.time_grain_sqla };\n\n    }\n\n    if (show_sqla_time_column) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.granularity_sqla]: form_data.granularity_sqla };\n\n    }\n\n    if (show_druid_time_granularity) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.granularity]: form_data.granularity };\n\n    }\n\n    if (show_druid_time_origin) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.druid_time_origin]: form_data.druid_time_origin };\n\n    }\n\n    configs = {\n      ...configs,\n      columns: updatedColumns,\n      labels: updatedLabels };\n\n  }\n  return configs;\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(getFilterConfigsFromFormdata, \"getFilterConfigsFromFormdata\", \"/app/superset-frontend/src/dashboard/util/getFilterConfigsFromFormdata.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/dashboard/util/getFilterConfigsFromFormdata.js"],"names":["FILTER_CONFIG_ATTRIBUTES","TIME_FILTER_LABELS","TIME_FILTER_MAP","getFilterConfigsFromFormdata","form_data","date_filter","filter_configs","show_druid_time_granularity","show_druid_time_origin","show_sqla_time_column","show_sqla_time_granularity","configs","columns","labels","config","defaultValues","DEFAULT_VALUE","MULTIPLE","defaultValue","split","updatedColumns","column","vals","updatedLabels","label","time_range","map","key","value","time_grain_sqla","granularity_sqla","granularity","druid_time_origin"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport {\n  FILTER_CONFIG_ATTRIBUTES,\n  TIME_FILTER_LABELS,\n  TIME_FILTER_MAP,\n} from 'src/explore/constants';\n\nexport default function getFilterConfigsFromFormdata(form_data = {}) {\n  const {\n    date_filter,\n    filter_configs = [],\n    show_druid_time_granularity,\n    show_druid_time_origin,\n    show_sqla_time_column,\n    show_sqla_time_granularity,\n  } = form_data;\n  let configs = filter_configs.reduce(\n    ({ columns, labels }, config) => {\n      let defaultValues = config[FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE];\n\n      // treat empty string as null (no default value)\n      if (defaultValues === '') {\n        defaultValues = null;\n      }\n\n      // defaultValue could be ; separated values,\n      // could be null or ''\n      if (defaultValues && config[FILTER_CONFIG_ATTRIBUTES.MULTIPLE]) {\n        defaultValues = config.defaultValue.split(';');\n      }\n\n      const updatedColumns = {\n        ...columns,\n        [config.column]: config.vals || defaultValues,\n      };\n      const updatedLabels = {\n        ...labels,\n        [config.column]: config.label,\n      };\n\n      return {\n        columns: updatedColumns,\n        labels: updatedLabels,\n      };\n    },\n    { columns: {}, labels: {} },\n  );\n\n  if (date_filter) {\n    let updatedColumns = {\n      ...configs.columns,\n      [TIME_FILTER_MAP.time_range]: form_data.time_range,\n    };\n    const updatedLabels = {\n      ...configs.labels,\n      ...Object.entries(TIME_FILTER_MAP).reduce(\n        (map, [key, value]) => ({\n          ...map,\n          [value]: TIME_FILTER_LABELS[key],\n        }),\n        {},\n      ),\n    };\n\n    if (show_sqla_time_granularity) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.time_grain_sqla]: form_data.time_grain_sqla,\n      };\n    }\n\n    if (show_sqla_time_column) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.granularity_sqla]: form_data.granularity_sqla,\n      };\n    }\n\n    if (show_druid_time_granularity) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.granularity]: form_data.granularity,\n      };\n    }\n\n    if (show_druid_time_origin) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.druid_time_origin]: form_data.druid_time_origin,\n      };\n    }\n\n    configs = {\n      ...configs,\n      columns: updatedColumns,\n      labels: updatedLabels,\n    };\n  }\n  return configs;\n}\n"]},"metadata":{},"sourceType":"module"}