{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useRef } from 'react';\nimport { useDrag, useDrop } from 'react-dnd';\nimport { styled, t, useTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { StyledMetricOption } from '../../optionRenderers';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nexport const DragContainer = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n  :last-child {\n    margin-bottom: 0;\n  }\n`;\nexport const OptionControlContainer = styled.div`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  background-color: ${({ theme }) => theme.colors.grayscale.light3};\n  border-radius: 3px;\n  cursor: ${({ withCaret }) => withCaret ? 'pointer' : 'default'};\n`;\nexport const Label = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    max-width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${theme.gridUnit}px;\n    svg {\n      margin-right: ${theme.gridUnit}px;\n      margin-left: ${theme.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${theme.gridUnit * 2}px;\n      margin-left: ${theme.gridUnit}px;\n      font-weight: ${theme.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}\n`;\nexport const CaretContainer = styled.div`\n  height: 100%;\n  border-left: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  margin-left: auto;\n`;\nexport const CloseContainer = styled.div`\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 6}px;\n  border-right: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  cursor: pointer;\n`;\nconst StyledInfoTooltipWithTrigger = styled(InfoTooltipWithTrigger)`\n  margin: 0 ${({ theme }) => theme.gridUnit}px;\n`;\nexport const HeaderContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n`;\nexport const LabelsContainer = styled.div`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: solid 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\nexport const DndLabelsContainer = styled.div`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: ${({ canDrop, isOver, theme }) => {\n  if (canDrop) {\n    return `dashed 1px ${theme.colors.info.dark1}`;\n  }\n  if (isOver && !canDrop) {\n    return `dashed 1px ${theme.colors.error.dark1}`;\n  }\n  return `solid 1px ${theme.colors.grayscale.light2}`;\n}};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\nexport const AddControlLabel = styled.div`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  padding-left: ${({ theme }) => theme.gridUnit}px;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n  border: dashed 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n  cursor: ${({ cancelHover }) => cancelHover ? 'inherit' : 'pointer'};\n\n  :hover {\n    background-color: ${({ cancelHover, theme }) => cancelHover ? 'inherit' : theme.colors.grayscale.light4};\n  }\n\n  :active {\n    background-color: ${({ cancelHover, theme }) => cancelHover ? 'inherit' : theme.colors.grayscale.light3};\n  }\n`;\nexport const AddIconButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: ${({ theme }) => theme.gridUnit * 4}px;\n  width: ${({ theme }) => theme.gridUnit * 4}px;\n  padding: 0;\n  background-color: ${({ theme }) => theme.colors.primary.dark1};\n  border: none;\n  border-radius: 2px;\n\n  :disabled {\n    cursor: not-allowed;\n    background-color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\nexport const OptionControlLabel = ({ label, savedMetric, adhocMetric, onRemove, onMoveLabel, onDropLabel, withCaret, isFunction, type, index, isExtra, tooltipTitle, ...props }) => {\n  const theme = useTheme();\n  const ref = useRef(null);\n  const [, drop] = useDrop({\n    accept: type,\n    drop() {\n      onDropLabel == null ? void 0 : onDropLabel();\n    },\n    hover(item, monitor) {var _ref$current;\n      if (!ref.current) {\n        return;\n      }\n      const dragIndex = item.index;\n      const hoverIndex = index;\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = (_ref$current = ref.current) == null ? void 0 : _ref$current.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY = (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset != null && clientOffset.y ?\n      (clientOffset == null ? void 0 : clientOffset.y) - hoverBoundingRect.top :\n      0;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n      // Time to actually perform the action\n      onMoveLabel == null ? void 0 : onMoveLabel(dragIndex, hoverIndex);\n      // Note: we're mutating the monitor item here!\n      // Generally it's better to avoid mutations,\n      // but it's good here for the sake of performance\n      // to avoid expensive index searches.\n      // eslint-disable-next-line no-param-reassign\n      item.index = hoverIndex;\n    } });\n\n  const [, drag] = useDrag({\n    item: {\n      type,\n      index,\n      value: savedMetric != null && savedMetric.metric_name ? savedMetric : adhocMetric },\n\n    collect: monitor => ({\n      isDragging: monitor.isDragging() }) });\n\n\n  const getLabelContent = () => {\n    if (savedMetric != null && savedMetric.metric_name) {\n      return ___EmotionJSX(StyledMetricOption, { metric: savedMetric });\n    }\n    return ___EmotionJSX(Tooltip, { title: tooltipTitle }, label);\n  };\n  const getOptionControlContent = () => ___EmotionJSX(OptionControlContainer, _extends({ withCaret: withCaret, \"data-test\": \"option-label\" }, props),\n  ___EmotionJSX(CloseContainer, { role: \"button\", \"data-test\": \"remove-control-button\", onClick: onRemove },\n  ___EmotionJSX(Icons.XSmall, { iconColor: theme.colors.grayscale.light1 })),\n\n  ___EmotionJSX(Label, { \"data-test\": \"control-label\" },\n  isFunction && ___EmotionJSX(Icons.FunctionX, { viewBox: \"0 0 16 11\", iconSize: \"l\" }),\n  getLabelContent()),\n\n  isExtra && ___EmotionJSX(StyledInfoTooltipWithTrigger, { icon: \"exclamation-triangle\", placement: \"top\", bsStyle: \"warning\", tooltip: t(`\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              `) }),\n  withCaret && ___EmotionJSX(CaretContainer, null,\n  ___EmotionJSX(Icons.CaretRight, { iconColor: theme.colors.grayscale.light1 })));\n\n\n  drag(drop(ref));\n  return ___EmotionJSX(DragContainer, { ref: ref }, getOptionControlContent());\n};__signature__(OptionControlLabel, \"useTheme{theme}\\nuseRef{ref}\\nuseDrop{[, drop]}\\nuseDrag{[, drag]}\", () => [useTheme, useDrop, useDrag]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(DragContainer, \"DragContainer\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(OptionControlContainer, \"OptionControlContainer\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(Label, \"Label\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(CaretContainer, \"CaretContainer\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(CloseContainer, \"CloseContainer\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(StyledInfoTooltipWithTrigger, \"StyledInfoTooltipWithTrigger\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(HeaderContainer, \"HeaderContainer\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(LabelsContainer, \"LabelsContainer\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(DndLabelsContainer, \"DndLabelsContainer\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(AddControlLabel, \"AddControlLabel\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(AddIconButton, \"AddIconButton\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");reactHotLoader.register(OptionControlLabel, \"OptionControlLabel\", \"/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/OptionControls/index.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useRef } from 'react';\nimport { useDrag, useDrop, DropTargetMonitor } from 'react-dnd';\nimport { styled, t, useTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { savedMetricType } from 'src/explore/components/controls/MetricControl/types';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport { StyledMetricOption } from '../../optionRenderers';\n\nexport const DragContainer = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n  :last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const OptionControlContainer = styled.div<{\n  withCaret?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  background-color: ${({ theme }) => theme.colors.grayscale.light3};\n  border-radius: 3px;\n  cursor: ${({ withCaret }) => (withCaret ? 'pointer' : 'default')};\n`;\n\nexport const Label = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    max-width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${theme.gridUnit}px;\n    svg {\n      margin-right: ${theme.gridUnit}px;\n      margin-left: ${theme.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${theme.gridUnit * 2}px;\n      margin-left: ${theme.gridUnit}px;\n      font-weight: ${theme.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}\n`;\n\nexport const CaretContainer = styled.div`\n  height: 100%;\n  border-left: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  margin-left: auto;\n`;\n\nexport const CloseContainer = styled.div`\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 6}px;\n  border-right: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  cursor: pointer;\n`;\n\nconst StyledInfoTooltipWithTrigger = styled(InfoTooltipWithTrigger)`\n  margin: 0 ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const HeaderContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n`;\n\nexport const LabelsContainer = styled.div`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: solid 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const DndLabelsContainer = styled.div<{\n  canDrop?: boolean;\n  isOver?: boolean;\n}>`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: ${({ canDrop, isOver, theme }) => {\n    if (canDrop) {\n      return `dashed 1px ${theme.colors.info.dark1}`;\n    }\n    if (isOver && !canDrop) {\n      return `dashed 1px ${theme.colors.error.dark1}`;\n    }\n    return `solid 1px ${theme.colors.grayscale.light2}`;\n  }};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const AddControlLabel = styled.div<{\n  cancelHover?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  padding-left: ${({ theme }) => theme.gridUnit}px;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n  border: dashed 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n  cursor: ${({ cancelHover }) => (cancelHover ? 'inherit' : 'pointer')};\n\n  :hover {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light4};\n  }\n\n  :active {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light3};\n  }\n`;\n\nexport const AddIconButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: ${({ theme }) => theme.gridUnit * 4}px;\n  width: ${({ theme }) => theme.gridUnit * 4}px;\n  padding: 0;\n  background-color: ${({ theme }) => theme.colors.primary.dark1};\n  border: none;\n  border-radius: 2px;\n\n  :disabled {\n    cursor: not-allowed;\n    background-color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\n\ninterface DragItem {\n  index: number;\n  type: string;\n}\n\nexport const OptionControlLabel = ({\n  label,\n  savedMetric,\n  adhocMetric,\n  onRemove,\n  onMoveLabel,\n  onDropLabel,\n  withCaret,\n  isFunction,\n  type,\n  index,\n  isExtra,\n  tooltipTitle,\n  ...props\n}: {\n  label: string | React.ReactNode;\n  savedMetric?: savedMetricType;\n  adhocMetric?: AdhocMetric;\n  onRemove: () => void;\n  onMoveLabel: (dragIndex: number, hoverIndex: number) => void;\n  onDropLabel: () => void;\n  withCaret?: boolean;\n  isFunction?: boolean;\n  isDraggable?: boolean;\n  type: string;\n  index: number;\n  isExtra?: boolean;\n  tooltipTitle: string;\n}) => {\n  const theme = useTheme();\n  const ref = useRef<HTMLDivElement>(null);\n  const [, drop] = useDrop({\n    accept: type,\n    drop() {\n      onDropLabel?.();\n    },\n    hover(item: DragItem, monitor: DropTargetMonitor) {\n      if (!ref.current) {\n        return;\n      }\n      const dragIndex = item.index;\n      const hoverIndex = index;\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY =\n        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset?.y\n        ? clientOffset?.y - hoverBoundingRect.top\n        : 0;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n      // Time to actually perform the action\n      onMoveLabel?.(dragIndex, hoverIndex);\n      // Note: we're mutating the monitor item here!\n      // Generally it's better to avoid mutations,\n      // but it's good here for the sake of performance\n      // to avoid expensive index searches.\n      // eslint-disable-next-line no-param-reassign\n      item.index = hoverIndex;\n    },\n  });\n  const [, drag] = useDrag({\n    item: {\n      type,\n      index,\n      value: savedMetric?.metric_name ? savedMetric : adhocMetric,\n    },\n    collect: monitor => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const getLabelContent = () => {\n    if (savedMetric?.metric_name) {\n      return <StyledMetricOption metric={savedMetric} />;\n    }\n    return <Tooltip title={tooltipTitle}>{label}</Tooltip>;\n  };\n\n  const getOptionControlContent = () => (\n    <OptionControlContainer\n      withCaret={withCaret}\n      data-test=\"option-label\"\n      {...props}\n    >\n      <CloseContainer\n        role=\"button\"\n        data-test=\"remove-control-button\"\n        onClick={onRemove}\n      >\n        <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n      </CloseContainer>\n      <Label data-test=\"control-label\">\n        {isFunction && <Icons.FunctionX viewBox=\"0 0 16 11\" iconSize=\"l\" />}\n        {getLabelContent()}\n      </Label>\n      {isExtra && (\n        <StyledInfoTooltipWithTrigger\n          icon=\"exclamation-triangle\"\n          placement=\"top\"\n          bsStyle=\"warning\"\n          tooltip={t(`\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              `)}\n        />\n      )}\n      {withCaret && (\n        <CaretContainer>\n          <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n        </CaretContainer>\n      )}\n    </OptionControlContainer>\n  );\n\n  drag(drop(ref));\n  return <DragContainer ref={ref}>{getOptionControlContent()}</DragContainer>;\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}