{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import { css as _css } from \"@emotion/react\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _flatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/flat\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _someInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/some\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _debounce from \"lodash/debounce\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, css, useTheme } from '@superset-ui/core';\n\nimport { Resizable } from 're-resizable';\n\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icons from 'src/components/Icons';\nimport {\ngetFromLocalStorage,\nsetInLocalStorage } from\n'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport cx from 'classnames';\nimport * as chartActions from 'src/chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as logActions from '../../logger/actions';\nimport {\nLOG_ACTIONS_MOUNT_EXPLORER,\nLOG_ACTIONS_CHANGE_EXPLORE_CONTROLS } from\n'../../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.number.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string };\n\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  flex-basis: 100vh;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth });\n\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = _debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}__signature__(useWindowSize, \"useState{[size, setSize](getWindowSize())}\\nuseEffect{}\");\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = useDynamicPluginContext();\n  const dynamicPlugin = dynamicPluginContext.plugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.loading;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  const previousControls = usePrevious(props.controls);\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const theme = useTheme();\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight ?\n  `${props.forcedHeight}px` :\n  `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width' };\n\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300 };\n\n\n  function addHistory({ isReplace = false, title } = {}) {\n    const payload = { ...props.form_data };\n    const longUrl = getExploreLongUrl(\n    props.form_data,\n    props.standalone ? URL_PARAMS.standalone.name : null,\n    false);\n\n    try {\n      if (isReplace) {\n        window.history.replaceState(payload, title, longUrl);\n      } else {\n        window.history.pushState(payload, title, longUrl);\n      }\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n      'Failed at altering browser history',\n      payload,\n      title,\n      longUrl);\n\n    }\n  }\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && _Object$keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n      formData,\n      false,\n      props.timeout,\n      props.chart.id);\n\n    }\n  }\n\n  function onQuery() {\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n  }\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (_sliceInstanceProperty(props)) {\n          props.actions.\n          saveSlice(props.form_data, {\n            action: 'overwrite',\n            slice_id: _sliceInstanceProperty(props).slice_id,\n            slice_name: _sliceInstanceProperty(props).slice_name,\n            add_to_dash: 'noSave',\n            goto_dash: false }).\n\n          then(({ data }) => {\n            window.location = _sliceInstanceProperty(data).slice_url;\n          });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {var _context;\n    const hasError = _someInstanceProperty(_context = _Object$values(props.controls)).call(_context,\n    (control) =>\n    control.validationErrors && control.validationErrors.length > 0);\n\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = () => {\n    props.actions.updateQueryFormData(\n    getFormDataFromControls(props.controls),\n    props.chart.id);\n\n    props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n    addHistory();\n  };\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {var _context2;\n      if (\n      props.controls.datasource && (\n      previousControls.datasource == null ||\n      props.controls.datasource.value !== previousControls.datasource.value))\n      {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = _filterInstanceProperty(_context2 = _Object$keys(props.controls)).call(_context2,\n      (key) =>\n      typeof previousControls[key] !== 'undefined' &&\n      !areObjectsEqual(\n      props.controls[key].value,\n      previousControls[key].value));\n\n\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = _someInstanceProperty(changedControlKeys).call(changedControlKeys,\n      key => props.controls[key].renderTrigger);\n\n      if (hasDisplayControlChanged) {\n        reRenderChart();\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (previousControls) {var _context3;\n      const changedControlKeys = _filterInstanceProperty(_context3 = _Object$keys(props.controls)).call(_context3,\n      (key) =>\n      typeof previousControls[key] !== 'undefined' &&\n      !areObjectsEqual(\n      props.controls[key].value,\n      previousControls[key].value));\n\n\n\n      return _someInstanceProperty(changedControlKeys).call(changedControlKeys,\n      (key) =>\n      !props.controls[key].renderTrigger &&\n      !props.controls[key].dontRefreshOnChange);\n\n    }\n    return false;\n  }, [previousControls, props.controls]);\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  function renderErrorMessage() {var _context4, _context5;\n    // Returns an error message as a node if any errors are in the store\n    const controlsWithErrors = _filterInstanceProperty(_context4 = _Object$values(props.controls)).call(_context4,\n    (control) =>\n    control.validationErrors && control.validationErrors.length > 0);\n\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = _mapInstanceProperty(controlsWithErrors).call(controlsWithErrors,\n    control => control.validationErrors);\n\n    const uniqueErrorMessages = [...new _Set(_flatInstanceProperty(errorMessages).call(errorMessages))];\n\n    const errors = _mapInstanceProperty(_context5 = _mapInstanceProperty(uniqueErrorMessages).call(uniqueErrorMessages,\n    message => {var _context6;\n      const matchingLabels = _mapInstanceProperty(_context6 = _filterInstanceProperty(controlsWithErrors).call(controlsWithErrors,\n      control => {var _control$validationEr;return (_control$validationEr = control.validationErrors) == null ? void 0 : _includesInstanceProperty(_control$validationEr).call(_control$validationEr, message);})).call(_context6,\n      control => control.label);\n      return [matchingLabels, message];\n    })).call(_context5,\n    ([labels, message]) =>\n    ___EmotionJSX(\"div\", { key: message },\n    labels.length > 1 ? t('Controls labeled ') : t('Control labeled '),\n    ___EmotionJSX(\"strong\", null, ` ${labels.join(', ')}`),\n    ___EmotionJSX(\"span\", null, \": \", message)));\n\n\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = ___EmotionJSX(\"div\", { style: { textAlign: 'left' } }, errors);\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      ___EmotionJSX(ExploreChartPanel, _extends({\n        width: width,\n        height: height },\n      props, {\n        errorMessage: renderErrorMessage(),\n        refreshOverlayVisible: chartIsStale,\n        addHistory: addHistory,\n        onQuery: onQuery })));\n\n\n  }\n\n  function getSidebarWidths(key) {\n    return getFromLocalStorage(key, defaultSidebarsWidth[key]);\n  }\n\n  function setSidebarWidths(key, dimension) {\n    const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n    setInLocalStorage(key, newDimension);\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    ___EmotionJSX(Styles, { id: \"explore-container\", height: height },\n    ___EmotionJSX(Global, {\n      styles: css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100vh;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        ` }),\n\n    showingModal &&\n    ___EmotionJSX(SaveModal, {\n      onHide: toggleModal,\n      actions: props.actions,\n      form_data: props.form_data,\n      sliceName: props.sliceName,\n      dashboardId: props.dashboardId }),\n\n\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.dataSourceWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.dataSourceWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.dataSourceWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className:\n      isCollapsed ? 'no-show' : 'explore-column data-source-selection' },\n\n\n    ___EmotionJSX(\"div\", { className: \"title-container\" },\n    ___EmotionJSX(\"span\", { className: \"horizont al-text\" }, t('Dataset')),\n    ___EmotionJSX(\"span\", {\n      role: \"button\",\n      tabIndex: 0,\n      className: \"action-button\",\n      onClick: toggleCollapse },\n\n    ___EmotionJSX(Icons.Expand, {\n      className: \"collapse-icon\",\n      iconColor: theme.colors.primary.base,\n      iconSize: \"l\" }))),\n\n\n\n    ___EmotionJSX(DataSourcePanel, {\n      datasource: props.datasource,\n      controls: props.controls,\n      actions: props.actions })),\n\n\n    isCollapsed ?\n    ___EmotionJSX(\"div\", {\n      className: \"sidebar\",\n      onClick: toggleCollapse,\n      \"data-test\": \"open-datasource-tab\",\n      role: \"button\",\n      tabIndex: 0 },\n\n    ___EmotionJSX(\"span\", { role: \"button\", tabIndex: 0, className: \"action-button\" },\n    ___EmotionJSX(Tooltip, { title: t('Open Datasource tab') },\n    ___EmotionJSX(Icons.Collapse, {\n      className: \"collapse-icon\",\n      iconColor: theme.colors.primary.base,\n      iconSize: \"l\" }))),\n\n\n\n    ___EmotionJSX(Icons.DatasetPhysical, {\n      css: /*#__PURE__*/_css({ marginTop: theme.gridUnit * 2 }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ExploreViewContainer;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9hcHAvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2V4cGxvcmUvY29tcG9uZW50cy9FeHBsb3JlVmlld0NvbnRhaW5lci5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBMGdCWSIsImZpbGUiOiIvYXBwL3N1cGVyc2V0LWZyb250ZW5kL3NyYy9leHBsb3JlL2NvbXBvbmVudHMvRXhwbG9yZVZpZXdDb250YWluZXIuanN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyogZXNsaW50IGNhbWVsY2FzZTogMCAqL1xuaW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCwgdXNlTWVtbywgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHsgYmluZEFjdGlvbkNyZWF0b3JzIH0gZnJvbSAncmVkdXgnO1xuaW1wb3J0IHsgY29ubmVjdCB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCB7IHN0eWxlZCwgdCwgY3NzLCB1c2VUaGVtZSB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCB7IGRlYm91bmNlIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IFJlc2l6YWJsZSB9IGZyb20gJ3JlLXJlc2l6YWJsZSc7XG5cbmltcG9ydCB7IHVzZUR5bmFtaWNQbHVnaW5Db250ZXh0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvRHluYW1pY1BsdWdpbnMnO1xuaW1wb3J0IHsgR2xvYmFsIH0gZnJvbSAnQGVtb3Rpb24vcmVhY3QnO1xuaW1wb3J0IHsgVG9vbHRpcCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL1Rvb2x0aXAnO1xuaW1wb3J0IHsgdXNlUHJldmlvdXMgfSBmcm9tICdzcmMvY29tbW9uL2hvb2tzL3VzZVByZXZpb3VzJztcbmltcG9ydCBJY29ucyBmcm9tICdzcmMvY29tcG9uZW50cy9JY29ucyc7XG5pbXBvcnQge1xuICBnZXRGcm9tTG9jYWxTdG9yYWdlLFxuICBzZXRJbkxvY2FsU3RvcmFnZSxcbn0gZnJvbSAnc3JjL3V0aWxzL2xvY2FsU3RvcmFnZUhlbHBlcnMnO1xuaW1wb3J0IHsgVVJMX1BBUkFNUyB9IGZyb20gJ3NyYy9jb25zdGFudHMnO1xuaW1wb3J0IGN4IGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0ICogYXMgY2hhcnRBY3Rpb25zIGZyb20gJ3NyYy9jaGFydC9jaGFydEFjdGlvbic7XG5pbXBvcnQgeyBmZXRjaERhdGFzb3VyY2VNZXRhZGF0YSB9IGZyb20gJ3NyYy9kYXNoYm9hcmQvYWN0aW9ucy9kYXRhc291cmNlcyc7XG5pbXBvcnQgeyBjaGFydFByb3BTaGFwZSB9IGZyb20gJ3NyYy9kYXNoYm9hcmQvdXRpbC9wcm9wU2hhcGVzJztcbmltcG9ydCB7IG1lcmdlRXh0cmFGb3JtRGF0YSB9IGZyb20gJ3NyYy9kYXNoYm9hcmQvY29tcG9uZW50cy9uYXRpdmVGaWx0ZXJzL3V0aWxzJztcbmltcG9ydCBFeHBsb3JlQ2hhcnRQYW5lbCBmcm9tICcuL0V4cGxvcmVDaGFydFBhbmVsJztcbmltcG9ydCBDb25uZWN0ZWRDb250cm9sUGFuZWxzQ29udGFpbmVyIGZyb20gJy4vQ29udHJvbFBhbmVsc0NvbnRhaW5lcic7XG5pbXBvcnQgU2F2ZU1vZGFsIGZyb20gJy4vU2F2ZU1vZGFsJztcbmltcG9ydCBRdWVyeUFuZFNhdmVCdG5zIGZyb20gJy4vUXVlcnlBbmRTYXZlQnRucyc7XG5pbXBvcnQgRGF0YVNvdXJjZVBhbmVsIGZyb20gJy4vRGF0YXNvdXJjZVBhbmVsJztcbmltcG9ydCB7IGdldEV4cGxvcmVMb25nVXJsIH0gZnJvbSAnLi4vZXhwbG9yZVV0aWxzJztcbmltcG9ydCB7IGFyZU9iamVjdHNFcXVhbCB9IGZyb20gJy4uLy4uL3JlZHV4VXRpbHMnO1xuaW1wb3J0IHsgZ2V0Rm9ybURhdGFGcm9tQ29udHJvbHMgfSBmcm9tICcuLi9jb250cm9sVXRpbHMnO1xuaW1wb3J0ICogYXMgZXhwbG9yZUFjdGlvbnMgZnJvbSAnLi4vYWN0aW9ucy9leHBsb3JlQWN0aW9ucyc7XG5pbXBvcnQgKiBhcyBzYXZlTW9kYWxBY3Rpb25zIGZyb20gJy4uL2FjdGlvbnMvc2F2ZU1vZGFsQWN0aW9ucyc7XG5pbXBvcnQgKiBhcyBsb2dBY3Rpb25zIGZyb20gJy4uLy4uL2xvZ2dlci9hY3Rpb25zJztcbmltcG9ydCB7XG4gIExPR19BQ1RJT05TX01PVU5UX0VYUExPUkVSLFxuICBMT0dfQUNUSU9OU19DSEFOR0VfRVhQTE9SRV9DT05UUk9MUyxcbn0gZnJvbSAnLi4vLi4vbG9nZ2VyL0xvZ1V0aWxzJztcblxuY29uc3QgcHJvcFR5cGVzID0ge1xuICAuLi5FeHBsb3JlQ2hhcnRQYW5lbC5wcm9wVHlwZXMsXG4gIGhlaWdodDogUHJvcFR5cGVzLnN0cmluZyxcbiAgd2lkdGg6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGFjdGlvbnM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgZGF0YXNvdXJjZV90eXBlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gIGRhc2hib2FyZElkOiBQcm9wVHlwZXMubnVtYmVyLFxuICBpc0RhdGFzb3VyY2VNZXRhTG9hZGluZzogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgY2hhcnQ6IGNoYXJ0UHJvcFNoYXBlLmlzUmVxdWlyZWQsXG4gIHNsaWNlOiBQcm9wVHlwZXMub2JqZWN0LFxuICBzbGljZU5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGNvbnRyb2xzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gIGZvcmNlZEhlaWdodDogUHJvcFR5cGVzLnN0cmluZyxcbiAgZm9ybV9kYXRhOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gIHN0YW5kYWxvbmU6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgdGltZW91dDogUHJvcFR5cGVzLm51bWJlcixcbiAgaW1wcmVzc2lvbklkOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB2aXpUeXBlOiBQcm9wVHlwZXMuc3RyaW5nLFxufTtcblxuY29uc3QgU3R5bGVzID0gc3R5bGVkLmRpdmBcbiAgYmFja2dyb3VuZDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0NX07XG4gIHRleHQtYWxpZ246IGxlZnQ7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgd2lkdGg6IDEwMCU7XG4gIGhlaWdodDogMTAwJTtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgZmxleC13cmFwOiBub3dyYXA7XG4gIGZsZXgtYmFzaXM6IDEwMHZoO1xuICBhbGlnbi1pdGVtczogc3RyZXRjaDtcbiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuICAuZXhwbG9yZS1jb2x1bW4ge1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgICBwYWRkaW5nOiAkeyh7IHRoZW1lIH0pID0+IDIgKiB0aGVtZS5ncmlkVW5pdH1weCAwO1xuICAgIG1heC1oZWlnaHQ6IDEwMCU7XG4gIH1cbiAgLmRhdGEtc291cmNlLXNlbGVjdGlvbiB7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0NH07XG4gICAgcGFkZGluZzogJHsoeyB0aGVtZSB9KSA9PiAyICogdGhlbWUuZ3JpZFVuaXR9cHggMDtcbiAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgfVxuICAubWFpbi1leHBsb3JlLWNvbnRlbnQge1xuICAgIGZsZXg6IDE7XG4gICAgbWluLXdpZHRoOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMTI4fXB4O1xuICAgIGJvcmRlci1sZWZ0OiAxcHggc29saWQgJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0Mn07XG4gICAgLnBhbmVsIHtcbiAgICAgIG1hcmdpbi1ib3R0b206IDA7XG4gICAgfVxuICB9XG4gIC5jb250cm9scy1jb2x1bW4ge1xuICAgIGFsaWduLXNlbGY6IGZsZXgtc3RhcnQ7XG4gICAgcGFkZGluZzogMDtcbiAgfVxuICAudGl0bGUtY29udGFpbmVyIHtcbiAgICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICBmbGV4LWRpcmVjdGlvbjogcm93O1xuICAgIHBhZGRpbmc6IDAgJHsoeyB0aGVtZSB9KSA9PiAyICogdGhlbWUuZ3JpZFVuaXR9cHg7XG4gICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICAgIC5ob3Jpem9udGFsLXRleHQge1xuICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTtcbiAgICAgIGNvbG9yOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQxfTtcbiAgICAgIGZvbnQtc2l6ZTogJHsoeyB0aGVtZSB9KSA9PiA0ICogdGhlbWUudHlwb2dyYXBoeS5zaXplcy5zfTtcbiAgICB9XG4gIH1cbiAgLm5vLXNob3cge1xuICAgIGRpc3BsYXk6IG5vbmU7XG4gIH1cbiAgLnZlcnRpY2FsLXRleHQge1xuICAgIHdyaXRpbmctbW9kZTogdmVydGljYWwtcmw7XG4gICAgdGV4dC1vcmllbnRhdGlvbjogbWl4ZWQ7XG4gIH1cbiAgLnNpZGViYXIge1xuICAgIGhlaWdodDogMTAwJTtcbiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQ0fTtcbiAgICBwYWRkaW5nOiAkeyh7IHRoZW1lIH0pID0+IDIgKiB0aGVtZS5ncmlkVW5pdH1weDtcbiAgICB3aWR0aDogJHsoeyB0aGVtZSB9KSA9PiA4ICogdGhlbWUuZ3JpZFVuaXR9cHg7XG4gIH1cbiAgLmNhbGxwYXNlLWljb24gPiBzdmcge1xuICAgIGNvbG9yOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5wcmltYXJ5LmJhc2V9O1xuICB9XG5gO1xuXG5jb25zdCBnZXRXaW5kb3dTaXplID0gKCkgPT4gKHtcbiAgaGVpZ2h0OiB3aW5kb3cuaW5uZXJIZWlnaHQsXG4gIHdpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCxcbn0pO1xuXG5mdW5jdGlvbiB1c2VXaW5kb3dTaXplKHsgZGVsYXlNcyA9IDI1MCB9ID0ge30pIHtcbiAgY29uc3QgW3NpemUsIHNldFNpemVdID0gdXNlU3RhdGUoZ2V0V2luZG93U2l6ZSgpKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IG9uV2luZG93UmVzaXplID0gZGVib3VuY2UoKCkgPT4gc2V0U2l6ZShnZXRXaW5kb3dTaXplKCkpLCBkZWxheU1zKTtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25XaW5kb3dSZXNpemUpO1xuICAgIHJldHVybiAoKSA9PiB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgb25XaW5kb3dSZXNpemUpO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIHNpemU7XG59XG5cbmZ1bmN0aW9uIEV4cGxvcmVWaWV3Q29udGFpbmVyKHByb3BzKSB7XG4gIGNvbnN0IGR5bmFtaWNQbHVnaW5Db250ZXh0ID0gdXNlRHluYW1pY1BsdWdpbkNvbnRleHQoKTtcbiAgY29uc3QgZHluYW1pY1BsdWdpbiA9IGR5bmFtaWNQbHVnaW5Db250ZXh0LnBsdWdpbnNbcHJvcHMudml6VHlwZV07XG4gIGNvbnN0IGlzRHluYW1pY1BsdWdpbkxvYWRpbmcgPSBkeW5hbWljUGx1Z2luICYmIGR5bmFtaWNQbHVnaW4ubG9hZGluZztcbiAgY29uc3Qgd2FzRHluYW1pY1BsdWdpbkxvYWRpbmcgPSB1c2VQcmV2aW91cyhpc0R5bmFtaWNQbHVnaW5Mb2FkaW5nKTtcblxuICBjb25zdCBwcmV2aW91c0NvbnRyb2xzID0gdXNlUHJldmlvdXMocHJvcHMuY29udHJvbHMpO1xuICBjb25zdCB3aW5kb3dTaXplID0gdXNlV2luZG93U2l6ZSgpO1xuXG4gIGNvbnN0IFtzaG93aW5nTW9kYWwsIHNldFNob3dpbmdNb2RhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtpc0NvbGxhcHNlZCwgc2V0SXNDb2xsYXBzZWRdID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gIGNvbnN0IHRoZW1lID0gdXNlVGhlbWUoKTtcbiAgY29uc3Qgd2lkdGggPSBgJHt3aW5kb3dTaXplLndpZHRofXB4YDtcbiAgY29uc3QgbmF2SGVpZ2h0ID0gcHJvcHMuc3RhbmRhbG9uZSA/IDAgOiA5MDtcbiAgY29uc3QgaGVpZ2h0ID0gcHJvcHMuZm9yY2VkSGVpZ2h0XG4gICAgPyBgJHtwcm9wcy5mb3JjZWRIZWlnaHR9cHhgXG4gICAgOiBgJHt3aW5kb3dTaXplLmhlaWdodCAtIG5hdkhlaWdodH1weGA7XG5cbiAgY29uc3Qgc3RvcmFnZUtleXMgPSB7XG4gICAgY29udHJvbHNXaWR0aDogJ2NvbnRyb2xzX3dpZHRoJyxcbiAgICBkYXRhU291cmNlV2lkdGg6ICdkYXRhc291cmNlX3dpZHRoJyxcbiAgfTtcblxuICBjb25zdCBkZWZhdWx0U2lkZWJhcnNXaWR0aCA9IHtcbiAgICBjb250cm9sc193aWR0aDogMzIwLFxuICAgIGRhdGFzb3VyY2Vfd2lkdGg6IDMwMCxcbiAgfTtcblxuICBmdW5jdGlvbiBhZGRIaXN0b3J5KHsgaXNSZXBsYWNlID0gZmFsc2UsIHRpdGxlIH0gPSB7fSkge1xuICAgIGNvbnN0IHBheWxvYWQgPSB7IC4uLnByb3BzLmZvcm1fZGF0YSB9O1xuICAgIGNvbnN0IGxvbmdVcmwgPSBnZXRFeHBsb3JlTG9uZ1VybChcbiAgICAgIHByb3BzLmZvcm1fZGF0YSxcbiAgICAgIHByb3BzLnN0YW5kYWxvbmUgPyBVUkxfUEFSQU1TLnN0YW5kYWxvbmUubmFtZSA6IG51bGwsXG4gICAgICBmYWxzZSxcbiAgICApO1xuICAgIHRyeSB7XG4gICAgICBpZiAoaXNSZXBsYWNlKSB7XG4gICAgICAgIHdpbmRvdy5oaXN0b3J5LnJlcGxhY2VTdGF0ZShwYXlsb2FkLCB0aXRsZSwgbG9uZ1VybCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUocGF5bG9hZCwgdGl0bGUsIGxvbmdVcmwpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdGYWlsZWQgYXQgYWx0ZXJpbmcgYnJvd3NlciBoaXN0b3J5JyxcbiAgICAgICAgcGF5bG9hZCxcbiAgICAgICAgdGl0bGUsXG4gICAgICAgIGxvbmdVcmwsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZVBvcHN0YXRlKCkge1xuICAgIGNvbnN0IGZvcm1EYXRhID0gd2luZG93Lmhpc3Rvcnkuc3RhdGU7XG4gICAgaWYgKGZvcm1EYXRhICYmIE9iamVjdC5rZXlzKGZvcm1EYXRhKS5sZW5ndGgpIHtcbiAgICAgIHByb3BzLmFjdGlvbnMuc2V0RXhwbG9yZUNvbnRyb2xzKGZvcm1EYXRhKTtcbiAgICAgIHByb3BzLmFjdGlvbnMucG9zdENoYXJ0Rm9ybURhdGEoXG4gICAgICAgIGZvcm1EYXRhLFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgcHJvcHMudGltZW91dCxcbiAgICAgICAgcHJvcHMuY2hhcnQuaWQsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uUXVlcnkoKSB7XG4gICAgcHJvcHMuYWN0aW9ucy50cmlnZ2VyUXVlcnkodHJ1ZSwgcHJvcHMuY2hhcnQuaWQpO1xuICAgIGFkZEhpc3RvcnkoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZUtleWRvd24oZXZlbnQpIHtcbiAgICBjb25zdCBjb250cm9sT3JDb21tYW5kID0gZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5O1xuICAgIGlmIChjb250cm9sT3JDb21tYW5kKSB7XG4gICAgICBjb25zdCBpc0VudGVyID0gZXZlbnQua2V5ID09PSAnRW50ZXInIHx8IGV2ZW50LmtleUNvZGUgPT09IDEzO1xuICAgICAgY29uc3QgaXNTID0gZXZlbnQua2V5ID09PSAncycgfHwgZXZlbnQua2V5Q29kZSA9PT0gODM7XG4gICAgICBpZiAoaXNFbnRlcikge1xuICAgICAgICBvblF1ZXJ5KCk7XG4gICAgICB9IGVsc2UgaWYgKGlzUykge1xuICAgICAgICBpZiAocHJvcHMuc2xpY2UpIHtcbiAgICAgICAgICBwcm9wcy5hY3Rpb25zXG4gICAgICAgICAgICAuc2F2ZVNsaWNlKHByb3BzLmZvcm1fZGF0YSwge1xuICAgICAgICAgICAgICBhY3Rpb246ICdvdmVyd3JpdGUnLFxuICAgICAgICAgICAgICBzbGljZV9pZDogcHJvcHMuc2xpY2Uuc2xpY2VfaWQsXG4gICAgICAgICAgICAgIHNsaWNlX25hbWU6IHByb3BzLnNsaWNlLnNsaWNlX25hbWUsXG4gICAgICAgICAgICAgIGFkZF90b19kYXNoOiAnbm9TYXZlJyxcbiAgICAgICAgICAgICAgZ290b19kYXNoOiBmYWxzZSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHtcbiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gZGF0YS5zbGljZS5zbGljZV91cmw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcCgpIHtcbiAgICBpZiAocHJvcHMuY2hhcnQgJiYgcHJvcHMuY2hhcnQucXVlcnlDb250cm9sbGVyKSB7XG4gICAgICBwcm9wcy5jaGFydC5xdWVyeUNvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB0b2dnbGVNb2RhbCgpIHtcbiAgICBzZXRTaG93aW5nTW9kYWwoIXNob3dpbmdNb2RhbCk7XG4gIH1cblxuICBmdW5jdGlvbiB0b2dnbGVDb2xsYXBzZSgpIHtcbiAgICBzZXRJc0NvbGxhcHNlZCghaXNDb2xsYXBzZWQpO1xuICB9XG5cbiAgLy8gZWZmZWN0IHRvIHJ1biBvbiBtb3VudFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHByb3BzLmFjdGlvbnMubG9nRXZlbnQoTE9HX0FDVElPTlNfTU9VTlRfRVhQTE9SRVIpO1xuICAgIGFkZEhpc3RvcnkoeyBpc1JlcGxhY2U6IHRydWUgfSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgaGFuZGxlUG9wc3RhdGUpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlkb3duKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgaGFuZGxlUG9wc3RhdGUpO1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUtleWRvd24pO1xuICAgIH07XG4gIH0sIFtdKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICh3YXNEeW5hbWljUGx1Z2luTG9hZGluZyAmJiAhaXNEeW5hbWljUGx1Z2luTG9hZGluZykge1xuICAgICAgLy8gcmVsb2FkIHRoZSBjb250cm9scyBub3cgdGhhdCB3ZSBhY3R1YWxseSBoYXZlIHRoZSBjb250cm9sIGNvbmZpZ1xuICAgICAgcHJvcHMuYWN0aW9ucy5keW5hbWljUGx1Z2luQ29udHJvbHNSZWFkeSgpO1xuICAgIH1cbiAgfSwgW2lzRHluYW1pY1BsdWdpbkxvYWRpbmddKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGhhc0Vycm9yID0gT2JqZWN0LnZhbHVlcyhwcm9wcy5jb250cm9scykuc29tZShcbiAgICAgIGNvbnRyb2wgPT5cbiAgICAgICAgY29udHJvbC52YWxpZGF0aW9uRXJyb3JzICYmIGNvbnRyb2wudmFsaWRhdGlvbkVycm9ycy5sZW5ndGggPiAwLFxuICAgICk7XG4gICAgaWYgKCFoYXNFcnJvcikge1xuICAgICAgcHJvcHMuYWN0aW9ucy50cmlnZ2VyUXVlcnkodHJ1ZSwgcHJvcHMuY2hhcnQuaWQpO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIGNvbnN0IHJlUmVuZGVyQ2hhcnQgPSAoKSA9PiB7XG4gICAgcHJvcHMuYWN0aW9ucy51cGRhdGVRdWVyeUZvcm1EYXRhKFxuICAgICAgZ2V0Rm9ybURhdGFGcm9tQ29udHJvbHMocHJvcHMuY29udHJvbHMpLFxuICAgICAgcHJvcHMuY2hhcnQuaWQsXG4gICAgKTtcbiAgICBwcm9wcy5hY3Rpb25zLnJlbmRlclRyaWdnZXJlZChuZXcgRGF0ZSgpLmdldFRpbWUoKSwgcHJvcHMuY2hhcnQuaWQpO1xuICAgIGFkZEhpc3RvcnkoKTtcbiAgfTtcblxuICAvLyBlZmZlY3QgdG8gcnVuIHdoZW4gY29udHJvbHMgY2hhbmdlXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHByZXZpb3VzQ29udHJvbHMpIHtcbiAgICAgIGlmIChcbiAgICAgICAgcHJvcHMuY29udHJvbHMuZGF0YXNvdXJjZSAmJlxuICAgICAgICAocHJldmlvdXNDb250cm9scy5kYXRhc291cmNlID09IG51bGwgfHxcbiAgICAgICAgICBwcm9wcy5jb250cm9scy5kYXRhc291cmNlLnZhbHVlICE9PSBwcmV2aW91c0NvbnRyb2xzLmRhdGFzb3VyY2UudmFsdWUpXG4gICAgICApIHtcbiAgICAgICAgLy8gdGhpcyBzaG91bGQgcmVhbGx5IGJlIGhhbmRsZWQgYnkgYWN0aW9uc1xuICAgICAgICBmZXRjaERhdGFzb3VyY2VNZXRhZGF0YShwcm9wcy5mb3JtX2RhdGEuZGF0YXNvdXJjZSwgdHJ1ZSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNoYW5nZWRDb250cm9sS2V5cyA9IE9iamVjdC5rZXlzKHByb3BzLmNvbnRyb2xzKS5maWx0ZXIoXG4gICAgICAgIGtleSA9PlxuICAgICAgICAgIHR5cGVvZiBwcmV2aW91c0NvbnRyb2xzW2tleV0gIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgICAgIWFyZU9iamVjdHNFcXVhbChcbiAgICAgICAgICAgIHByb3BzLmNvbnRyb2xzW2tleV0udmFsdWUsXG4gICAgICAgICAgICBwcmV2aW91c0NvbnRyb2xzW2tleV0udmFsdWUsXG4gICAgICAgICAgKSxcbiAgICAgICk7XG5cbiAgICAgIC8vIHRoaXMgc2hvdWxkIGFsc28gYmUgaGFuZGxlZCBieSB0aGUgYWN0aW9ucyB0aGF0IGFyZSBhY3R1YWxseSBjaGFuZ2luZyB0aGUgY29udHJvbHNcbiAgICAgIGNvbnN0IGhhc0Rpc3BsYXlDb250cm9sQ2hhbmdlZCA9IGNoYW5nZWRDb250cm9sS2V5cy5zb21lKFxuICAgICAgICBrZXkgPT4gcHJvcHMuY29udHJvbHNba2V5XS5yZW5kZXJUcmlnZ2VyLFxuICAgICAgKTtcbiAgICAgIGlmIChoYXNEaXNwbGF5Q29udHJvbENoYW5nZWQpIHtcbiAgICAgICAgcmVSZW5kZXJDaGFydCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwgW3Byb3BzLmNvbnRyb2xzLCBwcm9wcy5vd25TdGF0ZV0pO1xuXG4gIGNvbnN0IGNoYXJ0SXNTdGFsZSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGlmIChwcmV2aW91c0NvbnRyb2xzKSB7XG4gICAgICBjb25zdCBjaGFuZ2VkQ29udHJvbEtleXMgPSBPYmplY3Qua2V5cyhwcm9wcy5jb250cm9scykuZmlsdGVyKFxuICAgICAgICBrZXkgPT5cbiAgICAgICAgICB0eXBlb2YgcHJldmlvdXNDb250cm9sc1trZXldICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICFhcmVPYmplY3RzRXF1YWwoXG4gICAgICAgICAgICBwcm9wcy5jb250cm9sc1trZXldLnZhbHVlLFxuICAgICAgICAgICAgcHJldmlvdXNDb250cm9sc1trZXldLnZhbHVlLFxuICAgICAgICAgICksXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gY2hhbmdlZENvbnRyb2xLZXlzLnNvbWUoXG4gICAgICAgIGtleSA9PlxuICAgICAgICAgICFwcm9wcy5jb250cm9sc1trZXldLnJlbmRlclRyaWdnZXIgJiZcbiAgICAgICAgICAhcHJvcHMuY29udHJvbHNba2V5XS5kb250UmVmcmVzaE9uQ2hhbmdlLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LCBbcHJldmlvdXNDb250cm9scywgcHJvcHMuY29udHJvbHNdKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChwcm9wcy5vd25TdGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBvblF1ZXJ5KCk7XG4gICAgICByZVJlbmRlckNoYXJ0KCk7XG4gICAgfVxuICB9LCBbcHJvcHMub3duU3RhdGVdKTtcblxuICBpZiAoY2hhcnRJc1N0YWxlKSB7XG4gICAgcHJvcHMuYWN0aW9ucy5sb2dFdmVudChMT0dfQUNUSU9OU19DSEFOR0VfRVhQTE9SRV9DT05UUk9MUyk7XG4gIH1cblxuICBmdW5jdGlvbiByZW5kZXJFcnJvck1lc3NhZ2UoKSB7XG4gICAgLy8gUmV0dXJucyBhbiBlcnJvciBtZXNzYWdlIGFzIGEgbm9kZSBpZiBhbnkgZXJyb3JzIGFyZSBpbiB0aGUgc3RvcmVcbiAgICBjb25zdCBjb250cm9sc1dpdGhFcnJvcnMgPSBPYmplY3QudmFsdWVzKHByb3BzLmNvbnRyb2xzKS5maWx0ZXIoXG4gICAgICBjb250cm9sID0+XG4gICAgICAgIGNvbnRyb2wudmFsaWRhdGlvbkVycm9ycyAmJiBjb250cm9sLnZhbGlkYXRpb25FcnJvcnMubGVuZ3RoID4gMCxcbiAgICApO1xuICAgIGlmIChjb250cm9sc1dpdGhFcnJvcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvck1lc3NhZ2VzID0gY29udHJvbHNXaXRoRXJyb3JzLm1hcChcbiAgICAgIGNvbnRyb2wgPT4gY29udHJvbC52YWxpZGF0aW9uRXJyb3JzLFxuICAgICk7XG4gICAgY29uc3QgdW5pcXVlRXJyb3JNZXNzYWdlcyA9IFsuLi5uZXcgU2V0KGVycm9yTWVzc2FnZXMuZmxhdCgpKV07XG5cbiAgICBjb25zdCBlcnJvcnMgPSB1bmlxdWVFcnJvck1lc3NhZ2VzXG4gICAgICAubWFwKG1lc3NhZ2UgPT4ge1xuICAgICAgICBjb25zdCBtYXRjaGluZ0xhYmVscyA9IGNvbnRyb2xzV2l0aEVycm9yc1xuICAgICAgICAgIC5maWx0ZXIoY29udHJvbCA9PiBjb250cm9sLnZhbGlkYXRpb25FcnJvcnM/LmluY2x1ZGVzKG1lc3NhZ2UpKVxuICAgICAgICAgIC5tYXAoY29udHJvbCA9PiBjb250cm9sLmxhYmVsKTtcbiAgICAgICAgcmV0dXJuIFttYXRjaGluZ0xhYmVscywgbWVzc2FnZV07XG4gICAgICB9KVxuICAgICAgLm1hcCgoW2xhYmVscywgbWVzc2FnZV0pID0+IChcbiAgICAgICAgPGRpdiBrZXk9e21lc3NhZ2V9PlxuICAgICAgICAgIHtsYWJlbHMubGVuZ3RoID4gMSA/IHQoJ0NvbnRyb2xzIGxhYmVsZWQgJykgOiB0KCdDb250cm9sIGxhYmVsZWQgJyl9XG4gICAgICAgICAgPHN0cm9uZz57YCAke2xhYmVscy5qb2luKCcsICcpfWB9PC9zdHJvbmc+XG4gICAgICAgICAgPHNwYW4+OiB7bWVzc2FnZX08L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKSk7XG5cbiAgICBsZXQgZXJyb3JNZXNzYWdlO1xuICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgZXJyb3JNZXNzYWdlID0gPGRpdiBzdHlsZT17eyB0ZXh0QWxpZ246ICdsZWZ0JyB9fT57ZXJyb3JzfTwvZGl2PjtcbiAgICB9XG4gICAgcmV0dXJuIGVycm9yTWVzc2FnZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlckNoYXJ0Q29udGFpbmVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8RXhwbG9yZUNoYXJ0UGFuZWxcbiAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgICBoZWlnaHQ9e2hlaWdodH1cbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgICBlcnJvck1lc3NhZ2U9e3JlbmRlckVycm9yTWVzc2FnZSgpfVxuICAgICAgICByZWZyZXNoT3ZlcmxheVZpc2libGU9e2NoYXJ0SXNTdGFsZX1cbiAgICAgICAgYWRkSGlzdG9yeT17YWRkSGlzdG9yeX1cbiAgICAgICAgb25RdWVyeT17b25RdWVyeX1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFNpZGViYXJXaWR0aHMoa2V5KSB7XG4gICAgcmV0dXJuIGdldEZyb21Mb2NhbFN0b3JhZ2Uoa2V5LCBkZWZhdWx0U2lkZWJhcnNXaWR0aFtrZXldKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFNpZGViYXJXaWR0aHMoa2V5LCBkaW1lbnNpb24pIHtcbiAgICBjb25zdCBuZXdEaW1lbnNpb24gPSBOdW1iZXIoZ2V0U2lkZWJhcldpZHRocyhrZXkpKSArIGRpbWVuc2lvbi53aWR0aDtcbiAgICBzZXRJbkxvY2FsU3RvcmFnZShrZXksIG5ld0RpbWVuc2lvbik7XG4gIH1cblxuICBpZiAocHJvcHMuc3RhbmRhbG9uZSkge1xuICAgIHJldHVybiByZW5kZXJDaGFydENvbnRhaW5lcigpO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8U3R5bGVzIGlkPVwiZXhwbG9yZS1jb250YWluZXJcIiBoZWlnaHQ9e2hlaWdodH0+XG4gICAgICA8R2xvYmFsXG4gICAgICAgIHN0eWxlcz17Y3NzYFxuICAgICAgICAgIC5uYXZiYXIge1xuICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgYm9keSB7XG4gICAgICAgICAgICBtYXgtaGVpZ2h0OiAxMDB2aDtcbiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgICAgICAgfVxuICAgICAgICAgICNhcHAtbWVudSxcbiAgICAgICAgICAjYXBwIHtcbiAgICAgICAgICAgIGZsZXg6IDEgMSBhdXRvO1xuICAgICAgICAgIH1cbiAgICAgICAgICAjYXBwIHtcbiAgICAgICAgICAgIGZsZXgtYmFzaXM6IDEwMCU7XG4gICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICAgICAgaGVpZ2h0OiAxMDB2aDtcbiAgICAgICAgICB9XG4gICAgICAgICAgI2FwcC1tZW51IHtcbiAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwO1xuICAgICAgICAgIH1cbiAgICAgICAgYH1cbiAgICAgIC8+XG4gICAgICB7c2hvd2luZ01vZGFsICYmIChcbiAgICAgICAgPFNhdmVNb2RhbFxuICAgICAgICAgIG9uSGlkZT17dG9nZ2xlTW9kYWx9XG4gICAgICAgICAgYWN0aW9ucz17cHJvcHMuYWN0aW9uc31cbiAgICAgICAgICBmb3JtX2RhdGE9e3Byb3BzLmZvcm1fZGF0YX1cbiAgICAgICAgICBzbGljZU5hbWU9e3Byb3BzLnNsaWNlTmFtZX1cbiAgICAgICAgICBkYXNoYm9hcmRJZD17cHJvcHMuZGFzaGJvYXJkSWR9XG4gICAgICAgIC8+XG4gICAgICApfVxuICAgICAgPFJlc2l6YWJsZVxuICAgICAgICBvblJlc2l6ZVN0b3A9eyhldnQsIGRpcmVjdGlvbiwgcmVmLCBkKSA9PlxuICAgICAgICAgIHNldFNpZGViYXJXaWR0aHMoc3RvcmFnZUtleXMuZGF0YVNvdXJjZVdpZHRoLCBkKVxuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHRTaXplPXt7XG4gICAgICAgICAgd2lkdGg6IGdldFNpZGViYXJXaWR0aHMoc3RvcmFnZUtleXMuZGF0YVNvdXJjZVdpZHRoKSxcbiAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgICAgfX1cbiAgICAgICAgbWluV2lkdGg9e2RlZmF1bHRTaWRlYmFyc1dpZHRoW3N0b3JhZ2VLZXlzLmRhdGFTb3VyY2VXaWR0aF19XG4gICAgICAgIG1heFdpZHRoPVwiMzMlXCJcbiAgICAgICAgZW5hYmxlPXt7IHJpZ2h0OiB0cnVlIH19XG4gICAgICAgIGNsYXNzTmFtZT17XG4gICAgICAgICAgaXNDb2xsYXBzZWQgPyAnbm8tc2hvdycgOiAnZXhwbG9yZS1jb2x1bW4gZGF0YS1zb3VyY2Utc2VsZWN0aW9uJ1xuICAgICAgICB9XG4gICAgICA+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGl0bGUtY29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiaG9yaXpvbnQgYWwtdGV4dFwiPnt0KCdEYXRhc2V0Jyl9PC9zcGFuPlxuICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICByb2xlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgIHRhYkluZGV4PXswfVxuICAgICAgICAgICAgY2xhc3NOYW1lPVwiYWN0aW9uLWJ1dHRvblwiXG4gICAgICAgICAgICBvbkNsaWNrPXt0b2dnbGVDb2xsYXBzZX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8SWNvbnMuRXhwYW5kXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cImNvbGxhcHNlLWljb25cIlxuICAgICAgICAgICAgICBpY29uQ29sb3I9e3RoZW1lLmNvbG9ycy5wcmltYXJ5LmJhc2V9XG4gICAgICAgICAgICAgIGljb25TaXplPVwibFwiXG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxEYXRhU291cmNlUGFuZWxcbiAgICAgICAgICBkYXRhc291cmNlPXtwcm9wcy5kYXRhc291cmNlfVxuICAgICAgICAgIGNvbnRyb2xzPXtwcm9wcy5jb250cm9sc31cbiAgICAgICAgICBhY3Rpb25zPXtwcm9wcy5hY3Rpb25zfVxuICAgICAgICAvPlxuICAgICAgPC9SZXNpemFibGU+XG4gICAgICB7aXNDb2xsYXBzZWQgPyAoXG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzc05hbWU9XCJzaWRlYmFyXCJcbiAgICAgICAgICBvbkNsaWNrPXt0b2dnbGVDb2xsYXBzZX1cbiAgICAgICAgICBkYXRhLXRlc3Q9XCJvcGVuLWRhdGFzb3VyY2UtdGFiXCJcbiAgICAgICAgICByb2xlPVwiYnV0dG9uXCJcbiAgICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgICAgPlxuICAgICAgICAgIDxzcGFuIHJvbGU9XCJidXR0b25cIiB0YWJJbmRleD17MH0gY2xhc3NOYW1lPVwiYWN0aW9uLWJ1dHRvblwiPlxuICAgICAgICAgICAgPFRvb2x0aXAgdGl0bGU9e3QoJ09wZW4gRGF0YXNvdXJjZSB0YWInKX0+XG4gICAgICAgICAgICAgIDxJY29ucy5Db2xsYXBzZVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImNvbGxhcHNlLWljb25cIlxuICAgICAgICAgICAgICAgIGljb25Db2xvcj17dGhlbWUuY29sb3JzLnByaW1hcnkuYmFzZX1cbiAgICAgICAgICAgICAgICBpY29uU2l6ZT1cImxcIlxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9Ub29sdGlwPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8SWNvbnMuRGF0YXNldFBoeXNpY2FsXG4gICAgICAgICAgICBjc3M9e3sgbWFyZ2luVG9wOiB0aGVtZS5ncmlkVW5pdCAqIDIgfX1cbiAgICAgICAgICAgIGljb25TaXplPVwibFwiXG4gICAgICAgICAgICBpY29uQ29sb3I9e3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUuYmFzZX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICkgOiBudWxsfVxuICAgICAgPFJlc2l6YWJsZVxuICAgICAgICBvblJlc2l6ZVN0b3A9eyhldnQsIGRpcmVjdGlvbiwgcmVmLCBkKSA9PlxuICAgICAgICAgIHNldFNpZGViYXJXaWR0aHMoc3RvcmFnZUtleXMuY29udHJvbHNXaWR0aCwgZClcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0U2l6ZT17e1xuICAgICAgICAgIHdpZHRoOiBnZXRTaWRlYmFyV2lkdGhzKHN0b3JhZ2VLZXlzLmNvbnRyb2xzV2lkdGgpLFxuICAgICAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgICB9fVxuICAgICAgICBtaW5XaWR0aD17ZGVmYXVsdFNpZGViYXJzV2lkdGhbc3RvcmFnZUtleXMuY29udHJvbHNXaWR0aF19XG4gICAgICAgIG1heFdpZHRoPVwiMzMlXCJcbiAgICAgICAgZW5hYmxlPXt7IHJpZ2h0OiB0cnVlIH19XG4gICAgICAgIGNsYXNzTmFtZT1cImNvbC1zbS0zIGV4cGxvcmUtY29sdW1uIGNvbnRyb2xzLWNvbHVtblwiXG4gICAgICA+XG4gICAgICAgIDxRdWVyeUFuZFNhdmVCdG5zXG4gICAgICAgICAgY2FuQWRkPXshIShwcm9wcy5jYW5fYWRkIHx8IHByb3BzLmNhbl9vdmVyd3JpdGUpfVxuICAgICAgICAgIG9uUXVlcnk9e29uUXVlcnl9XG4gICAgICAgICAgb25TYXZlPXt0b2dnbGVNb2RhbH1cbiAgICAgICAgICBvblN0b3A9e29uU3RvcH1cbiAgICAgICAgICBsb2FkaW5nPXtwcm9wcy5jaGFydC5jaGFydFN0YXR1cyA9PT0gJ2xvYWRpbmcnfVxuICAgICAgICAgIGNoYXJ0SXNTdGFsZT17Y2hhcnRJc1N0YWxlfVxuICAgICAgICAgIGVycm9yTWVzc2FnZT17cmVuZGVyRXJyb3JNZXNzYWdlKCl9XG4gICAgICAgICAgZGF0YXNvdXJjZVR5cGU9e3Byb3BzLmRhdGFzb3VyY2VfdHlwZX1cbiAgICAgICAgLz5cbiAgICAgICAgPENvbm5lY3RlZENvbnRyb2xQYW5lbHNDb250YWluZXJcbiAgICAgICAgICBhY3Rpb25zPXtwcm9wcy5hY3Rpb25zfVxuICAgICAgICAgIGZvcm1fZGF0YT17cHJvcHMuZm9ybV9kYXRhfVxuICAgICAgICAgIGNvbnRyb2xzPXtwcm9wcy5jb250cm9sc31cbiAgICAgICAgICBkYXRhc291cmNlX3R5cGU9e3Byb3BzLmRhdGFzb3VyY2VfdHlwZX1cbiAgICAgICAgICBpc0RhdGFzb3VyY2VNZXRhTG9hZGluZz17cHJvcHMuaXNEYXRhc291cmNlTWV0YUxvYWRpbmd9XG4gICAgICAgIC8+XG4gICAgICA8L1Jlc2l6YWJsZT5cbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3NOYW1lPXtjeChcbiAgICAgICAgICAnbWFpbi1leHBsb3JlLWNvbnRlbnQnLFxuICAgICAgICAgIGlzQ29sbGFwc2VkID8gJ2NvbC1zbS05JyA6ICdjb2wtc20tNycsXG4gICAgICAgICl9XG4gICAgICA+XG4gICAgICAgIHtyZW5kZXJDaGFydENvbnRhaW5lcigpfVxuICAgICAgPC9kaXY+XG4gICAgPC9TdHlsZXM+XG4gICk7XG59XG5cbkV4cGxvcmVWaWV3Q29udGFpbmVyLnByb3BUeXBlcyA9IHByb3BUeXBlcztcblxuZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKHN0YXRlKSB7XG4gIGNvbnN0IHsgZXhwbG9yZSwgY2hhcnRzLCBpbXByZXNzaW9uSWQsIGRhdGFNYXNrIH0gPSBzdGF0ZTtcbiAgY29uc3QgZm9ybV9kYXRhID0gZ2V0Rm9ybURhdGFGcm9tQ29udHJvbHMoZXhwbG9yZS5jb250cm9scyk7XG4gIGZvcm1fZGF0YS5leHRyYV9mb3JtX2RhdGEgPSBtZXJnZUV4dHJhRm9ybURhdGEoXG4gICAgeyAuLi5mb3JtX2RhdGEuZXh0cmFfZm9ybV9kYXRhIH0sXG4gICAge1xuICAgICAgLi4uZGF0YU1hc2tbZm9ybV9kYXRhLnNsaWNlX2lkID8/IDBdPy5vd25TdGF0ZSwgLy8gMCAtIHVuc2F2ZWQgY2hhcnRcbiAgICB9LFxuICApO1xuICBjb25zdCBjaGFydEtleSA9IE9iamVjdC5rZXlzKGNoYXJ0cylbMF07XG4gIGNvbnN0IGNoYXJ0ID0gY2hhcnRzW2NoYXJ0S2V5XTtcbiAgcmV0dXJuIHtcbiAgICBpc0RhdGFzb3VyY2VNZXRhTG9hZGluZzogZXhwbG9yZS5pc0RhdGFzb3VyY2VNZXRhTG9hZGluZyxcbiAgICBkYXRhc291cmNlOiBleHBsb3JlLmRhdGFzb3VyY2UsXG4gICAgZGF0YXNvdXJjZV90eXBlOiBleHBsb3JlLmRhdGFzb3VyY2UudHlwZSxcbiAgICBkYXRhc291cmNlSWQ6IGV4cGxvcmUuZGF0YXNvdXJjZV9pZCxcbiAgICBkYXNoYm9hcmRJZDogZXhwbG9yZS5mb3JtX2RhdGEgPyBleHBsb3JlLmZvcm1fZGF0YS5kYXNoYm9hcmRJZCA6IHVuZGVmaW5lZCxcbiAgICBjb250cm9sczogZXhwbG9yZS5jb250cm9scyxcbiAgICBjYW5fb3ZlcndyaXRlOiAhIWV4cGxvcmUuY2FuX292ZXJ3cml0ZSxcbiAgICBjYW5fYWRkOiAhIWV4cGxvcmUuY2FuX2FkZCxcbiAgICBjYW5fZG93bmxvYWQ6ICEhZXhwbG9yZS5jYW5fZG93bmxvYWQsXG4gICAgY29sdW1uX2Zvcm1hdHM6IGV4cGxvcmUuZGF0YXNvdXJjZVxuICAgICAgPyBleHBsb3JlLmRhdGFzb3VyY2UuY29sdW1uX2Zvcm1hdHNcbiAgICAgIDogbnVsbCxcbiAgICBjb250YWluZXJJZDogZXhwbG9yZS5zbGljZVxuICAgICAgPyBgc2xpY2UtY29udGFpbmVyLSR7ZXhwbG9yZS5zbGljZS5zbGljZV9pZH1gXG4gICAgICA6ICdzbGljZS1jb250YWluZXInLFxuICAgIGlzU3RhcnJlZDogZXhwbG9yZS5pc1N0YXJyZWQsXG4gICAgc2xpY2U6IGV4cGxvcmUuc2xpY2UsXG4gICAgc2xpY2VOYW1lOiBleHBsb3JlLnNsaWNlTmFtZSxcbiAgICB0cmlnZ2VyUmVuZGVyOiBleHBsb3JlLnRyaWdnZXJSZW5kZXIsXG4gICAgZm9ybV9kYXRhLFxuICAgIHRhYmxlX25hbWU6IGZvcm1fZGF0YS5kYXRhc291cmNlX25hbWUsXG4gICAgdml6VHlwZTogZm9ybV9kYXRhLnZpel90eXBlLFxuICAgIHN0YW5kYWxvbmU6IGV4cGxvcmUuc3RhbmRhbG9uZSxcbiAgICBmb3JjZWRIZWlnaHQ6IGV4cGxvcmUuZm9yY2VkX2hlaWdodCxcbiAgICBjaGFydCxcbiAgICB0aW1lb3V0OiBleHBsb3JlLmNvbW1vbi5jb25mLlNVUEVSU0VUX1dFQlNFUlZFUl9USU1FT1VULFxuICAgIG93blN0YXRlOiBkYXRhTWFza1tmb3JtX2RhdGEuc2xpY2VfaWQgPz8gMF0/Lm93blN0YXRlLCAvLyAwIC0gdW5zYXZlZCBjaGFydFxuICAgIGltcHJlc3Npb25JZCxcbiAgICB1c2VySWQ6IGV4cGxvcmUudXNlcl9pZCxcbiAgfTtcbn1cblxuZnVuY3Rpb24gbWFwRGlzcGF0Y2hUb1Byb3BzKGRpc3BhdGNoKSB7XG4gIGNvbnN0IGFjdGlvbnMgPSB7XG4gICAgLi4uZXhwbG9yZUFjdGlvbnMsXG4gICAgLi4uc2F2ZU1vZGFsQWN0aW9ucyxcbiAgICAuLi5jaGFydEFjdGlvbnMsXG4gICAgLi4ubG9nQWN0aW9ucyxcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBhY3Rpb25zOiBiaW5kQWN0aW9uQ3JlYXRvcnMoYWN0aW9ucywgZGlzcGF0Y2gpLFxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjb25uZWN0KFxuICBtYXBTdGF0ZVRvUHJvcHMsXG4gIG1hcERpc3BhdGNoVG9Qcm9wcyxcbikoRXhwbG9yZVZpZXdDb250YWluZXIpO1xuIl19 */\"),\n      iconSize: \"l\",\n      iconColor: theme.colors.grayscale.base })) :\n\n\n    null,\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.controlsWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.controlsWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.controlsWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className: \"col-sm-3 explore-column controls-column\" },\n\n    ___EmotionJSX(QueryAndSaveBtns, {\n      canAdd: !!(props.can_add || props.can_overwrite),\n      onQuery: onQuery,\n      onSave: toggleModal,\n      onStop: onStop,\n      loading: props.chart.chartStatus === 'loading',\n      chartIsStale: chartIsStale,\n      errorMessage: renderErrorMessage(),\n      datasourceType: props.datasource_type }),\n\n    ___EmotionJSX(ConnectedControlPanelsContainer, {\n      actions: props.actions,\n      form_data: props.form_data,\n      controls: props.controls,\n      datasource_type: props.datasource_type,\n      isDatasourceMetaLoading: props.isDatasourceMetaLoading })),\n\n\n    ___EmotionJSX(\"div\", {\n      className: cx(\n      'main-explore-content',\n      isCollapsed ? 'col-sm-9' : 'col-sm-7') },\n\n\n    renderChartContainer())));\n\n\n\n}__signature__(ExploreViewContainer, \"useDynamicPluginContext{dynamicPluginContext}\\nusePrevious{wasDynamicPluginLoading}\\nusePrevious{previousControls}\\nuseWindowSize{windowSize}\\nuseState{[showingModal, setShowingModal](false)}\\nuseState{[isCollapsed, setIsCollapsed](false)}\\nuseTheme{theme}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseMemo{chartIsStale}\\nuseEffect{}\", () => [useDynamicPluginContext, usePrevious, usePrevious, useWindowSize, useTheme]);\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {var _dataMask, _form_data$slice_id, _dataMask2, _form_data$slice_id2;\n  const { explore, charts, impressionId, dataMask } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  form_data.extra_form_data = mergeExtraFormData(\n  { ...form_data.extra_form_data },\n  {\n    ...((_dataMask = dataMask[(_form_data$slice_id = form_data.slice_id) != null ? _form_data$slice_id : 0]) == null ? void 0 : _dataMask.ownState) // 0 - unsaved chart\n  });\n\n  const chartKey = _Object$keys(charts)[0];\n  const chart = charts[chartKey];\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource ?\n    explore.datasource.column_formats :\n    null,\n    containerId: _sliceInstanceProperty(explore) ?\n    `slice-container-${_sliceInstanceProperty(explore).slice_id}` :\n    'slice-container',\n    isStarred: explore.isStarred,\n    slice: _sliceInstanceProperty(explore),\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: (_dataMask2 = dataMask[(_form_data$slice_id2 = form_data.slice_id) != null ? _form_data$slice_id2 : 0]) == null ? void 0 : _dataMask2.ownState, // 0 - unsaved chart\n    impressionId,\n    userId: explore.user_id };\n\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions };\n\n  return {\n    actions: bindActionCreators(actions, dispatch) };\n\n}const _default =\n\nconnect(\nmapStateToProps,\nmapDispatchToProps)(\nExploreViewContainer);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(getWindowSize, \"getWindowSize\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(useWindowSize, \"useWindowSize\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(ExploreViewContainer, \"ExploreViewContainer\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/ExploreViewContainer.jsx"],"names":["React","useEffect","useMemo","useState","PropTypes","bindActionCreators","connect","styled","t","css","useTheme","Resizable","useDynamicPluginContext","Global","Tooltip","usePrevious","Icons","getFromLocalStorage","setInLocalStorage","URL_PARAMS","cx","chartActions","fetchDatasourceMetadata","chartPropShape","mergeExtraFormData","ExploreChartPanel","ConnectedControlPanelsContainer","SaveModal","QueryAndSaveBtns","DataSourcePanel","getExploreLongUrl","areObjectsEqual","getFormDataFromControls","exploreActions","saveModalActions","logActions","LOG_ACTIONS_MOUNT_EXPLORER","LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS","propTypes","height","string","width","actions","object","isRequired","datasource_type","dashboardId","number","isDatasourceMetaLoading","bool","chart","slice","sliceName","controls","forcedHeight","form_data","standalone","timeout","impressionId","vizType","Styles","div","theme","colors","grayscale","light5","light2","gridUnit","light4","light1","typography","sizes","s","primary","base","getWindowSize","window","innerHeight","innerWidth","useWindowSize","delayMs","size","setSize","onWindowResize","addEventListener","removeEventListener","ExploreViewContainer","props","dynamicPluginContext","dynamicPlugin","plugins","isDynamicPluginLoading","loading","wasDynamicPluginLoading","previousControls","windowSize","showingModal","setShowingModal","isCollapsed","setIsCollapsed","navHeight","storageKeys","controlsWidth","dataSourceWidth","defaultSidebarsWidth","controls_width","datasource_width","addHistory","isReplace","title","payload","longUrl","name","history","replaceState","pushState","e","console","warn","handlePopstate","formData","state","length","setExploreControls","postChartFormData","id","onQuery","triggerQuery","handleKeydown","event","controlOrCommand","ctrlKey","metaKey","isEnter","key","keyCode","isS","saveSlice","action","slice_id","slice_name","add_to_dash","goto_dash","then","data","location","slice_url","onStop","queryController","abort","toggleModal","toggleCollapse","logEvent","document","dynamicPluginControlsReady","hasError","control","validationErrors","reRenderChart","updateQueryFormData","renderTriggered","Date","getTime","datasource","value","changedControlKeys","hasDisplayControlChanged","renderTrigger","ownState","chartIsStale","dontRefreshOnChange","undefined","renderErrorMessage","controlsWithErrors","errorMessages","uniqueErrorMessages","errors","message","matchingLabels","label","labels","join","errorMessage","textAlign","renderChartContainer","getSidebarWidths","setSidebarWidths","dimension","newDimension","Number","evt","direction","ref","d","right","marginTop","can_add","can_overwrite","chartStatus","mapStateToProps","explore","charts","dataMask","extra_form_data","chartKey","type","datasourceId","datasource_id","can_download","column_formats","containerId","isStarred","triggerRender","table_name","datasource_name","viz_type","forced_height","common","conf","SUPERSET_WEBSERVER_TIMEOUT","userId","user_id","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, css, useTheme } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport { Resizable } from 're-resizable';\n\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icons from 'src/components/Icons';\nimport {\n  getFromLocalStorage,\n  setInLocalStorage,\n} from 'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport cx from 'classnames';\nimport * as chartActions from 'src/chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as logActions from '../../logger/actions';\nimport {\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS,\n} from '../../logger/LogUtils';\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.number.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string,\n};\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  flex-basis: 100vh;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth,\n});\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = useDynamicPluginContext();\n  const dynamicPlugin = dynamicPluginContext.plugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.loading;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  const previousControls = usePrevious(props.controls);\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const theme = useTheme();\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight\n    ? `${props.forcedHeight}px`\n    : `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width',\n  };\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300,\n  };\n\n  function addHistory({ isReplace = false, title } = {}) {\n    const payload = { ...props.form_data };\n    const longUrl = getExploreLongUrl(\n      props.form_data,\n      props.standalone ? URL_PARAMS.standalone.name : null,\n      false,\n    );\n    try {\n      if (isReplace) {\n        window.history.replaceState(payload, title, longUrl);\n      } else {\n        window.history.pushState(payload, title, longUrl);\n      }\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        'Failed at altering browser history',\n        payload,\n        title,\n        longUrl,\n      );\n    }\n  }\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n        formData,\n        false,\n        props.timeout,\n        props.chart.id,\n      );\n    }\n  }\n\n  function onQuery() {\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n  }\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (props.slice) {\n          props.actions\n            .saveSlice(props.form_data, {\n              action: 'overwrite',\n              slice_id: props.slice.slice_id,\n              slice_name: props.slice.slice_name,\n              add_to_dash: 'noSave',\n              goto_dash: false,\n            })\n            .then(({ data }) => {\n              window.location = data.slice.slice_url;\n            });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = () => {\n    props.actions.updateQueryFormData(\n      getFormDataFromControls(props.controls),\n      props.chart.id,\n    );\n    props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n    addHistory();\n  };\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {\n      if (\n        props.controls.datasource &&\n        (previousControls.datasource == null ||\n          props.controls.datasource.value !== previousControls.datasource.value)\n      ) {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = changedControlKeys.some(\n        key => props.controls[key].renderTrigger,\n      );\n      if (hasDisplayControlChanged) {\n        reRenderChart();\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (previousControls) {\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      return changedControlKeys.some(\n        key =>\n          !props.controls[key].renderTrigger &&\n          !props.controls[key].dontRefreshOnChange,\n      );\n    }\n    return false;\n  }, [previousControls, props.controls]);\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  function renderErrorMessage() {\n    // Returns an error message as a node if any errors are in the store\n    const controlsWithErrors = Object.values(props.controls).filter(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = controlsWithErrors.map(\n      control => control.validationErrors,\n    );\n    const uniqueErrorMessages = [...new Set(errorMessages.flat())];\n\n    const errors = uniqueErrorMessages\n      .map(message => {\n        const matchingLabels = controlsWithErrors\n          .filter(control => control.validationErrors?.includes(message))\n          .map(control => control.label);\n        return [matchingLabels, message];\n      })\n      .map(([labels, message]) => (\n        <div key={message}>\n          {labels.length > 1 ? t('Controls labeled ') : t('Control labeled ')}\n          <strong>{` ${labels.join(', ')}`}</strong>\n          <span>: {message}</span>\n        </div>\n      ));\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = <div style={{ textAlign: 'left' }}>{errors}</div>;\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      <ExploreChartPanel\n        width={width}\n        height={height}\n        {...props}\n        errorMessage={renderErrorMessage()}\n        refreshOverlayVisible={chartIsStale}\n        addHistory={addHistory}\n        onQuery={onQuery}\n      />\n    );\n  }\n\n  function getSidebarWidths(key) {\n    return getFromLocalStorage(key, defaultSidebarsWidth[key]);\n  }\n\n  function setSidebarWidths(key, dimension) {\n    const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n    setInLocalStorage(key, newDimension);\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    <Styles id=\"explore-container\" height={height}>\n      <Global\n        styles={css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100vh;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        `}\n      />\n      {showingModal && (\n        <SaveModal\n          onHide={toggleModal}\n          actions={props.actions}\n          form_data={props.form_data}\n          sliceName={props.sliceName}\n          dashboardId={props.dashboardId}\n        />\n      )}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.dataSourceWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.dataSourceWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.dataSourceWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className={\n          isCollapsed ? 'no-show' : 'explore-column data-source-selection'\n        }\n      >\n        <div className=\"title-container\">\n          <span className=\"horizont al-text\">{t('Dataset')}</span>\n          <span\n            role=\"button\"\n            tabIndex={0}\n            className=\"action-button\"\n            onClick={toggleCollapse}\n          >\n            <Icons.Expand\n              className=\"collapse-icon\"\n              iconColor={theme.colors.primary.base}\n              iconSize=\"l\"\n            />\n          </span>\n        </div>\n        <DataSourcePanel\n          datasource={props.datasource}\n          controls={props.controls}\n          actions={props.actions}\n        />\n      </Resizable>\n      {isCollapsed ? (\n        <div\n          className=\"sidebar\"\n          onClick={toggleCollapse}\n          data-test=\"open-datasource-tab\"\n          role=\"button\"\n          tabIndex={0}\n        >\n          <span role=\"button\" tabIndex={0} className=\"action-button\">\n            <Tooltip title={t('Open Datasource tab')}>\n              <Icons.Collapse\n                className=\"collapse-icon\"\n                iconColor={theme.colors.primary.base}\n                iconSize=\"l\"\n              />\n            </Tooltip>\n          </span>\n          <Icons.DatasetPhysical\n            css={{ marginTop: theme.gridUnit * 2 }}\n            iconSize=\"l\"\n            iconColor={theme.colors.grayscale.base}\n          />\n        </div>\n      ) : null}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.controlsWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.controlsWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.controlsWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className=\"col-sm-3 explore-column controls-column\"\n      >\n        <QueryAndSaveBtns\n          canAdd={!!(props.can_add || props.can_overwrite)}\n          onQuery={onQuery}\n          onSave={toggleModal}\n          onStop={onStop}\n          loading={props.chart.chartStatus === 'loading'}\n          chartIsStale={chartIsStale}\n          errorMessage={renderErrorMessage()}\n          datasourceType={props.datasource_type}\n        />\n        <ConnectedControlPanelsContainer\n          actions={props.actions}\n          form_data={props.form_data}\n          controls={props.controls}\n          datasource_type={props.datasource_type}\n          isDatasourceMetaLoading={props.isDatasourceMetaLoading}\n        />\n      </Resizable>\n      <div\n        className={cx(\n          'main-explore-content',\n          isCollapsed ? 'col-sm-9' : 'col-sm-7',\n        )}\n      >\n        {renderChartContainer()}\n      </div>\n    </Styles>\n  );\n}\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {\n  const { explore, charts, impressionId, dataMask } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  form_data.extra_form_data = mergeExtraFormData(\n    { ...form_data.extra_form_data },\n    {\n      ...dataMask[form_data.slice_id ?? 0]?.ownState, // 0 - unsaved chart\n    },\n  );\n  const chartKey = Object.keys(charts)[0];\n  const chart = charts[chartKey];\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource\n      ? explore.datasource.column_formats\n      : null,\n    containerId: explore.slice\n      ? `slice-container-${explore.slice.slice_id}`\n      : 'slice-container',\n    isStarred: explore.isStarred,\n    slice: explore.slice,\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: dataMask[form_data.slice_id ?? 0]?.ownState, // 0 - unsaved chart\n    impressionId,\n    userId: explore.user_id,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions,\n  };\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(ExploreViewContainer);\n"]},"metadata":{},"sourceType":"module"}