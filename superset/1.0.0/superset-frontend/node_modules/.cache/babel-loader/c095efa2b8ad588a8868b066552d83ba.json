{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _Promise from \"@babel/runtime-corejs3/core-js-stable/promise\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";import _someInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/some\";import _keysInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/keys\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useContext, useEffect, useReducer } from 'react';\nimport { defineSharedModules, logging, makeApi } from '@superset-ui/core';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst dummyPluginContext = {\n  loading: true,\n  plugins: {},\n  fetchAll: () => {} };\n\n/**\n * It is highly recommended to use the useDynamicPluginContext hook instead.\n * @see useDynamicPluginContext\n */\nexport const PluginContext = /*#__PURE__*/React.createContext(dummyPluginContext);\n/**\n * The plugin context provides info about what dynamic plugins are available.\n * It also provides loading info for the plugins' javascript bundles.\n *\n * Note: This does not include any information about static plugins.\n * Those are compiled into the Superset bundle at build time.\n * Dynamic plugins are added by the end user and can be any webhosted javascript.\n */\nexport const useDynamicPluginContext = () => useContext(PluginContext);__signature__(useDynamicPluginContext, \"useContext{}\");\nfunction pluginContextReducer(state, action) {\n  switch (action.type) {\n    case 'begin':{var _context;\n        const plugins = { ...state.plugins };\n        _forEachInstanceProperty(_context = _keysInstanceProperty(action)).call(_context, key => {\n          plugins[key] = { key, error: null, loading: true };\n        });\n        return {\n          ...state,\n          loading: _keysInstanceProperty(action).length > 0,\n          plugins };\n\n      }\n    case 'complete':{var _context2;\n        return {\n          ...state,\n          loading: _someInstanceProperty(_context2 = _Object$values(state.plugins)).call(_context2, plugin => plugin.loading && plugin.key !== action.key),\n          plugins: {\n            ...state.plugins,\n            [action.key]: {\n              key: action.key,\n              loading: false,\n              error: action.error } } };\n\n\n\n      }\n    default:\n      return state;}\n\n}\nconst pluginApi = makeApi({\n  method: 'GET',\n  endpoint: '/dynamic-plugins/api/read' });\n\nconst sharedModules = {\n  react: () => import('react'),\n  lodash: () => import('lodash'),\n  'react-dom': () => import('react-dom'),\n  '@superset-ui/chart-controls': () => import('@superset-ui/chart-controls'),\n  '@superset-ui/core': () => import('@superset-ui/core') };\n\nexport const DynamicPluginProvider = ({ children }) => {\n  const [pluginState, dispatch] = useReducer(pluginContextReducer, {\n    // use the dummy plugin context, and override the methods\n    ...dummyPluginContext,\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    fetchAll,\n    loading: isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS) });\n\n  // For now, we fetch all the plugins at the same time.\n  // In the future it would be nice to fetch on an as-needed basis.\n  // That will most likely depend on having a json manifest for each plugin.\n  async function fetchAll() {\n    try {\n      await defineSharedModules(sharedModules);\n      const { result: plugins } = await pluginApi({});\n      dispatch({ type: 'begin', keys: _mapInstanceProperty(plugins).call(plugins, plugin => plugin.key) });\n      await _Promise.all(_mapInstanceProperty(plugins).call(plugins, async plugin => {\n        let error = null;\n        try {\n          await import( /* webpackIgnore: true */plugin.bundle_url);\n        }\n        catch (err) {\n          logging.error(`Failed to load plugin ${plugin.key} with the following error:`, err.stack);\n          error = err;\n        }\n        dispatch({\n          type: 'complete',\n          key: plugin.key,\n          error });\n\n      }));\n    }\n    catch (error) {\n      logging.error('Failed to load dynamic plugins', error.stack || error);\n    }\n  }\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS)) {\n      fetchAll();\n    }\n  }, []);\n  return ___EmotionJSX(PluginContext.Provider, { value: pluginState },\n  children);\n\n};__signature__(DynamicPluginProvider, \"useReducer{[pluginState, dispatch]({\\n        // use the dummy plugin context, and override the methods\\n        ...dummyPluginContext,\\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\\n        fetchAll,\\n        loading: isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS),\\n    })}\\nuseEffect{}\");;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(dummyPluginContext, \"dummyPluginContext\", \"/app/superset-frontend/src/components/DynamicPlugins/index.tsx\");reactHotLoader.register(PluginContext, \"PluginContext\", \"/app/superset-frontend/src/components/DynamicPlugins/index.tsx\");reactHotLoader.register(useDynamicPluginContext, \"useDynamicPluginContext\", \"/app/superset-frontend/src/components/DynamicPlugins/index.tsx\");reactHotLoader.register(pluginContextReducer, \"pluginContextReducer\", \"/app/superset-frontend/src/components/DynamicPlugins/index.tsx\");reactHotLoader.register(pluginApi, \"pluginApi\", \"/app/superset-frontend/src/components/DynamicPlugins/index.tsx\");reactHotLoader.register(sharedModules, \"sharedModules\", \"/app/superset-frontend/src/components/DynamicPlugins/index.tsx\");reactHotLoader.register(DynamicPluginProvider, \"DynamicPluginProvider\", \"/app/superset-frontend/src/components/DynamicPlugins/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/components/DynamicPlugins/index.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useContext, useEffect, useReducer } from 'react';\nimport { defineSharedModules, logging, makeApi } from '@superset-ui/core';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\n\nexport type PluginContextType = {\n  loading: boolean;\n  plugins: {\n    [key: string]: {\n      key: string;\n      loading: boolean;\n      error: null | Error;\n    };\n  };\n  fetchAll: () => void;\n};\n\nconst dummyPluginContext: PluginContextType = {\n  loading: true,\n  plugins: {},\n  fetchAll: () => {},\n};\n\n/**\n * It is highly recommended to use the useDynamicPluginContext hook instead.\n * @see useDynamicPluginContext\n */\nexport const PluginContext = React.createContext(dummyPluginContext);\n\n/**\n * The plugin context provides info about what dynamic plugins are available.\n * It also provides loading info for the plugins' javascript bundles.\n *\n * Note: This does not include any information about static plugins.\n * Those are compiled into the Superset bundle at build time.\n * Dynamic plugins are added by the end user and can be any webhosted javascript.\n */\nexport const useDynamicPluginContext = () => useContext(PluginContext);\n\n// the plugin returned from the API\ntype Plugin = {\n  name: string;\n  key: string;\n  bundle_url: string;\n  id: number;\n};\n\n// when a plugin completes loading\ntype CompleteAction = {\n  type: 'complete';\n  key: string;\n  error: null | Error;\n};\n\n// when plugins start loading\ntype BeginAction = {\n  type: 'begin';\n  keys: string[];\n};\n\nfunction pluginContextReducer(\n  state: PluginContextType,\n  action: BeginAction | CompleteAction,\n): PluginContextType {\n  switch (action.type) {\n    case 'begin': {\n      const plugins = { ...state.plugins };\n      action.keys.forEach(key => {\n        plugins[key] = { key, error: null, loading: true };\n      });\n      return {\n        ...state,\n        loading: action.keys.length > 0,\n        plugins,\n      };\n    }\n    case 'complete': {\n      return {\n        ...state,\n        loading: Object.values(state.plugins).some(\n          plugin => plugin.loading && plugin.key !== action.key,\n        ),\n        plugins: {\n          ...state.plugins,\n          [action.key]: {\n            key: action.key,\n            loading: false,\n            error: action.error,\n          },\n        },\n      };\n    }\n    default:\n      return state;\n  }\n}\n\nconst pluginApi = makeApi<{}, { result: Plugin[] }>({\n  method: 'GET',\n  endpoint: '/dynamic-plugins/api/read',\n});\n\nconst sharedModules = {\n  react: () => import('react'),\n  lodash: () => import('lodash'),\n  'react-dom': () => import('react-dom'),\n  '@superset-ui/chart-controls': () => import('@superset-ui/chart-controls'),\n  '@superset-ui/core': () => import('@superset-ui/core'),\n};\n\nexport const DynamicPluginProvider: React.FC = ({ children }) => {\n  const [pluginState, dispatch] = useReducer(pluginContextReducer, {\n    // use the dummy plugin context, and override the methods\n    ...dummyPluginContext,\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    fetchAll,\n    loading: isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS),\n    // TODO: Write fetchByKeys\n  });\n\n  // For now, we fetch all the plugins at the same time.\n  // In the future it would be nice to fetch on an as-needed basis.\n  // That will most likely depend on having a json manifest for each plugin.\n  async function fetchAll() {\n    try {\n      await defineSharedModules(sharedModules);\n      const { result: plugins } = await pluginApi({});\n      dispatch({ type: 'begin', keys: plugins.map(plugin => plugin.key) });\n      await Promise.all(\n        plugins.map(async plugin => {\n          let error: Error | null = null;\n          try {\n            await import(/* webpackIgnore: true */ plugin.bundle_url);\n          } catch (err) {\n            logging.error(\n              `Failed to load plugin ${plugin.key} with the following error:`,\n              err.stack,\n            );\n            error = err;\n          }\n          dispatch({\n            type: 'complete',\n            key: plugin.key,\n            error,\n          });\n        }),\n      );\n    } catch (error) {\n      logging.error('Failed to load dynamic plugins', error.stack || error);\n    }\n  }\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS)) {\n      fetchAll();\n    }\n  }, []);\n\n  return (\n    <PluginContext.Provider value={pluginState}>\n      {children}\n    </PluginContext.Provider>\n  );\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}