{"ast":null,"code":"import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\n\nimport Popover from 'src/components/Popover';\nimport { FormLabel } from 'src/components/Form';\nimport Icons from 'src/components/Icons';\nimport { Tooltip } from 'src/components/Tooltip';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { getShortUrl } from 'src/utils/urlUtils';\nimport { URL_PARAMS } from 'src/constants';\nimport { getExploreLongUrl, getURIDirectory } from '../exploreUtils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  latestQueryFormData: PropTypes.object.isRequired };\n\n\nexport default class EmbedCodeButton extends React.Component {\n  constructor(props) {var _context, _context2, _context3;\n    super(props);\n    this.state = {\n      height: '400',\n      width: '600',\n      shortUrlId: 0 };\n\n    this.handleInputChange = _bindInstanceProperty(_context = this.handleInputChange).call(_context, this);\n    this.getCopyUrl = _bindInstanceProperty(_context2 = this.getCopyUrl).call(_context2, this);\n    this.onShortUrlSuccess = _bindInstanceProperty(_context3 = this.onShortUrlSuccess).call(_context3, this);\n  }\n\n  onShortUrlSuccess(shortUrl) {\n    const shortUrlId = shortUrl.substring(_indexOfInstanceProperty(shortUrl).call(shortUrl, '/r/') + 3);\n    this.setState(() => ({\n      shortUrlId }));\n\n  }\n\n  getCopyUrl() {\n    return getShortUrl(getExploreLongUrl(this.props.latestQueryFormData)).\n    then(this.onShortUrlSuccess).\n    catch(this.props.addDangerToast);\n  }\n\n  handleInputChange(e) {\n    const { value, name } = e.currentTarget;\n    const data = {};\n    data[name] = value;\n    this.setState(data);\n  }\n\n  generateEmbedHTML() {\n    const srcLink = `${window.location.origin + getURIDirectory()}?r=${\n    this.state.shortUrlId\n    }&${URL_PARAMS.standalone.name}=1&height=${this.state.height}`;\n    return (\n      '<iframe\\n' +\n      `  width=\"${this.state.width}\"\\n` +\n      `  height=\"${this.state.height}\"\\n` +\n      '  seamless\\n' +\n      '  frameBorder=\"0\"\\n' +\n      '  scrolling=\"no\"\\n' +\n      `  src=\"${srcLink}\"\\n` +\n      '>\\n' +\n      '</iframe>');\n\n  }\n\n  renderPopoverContent() {\n    const html = this.generateEmbedHTML();\n    return (\n      ___EmotionJSX(\"div\", { id: \"embed-code-popover\", \"data-test\": \"embed-code-popover\" },\n      ___EmotionJSX(\"div\", { className: \"row\" },\n      ___EmotionJSX(\"div\", { className: \"col-sm-10\" },\n      ___EmotionJSX(\"textarea\", {\n        \"data-test\": \"embed-code-textarea\",\n        name: \"embedCode\",\n        value: html,\n        rows: \"4\",\n        readOnly: true,\n        className: \"form-control input-sm\" })),\n\n\n      ___EmotionJSX(\"div\", { className: \"col-sm-2\" },\n      ___EmotionJSX(CopyToClipboard, {\n        shouldShowText: false,\n        text: html,\n        copyNode:\n        ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\", title: t('Copy to clipboard') }) }))),\n\n\n\n\n      ___EmotionJSX(\"br\", null),\n      ___EmotionJSX(\"div\", { className: \"row\" },\n      ___EmotionJSX(\"div\", { className: \"col-md-6 col-sm-12\" },\n      ___EmotionJSX(\"div\", { className: \"form-group\" },\n      ___EmotionJSX(\"small\", null,\n      ___EmotionJSX(FormLabel, { htmlFor: \"embed-height\" }, t('Height'))),\n\n      ___EmotionJSX(\"input\", {\n        className: \"form-control input-sm\",\n        type: \"text\",\n        defaultValue: this.state.height,\n        name: \"height\",\n        onChange: this.handleInputChange }))),\n\n\n\n      ___EmotionJSX(\"div\", { className: \"col-md-6 col-sm-12\" },\n      ___EmotionJSX(\"div\", { className: \"form-group\" },\n      ___EmotionJSX(\"small\", null,\n      ___EmotionJSX(FormLabel, { htmlFor: \"embed-width\" }, t('Width'))),\n\n      ___EmotionJSX(\"input\", {\n        className: \"form-control input-sm\",\n        type: \"text\",\n        defaultValue: this.state.width,\n        name: \"width\",\n        onChange: this.handleInputChange,\n        id: \"embed-width\" }))))));\n\n\n\n\n\n\n  }\n\n  render() {\n    return (\n      ___EmotionJSX(Popover, {\n        trigger: \"click\",\n        placement: \"left\",\n        onClick: this.getCopyUrl,\n        content: this.renderPopoverContent() },\n\n      ___EmotionJSX(Tooltip, {\n        id: \"embed-code-tooltip\",\n        placement: \"top\",\n        title: \"Embed code\",\n        trigger: ['hover'] },\n\n      ___EmotionJSX(\"div\", {\n        className: \"btn btn-default btn-sm\",\n        \"data-test\": \"embed-code-button\",\n        style: { display: 'flex', alignItems: 'center', height: 30 } },\n\n      ___EmotionJSX(Icons.Code, { iconSize: \"l\" })))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nEmbedCodeButton.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/EmbedCodeButton.jsx\");reactHotLoader.register(EmbedCodeButton, \"EmbedCodeButton\", \"/app/superset-frontend/src/explore/components/EmbedCodeButton.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/EmbedCodeButton.jsx"],"names":["React","PropTypes","t","Popover","FormLabel","Icons","Tooltip","CopyToClipboard","getShortUrl","URL_PARAMS","getExploreLongUrl","getURIDirectory","propTypes","latestQueryFormData","object","isRequired","EmbedCodeButton","Component","constructor","props","state","height","width","shortUrlId","handleInputChange","getCopyUrl","onShortUrlSuccess","shortUrl","substring","setState","then","catch","addDangerToast","e","value","name","currentTarget","data","generateEmbedHTML","srcLink","window","location","origin","standalone","renderPopoverContent","html","render","display","alignItems"],"mappings":"+dAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,CAAT,QAAkB,mBAAlB;;AAEA,OAAOC,OAAP,MAAoB,wBAApB;AACA,SAASC,SAAT,QAA0B,qBAA1B;AACA,OAAOC,KAAP,MAAkB,sBAAlB;AACA,SAASC,OAAT,QAAwB,wBAAxB;AACA,OAAOC,eAAP,MAA4B,gCAA5B;AACA,SAASC,WAAT,QAA4B,oBAA5B;AACA,SAASC,UAAT,QAA2B,eAA3B;AACA,SAASC,iBAAT,EAA4BC,eAA5B,QAAmD,iBAAnD,C;;AAEA,MAAMC,SAAS,GAAG;AAChBC,EAAAA,mBAAmB,EAAEZ,SAAS,CAACa,MAAV,CAAiBC,UADtB,EAAlB;;;AAIA,eAAe,MAAMC,eAAN,SAA8BhB,KAAK,CAACiB,SAApC,CAA8C;AAC3DC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa;AACXC,MAAAA,MAAM,EAAE,KADG;AAEXC,MAAAA,KAAK,EAAE,KAFI;AAGXC,MAAAA,UAAU,EAAE,CAHD,EAAb;;AAKA,SAAKC,iBAAL,GAAyB,sCAAKA,iBAAL,iBAA4B,IAA5B,CAAzB;AACA,SAAKC,UAAL,GAAkB,uCAAKA,UAAL,kBAAqB,IAArB,CAAlB;AACA,SAAKC,iBAAL,GAAyB,uCAAKA,iBAAL,kBAA4B,IAA5B,CAAzB;AACD;;AAEDA,EAAAA,iBAAiB,CAACC,QAAD,EAAW;AAC1B,UAAMJ,UAAU,GAAGI,QAAQ,CAACC,SAAT,CAAmB,yBAAAD,QAAQ,MAAR,CAAAA,QAAQ,EAAS,KAAT,CAAR,GAA0B,CAA7C,CAAnB;AACA,SAAKE,QAAL,CAAc,OAAO;AACnBN,MAAAA,UADmB,EAAP,CAAd;;AAGD;;AAEDE,EAAAA,UAAU,GAAG;AACX,WAAOjB,WAAW,CAACE,iBAAiB,CAAC,KAAKS,KAAL,CAAWN,mBAAZ,CAAlB,CAAX;AACJiB,IAAAA,IADI,CACC,KAAKJ,iBADN;AAEJK,IAAAA,KAFI,CAEE,KAAKZ,KAAL,CAAWa,cAFb,CAAP;AAGD;;AAEDR,EAAAA,iBAAiB,CAACS,CAAD,EAAI;AACnB,UAAM,EAAEC,KAAF,EAASC,IAAT,KAAkBF,CAAC,CAACG,aAA1B;AACA,UAAMC,IAAI,GAAG,EAAb;AACAA,IAAAA,IAAI,CAACF,IAAD,CAAJ,GAAaD,KAAb;AACA,SAAKL,QAAL,CAAcQ,IAAd;AACD;;AAEDC,EAAAA,iBAAiB,GAAG;AAClB,UAAMC,OAAO,GAAI,GAAEC,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GAAyB/B,eAAe,EAAG;AAC5D,SAAKS,KAAL,CAAWG;AACZ,QAAGd,UAAU,CAACkC,UAAX,CAAsBR,IAAK,aAAY,KAAKf,KAAL,CAAWC,MAAO,EAF7D;AAGA;AACE;AACC,kBAAW,KAAKD,KAAL,CAAWE,KAAM,KAD7B;AAEC,mBAAY,KAAKF,KAAL,CAAWC,MAAO,KAF/B;AAGA,oBAHA;AAIA,2BAJA;AAKA,0BALA;AAMC,gBAASkB,OAAQ,KANlB;AAOA,WAPA;AAQA,iBATF;;AAWD;;AAEDK,EAAAA,oBAAoB,GAAG;AACrB,UAAMC,IAAI,GAAG,KAAKP,iBAAL,EAAb;AACA;AACE,6BAAK,EAAE,EAAC,oBAAR,EAA6B,aAAU,oBAAvC;AACE,6BAAK,SAAS,EAAC,KAAf;AACE,6BAAK,SAAS,EAAC,WAAf;AACE;AACE,qBAAU,qBADZ;AAEE,QAAA,IAAI,EAAC,WAFP;AAGE,QAAA,KAAK,EAAEO,IAHT;AAIE,QAAA,IAAI,EAAC,GAJP;AAKE,QAAA,QAAQ,MALV;AAME,QAAA,SAAS,EAAC,uBANZ,GADF,CADF;;;AAWE,6BAAK,SAAS,EAAC,UAAf;AACE,oBAAC,eAAD;AACE,QAAA,cAAc,EAAE,KADlB;AAEE,QAAA,IAAI,EAAEA,IAFR;AAGE,QAAA,QAAQ;AACN,6BAAG,SAAS,EAAC,iBAAb,EAA+B,KAAK,EAAE3C,CAAC,CAAC,mBAAD,CAAvC,GAJJ,GADF,CAXF,CADF;;;;;AAsBE,+BAtBF;AAuBE,6BAAK,SAAS,EAAC,KAAf;AACE,6BAAK,SAAS,EAAC,oBAAf;AACE,6BAAK,SAAS,EAAC,YAAf;AACE;AACE,oBAAC,SAAD,IAAW,OAAO,EAAC,cAAnB,IAAmCA,CAAC,CAAC,QAAD,CAApC,CADF,CADF;;AAIE;AACE,QAAA,SAAS,EAAC,uBADZ;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,YAAY,EAAE,KAAKkB,KAAL,CAAWC,MAH3B;AAIE,QAAA,IAAI,EAAC,QAJP;AAKE,QAAA,QAAQ,EAAE,KAAKG,iBALjB,GAJF,CADF,CADF;;;;AAeE,6BAAK,SAAS,EAAC,oBAAf;AACE,6BAAK,SAAS,EAAC,YAAf;AACE;AACE,oBAAC,SAAD,IAAW,OAAO,EAAC,aAAnB,IAAkCtB,CAAC,CAAC,OAAD,CAAnC,CADF,CADF;;AAIE;AACE,QAAA,SAAS,EAAC,uBADZ;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,YAAY,EAAE,KAAKkB,KAAL,CAAWE,KAH3B;AAIE,QAAA,IAAI,EAAC,OAJP;AAKE,QAAA,QAAQ,EAAE,KAAKE,iBALjB;AAME,QAAA,EAAE,EAAC,aANL,GAJF,CADF,CAfF,CAvBF,CADF;;;;;;;AAyDD;;AAEDsB,EAAAA,MAAM,GAAG;AACP;AACE,oBAAC,OAAD;AACE,QAAA,OAAO,EAAC,OADV;AAEE,QAAA,SAAS,EAAC,MAFZ;AAGE,QAAA,OAAO,EAAE,KAAKrB,UAHhB;AAIE,QAAA,OAAO,EAAE,KAAKmB,oBAAL,EAJX;;AAME,oBAAC,OAAD;AACE,QAAA,EAAE,EAAC,oBADL;AAEE,QAAA,SAAS,EAAC,KAFZ;AAGE,QAAA,KAAK,EAAC,YAHR;AAIE,QAAA,OAAO,EAAE,CAAC,OAAD,CAJX;;AAME;AACE,QAAA,SAAS,EAAC,wBADZ;AAEE,qBAAU,mBAFZ;AAGE,QAAA,KAAK,EAAE,EAAEG,OAAO,EAAE,MAAX,EAAmBC,UAAU,EAAE,QAA/B,EAAyC3B,MAAM,EAAE,EAAjD,EAHT;;AAKE,oBAAC,KAAD,CAAO,IAAP,IAAY,QAAQ,EAAC,GAArB,GALF,CANF,CANF,CADF;;;;;AAuBD,GAvI0D;AAAA;AAAA;AA0I7DL,eAAe,CAACJ,SAAhB,GAA4BA,SAA5B,C,iLA9IMA,S,4GAIeI,e","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\n\nimport Popover from 'src/components/Popover';\nimport { FormLabel } from 'src/components/Form';\nimport Icons from 'src/components/Icons';\nimport { Tooltip } from 'src/components/Tooltip';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { getShortUrl } from 'src/utils/urlUtils';\nimport { URL_PARAMS } from 'src/constants';\nimport { getExploreLongUrl, getURIDirectory } from '../exploreUtils';\n\nconst propTypes = {\n  latestQueryFormData: PropTypes.object.isRequired,\n};\n\nexport default class EmbedCodeButton extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      height: '400',\n      width: '600',\n      shortUrlId: 0,\n    };\n    this.handleInputChange = this.handleInputChange.bind(this);\n    this.getCopyUrl = this.getCopyUrl.bind(this);\n    this.onShortUrlSuccess = this.onShortUrlSuccess.bind(this);\n  }\n\n  onShortUrlSuccess(shortUrl) {\n    const shortUrlId = shortUrl.substring(shortUrl.indexOf('/r/') + 3);\n    this.setState(() => ({\n      shortUrlId,\n    }));\n  }\n\n  getCopyUrl() {\n    return getShortUrl(getExploreLongUrl(this.props.latestQueryFormData))\n      .then(this.onShortUrlSuccess)\n      .catch(this.props.addDangerToast);\n  }\n\n  handleInputChange(e) {\n    const { value, name } = e.currentTarget;\n    const data = {};\n    data[name] = value;\n    this.setState(data);\n  }\n\n  generateEmbedHTML() {\n    const srcLink = `${window.location.origin + getURIDirectory()}?r=${\n      this.state.shortUrlId\n    }&${URL_PARAMS.standalone.name}=1&height=${this.state.height}`;\n    return (\n      '<iframe\\n' +\n      `  width=\"${this.state.width}\"\\n` +\n      `  height=\"${this.state.height}\"\\n` +\n      '  seamless\\n' +\n      '  frameBorder=\"0\"\\n' +\n      '  scrolling=\"no\"\\n' +\n      `  src=\"${srcLink}\"\\n` +\n      '>\\n' +\n      '</iframe>'\n    );\n  }\n\n  renderPopoverContent() {\n    const html = this.generateEmbedHTML();\n    return (\n      <div id=\"embed-code-popover\" data-test=\"embed-code-popover\">\n        <div className=\"row\">\n          <div className=\"col-sm-10\">\n            <textarea\n              data-test=\"embed-code-textarea\"\n              name=\"embedCode\"\n              value={html}\n              rows=\"4\"\n              readOnly\n              className=\"form-control input-sm\"\n            />\n          </div>\n          <div className=\"col-sm-2\">\n            <CopyToClipboard\n              shouldShowText={false}\n              text={html}\n              copyNode={\n                <i className=\"fa fa-clipboard\" title={t('Copy to clipboard')} />\n              }\n            />\n          </div>\n        </div>\n        <br />\n        <div className=\"row\">\n          <div className=\"col-md-6 col-sm-12\">\n            <div className=\"form-group\">\n              <small>\n                <FormLabel htmlFor=\"embed-height\">{t('Height')}</FormLabel>\n              </small>\n              <input\n                className=\"form-control input-sm\"\n                type=\"text\"\n                defaultValue={this.state.height}\n                name=\"height\"\n                onChange={this.handleInputChange}\n              />\n            </div>\n          </div>\n          <div className=\"col-md-6 col-sm-12\">\n            <div className=\"form-group\">\n              <small>\n                <FormLabel htmlFor=\"embed-width\">{t('Width')}</FormLabel>\n              </small>\n              <input\n                className=\"form-control input-sm\"\n                type=\"text\"\n                defaultValue={this.state.width}\n                name=\"width\"\n                onChange={this.handleInputChange}\n                id=\"embed-width\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <Popover\n        trigger=\"click\"\n        placement=\"left\"\n        onClick={this.getCopyUrl}\n        content={this.renderPopoverContent()}\n      >\n        <Tooltip\n          id=\"embed-code-tooltip\"\n          placement=\"top\"\n          title=\"Embed code\"\n          trigger={['hover']}\n        >\n          <div\n            className=\"btn btn-default btn-sm\"\n            data-test=\"embed-code-button\"\n            style={{ display: 'flex', alignItems: 'center', height: 30 }}\n          >\n            <Icons.Code iconSize=\"l\" />\n          </div>\n        </Tooltip>\n      </Popover>\n    );\n  }\n}\n\nEmbedCodeButton.propTypes = propTypes;\n"]},"metadata":{},"sourceType":"module"}