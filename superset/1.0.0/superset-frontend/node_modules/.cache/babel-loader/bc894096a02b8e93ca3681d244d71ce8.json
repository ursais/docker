{"ast":null,"code":"import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _parseInt from \"@babel/runtime-corejs3/core-js-stable/parse-int\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React from 'react';\nimport { Input } from 'src/common/components';\nimport { Form, FormItem } from 'src/components/Form';\nimport Alert from 'src/components/Alert';\nimport { t, styled } from '@superset-ui/core';\nimport ReactMarkdown from 'react-markdown';\nimport Modal from 'src/components/Modal';\nimport { Radio } from 'src/components/Radio';\nimport Button from 'src/components/Button';\nimport { CreatableSelect } from 'src/components/Select';\nimport { connect } from 'react-redux';\n// Session storage key for recent dashboard\nimport { jsx as ___EmotionJSX } from \"@emotion/react\";const SK_DASHBOARD_ID = 'save_chart_recent_dashboard';\nconst SELECT_PLACEHOLDER = t('**Select** a dashboard OR **create** a new one');\nexport const StyledModal = styled(Modal)`\n  .ant-modal-body {\n    overflow: visible;\n  }\n`;\nclass SaveModal extends React.Component {\n  constructor(props) {var _context, _context2, _context3, _context4;\n    super(props);\n    this.state = {\n      saveToDashboardId: null,\n      newSliceName: props.sliceName,\n      alert: null,\n      action: props.can_overwrite ? 'overwrite' : 'saveas' };\n\n    this.onDashboardSelectChange = _bindInstanceProperty(_context = this.onDashboardSelectChange).call(_context, this);\n    this.onSliceNameChange = _bindInstanceProperty(_context2 = this.onSliceNameChange).call(_context2, this);\n    this.changeAction = _bindInstanceProperty(_context3 = this.changeAction).call(_context3, this);\n    this.saveOrOverwrite = _bindInstanceProperty(_context4 = this.saveOrOverwrite).call(_context4, this);\n  }\n  componentDidMount() {\n    this.props.actions.fetchDashboards(this.props.userId).then(() => {var _context5;\n      const dashboardIds = _mapInstanceProperty(_context5 = this.props.dashboards).call(_context5, dashboard => dashboard.value);\n      const lastDashboard = sessionStorage.getItem(SK_DASHBOARD_ID);\n      let recentDashboard = lastDashboard && _parseInt(lastDashboard, 10);\n      if (!recentDashboard && this.props.dashboardId) {\n        recentDashboard = this.props.dashboardId;\n      }\n      if (recentDashboard !== null &&\n      _indexOfInstanceProperty(dashboardIds).call(dashboardIds, recentDashboard) !== -1) {\n        this.setState({\n          saveToDashboardId: recentDashboard });\n\n      }\n    });\n  }\n  onSliceNameChange(event) {\n    this.setState({ newSliceName: event.target.value });\n  }\n  onDashboardSelectChange(event) {\n    const newDashboardName = event ? event.label : null;\n    const saveToDashboardId = event && typeof event.value === 'number' ? event.value : null;\n    this.setState({ saveToDashboardId, newDashboardName });\n  }\n  changeAction(action) {\n    this.setState({ action });\n  }\n  saveOrOverwrite(gotodash) {\n    this.setState({ alert: null });\n    this.props.actions.removeSaveModalAlert();\n    const sliceParams = {};\n    if (_sliceInstanceProperty(this.props) && _sliceInstanceProperty(this.props).slice_id) {\n      sliceParams.slice_id = _sliceInstanceProperty(this.props).slice_id;\n    }\n    if (sliceParams.action === 'saveas') {\n      if (this.state.newSliceName === '') {\n        this.setState({ alert: t('Please enter a chart name') });\n        return;\n      }\n    }\n    sliceParams.action = this.state.action;\n    sliceParams.slice_name = this.state.newSliceName;\n    sliceParams.save_to_dashboard_id = this.state.saveToDashboardId;\n    sliceParams.new_dashboard_name = this.state.newDashboardName;\n    this.props.actions.\n    saveSlice(this.props.form_data, sliceParams).\n    then(data => {\n      if (data.dashboard_id === null) {\n        sessionStorage.removeItem(SK_DASHBOARD_ID);\n      } else\n      {\n        sessionStorage.setItem(SK_DASHBOARD_ID, data.dashboard_id);\n      }\n      // Go to new slice url or dashboard url\n      const url = gotodash ? data.dashboard_url : _sliceInstanceProperty(data).slice_url;\n      window.location.assign(url);\n    });\n    this.props.onHide();\n  }\n  removeAlert() {\n    if (this.props.alert) {\n      this.props.actions.removeSaveModalAlert();\n    }\n    this.setState({ alert: null });\n  }\n  render() {var _context6;\n    const dashboardSelectValue = this.state.saveToDashboardId || this.state.newDashboardName;\n    const valueObj = dashboardSelectValue ?\n    { value: dashboardSelectValue } :\n    null;\n    return ___EmotionJSX(StyledModal, { show: true, onHide: this.props.onHide, title: t('Save chart'), footer: ___EmotionJSX(\"div\", { \"data-test\": \"save-modal-footer\" },\n      ___EmotionJSX(Button, { id: \"btn_cancel\", buttonSize: \"small\", onClick: this.props.onHide },\n      t('Cancel')),\n\n      ___EmotionJSX(Button, { id: \"btn_modal_save_goto_dash\", buttonSize: \"small\", disabled: !this.state.newSliceName ||\n        !this.state.saveToDashboardId && !this.state.newDashboardName, onClick: () => this.saveOrOverwrite(true) },\n      t('Save & go to dashboard')),\n\n      ___EmotionJSX(Button, { id: \"btn_modal_save\", buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => this.saveOrOverwrite(false), disabled: !this.state.newSliceName, \"data-test\": \"btn-modal-save\" },\n      !this.props.can_overwrite && _sliceInstanceProperty(this.props) ?\n      t('Save as new chart') :\n      t('Save'))) },\n\n\n    ___EmotionJSX(Form, { \"data-test\": \"save-modal-body\", layout: \"vertical\" },\n    (this.state.alert || this.props.alert) && ___EmotionJSX(Alert, { type: \"warning\", message: ___EmotionJSX(React.Fragment, null,\n      this.state.alert ? this.state.alert : this.props.alert,\n      ___EmotionJSX(\"i\", { role: \"button\", \"aria-label\": \"Remove alert\", tabIndex: 0, className: \"fa fa-close pull-right\", onClick: _bindInstanceProperty(_context6 = this.removeAlert).call(_context6, this), style: { cursor: 'pointer' } })) }),\n\n    ___EmotionJSX(FormItem, { \"data-test\": \"radio-group\" },\n    ___EmotionJSX(Radio, { id: \"overwrite-radio\", disabled: !(this.props.can_overwrite && _sliceInstanceProperty(this.props)), checked: this.state.action === 'overwrite', onChange: () => this.changeAction('overwrite'), \"data-test\": \"save-overwrite-radio\" },\n    t('Save (Overwrite)')),\n\n    ___EmotionJSX(Radio, { id: \"saveas-radio\", \"data-test\": \"saveas-radio\", checked: this.state.action === 'saveas', onChange: () => this.changeAction('saveas') },\n    ' ',\n    t('Save as ...'), \" \\xA0\")),\n\n\n    ___EmotionJSX(\"hr\", null),\n    ___EmotionJSX(FormItem, { label: t('Chart name'), required: true },\n    ___EmotionJSX(Input, { name: \"new_slice_name\", type: \"text\", placeholder: \"Name\", value: this.state.newSliceName, onChange: this.onSliceNameChange, \"data-test\": \"new-chart-name\" })),\n\n    ___EmotionJSX(FormItem, { label: t('Add to dashboard'), \"data-test\": \"save-chart-modal-select-dashboard-form\" },\n    ___EmotionJSX(CreatableSelect, { id: \"dashboard-creatable-select\", className: \"save-modal-selector\", menuPosition: \"fixed\", options: this.props.dashboards, clearable: true, creatable: true, onChange: this.onDashboardSelectChange, autoSize: false, value: valueObj, placeholder:\n      // Using markdown to allow for good i18n\n      ___EmotionJSX(ReactMarkdown, { source: SELECT_PLACEHOLDER, renderers: { paragraph: 'span' } }) }))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}function mapStateToProps({ explore, saveModal }) {\n  return {\n    datasource: explore.datasource,\n    slice: _sliceInstanceProperty(explore),\n    can_overwrite: explore.can_overwrite,\n    userId: explore.user_id,\n    dashboards: saveModal.dashboards,\n    alert: saveModal.saveModalAlert };\n\n}const _default =\nconnect(mapStateToProps, () => ({}))(SaveModal);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(SK_DASHBOARD_ID, \"SK_DASHBOARD_ID\", \"/app/superset-frontend/src/explore/components/SaveModal.tsx\");reactHotLoader.register(SELECT_PLACEHOLDER, \"SELECT_PLACEHOLDER\", \"/app/superset-frontend/src/explore/components/SaveModal.tsx\");reactHotLoader.register(StyledModal, \"StyledModal\", \"/app/superset-frontend/src/explore/components/SaveModal.tsx\");reactHotLoader.register(SaveModal, \"SaveModal\", \"/app/superset-frontend/src/explore/components/SaveModal.tsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/app/superset-frontend/src/explore/components/SaveModal.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/SaveModal.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/SaveModal.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React from 'react';\nimport { Input } from 'src/common/components';\nimport { Form, FormItem } from 'src/components/Form';\nimport Alert from 'src/components/Alert';\nimport { JsonObject, t, styled } from '@superset-ui/core';\nimport ReactMarkdown from 'react-markdown';\nimport Modal from 'src/components/Modal';\nimport { Radio } from 'src/components/Radio';\nimport Button from 'src/components/Button';\nimport { CreatableSelect } from 'src/components/Select';\nimport { connect } from 'react-redux';\n\n// Session storage key for recent dashboard\nconst SK_DASHBOARD_ID = 'save_chart_recent_dashboard';\nconst SELECT_PLACEHOLDER = t('**Select** a dashboard OR **create** a new one');\n\ntype SaveModalProps = {\n  can_overwrite?: boolean;\n  onHide: () => void;\n  actions: Record<string, any>;\n  form_data?: Record<string, any>;\n  userId: string;\n  dashboards: Array<any>;\n  alert?: string;\n  sliceName?: string;\n  slice?: Record<string, any>;\n  datasource?: Record<string, any>;\n  dashboardId: '' | number | null;\n};\n\ntype ActionType = 'overwrite' | 'saveas';\n\ntype SaveModalState = {\n  saveToDashboardId: number | string | null;\n  newSliceName?: string;\n  newDashboardName?: string;\n  alert: string | null;\n  action: ActionType;\n};\n\nexport const StyledModal = styled(Modal)`\n  .ant-modal-body {\n    overflow: visible;\n  }\n`;\n\nclass SaveModal extends React.Component<SaveModalProps, SaveModalState> {\n  constructor(props: SaveModalProps) {\n    super(props);\n    this.state = {\n      saveToDashboardId: null,\n      newSliceName: props.sliceName,\n      alert: null,\n      action: props.can_overwrite ? 'overwrite' : 'saveas',\n    };\n    this.onDashboardSelectChange = this.onDashboardSelectChange.bind(this);\n    this.onSliceNameChange = this.onSliceNameChange.bind(this);\n    this.changeAction = this.changeAction.bind(this);\n    this.saveOrOverwrite = this.saveOrOverwrite.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.actions.fetchDashboards(this.props.userId).then(() => {\n      const dashboardIds = this.props.dashboards.map(\n        dashboard => dashboard.value,\n      );\n      const lastDashboard = sessionStorage.getItem(SK_DASHBOARD_ID);\n      let recentDashboard = lastDashboard && parseInt(lastDashboard, 10);\n\n      if (!recentDashboard && this.props.dashboardId) {\n        recentDashboard = this.props.dashboardId;\n      }\n\n      if (\n        recentDashboard !== null &&\n        dashboardIds.indexOf(recentDashboard) !== -1\n      ) {\n        this.setState({\n          saveToDashboardId: recentDashboard,\n        });\n      }\n    });\n  }\n\n  onSliceNameChange(event: React.ChangeEvent<HTMLInputElement>) {\n    this.setState({ newSliceName: event.target.value });\n  }\n\n  onDashboardSelectChange(event: Record<string, any>) {\n    const newDashboardName = event ? event.label : null;\n    const saveToDashboardId =\n      event && typeof event.value === 'number' ? event.value : null;\n    this.setState({ saveToDashboardId, newDashboardName });\n  }\n\n  changeAction(action: ActionType) {\n    this.setState({ action });\n  }\n\n  saveOrOverwrite(gotodash: boolean) {\n    this.setState({ alert: null });\n    this.props.actions.removeSaveModalAlert();\n    const sliceParams: Record<string, any> = {};\n\n    if (this.props.slice && this.props.slice.slice_id) {\n      sliceParams.slice_id = this.props.slice.slice_id;\n    }\n    if (sliceParams.action === 'saveas') {\n      if (this.state.newSliceName === '') {\n        this.setState({ alert: t('Please enter a chart name') });\n        return;\n      }\n    }\n    sliceParams.action = this.state.action;\n    sliceParams.slice_name = this.state.newSliceName;\n    sliceParams.save_to_dashboard_id = this.state.saveToDashboardId;\n    sliceParams.new_dashboard_name = this.state.newDashboardName;\n\n    this.props.actions\n      .saveSlice(this.props.form_data, sliceParams)\n      .then((data: JsonObject) => {\n        if (data.dashboard_id === null) {\n          sessionStorage.removeItem(SK_DASHBOARD_ID);\n        } else {\n          sessionStorage.setItem(SK_DASHBOARD_ID, data.dashboard_id);\n        }\n        // Go to new slice url or dashboard url\n        const url = gotodash ? data.dashboard_url : data.slice.slice_url;\n        window.location.assign(url);\n      });\n    this.props.onHide();\n  }\n\n  removeAlert() {\n    if (this.props.alert) {\n      this.props.actions.removeSaveModalAlert();\n    }\n    this.setState({ alert: null });\n  }\n\n  render() {\n    const dashboardSelectValue =\n      this.state.saveToDashboardId || this.state.newDashboardName;\n    const valueObj = dashboardSelectValue\n      ? { value: dashboardSelectValue }\n      : null;\n    return (\n      <StyledModal\n        show\n        onHide={this.props.onHide}\n        title={t('Save chart')}\n        footer={\n          <div data-test=\"save-modal-footer\">\n            <Button\n              id=\"btn_cancel\"\n              buttonSize=\"small\"\n              onClick={this.props.onHide}\n            >\n              {t('Cancel')}\n            </Button>\n            <Button\n              id=\"btn_modal_save_goto_dash\"\n              buttonSize=\"small\"\n              disabled={\n                !this.state.newSliceName ||\n                (!this.state.saveToDashboardId && !this.state.newDashboardName)\n              }\n              onClick={() => this.saveOrOverwrite(true)}\n            >\n              {t('Save & go to dashboard')}\n            </Button>\n            <Button\n              id=\"btn_modal_save\"\n              buttonSize=\"small\"\n              buttonStyle=\"primary\"\n              onClick={() => this.saveOrOverwrite(false)}\n              disabled={!this.state.newSliceName}\n              data-test=\"btn-modal-save\"\n            >\n              {!this.props.can_overwrite && this.props.slice\n                ? t('Save as new chart')\n                : t('Save')}\n            </Button>\n          </div>\n        }\n      >\n        <Form data-test=\"save-modal-body\" layout=\"vertical\">\n          {(this.state.alert || this.props.alert) && (\n            <Alert\n              type=\"warning\"\n              message={\n                <>\n                  {this.state.alert ? this.state.alert : this.props.alert}\n                  <i\n                    role=\"button\"\n                    aria-label=\"Remove alert\"\n                    tabIndex={0}\n                    className=\"fa fa-close pull-right\"\n                    onClick={this.removeAlert.bind(this)}\n                    style={{ cursor: 'pointer' }}\n                  />\n                </>\n              }\n            />\n          )}\n          <FormItem data-test=\"radio-group\">\n            <Radio\n              id=\"overwrite-radio\"\n              disabled={!(this.props.can_overwrite && this.props.slice)}\n              checked={this.state.action === 'overwrite'}\n              onChange={() => this.changeAction('overwrite')}\n              data-test=\"save-overwrite-radio\"\n            >\n              {t('Save (Overwrite)')}\n            </Radio>\n            <Radio\n              id=\"saveas-radio\"\n              data-test=\"saveas-radio\"\n              checked={this.state.action === 'saveas'}\n              onChange={() => this.changeAction('saveas')}\n            >\n              {' '}\n              {t('Save as ...')} &nbsp;\n            </Radio>\n          </FormItem>\n          <hr />\n          <FormItem label={t('Chart name')} required>\n            <Input\n              name=\"new_slice_name\"\n              type=\"text\"\n              placeholder=\"Name\"\n              value={this.state.newSliceName}\n              onChange={this.onSliceNameChange}\n              data-test=\"new-chart-name\"\n            />\n          </FormItem>\n          <FormItem\n            label={t('Add to dashboard')}\n            data-test=\"save-chart-modal-select-dashboard-form\"\n          >\n            <CreatableSelect\n              id=\"dashboard-creatable-select\"\n              className=\"save-modal-selector\"\n              menuPosition=\"fixed\"\n              options={this.props.dashboards}\n              clearable\n              creatable\n              onChange={this.onDashboardSelectChange}\n              autoSize={false}\n              value={valueObj}\n              placeholder={\n                // Using markdown to allow for good i18n\n                <ReactMarkdown\n                  source={SELECT_PLACEHOLDER}\n                  renderers={{ paragraph: 'span' }}\n                />\n              }\n            />\n          </FormItem>\n        </Form>\n      </StyledModal>\n    );\n  }\n}\n\nfunction mapStateToProps({\n  explore,\n  saveModal,\n}: Record<string, any>): Partial<SaveModalProps> {\n  return {\n    datasource: explore.datasource,\n    slice: explore.slice,\n    can_overwrite: explore.can_overwrite,\n    userId: explore.user_id,\n    dashboards: saveModal.dashboards,\n    alert: saveModal.saveModalAlert,\n  };\n}\n\nexport default connect(mapStateToProps, () => ({}))(SaveModal);\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}