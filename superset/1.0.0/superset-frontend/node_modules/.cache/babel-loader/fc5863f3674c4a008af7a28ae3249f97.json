{"ast":null,"code":"import \"core-js/modules/es.string.replace.js\";import \"core-js/modules/web.dom-collections.iterator.js\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _sliceInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/slice\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _debounce from \"lodash/debounce\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport Collapse from 'src/components/Collapse';\n\nimport { matchSorter, rankings } from 'match-sorter';\nimport { FAST_DEBOUNCE } from 'src/constants';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport Control from 'src/explore/components/Control';\nimport DatasourcePanelDragWrapper from './DatasourcePanelDragWrapper';\nimport { DndItemType } from '../DndItemType';\nimport { StyledColumnOption, StyledMetricOption } from '../optionRenderers';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst DatasourceContainer = styled.div`\n  background-color: ${({ theme }) => theme.colors.grayscale.light4};\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  max-height: 100%;\n  .ant-collapse {\n    height: auto;\n  }\n  .field-selections {\n    padding: ${({ theme }) => `0 0 ${4 * theme.gridUnit}px`};\n    overflow: auto;\n  }\n  .field-length {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n  .form-control.input-md {\n    width: calc(100% - ${({ theme }) => theme.gridUnit * 4}px);\n    margin: ${({ theme }) => theme.gridUnit * 2}px auto;\n  }\n  .type-label {\n    font-weight: ${({ theme }) => theme.typography.weights.light};\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n    color: ${({ theme }) => theme.colors.grayscale.base};\n  }\n  .Control {\n    padding-bottom: 0;\n  }\n`;\nconst LabelContainer = styled.div`\n  overflow: hidden;\n  text-overflow: ellipsis;\n\n  & > span {\n    white-space: nowrap;\n  }\n\n  .option-label {\n    display: inline;\n  }\n\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\nconst enableExploreDnd = isFeatureEnabled(FeatureFlag.ENABLE_EXPLORE_DRAG_AND_DROP);\nexport default function DataSourcePanel({ datasource, controls: { datasource: datasourceControl }, actions }) {var _context3, _context4;\n  const { columns, metrics } = datasource;\n  const [inputValue, setInputValue] = useState('');\n  const [lists, setList] = useState({\n    columns,\n    metrics });\n\n  const search = _debounce(value => {\n    if (value === '') {\n      setList({ columns, metrics });\n      return;\n    }\n    setList({\n      columns: matchSorter(columns, value, {\n        keys: [\n        {\n          key: 'verbose_name',\n          threshold: rankings.CONTAINS },\n\n        {\n          key: 'column_name',\n          threshold: rankings.CONTAINS },\n\n        {\n          key: item => {var _context;return _mapInstanceProperty(_context = [item.description, item.expression]).call(_context, x => (x == null ? void 0 : x.replace(/[_\\n\\s]+/g, ' ')) || '');},\n          threshold: rankings.CONTAINS,\n          maxRanking: rankings.CONTAINS }],\n\n\n        keepDiacritics: true }),\n\n      metrics: matchSorter(metrics, value, {\n        keys: [\n        {\n          key: 'verbose_name',\n          threshold: rankings.CONTAINS },\n\n        {\n          key: 'metric_name',\n          threshold: rankings.CONTAINS },\n\n        {\n          key: item => {var _context2;return _mapInstanceProperty(_context2 = [item.description, item.expression]).call(_context2, x => (x == null ? void 0 : x.replace(/[_\\n\\s]+/g, ' ')) || '');},\n          threshold: rankings.CONTAINS,\n          maxRanking: rankings.CONTAINS }],\n\n\n        keepDiacritics: true,\n        baseSort: (a, b) => Number(b.item.is_certified) - Number(a.item.is_certified) ||\n        String(a.rankedValue).localeCompare(b.rankedValue) }) });\n\n\n  }, FAST_DEBOUNCE);\n  useEffect(() => {\n    setList({\n      columns,\n      metrics });\n\n    setInputValue('');\n  }, [columns, datasource, metrics]);\n  const metricSlice = _sliceInstanceProperty(_context3 = lists.metrics).call(_context3, 0, 50);\n  const columnSlice = _sliceInstanceProperty(_context4 = lists.columns).call(_context4, 0, 50);\n  const mainBody = ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(\"input\", { type: \"text\", onChange: evt => {\n      setInputValue(evt.target.value);\n      search(evt.target.value);\n    }, value: inputValue, className: \"form-control input-md\", placeholder: t('Search Metrics & Columns') }),\n  ___EmotionJSX(\"div\", { className: \"field-selections\" },\n  ___EmotionJSX(Collapse, { bordered: true, defaultActiveKey: ['metrics', 'column'], expandIconPosition: \"right\", ghost: true },\n  ___EmotionJSX(Collapse.Panel, { header: ___EmotionJSX(\"span\", { className: \"header\" }, t('Metrics')), key: \"metrics\" },\n  ___EmotionJSX(\"div\", { className: \"field-length\" },\n  t(`Showing %s of %s`, metricSlice.length, lists.metrics.length)),\n\n  _mapInstanceProperty(metricSlice).call(metricSlice, m => ___EmotionJSX(LabelContainer, { key: m.metric_name, className: \"column\" },\n  enableExploreDnd ? ___EmotionJSX(DatasourcePanelDragWrapper, { value: m, type: DndItemType.Metric },\n  ___EmotionJSX(StyledMetricOption, { metric: m, showType: true })) :\n  ___EmotionJSX(StyledMetricOption, { metric: m, showType: true })))),\n\n\n  ___EmotionJSX(Collapse.Panel, { header: ___EmotionJSX(\"span\", { className: \"header\" }, t('Columns')), key: \"column\" },\n  ___EmotionJSX(\"div\", { className: \"field-length\" },\n  t(`Showing %s of %s`, columnSlice.length, lists.columns.length)),\n\n  _mapInstanceProperty(columnSlice).call(columnSlice, col => ___EmotionJSX(LabelContainer, { key: col.column_name, className: \"column\" },\n  enableExploreDnd ? ___EmotionJSX(DatasourcePanelDragWrapper, { value: col, type: DndItemType.Column },\n  ___EmotionJSX(StyledColumnOption, { column: col, showType: true })) :\n  ___EmotionJSX(StyledColumnOption, { column: col, showType: true })))))));\n\n\n\n\n\n  return ___EmotionJSX(DatasourceContainer, null,\n  ___EmotionJSX(Control, _extends({}, datasourceControl, { name: \"datasource\", actions: actions })),\n  datasource.id != null && mainBody);\n\n}__signature__(DataSourcePanel, \"useState{[inputValue, setInputValue]('')}\\nuseState{[lists, setList]({\\n        columns,\\n        metrics,\\n    })}\\nuseEffect{}\");;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(DatasourceContainer, \"DatasourceContainer\", \"/app/superset-frontend/src/explore/components/DatasourcePanel/index.tsx\");reactHotLoader.register(LabelContainer, \"LabelContainer\", \"/app/superset-frontend/src/explore/components/DatasourcePanel/index.tsx\");reactHotLoader.register(enableExploreDnd, \"enableExploreDnd\", \"/app/superset-frontend/src/explore/components/DatasourcePanel/index.tsx\");reactHotLoader.register(DataSourcePanel, \"DataSourcePanel\", \"/app/superset-frontend/src/explore/components/DatasourcePanel/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/DatasourcePanel/index.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport Collapse from 'src/components/Collapse';\nimport { ControlConfig, DatasourceMeta } from '@superset-ui/chart-controls';\nimport { debounce } from 'lodash';\nimport { matchSorter, rankings } from 'match-sorter';\nimport { FAST_DEBOUNCE } from 'src/constants';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport { ExploreActions } from 'src/explore/actions/exploreActions';\nimport Control from 'src/explore/components/Control';\nimport DatasourcePanelDragWrapper from './DatasourcePanelDragWrapper';\nimport { DndItemType } from '../DndItemType';\nimport { StyledColumnOption, StyledMetricOption } from '../optionRenderers';\n\ninterface DatasourceControl extends ControlConfig {\n  datasource?: DatasourceMeta;\n}\n\nexport interface Props {\n  datasource: DatasourceMeta;\n  controls: {\n    datasource: DatasourceControl;\n  };\n  actions: Partial<ExploreActions> & Pick<ExploreActions, 'setControlValue'>;\n}\n\nconst DatasourceContainer = styled.div`\n  background-color: ${({ theme }) => theme.colors.grayscale.light4};\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  max-height: 100%;\n  .ant-collapse {\n    height: auto;\n  }\n  .field-selections {\n    padding: ${({ theme }) => `0 0 ${4 * theme.gridUnit}px`};\n    overflow: auto;\n  }\n  .field-length {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n  .form-control.input-md {\n    width: calc(100% - ${({ theme }) => theme.gridUnit * 4}px);\n    margin: ${({ theme }) => theme.gridUnit * 2}px auto;\n  }\n  .type-label {\n    font-weight: ${({ theme }) => theme.typography.weights.light};\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n    color: ${({ theme }) => theme.colors.grayscale.base};\n  }\n  .Control {\n    padding-bottom: 0;\n  }\n`;\n\nconst LabelContainer = styled.div`\n  overflow: hidden;\n  text-overflow: ellipsis;\n\n  & > span {\n    white-space: nowrap;\n  }\n\n  .option-label {\n    display: inline;\n  }\n\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\n\nconst enableExploreDnd = isFeatureEnabled(\n  FeatureFlag.ENABLE_EXPLORE_DRAG_AND_DROP,\n);\n\nexport default function DataSourcePanel({\n  datasource,\n  controls: { datasource: datasourceControl },\n  actions,\n}: Props) {\n  const { columns, metrics } = datasource;\n  const [inputValue, setInputValue] = useState('');\n  const [lists, setList] = useState({\n    columns,\n    metrics,\n  });\n\n  const search = debounce((value: string) => {\n    if (value === '') {\n      setList({ columns, metrics });\n      return;\n    }\n    setList({\n      columns: matchSorter(columns, value, {\n        keys: [\n          {\n            key: 'verbose_name',\n            threshold: rankings.CONTAINS,\n          },\n          {\n            key: 'column_name',\n            threshold: rankings.CONTAINS,\n          },\n          {\n            key: item =>\n              [item.description, item.expression].map(\n                x => x?.replace(/[_\\n\\s]+/g, ' ') || '',\n              ),\n            threshold: rankings.CONTAINS,\n            maxRanking: rankings.CONTAINS,\n          },\n        ],\n        keepDiacritics: true,\n      }),\n      metrics: matchSorter(metrics, value, {\n        keys: [\n          {\n            key: 'verbose_name',\n            threshold: rankings.CONTAINS,\n          },\n          {\n            key: 'metric_name',\n            threshold: rankings.CONTAINS,\n          },\n          {\n            key: item =>\n              [item.description, item.expression].map(\n                x => x?.replace(/[_\\n\\s]+/g, ' ') || '',\n              ),\n            threshold: rankings.CONTAINS,\n            maxRanking: rankings.CONTAINS,\n          },\n        ],\n        keepDiacritics: true,\n        baseSort: (a, b) =>\n          Number(b.item.is_certified) - Number(a.item.is_certified) ||\n          String(a.rankedValue).localeCompare(b.rankedValue),\n      }),\n    });\n  }, FAST_DEBOUNCE);\n\n  useEffect(() => {\n    setList({\n      columns,\n      metrics,\n    });\n    setInputValue('');\n  }, [columns, datasource, metrics]);\n\n  const metricSlice = lists.metrics.slice(0, 50);\n  const columnSlice = lists.columns.slice(0, 50);\n\n  const mainBody = (\n    <>\n      <input\n        type=\"text\"\n        onChange={evt => {\n          setInputValue(evt.target.value);\n          search(evt.target.value);\n        }}\n        value={inputValue}\n        className=\"form-control input-md\"\n        placeholder={t('Search Metrics & Columns')}\n      />\n      <div className=\"field-selections\">\n        <Collapse\n          bordered\n          defaultActiveKey={['metrics', 'column']}\n          expandIconPosition=\"right\"\n          ghost\n        >\n          <Collapse.Panel\n            header={<span className=\"header\">{t('Metrics')}</span>}\n            key=\"metrics\"\n          >\n            <div className=\"field-length\">\n              {t(`Showing %s of %s`, metricSlice.length, lists.metrics.length)}\n            </div>\n            {metricSlice.map(m => (\n              <LabelContainer key={m.metric_name} className=\"column\">\n                {enableExploreDnd ? (\n                  <DatasourcePanelDragWrapper\n                    value={m}\n                    type={DndItemType.Metric}\n                  >\n                    <StyledMetricOption metric={m} showType />\n                  </DatasourcePanelDragWrapper>\n                ) : (\n                  <StyledMetricOption metric={m} showType />\n                )}\n              </LabelContainer>\n            ))}\n          </Collapse.Panel>\n          <Collapse.Panel\n            header={<span className=\"header\">{t('Columns')}</span>}\n            key=\"column\"\n          >\n            <div className=\"field-length\">\n              {t(`Showing %s of %s`, columnSlice.length, lists.columns.length)}\n            </div>\n            {columnSlice.map(col => (\n              <LabelContainer key={col.column_name} className=\"column\">\n                {enableExploreDnd ? (\n                  <DatasourcePanelDragWrapper\n                    value={col}\n                    type={DndItemType.Column}\n                  >\n                    <StyledColumnOption column={col} showType />\n                  </DatasourcePanelDragWrapper>\n                ) : (\n                  <StyledColumnOption column={col} showType />\n                )}\n              </LabelContainer>\n            ))}\n          </Collapse.Panel>\n        </Collapse>\n      </div>\n    </>\n  );\n\n  return (\n    <DatasourceContainer>\n      <Control {...datasourceControl} name=\"datasource\" actions={actions} />\n      {datasource.id != null && mainBody}\n    </DatasourceContainer>\n  );\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}