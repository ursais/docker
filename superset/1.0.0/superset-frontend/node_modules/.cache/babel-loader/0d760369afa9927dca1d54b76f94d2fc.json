{"ast":null,"code":"import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment from 'moment';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport Alert from 'src/components/Alert';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport shortid from 'shortid';\n\nimport Button from 'src/components/Button';\nimport * as actions from '../actions/sqlLab';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  query: PropTypes.object,\n  errorMessage: PropTypes.string,\n  timeout: PropTypes.number,\n  database: PropTypes.object.isRequired,\n  onClick: PropTypes.func.isRequired };\n\nconst defaultProps = {\n  query: {} };\n\n\nclass ExploreResultsButton extends React.PureComponent {\n  constructor(props) {var _context, _context2;\n    super(props);\n    this.getInvalidColumns = _bindInstanceProperty(_context = this.getInvalidColumns).call(_context, this);\n    this.renderInvalidColumnMessage = _bindInstanceProperty(_context2 = this.renderInvalidColumnMessage).call(_context2,\n    this);\n\n  }\n\n  getColumns() {\n    const { props } = this;\n    if (\n    props.query &&\n    props.query.results &&\n    props.query.results.selected_columns)\n    {\n      return props.query.results.selected_columns;\n    }\n    return [];\n  }\n\n  getQueryDuration() {\n    return moment.\n    duration(this.props.query.endDttm - this.props.query.startDttm).\n    asSeconds();\n  }\n\n  getInvalidColumns() {var _context3, _context4;\n    const re1 = /__\\d+$/; // duplicate column name pattern\n    const re2 = /^__timestamp/i; // reserved temporal column alias\n\n    return _filterInstanceProperty(_context3 = _mapInstanceProperty(_context4 = this.props.query.results.selected_columns).call(_context4,\n    col => col.name)).call(_context3,\n    col => re1.test(col) || re2.test(col));\n  }\n\n  datasourceName() {\n    const { query } = this.props;\n    const uniqueId = shortid.generate();\n    let datasourceName = uniqueId;\n    if (query) {\n      datasourceName = query.user ? `${query.user}-` : '';\n      datasourceName += `${query.tab}-${uniqueId}`;\n    }\n    return datasourceName;\n  }\n\n  buildVizOptions() {\n    const { schema, sql, dbId, templateParams } = this.props.query;\n    return {\n      dbId,\n      schema,\n      sql,\n      templateParams,\n      datasourceName: this.datasourceName(),\n      columns: this.getColumns() };\n\n  }\n\n  renderTimeoutWarning() {\n    return (\n      ___EmotionJSX(Alert, {\n        type: \"warning\",\n        message:\n        ___EmotionJSX(React.Fragment, null,\n        t(\n        'This query took %s seconds to run, ',\n        Math.round(this.getQueryDuration())) +\n\n        t(\n        'and the explore view times out at %s seconds ',\n        this.props.timeout) +\n\n        t(\n        'following this flow will most likely lead to your query timing out. ') +\n\n        t(\n        'We recommend your summarize your data further before following that flow. ') +\n\n        t('If activated you can use the '),\n        ___EmotionJSX(\"strong\", null, \"CREATE TABLE AS \"),\n        t(\n        'feature to store a summarized data set that you can then explore.')) }));\n\n\n\n\n\n  }\n\n  renderInvalidColumnMessage() {\n    const invalidColumns = this.getInvalidColumns();\n    if (invalidColumns.length === 0) {\n      return null;\n    }\n    return (\n      ___EmotionJSX(\"div\", null,\n      t('Column name(s) '),\n      ___EmotionJSX(\"code\", null,\n      ___EmotionJSX(\"strong\", null, invalidColumns.join(', '), \" \")),\n\n      t(`cannot be used as a column name. The column name/alias \"__timestamp\"\n          is reserved for the main temporal expression, and column aliases ending with\n          double underscores followed by a numeric value (e.g. \"my_col__1\") are reserved\n          for deduplicating duplicate column names. Please use aliases to rename the\n          invalid column names.`)));\n\n\n  }\n\n  render() {\n    const allowsSubquery =\n    this.props.database && this.props.database.allows_subquery;\n    return (\n      ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(Button, {\n        buttonSize: \"small\",\n        onClick: this.props.onClick,\n        disabled: !allowsSubquery,\n        tooltip: t('Explore the result set in the data exploration view') },\n\n      ___EmotionJSX(InfoTooltipWithTrigger, {\n        icon: \"line-chart\",\n        placement: \"top\",\n        label: \"explore\" }),\n      ' ',\n      t('Explore'))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}ExploreResultsButton.propTypes = propTypes;\nExploreResultsButton.defaultProps = defaultProps;\n\nfunction mapStateToProps({ sqlLab, common }) {\n  return {\n    errorMessage: sqlLab.errorMessage,\n    timeout: common.conf ? common.conf.SUPERSET_WEBSERVER_TIMEOUT : null };\n\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(actions, dispatch) };\n\n}const _default =\n\nconnect(\nmapStateToProps,\nmapDispatchToProps)(\nExploreResultsButton);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/SqlLab/components/ExploreResultsButton.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/SqlLab/components/ExploreResultsButton.jsx\");reactHotLoader.register(ExploreResultsButton, \"ExploreResultsButton\", \"/app/superset-frontend/src/SqlLab/components/ExploreResultsButton.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/app/superset-frontend/src/SqlLab/components/ExploreResultsButton.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/app/superset-frontend/src/SqlLab/components/ExploreResultsButton.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/SqlLab/components/ExploreResultsButton.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/SqlLab/components/ExploreResultsButton.jsx"],"names":["moment","React","PropTypes","bindActionCreators","connect","Alert","t","InfoTooltipWithTrigger","shortid","Button","actions","propTypes","object","isRequired","query","errorMessage","string","timeout","number","database","onClick","func","defaultProps","ExploreResultsButton","PureComponent","constructor","props","getInvalidColumns","renderInvalidColumnMessage","getColumns","results","selected_columns","getQueryDuration","duration","endDttm","startDttm","asSeconds","re1","re2","col","name","test","datasourceName","uniqueId","generate","user","tab","buildVizOptions","schema","sql","dbId","templateParams","columns","renderTimeoutWarning","Math","round","invalidColumns","length","join","render","allowsSubquery","allows_subquery","mapStateToProps","sqlLab","common","conf","SUPERSET_WEBSERVER_TIMEOUT","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment from 'moment';\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport Alert from 'src/components/Alert';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport shortid from 'shortid';\n\nimport Button from 'src/components/Button';\nimport * as actions from '../actions/sqlLab';\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  query: PropTypes.object,\n  errorMessage: PropTypes.string,\n  timeout: PropTypes.number,\n  database: PropTypes.object.isRequired,\n  onClick: PropTypes.func.isRequired,\n};\nconst defaultProps = {\n  query: {},\n};\n\nclass ExploreResultsButton extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.getInvalidColumns = this.getInvalidColumns.bind(this);\n    this.renderInvalidColumnMessage = this.renderInvalidColumnMessage.bind(\n      this,\n    );\n  }\n\n  getColumns() {\n    const { props } = this;\n    if (\n      props.query &&\n      props.query.results &&\n      props.query.results.selected_columns\n    ) {\n      return props.query.results.selected_columns;\n    }\n    return [];\n  }\n\n  getQueryDuration() {\n    return moment\n      .duration(this.props.query.endDttm - this.props.query.startDttm)\n      .asSeconds();\n  }\n\n  getInvalidColumns() {\n    const re1 = /__\\d+$/; // duplicate column name pattern\n    const re2 = /^__timestamp/i; // reserved temporal column alias\n\n    return this.props.query.results.selected_columns\n      .map(col => col.name)\n      .filter(col => re1.test(col) || re2.test(col));\n  }\n\n  datasourceName() {\n    const { query } = this.props;\n    const uniqueId = shortid.generate();\n    let datasourceName = uniqueId;\n    if (query) {\n      datasourceName = query.user ? `${query.user}-` : '';\n      datasourceName += `${query.tab}-${uniqueId}`;\n    }\n    return datasourceName;\n  }\n\n  buildVizOptions() {\n    const { schema, sql, dbId, templateParams } = this.props.query;\n    return {\n      dbId,\n      schema,\n      sql,\n      templateParams,\n      datasourceName: this.datasourceName(),\n      columns: this.getColumns(),\n    };\n  }\n\n  renderTimeoutWarning() {\n    return (\n      <Alert\n        type=\"warning\"\n        message={\n          <>\n            {t(\n              'This query took %s seconds to run, ',\n              Math.round(this.getQueryDuration()),\n            ) +\n              t(\n                'and the explore view times out at %s seconds ',\n                this.props.timeout,\n              ) +\n              t(\n                'following this flow will most likely lead to your query timing out. ',\n              ) +\n              t(\n                'We recommend your summarize your data further before following that flow. ',\n              ) +\n              t('If activated you can use the ')}\n            <strong>CREATE TABLE AS </strong>\n            {t(\n              'feature to store a summarized data set that you can then explore.',\n            )}\n          </>\n        }\n      />\n    );\n  }\n\n  renderInvalidColumnMessage() {\n    const invalidColumns = this.getInvalidColumns();\n    if (invalidColumns.length === 0) {\n      return null;\n    }\n    return (\n      <div>\n        {t('Column name(s) ')}\n        <code>\n          <strong>{invalidColumns.join(', ')} </strong>\n        </code>\n        {t(`cannot be used as a column name. The column name/alias \"__timestamp\"\n          is reserved for the main temporal expression, and column aliases ending with\n          double underscores followed by a numeric value (e.g. \"my_col__1\") are reserved\n          for deduplicating duplicate column names. Please use aliases to rename the\n          invalid column names.`)}\n      </div>\n    );\n  }\n\n  render() {\n    const allowsSubquery =\n      this.props.database && this.props.database.allows_subquery;\n    return (\n      <>\n        <Button\n          buttonSize=\"small\"\n          onClick={this.props.onClick}\n          disabled={!allowsSubquery}\n          tooltip={t('Explore the result set in the data exploration view')}\n        >\n          <InfoTooltipWithTrigger\n            icon=\"line-chart\"\n            placement=\"top\"\n            label=\"explore\"\n          />{' '}\n          {t('Explore')}\n        </Button>\n      </>\n    );\n  }\n}\nExploreResultsButton.propTypes = propTypes;\nExploreResultsButton.defaultProps = defaultProps;\n\nfunction mapStateToProps({ sqlLab, common }) {\n  return {\n    errorMessage: sqlLab.errorMessage,\n    timeout: common.conf ? common.conf.SUPERSET_WEBSERVER_TIMEOUT : null,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(ExploreResultsButton);\n"]},"metadata":{},"sourceType":"module"}