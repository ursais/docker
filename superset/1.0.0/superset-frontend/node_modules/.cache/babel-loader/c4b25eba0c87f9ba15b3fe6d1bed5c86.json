{"ast":null,"code":"import \"core-js/modules/es.string.replace.js\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { styled, SupersetClient, t } from '@superset-ui/core';\n\nimport { Menu, NoAnimationDropdown } from 'src/common/components';\nimport Icon from 'src/components/Icon';\nimport { URL_PARAMS } from 'src/constants';\nimport ShareMenuItems from 'src/dashboard/components/menu/ShareMenuItems';\nimport CssEditor from 'src/dashboard/components/CssEditor';\nimport RefreshIntervalModal from 'src/dashboard/components/RefreshIntervalModal';\nimport SaveModal from 'src/dashboard/components/SaveModal';\nimport injectCustomCss from 'src/dashboard/util/injectCustomCss';\nimport { SAVE_TYPE_NEWDASHBOARD } from 'src/dashboard/util/constants';\nimport FilterScopeModal from 'src/dashboard/components/filterscope/FilterScopeModal';\nimport downloadAsImage from 'src/utils/downloadAsImage';\nimport getDashboardUrl from 'src/dashboard/util/getDashboardUrl';\nimport { getActiveFilters } from 'src/dashboard/util/activeDashboardFilters';\nimport { getUrlParam } from 'src/utils/urlUtils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  addSuccessToast: PropTypes.func.isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n  dashboardInfo: PropTypes.object.isRequired,\n  dashboardId: PropTypes.number.isRequired,\n  dashboardTitle: PropTypes.string.isRequired,\n  customCss: PropTypes.string.isRequired,\n  colorNamespace: PropTypes.string,\n  colorScheme: PropTypes.string,\n  onChange: PropTypes.func.isRequired,\n  updateCss: PropTypes.func.isRequired,\n  forceRefreshAllCharts: PropTypes.func.isRequired,\n  refreshFrequency: PropTypes.number.isRequired,\n  shouldPersistRefreshFrequency: PropTypes.bool.isRequired,\n  setRefreshFrequency: PropTypes.func.isRequired,\n  startPeriodicRender: PropTypes.func.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  userCanEdit: PropTypes.bool.isRequired,\n  userCanShare: PropTypes.bool.isRequired,\n  userCanSave: PropTypes.bool.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  layout: PropTypes.object.isRequired,\n  expandedSlices: PropTypes.object.isRequired,\n  onSave: PropTypes.func.isRequired,\n  showPropertiesModal: PropTypes.func.isRequired,\n  refreshLimit: PropTypes.number,\n  refreshWarning: PropTypes.string,\n  lastModifiedTime: PropTypes.number.isRequired };\n\n\nconst defaultProps = {\n  colorNamespace: undefined,\n  colorScheme: undefined,\n  refreshLimit: 0,\n  refreshWarning: null };\n\n\nconst MENU_KEYS = {\n  SAVE_MODAL: 'save-modal',\n  SHARE_DASHBOARD: 'share-dashboard',\n  REFRESH_DASHBOARD: 'refresh-dashboard',\n  AUTOREFRESH_MODAL: 'autorefresh-modal',\n  SET_FILTER_MAPPING: 'set-filter-mapping',\n  EDIT_PROPERTIES: 'edit-properties',\n  EDIT_CSS: 'edit-css',\n  DOWNLOAD_AS_IMAGE: 'download-as-image',\n  TOGGLE_FULLSCREEN: 'toggle-fullscreen' };\n\n\nconst DropdownButton = styled.div`\n  margin-left: ${({ theme }) => theme.gridUnit * 2.5}px;\n`;\n\nconst SCREENSHOT_NODE_SELECTOR = '.dashboard';\n\nclass HeaderActionsDropdown extends React.PureComponent {\n  static discardChanges() {\n    window.location.reload();\n  }\n\n  constructor(props) {var _context, _context2, _context3;\n    super(props);\n    this.state = {\n      css: props.customCss,\n      cssTemplates: [] };\n\n\n    this.changeCss = _bindInstanceProperty(_context = this.changeCss).call(_context, this);\n    this.changeRefreshInterval = _bindInstanceProperty(_context2 = this.changeRefreshInterval).call(_context2, this);\n    this.handleMenuClick = _bindInstanceProperty(_context3 = this.handleMenuClick).call(_context3, this);\n  }\n\n  UNSAFE_componentWillMount() {\n    injectCustomCss(this.state.css);\n\n    SupersetClient.get({ endpoint: '/csstemplateasyncmodelview/api/read' }).\n    then(({ json }) => {var _context4;\n      const cssTemplates = _mapInstanceProperty(_context4 = json.result).call(_context4, row => ({\n        value: row.template_name,\n        css: row.css,\n        label: row.template_name }));\n\n      this.setState({ cssTemplates });\n    }).\n    catch(() => {\n      this.props.addDangerToast(\n      t('An error occurred while fetching available CSS templates'));\n\n    });\n  }\n\n  changeCss(css) {\n    this.setState({ css }, () => {\n      injectCustomCss(css);\n    });\n    this.props.onChange();\n    this.props.updateCss(css);\n  }\n\n  changeRefreshInterval(refreshInterval, isPersistent) {\n    this.props.setRefreshFrequency(refreshInterval, isPersistent);\n    this.props.startPeriodicRender(refreshInterval * 1000);\n  }\n\n  handleMenuClick({ key, domEvent }) {\n    switch (key) {\n      case MENU_KEYS.REFRESH_DASHBOARD:\n        this.props.forceRefreshAllCharts();\n        break;\n      case MENU_KEYS.EDIT_PROPERTIES:\n        this.props.showPropertiesModal();\n        break;\n      case MENU_KEYS.DOWNLOAD_AS_IMAGE:{\n          // menu closes with a delay, we need to hide it manually,\n          // so that we don't capture it on the screenshot\n          const menu = document.querySelector(\n          '.ant-dropdown:not(.ant-dropdown-hidden)');\n\n          menu.style.visibility = 'hidden';\n          downloadAsImage(\n          SCREENSHOT_NODE_SELECTOR,\n          this.props.dashboardTitle)(\n          domEvent).then(() => {\n            menu.style.visibility = 'visible';\n          });\n          break;\n        }\n      case MENU_KEYS.TOGGLE_FULLSCREEN:{\n          const url = getDashboardUrl(\n          window.location.pathname,\n          getActiveFilters(),\n          window.location.hash,\n          !getUrlParam(URL_PARAMS.standalone));\n\n          window.location.replace(url);\n          break;\n        }\n      default:\n        break;}\n\n  }\n\n  render() {\n    const {\n      dashboardTitle,\n      dashboardId,\n      dashboardInfo,\n      refreshFrequency,\n      shouldPersistRefreshFrequency,\n      editMode,\n      customCss,\n      colorNamespace,\n      colorScheme,\n      layout,\n      expandedSlices,\n      onSave,\n      userCanEdit,\n      userCanShare,\n      userCanSave,\n      isLoading,\n      refreshLimit,\n      refreshWarning,\n      lastModifiedTime,\n      addSuccessToast,\n      addDangerToast } =\n    this.props;\n\n    const emailTitle = t('Superset dashboard');\n    const emailSubject = `${emailTitle} ${dashboardTitle}`;\n    const emailBody = t('Check out this dashboard: ');\n    const url = getDashboardUrl(\n    window.location.pathname,\n    getActiveFilters(),\n    window.location.hash);\n\n\n    const menu =\n    ___EmotionJSX(Menu, {\n      onClick: this.handleMenuClick,\n      selectable: false,\n      \"data-test\": \"header-actions-menu\" },\n\n    userCanSave &&\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.SAVE_MODAL },\n    ___EmotionJSX(SaveModal, {\n      addSuccessToast: this.props.addSuccessToast,\n      addDangerToast: this.props.addDangerToast,\n      dashboardId: dashboardId,\n      dashboardTitle: dashboardTitle,\n      dashboardInfo: dashboardInfo,\n      saveType: SAVE_TYPE_NEWDASHBOARD,\n      layout: layout,\n      expandedSlices: expandedSlices,\n      refreshFrequency: refreshFrequency,\n      shouldPersistRefreshFrequency: shouldPersistRefreshFrequency,\n      lastModifiedTime: lastModifiedTime,\n      customCss: customCss,\n      colorNamespace: colorNamespace,\n      colorScheme: colorScheme,\n      onSave: onSave,\n      triggerNode:\n      ___EmotionJSX(\"span\", { \"data-test\": \"save-as-menu-item\" }, t('Save as')),\n\n      canOverwrite: userCanEdit })),\n\n\n\n    userCanShare &&\n    ___EmotionJSX(ShareMenuItems, {\n      url: url,\n      copyMenuItemTitle: t('Copy dashboard URL'),\n      emailMenuItemTitle: t('Share dashboard by email'),\n      emailSubject: emailSubject,\n      emailBody: emailBody,\n      addSuccessToast: addSuccessToast,\n      addDangerToast: addDangerToast }),\n\n\n    ___EmotionJSX(Menu.Item, {\n      key: MENU_KEYS.REFRESH_DASHBOARD,\n      \"data-test\": \"refresh-dashboard-menu-item\",\n      disabled: isLoading },\n\n    t('Refresh dashboard')),\n\n    ___EmotionJSX(Menu.Divider, null),\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.AUTOREFRESH_MODAL },\n    ___EmotionJSX(RefreshIntervalModal, {\n      refreshFrequency: refreshFrequency,\n      refreshLimit: refreshLimit,\n      refreshWarning: refreshWarning,\n      onChange: this.changeRefreshInterval,\n      editMode: editMode,\n      triggerNode: ___EmotionJSX(\"span\", null, t('Set auto-refresh interval')) })),\n\n\n\n    editMode &&\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.SET_FILTER_MAPPING },\n    ___EmotionJSX(FilterScopeModal, {\n      className: \"m-r-5\",\n      triggerNode: t('Set filter mapping') })),\n\n\n\n\n    editMode &&\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.EDIT_PROPERTIES },\n    t('Edit dashboard properties')),\n\n\n\n    editMode &&\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.EDIT_CSS },\n    ___EmotionJSX(CssEditor, {\n      triggerNode: ___EmotionJSX(\"span\", null, t('Edit CSS')),\n      initialCss: this.state.css,\n      templates: this.state.cssTemplates,\n      onChange: this.changeCss })),\n\n\n\n\n    !editMode &&\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.DOWNLOAD_AS_IMAGE },\n    t('Download as image')),\n\n\n\n    !editMode &&\n    ___EmotionJSX(Menu.Item, { key: MENU_KEYS.TOGGLE_FULLSCREEN },\n    getUrlParam(URL_PARAMS.standalone) ?\n    t('Exit fullscreen') :\n    t('Enter fullscreen')));\n\n\n\n\n    return (\n      ___EmotionJSX(NoAnimationDropdown, {\n        overlay: menu,\n        trigger: ['click'],\n        getPopupContainer: (triggerNode) =>\n        triggerNode.closest('.dashboard-header') },\n\n\n      ___EmotionJSX(DropdownButton, { id: \"save-dash-split-button\", role: \"button\" },\n      ___EmotionJSX(Icon, { name: \"more-horiz\" }))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nHeaderActionsDropdown.propTypes = propTypes;\nHeaderActionsDropdown.defaultProps = defaultProps;const _default =\n\nHeaderActionsDropdown;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/dashboard/components/Header/HeaderActionsDropdown/index.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/dashboard/components/Header/HeaderActionsDropdown/index.jsx\");reactHotLoader.register(MENU_KEYS, \"MENU_KEYS\", \"/app/superset-frontend/src/dashboard/components/Header/HeaderActionsDropdown/index.jsx\");reactHotLoader.register(DropdownButton, \"DropdownButton\", \"/app/superset-frontend/src/dashboard/components/Header/HeaderActionsDropdown/index.jsx\");reactHotLoader.register(SCREENSHOT_NODE_SELECTOR, \"SCREENSHOT_NODE_SELECTOR\", \"/app/superset-frontend/src/dashboard/components/Header/HeaderActionsDropdown/index.jsx\");reactHotLoader.register(HeaderActionsDropdown, \"HeaderActionsDropdown\", \"/app/superset-frontend/src/dashboard/components/Header/HeaderActionsDropdown/index.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/dashboard/components/Header/HeaderActionsDropdown/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/dashboard/components/Header/HeaderActionsDropdown/index.jsx"],"names":["React","PropTypes","styled","SupersetClient","t","Menu","NoAnimationDropdown","Icon","URL_PARAMS","ShareMenuItems","CssEditor","RefreshIntervalModal","SaveModal","injectCustomCss","SAVE_TYPE_NEWDASHBOARD","FilterScopeModal","downloadAsImage","getDashboardUrl","getActiveFilters","getUrlParam","propTypes","addSuccessToast","func","isRequired","addDangerToast","dashboardInfo","object","dashboardId","number","dashboardTitle","string","customCss","colorNamespace","colorScheme","onChange","updateCss","forceRefreshAllCharts","refreshFrequency","shouldPersistRefreshFrequency","bool","setRefreshFrequency","startPeriodicRender","editMode","userCanEdit","userCanShare","userCanSave","isLoading","layout","expandedSlices","onSave","showPropertiesModal","refreshLimit","refreshWarning","lastModifiedTime","defaultProps","undefined","MENU_KEYS","SAVE_MODAL","SHARE_DASHBOARD","REFRESH_DASHBOARD","AUTOREFRESH_MODAL","SET_FILTER_MAPPING","EDIT_PROPERTIES","EDIT_CSS","DOWNLOAD_AS_IMAGE","TOGGLE_FULLSCREEN","DropdownButton","div","theme","gridUnit","SCREENSHOT_NODE_SELECTOR","HeaderActionsDropdown","PureComponent","discardChanges","window","location","reload","constructor","props","state","css","cssTemplates","changeCss","changeRefreshInterval","handleMenuClick","UNSAFE_componentWillMount","get","endpoint","then","json","result","row","value","template_name","label","setState","catch","refreshInterval","isPersistent","key","domEvent","menu","document","querySelector","style","visibility","url","pathname","hash","standalone","replace","render","emailTitle","emailSubject","emailBody","triggerNode","closest"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { styled, SupersetClient, t } from '@superset-ui/core';\n\nimport { Menu, NoAnimationDropdown } from 'src/common/components';\nimport Icon from 'src/components/Icon';\nimport { URL_PARAMS } from 'src/constants';\nimport ShareMenuItems from 'src/dashboard/components/menu/ShareMenuItems';\nimport CssEditor from 'src/dashboard/components/CssEditor';\nimport RefreshIntervalModal from 'src/dashboard/components/RefreshIntervalModal';\nimport SaveModal from 'src/dashboard/components/SaveModal';\nimport injectCustomCss from 'src/dashboard/util/injectCustomCss';\nimport { SAVE_TYPE_NEWDASHBOARD } from 'src/dashboard/util/constants';\nimport FilterScopeModal from 'src/dashboard/components/filterscope/FilterScopeModal';\nimport downloadAsImage from 'src/utils/downloadAsImage';\nimport getDashboardUrl from 'src/dashboard/util/getDashboardUrl';\nimport { getActiveFilters } from 'src/dashboard/util/activeDashboardFilters';\nimport { getUrlParam } from 'src/utils/urlUtils';\n\nconst propTypes = {\n  addSuccessToast: PropTypes.func.isRequired,\n  addDangerToast: PropTypes.func.isRequired,\n  dashboardInfo: PropTypes.object.isRequired,\n  dashboardId: PropTypes.number.isRequired,\n  dashboardTitle: PropTypes.string.isRequired,\n  customCss: PropTypes.string.isRequired,\n  colorNamespace: PropTypes.string,\n  colorScheme: PropTypes.string,\n  onChange: PropTypes.func.isRequired,\n  updateCss: PropTypes.func.isRequired,\n  forceRefreshAllCharts: PropTypes.func.isRequired,\n  refreshFrequency: PropTypes.number.isRequired,\n  shouldPersistRefreshFrequency: PropTypes.bool.isRequired,\n  setRefreshFrequency: PropTypes.func.isRequired,\n  startPeriodicRender: PropTypes.func.isRequired,\n  editMode: PropTypes.bool.isRequired,\n  userCanEdit: PropTypes.bool.isRequired,\n  userCanShare: PropTypes.bool.isRequired,\n  userCanSave: PropTypes.bool.isRequired,\n  isLoading: PropTypes.bool.isRequired,\n  layout: PropTypes.object.isRequired,\n  expandedSlices: PropTypes.object.isRequired,\n  onSave: PropTypes.func.isRequired,\n  showPropertiesModal: PropTypes.func.isRequired,\n  refreshLimit: PropTypes.number,\n  refreshWarning: PropTypes.string,\n  lastModifiedTime: PropTypes.number.isRequired,\n};\n\nconst defaultProps = {\n  colorNamespace: undefined,\n  colorScheme: undefined,\n  refreshLimit: 0,\n  refreshWarning: null,\n};\n\nconst MENU_KEYS = {\n  SAVE_MODAL: 'save-modal',\n  SHARE_DASHBOARD: 'share-dashboard',\n  REFRESH_DASHBOARD: 'refresh-dashboard',\n  AUTOREFRESH_MODAL: 'autorefresh-modal',\n  SET_FILTER_MAPPING: 'set-filter-mapping',\n  EDIT_PROPERTIES: 'edit-properties',\n  EDIT_CSS: 'edit-css',\n  DOWNLOAD_AS_IMAGE: 'download-as-image',\n  TOGGLE_FULLSCREEN: 'toggle-fullscreen',\n};\n\nconst DropdownButton = styled.div`\n  margin-left: ${({ theme }) => theme.gridUnit * 2.5}px;\n`;\n\nconst SCREENSHOT_NODE_SELECTOR = '.dashboard';\n\nclass HeaderActionsDropdown extends React.PureComponent {\n  static discardChanges() {\n    window.location.reload();\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      css: props.customCss,\n      cssTemplates: [],\n    };\n\n    this.changeCss = this.changeCss.bind(this);\n    this.changeRefreshInterval = this.changeRefreshInterval.bind(this);\n    this.handleMenuClick = this.handleMenuClick.bind(this);\n  }\n\n  UNSAFE_componentWillMount() {\n    injectCustomCss(this.state.css);\n\n    SupersetClient.get({ endpoint: '/csstemplateasyncmodelview/api/read' })\n      .then(({ json }) => {\n        const cssTemplates = json.result.map(row => ({\n          value: row.template_name,\n          css: row.css,\n          label: row.template_name,\n        }));\n        this.setState({ cssTemplates });\n      })\n      .catch(() => {\n        this.props.addDangerToast(\n          t('An error occurred while fetching available CSS templates'),\n        );\n      });\n  }\n\n  changeCss(css) {\n    this.setState({ css }, () => {\n      injectCustomCss(css);\n    });\n    this.props.onChange();\n    this.props.updateCss(css);\n  }\n\n  changeRefreshInterval(refreshInterval, isPersistent) {\n    this.props.setRefreshFrequency(refreshInterval, isPersistent);\n    this.props.startPeriodicRender(refreshInterval * 1000);\n  }\n\n  handleMenuClick({ key, domEvent }) {\n    switch (key) {\n      case MENU_KEYS.REFRESH_DASHBOARD:\n        this.props.forceRefreshAllCharts();\n        break;\n      case MENU_KEYS.EDIT_PROPERTIES:\n        this.props.showPropertiesModal();\n        break;\n      case MENU_KEYS.DOWNLOAD_AS_IMAGE: {\n        // menu closes with a delay, we need to hide it manually,\n        // so that we don't capture it on the screenshot\n        const menu = document.querySelector(\n          '.ant-dropdown:not(.ant-dropdown-hidden)',\n        );\n        menu.style.visibility = 'hidden';\n        downloadAsImage(\n          SCREENSHOT_NODE_SELECTOR,\n          this.props.dashboardTitle,\n        )(domEvent).then(() => {\n          menu.style.visibility = 'visible';\n        });\n        break;\n      }\n      case MENU_KEYS.TOGGLE_FULLSCREEN: {\n        const url = getDashboardUrl(\n          window.location.pathname,\n          getActiveFilters(),\n          window.location.hash,\n          !getUrlParam(URL_PARAMS.standalone),\n        );\n        window.location.replace(url);\n        break;\n      }\n      default:\n        break;\n    }\n  }\n\n  render() {\n    const {\n      dashboardTitle,\n      dashboardId,\n      dashboardInfo,\n      refreshFrequency,\n      shouldPersistRefreshFrequency,\n      editMode,\n      customCss,\n      colorNamespace,\n      colorScheme,\n      layout,\n      expandedSlices,\n      onSave,\n      userCanEdit,\n      userCanShare,\n      userCanSave,\n      isLoading,\n      refreshLimit,\n      refreshWarning,\n      lastModifiedTime,\n      addSuccessToast,\n      addDangerToast,\n    } = this.props;\n\n    const emailTitle = t('Superset dashboard');\n    const emailSubject = `${emailTitle} ${dashboardTitle}`;\n    const emailBody = t('Check out this dashboard: ');\n    const url = getDashboardUrl(\n      window.location.pathname,\n      getActiveFilters(),\n      window.location.hash,\n    );\n\n    const menu = (\n      <Menu\n        onClick={this.handleMenuClick}\n        selectable={false}\n        data-test=\"header-actions-menu\"\n      >\n        {userCanSave && (\n          <Menu.Item key={MENU_KEYS.SAVE_MODAL}>\n            <SaveModal\n              addSuccessToast={this.props.addSuccessToast}\n              addDangerToast={this.props.addDangerToast}\n              dashboardId={dashboardId}\n              dashboardTitle={dashboardTitle}\n              dashboardInfo={dashboardInfo}\n              saveType={SAVE_TYPE_NEWDASHBOARD}\n              layout={layout}\n              expandedSlices={expandedSlices}\n              refreshFrequency={refreshFrequency}\n              shouldPersistRefreshFrequency={shouldPersistRefreshFrequency}\n              lastModifiedTime={lastModifiedTime}\n              customCss={customCss}\n              colorNamespace={colorNamespace}\n              colorScheme={colorScheme}\n              onSave={onSave}\n              triggerNode={\n                <span data-test=\"save-as-menu-item\">{t('Save as')}</span>\n              }\n              canOverwrite={userCanEdit}\n            />\n          </Menu.Item>\n        )}\n        {userCanShare && (\n          <ShareMenuItems\n            url={url}\n            copyMenuItemTitle={t('Copy dashboard URL')}\n            emailMenuItemTitle={t('Share dashboard by email')}\n            emailSubject={emailSubject}\n            emailBody={emailBody}\n            addSuccessToast={addSuccessToast}\n            addDangerToast={addDangerToast}\n          />\n        )}\n        <Menu.Item\n          key={MENU_KEYS.REFRESH_DASHBOARD}\n          data-test=\"refresh-dashboard-menu-item\"\n          disabled={isLoading}\n        >\n          {t('Refresh dashboard')}\n        </Menu.Item>\n        <Menu.Divider />\n        <Menu.Item key={MENU_KEYS.AUTOREFRESH_MODAL}>\n          <RefreshIntervalModal\n            refreshFrequency={refreshFrequency}\n            refreshLimit={refreshLimit}\n            refreshWarning={refreshWarning}\n            onChange={this.changeRefreshInterval}\n            editMode={editMode}\n            triggerNode={<span>{t('Set auto-refresh interval')}</span>}\n          />\n        </Menu.Item>\n\n        {editMode && (\n          <Menu.Item key={MENU_KEYS.SET_FILTER_MAPPING}>\n            <FilterScopeModal\n              className=\"m-r-5\"\n              triggerNode={t('Set filter mapping')}\n            />\n          </Menu.Item>\n        )}\n\n        {editMode && (\n          <Menu.Item key={MENU_KEYS.EDIT_PROPERTIES}>\n            {t('Edit dashboard properties')}\n          </Menu.Item>\n        )}\n\n        {editMode && (\n          <Menu.Item key={MENU_KEYS.EDIT_CSS}>\n            <CssEditor\n              triggerNode={<span>{t('Edit CSS')}</span>}\n              initialCss={this.state.css}\n              templates={this.state.cssTemplates}\n              onChange={this.changeCss}\n            />\n          </Menu.Item>\n        )}\n\n        {!editMode && (\n          <Menu.Item key={MENU_KEYS.DOWNLOAD_AS_IMAGE}>\n            {t('Download as image')}\n          </Menu.Item>\n        )}\n\n        {!editMode && (\n          <Menu.Item key={MENU_KEYS.TOGGLE_FULLSCREEN}>\n            {getUrlParam(URL_PARAMS.standalone)\n              ? t('Exit fullscreen')\n              : t('Enter fullscreen')}\n          </Menu.Item>\n        )}\n      </Menu>\n    );\n    return (\n      <NoAnimationDropdown\n        overlay={menu}\n        trigger={['click']}\n        getPopupContainer={triggerNode =>\n          triggerNode.closest('.dashboard-header')\n        }\n      >\n        <DropdownButton id=\"save-dash-split-button\" role=\"button\">\n          <Icon name=\"more-horiz\" />\n        </DropdownButton>\n      </NoAnimationDropdown>\n    );\n  }\n}\n\nHeaderActionsDropdown.propTypes = propTypes;\nHeaderActionsDropdown.defaultProps = defaultProps;\n\nexport default HeaderActionsDropdown;\n"]},"metadata":{},"sourceType":"module"}