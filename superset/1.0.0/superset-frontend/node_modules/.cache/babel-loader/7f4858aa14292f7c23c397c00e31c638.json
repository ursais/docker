{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _someInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/some\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _Array$isArray from \"@babel/runtime-corejs3/core-js-stable/array/is-array\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _findInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { NativeSelect as Select } from 'src/components/Select';\nimport { t, SupersetClient, styled } from '@superset-ui/core';\nimport { Operators, OPERATORS_OPTIONS, TABLE_ONLY_OPERATORS, DRUID_ONLY_OPERATORS, HAVING_OPERATORS, MULTI_OPERATORS, CUSTOM_OPERATORS, DISABLE_INPUT_OPERATORS, OPERATOR_ENUM_TO_OPERATOR_TYPE } from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport { EXPRESSION_TYPES, CLAUSES } from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Input } from 'src/common/components';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst SelectWithLabel = styled(Select)`\n  .ant-select-selector {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n  }\n\n  .ant-select-selector::after {\n    content: '${pr => pr.labelText || '\\\\A0'}';\n    display: inline-block;\n    white-space: nowrap;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n    width: max-content;\n  }\n`;\nexport const useSimpleTabFilterProps = props => {\n  const isOperatorRelevant = (operator, subject) => {var _props$datasource$col;\n    const column = (_props$datasource$col = props.datasource.columns) == null ? void 0 : _findInstanceProperty(_props$datasource$col).call(_props$datasource$col, col => col.column_name === subject);\n    const isColumnBoolean = !!column && (column.type === 'BOOL' || column.type === 'BOOLEAN');\n    const isColumnNumber = !!column && (column.type === 'INT' || column.type === 'INTEGER');\n    const isColumnFunction = !!column && !!column.expression;\n    if (operator && CUSTOM_OPERATORS.has(operator)) {\n      const { partitionColumn } = props;\n      return partitionColumn && subject && subject === partitionColumn;\n    }\n    if (operator === Operators.IS_TRUE || operator === Operators.IS_FALSE) {\n      return isColumnBoolean || isColumnNumber || isColumnFunction;\n    }\n    if (isColumnBoolean) {\n      return operator === Operators.IS_NULL || operator === Operators.IS_NOT_NULL;\n    }\n    return !(props.datasource.type === 'druid' &&\n    _indexOfInstanceProperty(TABLE_ONLY_OPERATORS).call(TABLE_ONLY_OPERATORS, operator) >= 0 ||\n    props.datasource.type === 'table' &&\n    _indexOfInstanceProperty(DRUID_ONLY_OPERATORS).call(DRUID_ONLY_OPERATORS, operator) >= 0 ||\n    props.adhocFilter.clause === CLAUSES.HAVING &&\n    _indexOfInstanceProperty(HAVING_OPERATORS).call(HAVING_OPERATORS, operator) === -1);\n  };\n  const onSubjectChange = id => {var _context;\n    const option = _findInstanceProperty(_context = props.options).call(_context, option => 'id' in option && option.id === id ||\n    'optionName' in option && option.optionName === id);\n    let subject = '';\n    let clause;\n    // infer the new clause based on what subject was selected.\n    if (option && 'column_name' in option) {\n      subject = option.column_name;\n      clause = CLAUSES.WHERE;\n    } else\n    if (option && 'saved_metric_name' in option) {\n      subject = option.saved_metric_name;\n      clause = CLAUSES.HAVING;\n    } else\n    if (option && option.label) {\n      subject = option.label;\n      clause = CLAUSES.HAVING;\n    }\n    const { operator, operatorId } = props.adhocFilter;\n    props.onChange(props.adhocFilter.duplicateWith({\n      subject,\n      clause,\n      operator: operator && isOperatorRelevant(operatorId, subject) ?\n      OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation :\n      null,\n      expressionType: EXPRESSION_TYPES.SIMPLE,\n      operatorId }));\n\n  };\n  const onOperatorChange = operatorId => {\n    const currentComparator = props.adhocFilter.comparator;\n    let newComparator;\n    // convert between list of comparators and individual comparators\n    // (e.g. `in ('North America', 'Africa')` to `== 'North America'`)\n    if (MULTI_OPERATORS.has(operatorId)) {var _context2;\n      newComparator = _Array$isArray(currentComparator) ?\n      currentComparator :\n      _filterInstanceProperty(_context2 = [currentComparator]).call(_context2, element => element);\n    } else\n    {\n      newComparator = _Array$isArray(currentComparator) ?\n      currentComparator[0] :\n      currentComparator;\n    }\n    if (operatorId === Operators.IS_TRUE || operatorId === Operators.IS_FALSE) {\n      newComparator = Operators.IS_TRUE === operatorId;\n    }\n    if (operatorId && CUSTOM_OPERATORS.has(operatorId)) {\n      props.onChange(props.adhocFilter.duplicateWith({\n        subject: props.adhocFilter.subject,\n        clause: CLAUSES.WHERE,\n        operatorId,\n        operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n        expressionType: EXPRESSION_TYPES.SQL,\n        datasource: props.datasource }));\n\n    } else\n    {\n      props.onChange(props.adhocFilter.duplicateWith({\n        operatorId,\n        operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n        comparator: newComparator,\n        expressionType: EXPRESSION_TYPES.SIMPLE }));\n\n    }\n  };\n  const onComparatorChange = comparator => {\n    props.onChange(props.adhocFilter.duplicateWith({\n      comparator,\n      expressionType: EXPRESSION_TYPES.SIMPLE }));\n\n  };\n  return {\n    onSubjectChange,\n    onOperatorChange,\n    onComparatorChange,\n    isOperatorRelevant };\n\n};\nconst AdhocFilterEditPopoverSimpleTabContent = props => {var _OPERATOR_ENUM_TO_OPE, _context6;\n  const selectProps = {\n    name: 'select-column',\n    showSearch: true };\n\n  const { onSubjectChange, onOperatorChange, isOperatorRelevant, onComparatorChange } = useSimpleTabFilterProps(props);\n  const [suggestions, setSuggestions] = useState([]);\n  const [currentSuggestionSearch, setCurrentSuggestionSearch] = useState('');\n  const [loadingComparatorSuggestions, setLoadingComparatorSuggestions] = useState(false);\n  useEffect(() => {\n    const refreshComparatorSuggestions = () => {\n      const { datasource } = props;\n      const col = props.adhocFilter.subject;\n      const having = props.adhocFilter.clause === CLAUSES.HAVING;\n      if (col && datasource && datasource.filter_select && !having) {\n        const controller = new AbortController();\n        const { signal } = controller;\n        if (loadingComparatorSuggestions) {\n          controller.abort();\n        }\n        setLoadingComparatorSuggestions(true);\n        SupersetClient.get({\n          signal,\n          endpoint: `/superset/filter/${datasource.type}/${datasource.id}/${col}/` }).\n\n        then(({ json }) => {\n          setSuggestions(json);\n          setLoadingComparatorSuggestions(false);\n        }).\n        catch(() => {\n          setSuggestions([]);\n          setLoadingComparatorSuggestions(false);\n        });\n      }\n    };\n    refreshComparatorSuggestions();\n  }, [props.adhocFilter.subject]);\n  const onInputComparatorChange = event => {\n    onComparatorChange(event.target.value);\n  };\n  const renderSubjectOptionLabel = option => ___EmotionJSX(FilterDefinitionOption, { option: option });\n  const clearSuggestionSearch = () => {\n    setCurrentSuggestionSearch('');\n  };\n  const getOptionsRemaining = () => {var _ref;\n    const { comparator } = props.adhocFilter;\n    // if select is multi/value is array, we show the options not selected\n    const valuesFromSuggestionsLength = _Array$isArray(comparator) ?\n    _filterInstanceProperty(comparator).call(comparator, v => _includesInstanceProperty(suggestions).call(suggestions, v)).length :\n    0;\n    return (_ref = (suggestions == null ? void 0 : suggestions.length) - valuesFromSuggestionsLength) != null ? _ref : 0;\n  };\n  const createSuggestionsPlaceholder = () => {\n    const optionsRemaining = getOptionsRemaining();\n    const placeholder = t('%s option(s)', optionsRemaining);\n    return optionsRemaining ? placeholder : '';\n  };\n  let columns = props.options;\n  const { subject, operator, comparator, operatorId } = props.adhocFilter;\n  const subjectSelectProps = {\n    value: subject != null ? subject : undefined,\n    onChange: onSubjectChange,\n    notFoundContent: t('No such column found. To filter on a metric, try the Custom SQL tab.'),\n    autoFocus: !subject,\n    placeholder: '' };\n\n  if (props.datasource.type === 'druid') {\n    subjectSelectProps.placeholder = t('%s column(s) and metric(s)', columns.length);\n  } else\n  {var _context3;\n    // we cannot support simple ad-hoc filters for metrics because we don't know what type\n    // the value should be cast to (without knowing the output type of the aggregate, which\n    // becomes a rather complicated problem)\n    subjectSelectProps.placeholder =\n    props.adhocFilter.clause === CLAUSES.WHERE ?\n    t('%s column(s)', columns.length) :\n    t('To filter on a metric, use Custom SQL tab.');\n    columns = _filterInstanceProperty(_context3 = props.options).call(_context3, option => 'column_name' in option && option.column_name);\n  }\n  const operatorSelectProps = {\n    placeholder: t('%s operator(s)', _filterInstanceProperty(OPERATORS_OPTIONS).call(OPERATORS_OPTIONS, op => isOperatorRelevant(op, subject)).length),\n    value: (_OPERATOR_ENUM_TO_OPE = OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId]) == null ? void 0 : _OPERATOR_ENUM_TO_OPE.display,\n    onChange: onOperatorChange,\n    autoFocus: !!subjectSelectProps.value && !operator,\n    name: 'select-operator' };\n\n  const shouldFocusComparator = !!subjectSelectProps.value && !!operatorSelectProps.value;\n  const comparatorSelectProps = {\n    allowClear: true,\n    showSearch: true,\n    mode: MULTI_OPERATORS.has(operatorId) ? 'tags' : undefined,\n    tokenSeparators: [',', '\\n', '\\t', ';'],\n    loading: loadingComparatorSuggestions,\n    value: comparator,\n    onChange: onComparatorChange,\n    notFoundContent: t('Type a value here'),\n    disabled: _includesInstanceProperty(DISABLE_INPUT_OPERATORS).call(DISABLE_INPUT_OPERATORS, operatorId),\n    placeholder: createSuggestionsPlaceholder(),\n    labelText: comparator && comparator.length > 0 && createSuggestionsPlaceholder(),\n    autoFocus: shouldFocusComparator };\n\n  return ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(Select, _extends({ css: theme => ({\n      marginTop: theme.gridUnit * 4,\n      marginBottom: theme.gridUnit * 4 }) },\n  selectProps, subjectSelectProps, { filterOption: (input, option) => {var _context4;return option && option.filterBy ?\n      _indexOfInstanceProperty(_context4 = option.filterBy.toLowerCase()).call(_context4, input.toLowerCase()) >= 0 :\n      false;}, getPopupContainer: triggerNode => triggerNode.parentNode }),\n  _mapInstanceProperty(columns).call(columns, column => ___EmotionJSX(Select.Option, { value: 'id' in column && column.id ||\n    'optionName' in column && column.optionName ||\n    '', filterBy: 'saved_metric_name' in column && column.saved_metric_name ||\n    'column_name' in column && column.column_name ||\n    'label' in column && column.label, key: 'id' in column && column.id ||\n    'optionName' in column && column.optionName ||\n    undefined },\n  renderSubjectOptionLabel(column)))),\n\n\n  ___EmotionJSX(Select, _extends({ css: theme => ({ marginBottom: theme.gridUnit * 4 }) }, selectProps, operatorSelectProps, { filterOption: (input, option) => {var _context5;return option && option.children ?\n      _indexOfInstanceProperty(_context5 = option.children.toLowerCase()).call(_context5, input.toLowerCase()) >= 0 :\n      false;}, getPopupContainer: triggerNode => triggerNode.parentNode }),\n  _mapInstanceProperty(_context6 = _filterInstanceProperty(OPERATORS_OPTIONS).call(OPERATORS_OPTIONS, op => isOperatorRelevant(op, subject))).call(_context6, option => ___EmotionJSX(Select.Option, { value: option, key: option },\n  OPERATOR_ENUM_TO_OPERATOR_TYPE[option].display))),\n\n\n  MULTI_OPERATORS.has(operatorId) || suggestions.length > 0 ? ___EmotionJSX(SelectWithLabel, _extends({ \"data-test\": \"adhoc-filter-simple-value\" }, comparatorSelectProps, { getPopupContainer: triggerNode => triggerNode.parentNode, onSearch: val => setCurrentSuggestionSearch(val), onSelect: clearSuggestionSearch, onBlur: clearSuggestionSearch }),\n  _mapInstanceProperty(suggestions).call(suggestions, suggestion => ___EmotionJSX(Select.Option, { value: suggestion, key: suggestion },\n  suggestion)),\n\n\n\n  currentSuggestionSearch &&\n  !_someInstanceProperty(suggestions).call(suggestions, suggestion => suggestion === currentSuggestionSearch) && ___EmotionJSX(Select.Option, { value: currentSuggestionSearch },\n  currentSuggestionSearch)) :\n\n  ___EmotionJSX(Input, { \"data-test\": \"adhoc-filter-simple-value\", name: \"filter-value\", ref: ref => {\n      if (ref && shouldFocusComparator) {\n        ref.blur();\n      }\n    }, onChange: onInputComparatorChange, value: comparator, placeholder: t('Filter value (case sensitive)'), disabled: _includesInstanceProperty(DISABLE_INPUT_OPERATORS).call(DISABLE_INPUT_OPERATORS, operatorId) }));\n\n};__signature__(AdhocFilterEditPopoverSimpleTabContent, \"useSimpleTabFilterProps{{ onSubjectChange, onOperatorChange, isOperatorRelevant, onComparatorChange, }}\\nuseState{[suggestions, setSuggestions]([])}\\nuseState{[currentSuggestionSearch, setCurrentSuggestionSearch]('')}\\nuseState{[loadingComparatorSuggestions, setLoadingComparatorSuggestions,](false)}\\nuseEffect{}\", () => [useSimpleTabFilterProps]);const _default =\nAdhocFilterEditPopoverSimpleTabContent;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(SelectWithLabel, \"SelectWithLabel\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/index.tsx\");reactHotLoader.register(useSimpleTabFilterProps, \"useSimpleTabFilterProps\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/index.tsx\");reactHotLoader.register(AdhocFilterEditPopoverSimpleTabContent, \"AdhocFilterEditPopoverSimpleTabContent\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/index.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/index.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { NativeSelect as Select } from 'src/components/Select';\nimport { t, SupersetClient, styled } from '@superset-ui/core';\nimport {\n  Operators,\n  OPERATORS_OPTIONS,\n  TABLE_ONLY_OPERATORS,\n  DRUID_ONLY_OPERATORS,\n  HAVING_OPERATORS,\n  MULTI_OPERATORS,\n  CUSTOM_OPERATORS,\n  DISABLE_INPUT_OPERATORS,\n  AGGREGATES,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n  CLAUSES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Input, SelectProps } from 'src/common/components';\n\nconst SelectWithLabel = styled(Select)`\n  .ant-select-selector {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n  }\n\n  .ant-select-selector::after {\n    content: '${(\n      pr: SelectProps<any> & {\n        labelText: string | boolean;\n      },\n    ) => pr.labelText || '\\\\A0'}';\n    display: inline-block;\n    white-space: nowrap;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n    width: max-content;\n  }\n`;\n\nexport interface SimpleColumnType {\n  id: number;\n  column_name: string;\n  expression?: string;\n  type: string;\n  optionName?: string;\n  filterBy?: string;\n  value?: string;\n}\n\nexport interface SimpleExpressionType {\n  expressionType: keyof typeof EXPRESSION_TYPES;\n  column: SimpleColumnType;\n  aggregate: keyof typeof AGGREGATES;\n  label: string;\n}\nexport interface SQLExpressionType {\n  expressionType: keyof typeof EXPRESSION_TYPES;\n  sqlExpression: string;\n  label: string;\n}\n\nexport interface MetricColumnType {\n  saved_metric_name: string;\n}\n\nexport type ColumnType =\n  | SimpleColumnType\n  | SimpleExpressionType\n  | SQLExpressionType\n  | MetricColumnType;\n\nexport interface Props {\n  adhocFilter: AdhocFilter;\n  onChange: (filter: AdhocFilter) => void;\n  options: ColumnType[];\n  datasource: {\n    id: string;\n    columns: SimpleColumnType[];\n    type: string;\n    filter_select: boolean;\n  };\n  partitionColumn: string;\n}\nexport const useSimpleTabFilterProps = (props: Props) => {\n  const isOperatorRelevant = (operator: Operators, subject: string) => {\n    const column = props.datasource.columns?.find(\n      col => col.column_name === subject,\n    );\n    const isColumnBoolean =\n      !!column && (column.type === 'BOOL' || column.type === 'BOOLEAN');\n    const isColumnNumber =\n      !!column && (column.type === 'INT' || column.type === 'INTEGER');\n    const isColumnFunction = !!column && !!column.expression;\n\n    if (operator && CUSTOM_OPERATORS.has(operator)) {\n      const { partitionColumn } = props;\n      return partitionColumn && subject && subject === partitionColumn;\n    }\n    if (operator === Operators.IS_TRUE || operator === Operators.IS_FALSE) {\n      return isColumnBoolean || isColumnNumber || isColumnFunction;\n    }\n    if (isColumnBoolean) {\n      return (\n        operator === Operators.IS_NULL || operator === Operators.IS_NOT_NULL\n      );\n    }\n    return !(\n      (props.datasource.type === 'druid' &&\n        TABLE_ONLY_OPERATORS.indexOf(operator) >= 0) ||\n      (props.datasource.type === 'table' &&\n        DRUID_ONLY_OPERATORS.indexOf(operator) >= 0) ||\n      (props.adhocFilter.clause === CLAUSES.HAVING &&\n        HAVING_OPERATORS.indexOf(operator) === -1)\n    );\n  };\n  const onSubjectChange = (id: string | number) => {\n    const option = props.options.find(\n      option =>\n        ('id' in option && option.id === id) ||\n        ('optionName' in option && option.optionName === id),\n    );\n\n    let subject = '';\n    let clause;\n    // infer the new clause based on what subject was selected.\n    if (option && 'column_name' in option) {\n      subject = option.column_name;\n      clause = CLAUSES.WHERE;\n    } else if (option && 'saved_metric_name' in option) {\n      subject = option.saved_metric_name;\n      clause = CLAUSES.HAVING;\n    } else if (option && option.label) {\n      subject = option.label;\n      clause = CLAUSES.HAVING;\n    }\n    const { operator, operatorId } = props.adhocFilter;\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        subject,\n        clause,\n        operator:\n          operator && isOperatorRelevant(operatorId, subject)\n            ? OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation\n            : null,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n        operatorId,\n      }),\n    );\n  };\n  const onOperatorChange = (operatorId: Operators) => {\n    const currentComparator = props.adhocFilter.comparator;\n    let newComparator;\n    // convert between list of comparators and individual comparators\n    // (e.g. `in ('North America', 'Africa')` to `== 'North America'`)\n    if (MULTI_OPERATORS.has(operatorId)) {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator\n        : [currentComparator].filter(element => element);\n    } else {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator[0]\n        : currentComparator;\n    }\n    if (operatorId === Operators.IS_TRUE || operatorId === Operators.IS_FALSE) {\n      newComparator = Operators.IS_TRUE === operatorId;\n    }\n    if (operatorId && CUSTOM_OPERATORS.has(operatorId)) {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          subject: props.adhocFilter.subject,\n          clause: CLAUSES.WHERE,\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          expressionType: EXPRESSION_TYPES.SQL,\n          datasource: props.datasource,\n        }),\n      );\n    } else {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          comparator: newComparator,\n          expressionType: EXPRESSION_TYPES.SIMPLE,\n        }),\n      );\n    }\n  };\n  const onComparatorChange = (comparator: string) => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        comparator,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    );\n  };\n  return {\n    onSubjectChange,\n    onOperatorChange,\n    onComparatorChange,\n    isOperatorRelevant,\n  };\n};\n\nconst AdhocFilterEditPopoverSimpleTabContent: React.FC<Props> = props => {\n  const selectProps = {\n    name: 'select-column',\n    showSearch: true,\n  };\n  const {\n    onSubjectChange,\n    onOperatorChange,\n    isOperatorRelevant,\n    onComparatorChange,\n  } = useSimpleTabFilterProps(props);\n  const [suggestions, setSuggestions] = useState<Record<string, any>>([]);\n  const [currentSuggestionSearch, setCurrentSuggestionSearch] = useState('');\n  const [\n    loadingComparatorSuggestions,\n    setLoadingComparatorSuggestions,\n  ] = useState(false);\n\n  useEffect(() => {\n    const refreshComparatorSuggestions = () => {\n      const { datasource } = props;\n      const col = props.adhocFilter.subject;\n      const having = props.adhocFilter.clause === CLAUSES.HAVING;\n\n      if (col && datasource && datasource.filter_select && !having) {\n        const controller = new AbortController();\n        const { signal } = controller;\n        if (loadingComparatorSuggestions) {\n          controller.abort();\n        }\n        setLoadingComparatorSuggestions(true);\n        SupersetClient.get({\n          signal,\n          endpoint: `/superset/filter/${datasource.type}/${datasource.id}/${col}/`,\n        })\n          .then(({ json }) => {\n            setSuggestions(json);\n            setLoadingComparatorSuggestions(false);\n          })\n          .catch(() => {\n            setSuggestions([]);\n            setLoadingComparatorSuggestions(false);\n          });\n      }\n    };\n    refreshComparatorSuggestions();\n  }, [props.adhocFilter.subject]);\n\n  const onInputComparatorChange = (\n    event: React.ChangeEvent<HTMLInputElement>,\n  ) => {\n    onComparatorChange(event.target.value);\n  };\n\n  const renderSubjectOptionLabel = (option: ColumnType) => (\n    <FilterDefinitionOption option={option} />\n  );\n\n  const clearSuggestionSearch = () => {\n    setCurrentSuggestionSearch('');\n  };\n\n  const getOptionsRemaining = () => {\n    const { comparator } = props.adhocFilter;\n    // if select is multi/value is array, we show the options not selected\n    const valuesFromSuggestionsLength = Array.isArray(comparator)\n      ? comparator.filter(v => suggestions.includes(v)).length\n      : 0;\n    return suggestions?.length - valuesFromSuggestionsLength ?? 0;\n  };\n  const createSuggestionsPlaceholder = () => {\n    const optionsRemaining = getOptionsRemaining();\n    const placeholder = t('%s option(s)', optionsRemaining);\n    return optionsRemaining ? placeholder : '';\n  };\n\n  let columns = props.options;\n  const { subject, operator, comparator, operatorId } = props.adhocFilter;\n  const subjectSelectProps = {\n    value: subject ?? undefined,\n    onChange: onSubjectChange,\n    notFoundContent: t(\n      'No such column found. To filter on a metric, try the Custom SQL tab.',\n    ),\n    autoFocus: !subject,\n    placeholder: '',\n  };\n\n  if (props.datasource.type === 'druid') {\n    subjectSelectProps.placeholder = t(\n      '%s column(s) and metric(s)',\n      columns.length,\n    );\n  } else {\n    // we cannot support simple ad-hoc filters for metrics because we don't know what type\n    // the value should be cast to (without knowing the output type of the aggregate, which\n    // becomes a rather complicated problem)\n    subjectSelectProps.placeholder =\n      props.adhocFilter.clause === CLAUSES.WHERE\n        ? t('%s column(s)', columns.length)\n        : t('To filter on a metric, use Custom SQL tab.');\n    columns = props.options.filter(\n      option => 'column_name' in option && option.column_name,\n    );\n  }\n\n  const operatorSelectProps = {\n    placeholder: t(\n      '%s operator(s)',\n      OPERATORS_OPTIONS.filter(op => isOperatorRelevant(op, subject)).length,\n    ),\n    value: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId]?.display,\n    onChange: onOperatorChange,\n    autoFocus: !!subjectSelectProps.value && !operator,\n    name: 'select-operator',\n  };\n\n  const shouldFocusComparator =\n    !!subjectSelectProps.value && !!operatorSelectProps.value;\n\n  const comparatorSelectProps: SelectProps<any> & {\n    labelText: string | boolean;\n  } = {\n    allowClear: true,\n    showSearch: true,\n    mode: MULTI_OPERATORS.has(operatorId) ? 'tags' : undefined,\n    tokenSeparators: [',', '\\n', '\\t', ';'],\n    loading: loadingComparatorSuggestions,\n    value: comparator,\n    onChange: onComparatorChange,\n    notFoundContent: t('Type a value here'),\n    disabled: DISABLE_INPUT_OPERATORS.includes(operatorId),\n    placeholder: createSuggestionsPlaceholder(),\n    labelText:\n      comparator && comparator.length > 0 && createSuggestionsPlaceholder(),\n    autoFocus: shouldFocusComparator,\n  };\n\n  return (\n    <>\n      <Select\n        css={theme => ({\n          marginTop: theme.gridUnit * 4,\n          marginBottom: theme.gridUnit * 4,\n        })}\n        {...selectProps}\n        {...subjectSelectProps}\n        filterOption={(input, option) =>\n          option && option.filterBy\n            ? option.filterBy.toLowerCase().indexOf(input.toLowerCase()) >= 0\n            : false\n        }\n        getPopupContainer={triggerNode => triggerNode.parentNode}\n      >\n        {columns.map(column => (\n          <Select.Option\n            value={\n              ('id' in column && column.id) ||\n              ('optionName' in column && column.optionName) ||\n              ''\n            }\n            filterBy={\n              ('saved_metric_name' in column && column.saved_metric_name) ||\n              ('column_name' in column && column.column_name) ||\n              ('label' in column && column.label)\n            }\n            key={\n              ('id' in column && column.id) ||\n              ('optionName' in column && column.optionName) ||\n              undefined\n            }\n          >\n            {renderSubjectOptionLabel(column)}\n          </Select.Option>\n        ))}\n      </Select>\n      <Select\n        css={theme => ({ marginBottom: theme.gridUnit * 4 })}\n        {...selectProps}\n        {...operatorSelectProps}\n        filterOption={(input, option) =>\n          option && option.children\n            ? option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0\n            : false\n        }\n        getPopupContainer={triggerNode => triggerNode.parentNode}\n      >\n        {OPERATORS_OPTIONS.filter(op => isOperatorRelevant(op, subject)).map(\n          option => (\n            <Select.Option value={option} key={option}>\n              {OPERATOR_ENUM_TO_OPERATOR_TYPE[option].display}\n            </Select.Option>\n          ),\n        )}\n      </Select>\n      {MULTI_OPERATORS.has(operatorId) || suggestions.length > 0 ? (\n        <SelectWithLabel\n          data-test=\"adhoc-filter-simple-value\"\n          {...comparatorSelectProps}\n          getPopupContainer={triggerNode => triggerNode.parentNode}\n          onSearch={val => setCurrentSuggestionSearch(val)}\n          onSelect={clearSuggestionSearch}\n          onBlur={clearSuggestionSearch}\n        >\n          {suggestions.map((suggestion: string) => (\n            <Select.Option value={suggestion} key={suggestion}>\n              {suggestion}\n            </Select.Option>\n          ))}\n\n          {/* enable selecting an option not included in suggestions */}\n          {currentSuggestionSearch &&\n            !suggestions.some(\n              (suggestion: string) => suggestion === currentSuggestionSearch,\n            ) && (\n              <Select.Option value={currentSuggestionSearch}>\n                {currentSuggestionSearch}\n              </Select.Option>\n            )}\n        </SelectWithLabel>\n      ) : (\n        <Input\n          data-test=\"adhoc-filter-simple-value\"\n          name=\"filter-value\"\n          ref={ref => {\n            if (ref && shouldFocusComparator) {\n              ref.blur();\n            }\n          }}\n          onChange={onInputComparatorChange}\n          value={comparator}\n          placeholder={t('Filter value (case sensitive)')}\n          disabled={DISABLE_INPUT_OPERATORS.includes(operatorId)}\n        />\n      )}\n    </>\n  );\n};\n\nexport default AdhocFilterEditPopoverSimpleTabContent;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}