{"ast":null,"code":"import \"core-js/modules/es.string.replace.js\";import \"core-js/modules/web.dom-collections.iterator.js\";import _findInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/find\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _trimInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/trim\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable jsx-a11y/anchor-is-valid */\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React from 'react';\nimport { CSSTransition } from 'react-transition-group';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport { t, styled, supersetTheme } from '@superset-ui/core';\nimport debounce from 'lodash/debounce';\nimport throttle from 'lodash/throttle';\nimport StyledModal from 'src/components/Modal';\nimport Mousetrap from 'mousetrap';\nimport Button from 'src/components/Button';\nimport Timer from 'src/components/Timer';\nimport {\nDropdown,\nMenu as AntdMenu,\nMenu,\nSwitch,\nInput } from\n'src/common/components';\nimport Icon from 'src/components/Icon';\nimport { detectOS } from 'src/utils/common';\nimport {\naddQueryEditor,\nCtasEnum,\nestimateQueryCost,\npersistEditorHeight,\npostStopQuery,\nqueryEditorSetAutorun,\nqueryEditorSetQueryLimit,\nqueryEditorSetSql,\nqueryEditorSetTemplateParams,\nrunQuery,\nsaveQuery,\nscheduleQuery,\nsetActiveSouthPaneTab,\nupdateSavedQuery,\nvalidateQuery } from\n'src/SqlLab/actions/sqlLab';\nimport {\nSTATE_TYPE_MAP,\nSQL_EDITOR_GUTTER_HEIGHT,\nSQL_EDITOR_GUTTER_MARGIN,\nSQL_TOOLBAR_HEIGHT } from\n'src/SqlLab/constants';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport TemplateParamsEditor from './TemplateParamsEditor';\nimport ConnectedSouthPane from './SouthPane/state';\nimport SaveQuery from './SaveQuery';\nimport ScheduleQueryButton from './ScheduleQueryButton';\nimport EstimateQueryCostButton from './EstimateQueryCostButton';\nimport ShareSqlLabQuery from './ShareSqlLabQuery';\nimport SqlEditorLeftBar from './SqlEditorLeftBar';\nimport AceEditorWrapper from './AceEditorWrapper';\nimport RunQueryActionButton from './RunQueryActionButton';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst LIMIT_DROPDOWN = [10, 100, 1000, 10000, 100000];\nconst SQL_EDITOR_PADDING = 10;\nconst INITIAL_NORTH_PERCENT = 30;\nconst INITIAL_SOUTH_PERCENT = 70;\nconst SET_QUERY_EDITOR_SQL_DEBOUNCE_MS = 2000;\nconst VALIDATION_DEBOUNCE_MS = 600;\nconst WINDOW_RESIZE_THROTTLE_MS = 100;\n\nconst LimitSelectStyled = styled.span`\n  .ant-dropdown-trigger {\n    align-items: center;\n    color: black;\n    display: flex;\n    font-size: 12px;\n    margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n    text-decoration: none;\n    span {\n      display: inline-block;\n      margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n      &:last-of-type: {\n        margin-right: ${({ theme }) => theme.gridUnit * 4}px;\n      }\n    }\n  }\n`;\n\nconst StyledToolbar = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 2}px;\n  background-color: @lightest;\n  display: flex;\n  justify-content: space-between;\n  border: 1px solid ${supersetTheme.colors.grayscale.light2};\n  border-top: 0;\n\n  form {\n    margin-block-end: 0;\n  }\n\n  .leftItems,\n  .rightItems {\n    display: flex;\n    align-items: center;\n    & > span {\n      margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n      display: inline-block;\n\n      &:last-child {\n        margin-right: 0;\n      }\n    }\n  }\n`;\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  database: PropTypes.object,\n  latestQuery: PropTypes.object,\n  tables: PropTypes.array.isRequired,\n  editorQueries: PropTypes.array.isRequired,\n  dataPreviewQueries: PropTypes.array.isRequired,\n  queryEditorId: PropTypes.string.isRequired,\n  hideLeftBar: PropTypes.bool,\n  defaultQueryLimit: PropTypes.number.isRequired,\n  maxRow: PropTypes.number.isRequired,\n  displayLimit: PropTypes.number.isRequired,\n  saveQueryWarning: PropTypes.string,\n  scheduleQueryWarning: PropTypes.string };\n\n\nconst defaultProps = {\n  database: null,\n  latestQuery: null,\n  hideLeftBar: false,\n  scheduleQueryWarning: null };\n\n\nclass SqlEditor extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4, _context5, _context6, _context7, _context8, _context9, _context10, _context11, _context12, _context13, _context14, _context15, _context16, _context17;\n    super(props);this.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    handleToggleAutocompleteEnabled = () => {\n      this.setState(prevState => ({\n        autocompleteEnabled: !prevState.autocompleteEnabled }));\n\n    };this.state = { autorun: props.queryEditor.autorun, ctas: '', northPercent: props.queryEditor.northPercent || INITIAL_NORTH_PERCENT, southPercent: props.queryEditor.southPercent || INITIAL_SOUTH_PERCENT, sql: props.queryEditor.sql, autocompleteEnabled: true, showCreateAsModal: false, createAs: '' };this.sqlEditorRef = /*#__PURE__*/React.createRef();this.northPaneRef = /*#__PURE__*/React.createRef();this.elementStyle = _bindInstanceProperty(_context = this.elementStyle).call(_context, this);this.onResizeStart = _bindInstanceProperty(_context2 = this.onResizeStart).call(_context2, this);this.onResizeEnd = _bindInstanceProperty(_context3 = this.onResizeEnd).call(_context3, this);this.canValidateQuery = _bindInstanceProperty(_context4 = this.canValidateQuery).call(_context4, this);this.runQuery = _bindInstanceProperty(_context5 = this.runQuery).call(_context5, this);this.stopQuery = _bindInstanceProperty(_context6 = this.stopQuery).call(_context6, this);this.onSqlChanged = _bindInstanceProperty(_context7 = this.onSqlChanged).call(_context7, this);this.setQueryEditorSql = _bindInstanceProperty(_context8 = this.setQueryEditorSql).call(_context8, this);this.setQueryEditorSqlWithDebounce = debounce(_bindInstanceProperty(_context9 = this.setQueryEditorSql).call(_context9, this), SET_QUERY_EDITOR_SQL_DEBOUNCE_MS);this.queryPane = _bindInstanceProperty(_context10 = this.queryPane).call(_context10, this);this.renderQueryLimit = _bindInstanceProperty(_context11 = this.renderQueryLimit).call(_context11, this);this.getAceEditorAndSouthPaneHeights = _bindInstanceProperty(_context12 = this.getAceEditorAndSouthPaneHeights).call(_context12, this);this.getSqlEditorHeight = _bindInstanceProperty(_context13 = this.getSqlEditorHeight).call(_context13, this);this.requestValidation = debounce(_bindInstanceProperty(_context14 = this.requestValidation).call(_context14, this), VALIDATION_DEBOUNCE_MS);this.getQueryCostEstimate = _bindInstanceProperty(_context15 = this.getQueryCostEstimate).call(_context15, this);this.handleWindowResize = throttle(_bindInstanceProperty(_context16 = this.handleWindowResize).call(_context16, this), WINDOW_RESIZE_THROTTLE_MS);this.renderDropdown = _bindInstanceProperty(_context17 = this.renderDropdown).call(_context17, this);}UNSAFE_componentWillMount() {if (this.state.autorun) {this.setState({ autorun: false });this.props.queryEditorSetAutorun(this.props.queryEditor, false);this.startQuery();}}componentDidMount() {// We need to measure the height of the sql editor post render to figure the height of\n    // the south pane so it gets rendered properly\n    // eslint-disable-next-line react/no-did-mount-set-state\n    this.setState({ height: this.getSqlEditorHeight() });window.addEventListener('resize', this.handleWindowResize); // setup hotkeys\n    const hotkeys = this.getHotkeyConfig();_forEachInstanceProperty(hotkeys).call(hotkeys, keyConfig => {_bindInstanceProperty(Mousetrap).call(Mousetrap, [keyConfig.key], keyConfig.func);});}componentWillUnmount() {window.removeEventListener('resize', this.handleWindowResize);}onResizeStart() {// Set the heights on the ace editor and the ace content area after drag starts\n    // to smooth out the visual transition to the new heights when drag ends\n    document.getElementsByClassName('ace_content')[0].style.height = '100%';}onResizeEnd([northPercent, southPercent]) {this.setState({ northPercent, southPercent });if (this.northPaneRef.current && this.northPaneRef.current.clientHeight) {this.props.persistEditorHeight(this.props.queryEditor, northPercent, southPercent);}}onSqlChanged(sql) {this.setState({ sql });this.setQueryEditorSqlWithDebounce(sql); // Request server-side validation of the query text\n    if (this.canValidateQuery()) {// NB. requestValidation is debounced\n      this.requestValidation();}} // One layer of abstraction for easy spying in unit tests\n  getSqlEditorHeight() {return this.sqlEditorRef.current ? this.sqlEditorRef.current.clientHeight - SQL_EDITOR_PADDING * 2 : 0;} // Return the heights for the ace editor and the south pane as an object\n  // given the height of the sql editor, north pane percent and south pane percent.\n  getAceEditorAndSouthPaneHeights(height, northPercent, southPercent) {return { aceEditorHeight: height * northPercent / 100 - (SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN) - SQL_TOOLBAR_HEIGHT, southPaneHeight: height * southPercent / 100 - (SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN) };}getHotkeyConfig() {// Get the user's OS\n    const userOS = detectOS();return [{ name: 'runQuery1', key: 'ctrl+r', descr: t('Run query'), func: () => {var _context18;if (_trimInstanceProperty(_context18 = this.state.sql).call(_context18) !== '') {this.runQuery();}} }, { name: 'runQuery2', key: 'ctrl+enter', descr: t('Run query'), func: () => {var _context19;if (_trimInstanceProperty(_context19 = this.state.sql).call(_context19) !== '') {this.runQuery();}} }, { name: 'newTab', key: userOS === 'Windows' ? 'ctrl+q' : 'ctrl+t', descr: t('New tab'), func: () => {this.props.addQueryEditor({ ...this.props.queryEditor, title: t('Untitled query'), sql: '' });} }, { name: 'stopQuery', key: 'ctrl+x', descr: t('Stop query'), func: this.stopQuery }];}setQueryEditorSql(sql) {this.props.queryEditorSetSql(this.props.queryEditor, sql);}setQueryLimit(queryLimit) {this.props.queryEditorSetQueryLimit(this.props.queryEditor, queryLimit);}getQueryCostEstimate() {if (this.props.database) {const qe = this.props.queryEditor;const query = { dbId: qe.dbId, sql: qe.selectedText ? qe.selectedText : this.state.sql, sqlEditorId: qe.id, schema: qe.schema, templateParams: qe.templateParams };this.props.estimateQueryCost(query);}}handleWindowResize() {this.setState({ height: this.getSqlEditorHeight() });}elementStyle(dimension, elementSize, gutterSize) {return { [dimension]: `calc(${elementSize}% - ${gutterSize + SQL_EDITOR_GUTTER_MARGIN}px)` };}\n\n  requestValidation() {\n    if (this.props.database) {\n      const qe = this.props.queryEditor;\n      const query = {\n        dbId: qe.dbId,\n        sql: this.state.sql,\n        sqlEditorId: qe.id,\n        schema: qe.schema,\n        templateParams: qe.templateParams };\n\n      this.props.validateQuery(query);\n    }\n  }\n\n  canValidateQuery() {\n    // Check whether or not we can validate the current query based on whether\n    // or not the backend has a validator configured for it.\n    const validatorMap = window.featureFlags.SQL_VALIDATORS_BY_ENGINE;\n    if (this.props.database && validatorMap != null) {\n      return validatorMap.hasOwnProperty(this.props.database.backend);\n    }\n    return false;\n  }\n\n  runQuery() {\n    if (this.props.database) {\n      this.startQuery();\n    }\n  }\n\n  convertToNumWithSpaces(num) {\n    return num.toString().replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, '$1 ');\n  }\n\n  startQuery(ctas = false, ctas_method = CtasEnum.TABLE) {\n    const qe = this.props.queryEditor;\n    const query = {\n      dbId: qe.dbId,\n      sql: qe.selectedText ? qe.selectedText : this.state.sql,\n      sqlEditorId: qe.id,\n      tab: qe.title,\n      schema: qe.schema,\n      tempTable: ctas ? this.state.ctas : '',\n      templateParams: qe.templateParams,\n      queryLimit: qe.queryLimit || this.props.defaultQueryLimit,\n      runAsync: this.props.database ?\n      this.props.database.allow_run_async :\n      false,\n      ctas,\n      ctas_method,\n      updateTabState: !qe.selectedText };\n\n    this.props.runQuery(query);\n    this.props.setActiveSouthPaneTab('Results');\n  }\n\n  stopQuery() {var _context20;\n    if (\n    this.props.latestQuery &&\n    _indexOfInstanceProperty(_context20 = ['running', 'pending']).call(_context20, this.props.latestQuery.state) >= 0)\n    {\n      this.props.postStopQuery(this.props.latestQuery);\n    }\n  }\n\n  createTableAs() {\n    this.startQuery(true, CtasEnum.TABLE);\n    this.setState({ showCreateAsModal: false, ctas: '' });\n  }\n\n  createViewAs() {\n    this.startQuery(true, CtasEnum.VIEW);\n    this.setState({ showCreateAsModal: false, ctas: '' });\n  }\n\n  ctasChanged(event) {\n    this.setState({ ctas: event.target.value });\n  }\n\n  queryPane() {\n    const hotkeys = this.getHotkeyConfig();\n    const {\n      aceEditorHeight,\n      southPaneHeight } =\n    this.getAceEditorAndSouthPaneHeights(\n    this.state.height,\n    this.state.northPercent,\n    this.state.southPercent);\n\n    return (\n      ___EmotionJSX(Split, {\n        expandToMin: true,\n        className: \"queryPane\",\n        sizes: [this.state.northPercent, this.state.southPercent],\n        elementStyle: this.elementStyle,\n        minSize: 200,\n        direction: \"vertical\",\n        gutterSize: SQL_EDITOR_GUTTER_HEIGHT,\n        onDragStart: this.onResizeStart,\n        onDragEnd: this.onResizeEnd },\n\n      ___EmotionJSX(\"div\", { ref: this.northPaneRef, className: \"north-pane\" },\n      ___EmotionJSX(AceEditorWrapper, {\n        actions: this.props.actions,\n        autocomplete: this.state.autocompleteEnabled,\n        onBlur: this.setQueryEditorSql,\n        onChange: this.onSqlChanged,\n        queryEditor: this.props.queryEditor,\n        sql: this.props.queryEditor.sql,\n        schemas: this.props.queryEditor.schemaOptions,\n        tables: this.props.queryEditor.tableOptions,\n        functionNames: this.props.queryEditor.functionNames,\n        extendedTables: this.props.tables,\n        height: `${aceEditorHeight}px`,\n        hotkeys: hotkeys }),\n\n      this.renderEditorBottomBar(hotkeys)),\n\n      ___EmotionJSX(ConnectedSouthPane, {\n        editorQueries: this.props.editorQueries,\n        latestQueryId: this.props.latestQuery && this.props.latestQuery.id,\n        dataPreviewQueries: this.props.dataPreviewQueries,\n        actions: this.props.actions,\n        height: southPaneHeight,\n        displayLimit: this.props.displayLimit,\n        defaultQueryLimit: this.props.defaultQueryLimit })));\n\n\n\n  }\n\n  renderDropdown() {var _this$props$latestQue;\n    const qe = this.props.queryEditor;\n    const successful = ((_this$props$latestQue = this.props.latestQuery) == null ? void 0 : _this$props$latestQue.state) === 'success';\n    const scheduleToolTip = successful ?\n    t('Schedule the query periodically') :\n    t('You must run the query successfully first');\n    return (\n      ___EmotionJSX(Menu, { onClick: this.handleMenuClick, style: { width: 176 } },\n      ___EmotionJSX(Menu.Item, { style: { display: 'flex', justifyContent: 'space-between' } },\n      ' ',\n      ___EmotionJSX(\"span\", null, t('Autocomplete')), ' ',\n      ___EmotionJSX(Switch, {\n        checked: this.state.autocompleteEnabled,\n        onChange: this.handleToggleAutocompleteEnabled,\n        name: \"autocomplete-switch\" }),\n      ' '),\n\n      isFeatureEnabled(FeatureFlag.ENABLE_TEMPLATE_PROCESSING) &&\n      ___EmotionJSX(Menu.Item, null,\n      ___EmotionJSX(TemplateParamsEditor, {\n        language: \"json\",\n        onChange: params => {\n          this.props.actions.queryEditorSetTemplateParams(qe, params);\n        },\n        code: qe.templateParams })),\n\n\n\n      isFeatureEnabled(FeatureFlag.SCHEDULED_QUERIES) &&\n      ___EmotionJSX(Menu.Item, null,\n      ___EmotionJSX(ScheduleQueryButton, {\n        defaultLabel: qe.title,\n        sql: qe.sql,\n        onSchedule: this.props.actions.scheduleQuery,\n        schema: qe.schema,\n        dbId: qe.dbId,\n        scheduleQueryWarning: this.props.scheduleQueryWarning,\n        tooltip: scheduleToolTip,\n        disabled: !successful }))));\n\n\n\n\n\n  }\n\n  renderQueryLimit() {var _context21;\n    // Adding SQL_MAX_ROW value to dropdown\n    const { maxRow } = this.props;\n    LIMIT_DROPDOWN.push(maxRow);\n\n    return (\n      ___EmotionJSX(AntdMenu, null,\n      _mapInstanceProperty(_context21 = [...new _Set(LIMIT_DROPDOWN)]).call(_context21, (limit) =>\n      ___EmotionJSX(AntdMenu.Item, {\n        key: `${limit}`,\n        onClick: () => this.setQueryLimit(limit) },\n\n\n      ___EmotionJSX(\"a\", { role: \"button\", styling: \"link\" },\n      this.convertToNumWithSpaces(limit)),\n      ' '))));\n\n\n\n\n  }\n\n  renderEditorBottomBar() {var _this$props$latestQue2;\n    const { queryEditor: qe } = this.props;\n\n    const { allow_ctas: allowCTAS, allow_cvas: allowCVAS } =\n    this.props.database || {};\n\n    const showMenu = allowCTAS || allowCVAS;\n\n    const runMenuBtn =\n    ___EmotionJSX(Menu, null,\n    allowCTAS &&\n    ___EmotionJSX(Menu.Item, {\n      onClick: () => {\n        this.setState({\n          showCreateAsModal: true,\n          createAs: CtasEnum.TABLE });\n\n      },\n      key: \"1\" },\n\n    t('CREATE TABLE AS')),\n\n\n    allowCVAS &&\n    ___EmotionJSX(Menu.Item, {\n      onClick: () => {\n        this.setState({\n          showCreateAsModal: true,\n          createAs: CtasEnum.VIEW });\n\n      },\n      key: \"2\" },\n\n    t('CREATE VIEW AS')));\n\n\n\n\n    return (\n      ___EmotionJSX(StyledToolbar, { className: \"sql-toolbar\", id: \"js-sql-toolbar\" },\n      ___EmotionJSX(\"div\", { className: \"leftItems\" },\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(RunQueryActionButton, {\n        allowAsync:\n        this.props.database ?\n        this.props.database.allow_run_async :\n        false,\n\n        queryState: (_this$props$latestQue2 = this.props.latestQuery) == null ? void 0 : _this$props$latestQue2.state,\n        runQuery: this.runQuery,\n        selectedText: qe.selectedText,\n        stopQuery: this.stopQuery,\n        sql: this.state.sql,\n        overlayCreateAsMenu: showMenu ? runMenuBtn : null })),\n\n\n      isFeatureEnabled(FeatureFlag.ESTIMATE_QUERY_COST) &&\n      this.props.database &&\n      this.props.database.allows_cost_estimate &&\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(EstimateQueryCostButton, {\n        dbId: qe.dbId,\n        schema: qe.schema,\n        sql: qe.sql,\n        getEstimate: this.getQueryCostEstimate,\n        queryCostEstimate: qe.queryCostEstimate,\n        selectedText: qe.selectedText,\n        tooltip: t('Estimate the cost before running a query') })),\n\n\n\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(LimitSelectStyled, null,\n      ___EmotionJSX(Dropdown, { overlay: this.renderQueryLimit(), trigger: \"click\" },\n      ___EmotionJSX(\"a\", { onClick: e => e.preventDefault() },\n      ___EmotionJSX(\"span\", null, \"LIMIT:\"),\n      ___EmotionJSX(\"span\", null,\n      this.convertToNumWithSpaces(\n      this.props.queryEditor.queryLimit ||\n      this.props.defaultQueryLimit)),\n\n\n      ___EmotionJSX(Icon, { name: \"triangle-down\" }))))),\n\n\n\n\n      this.props.latestQuery &&\n      ___EmotionJSX(Timer, {\n        startTime: this.props.latestQuery.startDttm,\n        endTime: this.props.latestQuery.endDttm,\n        state: STATE_TYPE_MAP[this.props.latestQuery.state],\n        isRunning: this.props.latestQuery.state === 'running' })),\n\n\n\n      ___EmotionJSX(\"div\", { className: \"rightItems\" },\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(SaveQuery, {\n        query: qe,\n        defaultLabel: qe.title || qe.description,\n        onSave: this.props.actions.saveQuery,\n        onUpdate: this.props.actions.updateSavedQuery,\n        saveQueryWarning: this.props.saveQueryWarning })),\n\n\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(ShareSqlLabQuery, { queryEditor: qe })),\n\n      ___EmotionJSX(Dropdown, { overlay: this.renderDropdown(), trigger: \"click\" },\n      ___EmotionJSX(Icon, { name: \"more-horiz\" })))));\n\n\n\n\n  }\n\n  render() {var _context22, _context23, _context24;\n    const createViewModalTitle =\n    this.state.createAs === CtasEnum.VIEW ?\n    'CREATE VIEW AS' :\n    'CREATE TABLE AS';\n\n    const createModalPlaceHolder =\n    this.state.createAs === CtasEnum.VIEW ?\n    'Specify name to CREATE VIEW AS schema in: public' :\n    'Specify name to CREATE TABLE AS schema in: public';\n\n    const leftBarStateClass = this.props.hideLeftBar ?\n    'schemaPane-exit-done' :\n    'schemaPane-enter-done';\n    return (\n      ___EmotionJSX(\"div\", { ref: this.sqlEditorRef, className: \"SqlEditor\" },\n      ___EmotionJSX(CSSTransition, {\n        classNames: \"schemaPane\",\n        in: !this.props.hideLeftBar,\n        timeout: 300 },\n\n      ___EmotionJSX(\"div\", { className: `schemaPane ${leftBarStateClass}` },\n      ___EmotionJSX(SqlEditorLeftBar, {\n        database: this.props.database,\n        queryEditor: this.props.queryEditor,\n        tables: this.props.tables,\n        actions: this.props.actions }))),\n\n\n\n      this.queryPane(),\n      ___EmotionJSX(StyledModal, {\n        visible: this.state.showCreateAsModal,\n        title: t(createViewModalTitle),\n        onHide: () => {\n          this.setState({ showCreateAsModal: false });\n        },\n        footer:\n        ___EmotionJSX(React.Fragment, null,\n        ___EmotionJSX(Button, {\n          onClick: () => this.setState({ showCreateAsModal: false }) }, \"Cancel\"),\n\n\n\n        this.state.createAs === CtasEnum.TABLE &&\n        ___EmotionJSX(Button, {\n          buttonStyle: \"primary\",\n          disabled: this.state.ctas.length === 0,\n          onClick: _bindInstanceProperty(_context22 = this.createTableAs).call(_context22, this) }, \"Create\"),\n\n\n\n\n        this.state.createAs === CtasEnum.VIEW &&\n        ___EmotionJSX(Button, {\n          buttonStyle: \"primary\",\n          disabled: this.state.ctas.length === 0,\n          onClick: _bindInstanceProperty(_context23 = this.createViewAs).call(_context23, this) }, \"Create\")) },\n\n\n\n\n\n\n\n      ___EmotionJSX(\"span\", null, \"Name\"),\n      ___EmotionJSX(Input, {\n        placeholder: createModalPlaceHolder,\n        onChange: _bindInstanceProperty(_context24 = this.ctasChanged).call(_context24, this) }))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}SqlEditor.defaultProps = defaultProps;\nSqlEditor.propTypes = propTypes;\n\nfunction mapStateToProps(state, props) {var _context25;\n  const { sqlLab } = state;\n  const queryEditor = _findInstanceProperty(_context25 = sqlLab.queryEditors).call(_context25,\n  editor => editor.id === props.queryEditorId);\n\n\n  return { sqlLab, ...props, queryEditor };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators(\n  {\n    addQueryEditor,\n    estimateQueryCost,\n    persistEditorHeight,\n    postStopQuery,\n    queryEditorSetAutorun,\n    queryEditorSetQueryLimit,\n    queryEditorSetSql,\n    queryEditorSetTemplateParams,\n    runQuery,\n    saveQuery,\n    scheduleQuery,\n    setActiveSouthPaneTab,\n    updateSavedQuery,\n    validateQuery },\n\n  dispatch);\n\n}const _default =\n\nconnect(mapStateToProps, mapDispatchToProps)(SqlEditor);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(LIMIT_DROPDOWN, \"LIMIT_DROPDOWN\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(SQL_EDITOR_PADDING, \"SQL_EDITOR_PADDING\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(INITIAL_NORTH_PERCENT, \"INITIAL_NORTH_PERCENT\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(INITIAL_SOUTH_PERCENT, \"INITIAL_SOUTH_PERCENT\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(SET_QUERY_EDITOR_SQL_DEBOUNCE_MS, \"SET_QUERY_EDITOR_SQL_DEBOUNCE_MS\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(VALIDATION_DEBOUNCE_MS, \"VALIDATION_DEBOUNCE_MS\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(WINDOW_RESIZE_THROTTLE_MS, \"WINDOW_RESIZE_THROTTLE_MS\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(LimitSelectStyled, \"LimitSelectStyled\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(StyledToolbar, \"StyledToolbar\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(SqlEditor, \"SqlEditor\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/SqlLab/components/SqlEditor.jsx"],"names":["React","CSSTransition","connect","bindActionCreators","PropTypes","Split","t","styled","supersetTheme","debounce","throttle","StyledModal","Mousetrap","Button","Timer","Dropdown","Menu","AntdMenu","Switch","Input","Icon","detectOS","addQueryEditor","CtasEnum","estimateQueryCost","persistEditorHeight","postStopQuery","queryEditorSetAutorun","queryEditorSetQueryLimit","queryEditorSetSql","queryEditorSetTemplateParams","runQuery","saveQuery","scheduleQuery","setActiveSouthPaneTab","updateSavedQuery","validateQuery","STATE_TYPE_MAP","SQL_EDITOR_GUTTER_HEIGHT","SQL_EDITOR_GUTTER_MARGIN","SQL_TOOLBAR_HEIGHT","FeatureFlag","isFeatureEnabled","TemplateParamsEditor","ConnectedSouthPane","SaveQuery","ScheduleQueryButton","EstimateQueryCostButton","ShareSqlLabQuery","SqlEditorLeftBar","AceEditorWrapper","RunQueryActionButton","LIMIT_DROPDOWN","SQL_EDITOR_PADDING","INITIAL_NORTH_PERCENT","INITIAL_SOUTH_PERCENT","SET_QUERY_EDITOR_SQL_DEBOUNCE_MS","VALIDATION_DEBOUNCE_MS","WINDOW_RESIZE_THROTTLE_MS","LimitSelectStyled","span","theme","gridUnit","StyledToolbar","div","colors","grayscale","light2","propTypes","actions","object","isRequired","database","latestQuery","tables","array","editorQueries","dataPreviewQueries","queryEditorId","string","hideLeftBar","bool","defaultQueryLimit","number","maxRow","displayLimit","saveQueryWarning","scheduleQueryWarning","defaultProps","SqlEditor","PureComponent","constructor","props","handleToggleAutocompleteEnabled","setState","prevState","autocompleteEnabled","state","autorun","queryEditor","ctas","northPercent","southPercent","sql","showCreateAsModal","createAs","sqlEditorRef","createRef","northPaneRef","elementStyle","onResizeStart","onResizeEnd","canValidateQuery","stopQuery","onSqlChanged","setQueryEditorSql","setQueryEditorSqlWithDebounce","queryPane","renderQueryLimit","getAceEditorAndSouthPaneHeights","getSqlEditorHeight","requestValidation","getQueryCostEstimate","handleWindowResize","renderDropdown","UNSAFE_componentWillMount","startQuery","componentDidMount","height","window","addEventListener","hotkeys","getHotkeyConfig","keyConfig","key","func","componentWillUnmount","removeEventListener","document","getElementsByClassName","style","current","clientHeight","aceEditorHeight","southPaneHeight","userOS","name","descr","title","setQueryLimit","queryLimit","qe","query","dbId","selectedText","sqlEditorId","id","schema","templateParams","dimension","elementSize","gutterSize","validatorMap","featureFlags","SQL_VALIDATORS_BY_ENGINE","hasOwnProperty","backend","convertToNumWithSpaces","num","toString","replace","ctas_method","TABLE","tab","tempTable","runAsync","allow_run_async","updateTabState","createTableAs","createViewAs","VIEW","ctasChanged","event","target","value","schemaOptions","tableOptions","functionNames","renderEditorBottomBar","successful","scheduleToolTip","handleMenuClick","width","display","justifyContent","ENABLE_TEMPLATE_PROCESSING","params","SCHEDULED_QUERIES","push","limit","allow_ctas","allowCTAS","allow_cvas","allowCVAS","showMenu","runMenuBtn","ESTIMATE_QUERY_COST","allows_cost_estimate","queryCostEstimate","e","preventDefault","startDttm","endDttm","description","render","createViewModalTitle","createModalPlaceHolder","leftBarStateClass","length","mapStateToProps","sqlLab","queryEditors","editor","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable jsx-a11y/anchor-is-valid */\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React from 'react';\nimport { CSSTransition } from 'react-transition-group';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport { t, styled, supersetTheme } from '@superset-ui/core';\nimport debounce from 'lodash/debounce';\nimport throttle from 'lodash/throttle';\nimport StyledModal from 'src/components/Modal';\nimport Mousetrap from 'mousetrap';\nimport Button from 'src/components/Button';\nimport Timer from 'src/components/Timer';\nimport {\n  Dropdown,\n  Menu as AntdMenu,\n  Menu,\n  Switch,\n  Input,\n} from 'src/common/components';\nimport Icon from 'src/components/Icon';\nimport { detectOS } from 'src/utils/common';\nimport {\n  addQueryEditor,\n  CtasEnum,\n  estimateQueryCost,\n  persistEditorHeight,\n  postStopQuery,\n  queryEditorSetAutorun,\n  queryEditorSetQueryLimit,\n  queryEditorSetSql,\n  queryEditorSetTemplateParams,\n  runQuery,\n  saveQuery,\n  scheduleQuery,\n  setActiveSouthPaneTab,\n  updateSavedQuery,\n  validateQuery,\n} from 'src/SqlLab/actions/sqlLab';\nimport {\n  STATE_TYPE_MAP,\n  SQL_EDITOR_GUTTER_HEIGHT,\n  SQL_EDITOR_GUTTER_MARGIN,\n  SQL_TOOLBAR_HEIGHT,\n} from 'src/SqlLab/constants';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport TemplateParamsEditor from './TemplateParamsEditor';\nimport ConnectedSouthPane from './SouthPane/state';\nimport SaveQuery from './SaveQuery';\nimport ScheduleQueryButton from './ScheduleQueryButton';\nimport EstimateQueryCostButton from './EstimateQueryCostButton';\nimport ShareSqlLabQuery from './ShareSqlLabQuery';\nimport SqlEditorLeftBar from './SqlEditorLeftBar';\nimport AceEditorWrapper from './AceEditorWrapper';\nimport RunQueryActionButton from './RunQueryActionButton';\n\nconst LIMIT_DROPDOWN = [10, 100, 1000, 10000, 100000];\nconst SQL_EDITOR_PADDING = 10;\nconst INITIAL_NORTH_PERCENT = 30;\nconst INITIAL_SOUTH_PERCENT = 70;\nconst SET_QUERY_EDITOR_SQL_DEBOUNCE_MS = 2000;\nconst VALIDATION_DEBOUNCE_MS = 600;\nconst WINDOW_RESIZE_THROTTLE_MS = 100;\n\nconst LimitSelectStyled = styled.span`\n  .ant-dropdown-trigger {\n    align-items: center;\n    color: black;\n    display: flex;\n    font-size: 12px;\n    margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n    text-decoration: none;\n    span {\n      display: inline-block;\n      margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n      &:last-of-type: {\n        margin-right: ${({ theme }) => theme.gridUnit * 4}px;\n      }\n    }\n  }\n`;\n\nconst StyledToolbar = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 2}px;\n  background-color: @lightest;\n  display: flex;\n  justify-content: space-between;\n  border: 1px solid ${supersetTheme.colors.grayscale.light2};\n  border-top: 0;\n\n  form {\n    margin-block-end: 0;\n  }\n\n  .leftItems,\n  .rightItems {\n    display: flex;\n    align-items: center;\n    & > span {\n      margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n      display: inline-block;\n\n      &:last-child {\n        margin-right: 0;\n      }\n    }\n  }\n`;\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  database: PropTypes.object,\n  latestQuery: PropTypes.object,\n  tables: PropTypes.array.isRequired,\n  editorQueries: PropTypes.array.isRequired,\n  dataPreviewQueries: PropTypes.array.isRequired,\n  queryEditorId: PropTypes.string.isRequired,\n  hideLeftBar: PropTypes.bool,\n  defaultQueryLimit: PropTypes.number.isRequired,\n  maxRow: PropTypes.number.isRequired,\n  displayLimit: PropTypes.number.isRequired,\n  saveQueryWarning: PropTypes.string,\n  scheduleQueryWarning: PropTypes.string,\n};\n\nconst defaultProps = {\n  database: null,\n  latestQuery: null,\n  hideLeftBar: false,\n  scheduleQueryWarning: null,\n};\n\nclass SqlEditor extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      autorun: props.queryEditor.autorun,\n      ctas: '',\n      northPercent: props.queryEditor.northPercent || INITIAL_NORTH_PERCENT,\n      southPercent: props.queryEditor.southPercent || INITIAL_SOUTH_PERCENT,\n      sql: props.queryEditor.sql,\n      autocompleteEnabled: true,\n      showCreateAsModal: false,\n      createAs: '',\n    };\n    this.sqlEditorRef = React.createRef();\n    this.northPaneRef = React.createRef();\n\n    this.elementStyle = this.elementStyle.bind(this);\n    this.onResizeStart = this.onResizeStart.bind(this);\n    this.onResizeEnd = this.onResizeEnd.bind(this);\n    this.canValidateQuery = this.canValidateQuery.bind(this);\n    this.runQuery = this.runQuery.bind(this);\n    this.stopQuery = this.stopQuery.bind(this);\n    this.onSqlChanged = this.onSqlChanged.bind(this);\n    this.setQueryEditorSql = this.setQueryEditorSql.bind(this);\n    this.setQueryEditorSqlWithDebounce = debounce(\n      this.setQueryEditorSql.bind(this),\n      SET_QUERY_EDITOR_SQL_DEBOUNCE_MS,\n    );\n    this.queryPane = this.queryPane.bind(this);\n    this.renderQueryLimit = this.renderQueryLimit.bind(this);\n    this.getAceEditorAndSouthPaneHeights = this.getAceEditorAndSouthPaneHeights.bind(\n      this,\n    );\n    this.getSqlEditorHeight = this.getSqlEditorHeight.bind(this);\n    this.requestValidation = debounce(\n      this.requestValidation.bind(this),\n      VALIDATION_DEBOUNCE_MS,\n    );\n    this.getQueryCostEstimate = this.getQueryCostEstimate.bind(this);\n    this.handleWindowResize = throttle(\n      this.handleWindowResize.bind(this),\n      WINDOW_RESIZE_THROTTLE_MS,\n    );\n\n    this.renderDropdown = this.renderDropdown.bind(this);\n  }\n\n  UNSAFE_componentWillMount() {\n    if (this.state.autorun) {\n      this.setState({ autorun: false });\n      this.props.queryEditorSetAutorun(this.props.queryEditor, false);\n      this.startQuery();\n    }\n  }\n\n  componentDidMount() {\n    // We need to measure the height of the sql editor post render to figure the height of\n    // the south pane so it gets rendered properly\n    // eslint-disable-next-line react/no-did-mount-set-state\n    this.setState({ height: this.getSqlEditorHeight() });\n\n    window.addEventListener('resize', this.handleWindowResize);\n\n    // setup hotkeys\n    const hotkeys = this.getHotkeyConfig();\n    hotkeys.forEach(keyConfig => {\n      Mousetrap.bind([keyConfig.key], keyConfig.func);\n    });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('resize', this.handleWindowResize);\n  }\n\n  onResizeStart() {\n    // Set the heights on the ace editor and the ace content area after drag starts\n    // to smooth out the visual transition to the new heights when drag ends\n    document.getElementsByClassName('ace_content')[0].style.height = '100%';\n  }\n\n  onResizeEnd([northPercent, southPercent]) {\n    this.setState({ northPercent, southPercent });\n\n    if (this.northPaneRef.current && this.northPaneRef.current.clientHeight) {\n      this.props.persistEditorHeight(\n        this.props.queryEditor,\n        northPercent,\n        southPercent,\n      );\n    }\n  }\n\n  onSqlChanged(sql) {\n    this.setState({ sql });\n    this.setQueryEditorSqlWithDebounce(sql);\n    // Request server-side validation of the query text\n    if (this.canValidateQuery()) {\n      // NB. requestValidation is debounced\n      this.requestValidation();\n    }\n  }\n\n  // One layer of abstraction for easy spying in unit tests\n  getSqlEditorHeight() {\n    return this.sqlEditorRef.current\n      ? this.sqlEditorRef.current.clientHeight - SQL_EDITOR_PADDING * 2\n      : 0;\n  }\n\n  // Return the heights for the ace editor and the south pane as an object\n  // given the height of the sql editor, north pane percent and south pane percent.\n  getAceEditorAndSouthPaneHeights(height, northPercent, southPercent) {\n    return {\n      aceEditorHeight:\n        (height * northPercent) / 100 -\n        (SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN) -\n        SQL_TOOLBAR_HEIGHT,\n      southPaneHeight:\n        (height * southPercent) / 100 -\n        (SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN),\n    };\n  }\n\n  getHotkeyConfig() {\n    // Get the user's OS\n    const userOS = detectOS();\n    return [\n      {\n        name: 'runQuery1',\n        key: 'ctrl+r',\n        descr: t('Run query'),\n        func: () => {\n          if (this.state.sql.trim() !== '') {\n            this.runQuery();\n          }\n        },\n      },\n      {\n        name: 'runQuery2',\n        key: 'ctrl+enter',\n        descr: t('Run query'),\n        func: () => {\n          if (this.state.sql.trim() !== '') {\n            this.runQuery();\n          }\n        },\n      },\n      {\n        name: 'newTab',\n        key: userOS === 'Windows' ? 'ctrl+q' : 'ctrl+t',\n        descr: t('New tab'),\n        func: () => {\n          this.props.addQueryEditor({\n            ...this.props.queryEditor,\n            title: t('Untitled query'),\n            sql: '',\n          });\n        },\n      },\n      {\n        name: 'stopQuery',\n        key: 'ctrl+x',\n        descr: t('Stop query'),\n        func: this.stopQuery,\n      },\n    ];\n  }\n\n  setQueryEditorSql(sql) {\n    this.props.queryEditorSetSql(this.props.queryEditor, sql);\n  }\n\n  setQueryLimit(queryLimit) {\n    this.props.queryEditorSetQueryLimit(this.props.queryEditor, queryLimit);\n  }\n\n  getQueryCostEstimate() {\n    if (this.props.database) {\n      const qe = this.props.queryEditor;\n      const query = {\n        dbId: qe.dbId,\n        sql: qe.selectedText ? qe.selectedText : this.state.sql,\n        sqlEditorId: qe.id,\n        schema: qe.schema,\n        templateParams: qe.templateParams,\n      };\n      this.props.estimateQueryCost(query);\n    }\n  }\n\n  handleToggleAutocompleteEnabled = () => {\n    this.setState(prevState => ({\n      autocompleteEnabled: !prevState.autocompleteEnabled,\n    }));\n  };\n\n  handleWindowResize() {\n    this.setState({ height: this.getSqlEditorHeight() });\n  }\n\n  elementStyle(dimension, elementSize, gutterSize) {\n    return {\n      [dimension]: `calc(${elementSize}% - ${\n        gutterSize + SQL_EDITOR_GUTTER_MARGIN\n      }px)`,\n    };\n  }\n\n  requestValidation() {\n    if (this.props.database) {\n      const qe = this.props.queryEditor;\n      const query = {\n        dbId: qe.dbId,\n        sql: this.state.sql,\n        sqlEditorId: qe.id,\n        schema: qe.schema,\n        templateParams: qe.templateParams,\n      };\n      this.props.validateQuery(query);\n    }\n  }\n\n  canValidateQuery() {\n    // Check whether or not we can validate the current query based on whether\n    // or not the backend has a validator configured for it.\n    const validatorMap = window.featureFlags.SQL_VALIDATORS_BY_ENGINE;\n    if (this.props.database && validatorMap != null) {\n      return validatorMap.hasOwnProperty(this.props.database.backend);\n    }\n    return false;\n  }\n\n  runQuery() {\n    if (this.props.database) {\n      this.startQuery();\n    }\n  }\n\n  convertToNumWithSpaces(num) {\n    return num.toString().replace(/(\\d)(?=(\\d{3})+(?!\\d))/g, '$1 ');\n  }\n\n  startQuery(ctas = false, ctas_method = CtasEnum.TABLE) {\n    const qe = this.props.queryEditor;\n    const query = {\n      dbId: qe.dbId,\n      sql: qe.selectedText ? qe.selectedText : this.state.sql,\n      sqlEditorId: qe.id,\n      tab: qe.title,\n      schema: qe.schema,\n      tempTable: ctas ? this.state.ctas : '',\n      templateParams: qe.templateParams,\n      queryLimit: qe.queryLimit || this.props.defaultQueryLimit,\n      runAsync: this.props.database\n        ? this.props.database.allow_run_async\n        : false,\n      ctas,\n      ctas_method,\n      updateTabState: !qe.selectedText,\n    };\n    this.props.runQuery(query);\n    this.props.setActiveSouthPaneTab('Results');\n  }\n\n  stopQuery() {\n    if (\n      this.props.latestQuery &&\n      ['running', 'pending'].indexOf(this.props.latestQuery.state) >= 0\n    ) {\n      this.props.postStopQuery(this.props.latestQuery);\n    }\n  }\n\n  createTableAs() {\n    this.startQuery(true, CtasEnum.TABLE);\n    this.setState({ showCreateAsModal: false, ctas: '' });\n  }\n\n  createViewAs() {\n    this.startQuery(true, CtasEnum.VIEW);\n    this.setState({ showCreateAsModal: false, ctas: '' });\n  }\n\n  ctasChanged(event) {\n    this.setState({ ctas: event.target.value });\n  }\n\n  queryPane() {\n    const hotkeys = this.getHotkeyConfig();\n    const {\n      aceEditorHeight,\n      southPaneHeight,\n    } = this.getAceEditorAndSouthPaneHeights(\n      this.state.height,\n      this.state.northPercent,\n      this.state.southPercent,\n    );\n    return (\n      <Split\n        expandToMin\n        className=\"queryPane\"\n        sizes={[this.state.northPercent, this.state.southPercent]}\n        elementStyle={this.elementStyle}\n        minSize={200}\n        direction=\"vertical\"\n        gutterSize={SQL_EDITOR_GUTTER_HEIGHT}\n        onDragStart={this.onResizeStart}\n        onDragEnd={this.onResizeEnd}\n      >\n        <div ref={this.northPaneRef} className=\"north-pane\">\n          <AceEditorWrapper\n            actions={this.props.actions}\n            autocomplete={this.state.autocompleteEnabled}\n            onBlur={this.setQueryEditorSql}\n            onChange={this.onSqlChanged}\n            queryEditor={this.props.queryEditor}\n            sql={this.props.queryEditor.sql}\n            schemas={this.props.queryEditor.schemaOptions}\n            tables={this.props.queryEditor.tableOptions}\n            functionNames={this.props.queryEditor.functionNames}\n            extendedTables={this.props.tables}\n            height={`${aceEditorHeight}px`}\n            hotkeys={hotkeys}\n          />\n          {this.renderEditorBottomBar(hotkeys)}\n        </div>\n        <ConnectedSouthPane\n          editorQueries={this.props.editorQueries}\n          latestQueryId={this.props.latestQuery && this.props.latestQuery.id}\n          dataPreviewQueries={this.props.dataPreviewQueries}\n          actions={this.props.actions}\n          height={southPaneHeight}\n          displayLimit={this.props.displayLimit}\n          defaultQueryLimit={this.props.defaultQueryLimit}\n        />\n      </Split>\n    );\n  }\n\n  renderDropdown() {\n    const qe = this.props.queryEditor;\n    const successful = this.props.latestQuery?.state === 'success';\n    const scheduleToolTip = successful\n      ? t('Schedule the query periodically')\n      : t('You must run the query successfully first');\n    return (\n      <Menu onClick={this.handleMenuClick} style={{ width: 176 }}>\n        <Menu.Item style={{ display: 'flex', justifyContent: 'space-between' }}>\n          {' '}\n          <span>{t('Autocomplete')}</span>{' '}\n          <Switch\n            checked={this.state.autocompleteEnabled}\n            onChange={this.handleToggleAutocompleteEnabled}\n            name=\"autocomplete-switch\"\n          />{' '}\n        </Menu.Item>\n        {isFeatureEnabled(FeatureFlag.ENABLE_TEMPLATE_PROCESSING) && (\n          <Menu.Item>\n            <TemplateParamsEditor\n              language=\"json\"\n              onChange={params => {\n                this.props.actions.queryEditorSetTemplateParams(qe, params);\n              }}\n              code={qe.templateParams}\n            />\n          </Menu.Item>\n        )}\n        {isFeatureEnabled(FeatureFlag.SCHEDULED_QUERIES) && (\n          <Menu.Item>\n            <ScheduleQueryButton\n              defaultLabel={qe.title}\n              sql={qe.sql}\n              onSchedule={this.props.actions.scheduleQuery}\n              schema={qe.schema}\n              dbId={qe.dbId}\n              scheduleQueryWarning={this.props.scheduleQueryWarning}\n              tooltip={scheduleToolTip}\n              disabled={!successful}\n            />\n          </Menu.Item>\n        )}\n      </Menu>\n    );\n  }\n\n  renderQueryLimit() {\n    // Adding SQL_MAX_ROW value to dropdown\n    const { maxRow } = this.props;\n    LIMIT_DROPDOWN.push(maxRow);\n\n    return (\n      <AntdMenu>\n        {[...new Set(LIMIT_DROPDOWN)].map(limit => (\n          <AntdMenu.Item\n            key={`${limit}`}\n            onClick={() => this.setQueryLimit(limit)}\n          >\n            {/* // eslint-disable-line no-use-before-define */}\n            <a role=\"button\" styling=\"link\">\n              {this.convertToNumWithSpaces(limit)}\n            </a>{' '}\n          </AntdMenu.Item>\n        ))}\n      </AntdMenu>\n    );\n  }\n\n  renderEditorBottomBar() {\n    const { queryEditor: qe } = this.props;\n\n    const { allow_ctas: allowCTAS, allow_cvas: allowCVAS } =\n      this.props.database || {};\n\n    const showMenu = allowCTAS || allowCVAS;\n\n    const runMenuBtn = (\n      <Menu>\n        {allowCTAS && (\n          <Menu.Item\n            onClick={() => {\n              this.setState({\n                showCreateAsModal: true,\n                createAs: CtasEnum.TABLE,\n              });\n            }}\n            key=\"1\"\n          >\n            {t('CREATE TABLE AS')}\n          </Menu.Item>\n        )}\n        {allowCVAS && (\n          <Menu.Item\n            onClick={() => {\n              this.setState({\n                showCreateAsModal: true,\n                createAs: CtasEnum.VIEW,\n              });\n            }}\n            key=\"2\"\n          >\n            {t('CREATE VIEW AS')}\n          </Menu.Item>\n        )}\n      </Menu>\n    );\n    return (\n      <StyledToolbar className=\"sql-toolbar\" id=\"js-sql-toolbar\">\n        <div className=\"leftItems\">\n          <span>\n            <RunQueryActionButton\n              allowAsync={\n                this.props.database\n                  ? this.props.database.allow_run_async\n                  : false\n              }\n              queryState={this.props.latestQuery?.state}\n              runQuery={this.runQuery}\n              selectedText={qe.selectedText}\n              stopQuery={this.stopQuery}\n              sql={this.state.sql}\n              overlayCreateAsMenu={showMenu ? runMenuBtn : null}\n            />\n          </span>\n          {isFeatureEnabled(FeatureFlag.ESTIMATE_QUERY_COST) &&\n            this.props.database &&\n            this.props.database.allows_cost_estimate && (\n              <span>\n                <EstimateQueryCostButton\n                  dbId={qe.dbId}\n                  schema={qe.schema}\n                  sql={qe.sql}\n                  getEstimate={this.getQueryCostEstimate}\n                  queryCostEstimate={qe.queryCostEstimate}\n                  selectedText={qe.selectedText}\n                  tooltip={t('Estimate the cost before running a query')}\n                />\n              </span>\n            )}\n          <span>\n            <LimitSelectStyled>\n              <Dropdown overlay={this.renderQueryLimit()} trigger=\"click\">\n                <a onClick={e => e.preventDefault()}>\n                  <span>LIMIT:</span>\n                  <span>\n                    {this.convertToNumWithSpaces(\n                      this.props.queryEditor.queryLimit ||\n                        this.props.defaultQueryLimit,\n                    )}\n                  </span>\n                  <Icon name=\"triangle-down\" />\n                </a>\n              </Dropdown>\n            </LimitSelectStyled>\n          </span>\n          {this.props.latestQuery && (\n            <Timer\n              startTime={this.props.latestQuery.startDttm}\n              endTime={this.props.latestQuery.endDttm}\n              state={STATE_TYPE_MAP[this.props.latestQuery.state]}\n              isRunning={this.props.latestQuery.state === 'running'}\n            />\n          )}\n        </div>\n        <div className=\"rightItems\">\n          <span>\n            <SaveQuery\n              query={qe}\n              defaultLabel={qe.title || qe.description}\n              onSave={this.props.actions.saveQuery}\n              onUpdate={this.props.actions.updateSavedQuery}\n              saveQueryWarning={this.props.saveQueryWarning}\n            />\n          </span>\n          <span>\n            <ShareSqlLabQuery queryEditor={qe} />\n          </span>\n          <Dropdown overlay={this.renderDropdown()} trigger=\"click\">\n            <Icon name=\"more-horiz\" />\n          </Dropdown>\n        </div>\n      </StyledToolbar>\n    );\n  }\n\n  render() {\n    const createViewModalTitle =\n      this.state.createAs === CtasEnum.VIEW\n        ? 'CREATE VIEW AS'\n        : 'CREATE TABLE AS';\n\n    const createModalPlaceHolder =\n      this.state.createAs === CtasEnum.VIEW\n        ? 'Specify name to CREATE VIEW AS schema in: public'\n        : 'Specify name to CREATE TABLE AS schema in: public';\n\n    const leftBarStateClass = this.props.hideLeftBar\n      ? 'schemaPane-exit-done'\n      : 'schemaPane-enter-done';\n    return (\n      <div ref={this.sqlEditorRef} className=\"SqlEditor\">\n        <CSSTransition\n          classNames=\"schemaPane\"\n          in={!this.props.hideLeftBar}\n          timeout={300}\n        >\n          <div className={`schemaPane ${leftBarStateClass}`}>\n            <SqlEditorLeftBar\n              database={this.props.database}\n              queryEditor={this.props.queryEditor}\n              tables={this.props.tables}\n              actions={this.props.actions}\n            />\n          </div>\n        </CSSTransition>\n        {this.queryPane()}\n        <StyledModal\n          visible={this.state.showCreateAsModal}\n          title={t(createViewModalTitle)}\n          onHide={() => {\n            this.setState({ showCreateAsModal: false });\n          }}\n          footer={\n            <>\n              <Button\n                onClick={() => this.setState({ showCreateAsModal: false })}\n              >\n                Cancel\n              </Button>\n              {this.state.createAs === CtasEnum.TABLE && (\n                <Button\n                  buttonStyle=\"primary\"\n                  disabled={this.state.ctas.length === 0}\n                  onClick={this.createTableAs.bind(this)}\n                >\n                  Create\n                </Button>\n              )}\n              {this.state.createAs === CtasEnum.VIEW && (\n                <Button\n                  buttonStyle=\"primary\"\n                  disabled={this.state.ctas.length === 0}\n                  onClick={this.createViewAs.bind(this)}\n                >\n                  Create\n                </Button>\n              )}\n            </>\n          }\n        >\n          <span>Name</span>\n          <Input\n            placeholder={createModalPlaceHolder}\n            onChange={this.ctasChanged.bind(this)}\n          />\n        </StyledModal>\n      </div>\n    );\n  }\n}\nSqlEditor.defaultProps = defaultProps;\nSqlEditor.propTypes = propTypes;\n\nfunction mapStateToProps(state, props) {\n  const { sqlLab } = state;\n  const queryEditor = sqlLab.queryEditors.find(\n    editor => editor.id === props.queryEditorId,\n  );\n\n  return { sqlLab, ...props, queryEditor };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return bindActionCreators(\n    {\n      addQueryEditor,\n      estimateQueryCost,\n      persistEditorHeight,\n      postStopQuery,\n      queryEditorSetAutorun,\n      queryEditorSetQueryLimit,\n      queryEditorSetSql,\n      queryEditorSetTemplateParams,\n      runQuery,\n      saveQuery,\n      scheduleQuery,\n      setActiveSouthPaneTab,\n      updateSavedQuery,\n      validateQuery,\n    },\n    dispatch,\n  );\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(SqlEditor);\n"]},"metadata":{},"sourceType":"module"}