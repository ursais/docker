{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Button from 'src/components/Button';\nimport { styled, t } from '@superset-ui/core';\n\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport Tabs from 'src/components/Tabs';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport AdhocFilter, {\nEXPRESSION_TYPES } from\n'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n  PropTypes.oneOfType([\n  columnType,\n  PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n  adhocMetricType])).\n\n  isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n  theme: PropTypes.object };\n\n\nconst ResizeIcon = styled.i`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst startingWidth = 320;\nconst startingHeight = 240;\n\nconst FilterPopoverContentContainer = styled.div`\n  .adhoc-filter-edit-tabs > .nav-tabs {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n\n    & > li > a {\n      padding: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n\n  #filter-edit-popover {\n    max-width: none;\n  }\n\n  .filter-edit-clause-dropdown {\n    width: ${({ theme }) => theme.gridUnit * 30}px;\n    margin-right: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .filter-edit-clause-info {\n    font-size: ${({ theme }) => theme.typography.sizes.xs}px;\n    padding-left: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .filter-edit-clause-section {\n    display: inline-flex;\n  }\n\n  .adhoc-filter-simple-column-dropdown {\n    margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  }\n`;\n\nexport default class AdhocFilterEditPopover extends React.Component {\n  constructor(props) {var _context, _context2, _context3, _context4, _context5, _context6, _context7, _this$props, _this$props$adhocFilt;\n    super(props);\n    this.onSave = _bindInstanceProperty(_context = this.onSave).call(_context, this);\n    this.onDragDown = _bindInstanceProperty(_context2 = this.onDragDown).call(_context2, this);\n    this.onMouseMove = _bindInstanceProperty(_context3 = this.onMouseMove).call(_context3, this);\n    this.onMouseUp = _bindInstanceProperty(_context4 = this.onMouseUp).call(_context4, this);\n    this.onAdhocFilterChange = _bindInstanceProperty(_context5 = this.onAdhocFilterChange).call(_context5, this);\n    this.adjustHeight = _bindInstanceProperty(_context6 = this.adjustHeight).call(_context6, this);\n    this.onTabChange = _bindInstanceProperty(_context7 = this.onTabChange).call(_context7, this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: startingWidth,\n      height: startingHeight,\n      activeKey: ((_this$props = this.props) == null ? void 0 : (_this$props$adhocFilt = _this$props.adhocFilter) == null ? void 0 : _this$props$adhocFilt.expressionType) || 'SIMPLE' };\n\n\n    this.popoverContentRef = /*#__PURE__*/React.createRef();\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n      this.dragStartWidth + (e.clientX - this.dragStartX),\n      startingWidth),\n\n      height: Math.max(\n      this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n      startingHeight) });\n\n\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(activeKey) {\n    this.setState({\n      activeKey });\n\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState(state => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const {\n      adhocFilter: propsAdhocFilter,\n      options,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      partitionColumn,\n      theme,\n      ...popoverProps } =\n    this.props;\n\n    const { adhocFilter } = this.state;\n\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges = !adhocFilter.equals(propsAdhocFilter);\n\n    return (\n      ___EmotionJSX(FilterPopoverContentContainer, _extends({\n        id: \"filter-edit-popover\" },\n      popoverProps, {\n        \"data-test\": \"filter-edit-popover\",\n        ref: this.popoverContentRef }),\n\n      ___EmotionJSX(Tabs, {\n        id: \"adhoc-filter-edit-tabs\",\n        defaultActiveKey: adhocFilter.expressionType,\n        className: \"adhoc-filter-edit-tabs\",\n        \"data-test\": \"adhoc-filter-edit-tabs\",\n        style: { minHeight: this.state.height, width: this.state.width },\n        allowOverflow: true,\n        onChange: this.onTabChange },\n\n      ___EmotionJSX(Tabs.TabPane, {\n        className: \"adhoc-filter-edit-tab\",\n        key: EXPRESSION_TYPES.SIMPLE,\n        tab: t('Simple') },\n\n      ___EmotionJSX(ErrorBoundary, null,\n      ___EmotionJSX(AdhocFilterEditPopoverSimpleTabContent, {\n        adhocFilter: this.state.adhocFilter,\n        onChange: this.onAdhocFilterChange,\n        options: options,\n        datasource: datasource,\n        onHeightChange: this.adjustHeight,\n        partitionColumn: partitionColumn,\n        popoverRef: this.popoverContentRef.current }))),\n\n\n\n      ___EmotionJSX(Tabs.TabPane, {\n        className: \"adhoc-filter-edit-tab\",\n        key: EXPRESSION_TYPES.SQL,\n        tab: t('Custom SQL') },\n\n      ___EmotionJSX(ErrorBoundary, null,\n      !this.props.datasource ||\n      this.props.datasource.type !== 'druid' ?\n      ___EmotionJSX(AdhocFilterEditPopoverSqlTabContent, {\n        adhocFilter: this.state.adhocFilter,\n        onChange: this.onAdhocFilterChange,\n        options: this.props.options,\n        height: this.state.height,\n        activeKey: this.state.activeKey }) :\n\n\n      ___EmotionJSX(\"div\", { className: \"custom-sql-disabled-message\" }, \"Custom SQL Filters are not available on druid datasources\")))),\n\n\n\n\n\n\n      ___EmotionJSX(\"div\", null,\n      ___EmotionJSX(Button, { buttonSize: \"small\", onClick: this.props.onClose, cta: true },\n      t('Close')),\n\n      ___EmotionJSX(Button, {\n        \"data-test\": \"adhoc-filter-edit-popover-save-button\",\n        disabled: !stateIsValid,\n        buttonStyle:\n        hasUnsavedChanges && stateIsValid ? 'primary' : 'default',\n\n        buttonSize: \"small\",\n        className: \"m-r-5\",\n        onClick: this.onSave,\n        cta: true },\n\n      t('Save')),\n\n      ___EmotionJSX(ResizeIcon, {\n        role: \"button\",\n        \"aria-label\": \"Resize\",\n        tabIndex: 0,\n        onMouseDown: this.onDragDown,\n        className: \"fa fa-expand edit-popover-resize text-muted\" }))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nAdhocFilterEditPopover.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(ResizeIcon, \"ResizeIcon\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(startingWidth, \"startingWidth\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(startingHeight, \"startingHeight\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(FilterPopoverContentContainer, \"FilterPopoverContentContainer\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(AdhocFilterEditPopover, \"AdhocFilterEditPopover\", \"/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx"],"names":["React","PropTypes","Button","styled","t","ErrorBoundary","Tabs","adhocMetricType","AdhocFilter","EXPRESSION_TYPES","AdhocFilterEditPopoverSimpleTabContent","AdhocFilterEditPopoverSqlTabContent","columnType","propTypes","adhocFilter","instanceOf","isRequired","onChange","func","onClose","onResize","options","arrayOf","oneOfType","shape","saved_metric_name","string","datasource","object","partitionColumn","theme","ResizeIcon","i","gridUnit","startingWidth","startingHeight","FilterPopoverContentContainer","div","typography","sizes","xs","AdhocFilterEditPopover","Component","constructor","props","onSave","onDragDown","onMouseMove","onMouseUp","onAdhocFilterChange","adjustHeight","onTabChange","state","width","height","activeKey","expressionType","popoverContentRef","createRef","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","setState","e","dragStartX","clientX","dragStartY","clientY","dragStartWidth","dragStartHeight","Math","max","heightDifference","render","propsAdhocFilter","popoverProps","stateIsValid","isValid","hasUnsavedChanges","equals","minHeight","SIMPLE","current","SQL","type"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Button from 'src/components/Button';\nimport { styled, t } from '@superset-ui/core';\n\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport Tabs from 'src/components/Tabs';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n  theme: PropTypes.object,\n};\n\nconst ResizeIcon = styled.i`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst startingWidth = 320;\nconst startingHeight = 240;\n\nconst FilterPopoverContentContainer = styled.div`\n  .adhoc-filter-edit-tabs > .nav-tabs {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n\n    & > li > a {\n      padding: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n\n  #filter-edit-popover {\n    max-width: none;\n  }\n\n  .filter-edit-clause-dropdown {\n    width: ${({ theme }) => theme.gridUnit * 30}px;\n    margin-right: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .filter-edit-clause-info {\n    font-size: ${({ theme }) => theme.typography.sizes.xs}px;\n    padding-left: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .filter-edit-clause-section {\n    display: inline-flex;\n  }\n\n  .adhoc-filter-simple-column-dropdown {\n    margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  }\n`;\n\nexport default class AdhocFilterEditPopover extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onAdhocFilterChange = this.onAdhocFilterChange.bind(this);\n    this.adjustHeight = this.adjustHeight.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: startingWidth,\n      height: startingHeight,\n      activeKey: this.props?.adhocFilter?.expressionType || 'SIMPLE',\n    };\n\n    this.popoverContentRef = React.createRef();\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        startingWidth,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n        startingHeight,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(activeKey) {\n    this.setState({\n      activeKey,\n    });\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState(state => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const {\n      adhocFilter: propsAdhocFilter,\n      options,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      partitionColumn,\n      theme,\n      ...popoverProps\n    } = this.props;\n\n    const { adhocFilter } = this.state;\n\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges = !adhocFilter.equals(propsAdhocFilter);\n\n    return (\n      <FilterPopoverContentContainer\n        id=\"filter-edit-popover\"\n        {...popoverProps}\n        data-test=\"filter-edit-popover\"\n        ref={this.popoverContentRef}\n      >\n        <Tabs\n          id=\"adhoc-filter-edit-tabs\"\n          defaultActiveKey={adhocFilter.expressionType}\n          className=\"adhoc-filter-edit-tabs\"\n          data-test=\"adhoc-filter-edit-tabs\"\n          style={{ minHeight: this.state.height, width: this.state.width }}\n          allowOverflow\n          onChange={this.onTabChange}\n        >\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={EXPRESSION_TYPES.SIMPLE}\n            tab={t('Simple')}\n          >\n            <ErrorBoundary>\n              <AdhocFilterEditPopoverSimpleTabContent\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={options}\n                datasource={datasource}\n                onHeightChange={this.adjustHeight}\n                partitionColumn={partitionColumn}\n                popoverRef={this.popoverContentRef.current}\n              />\n            </ErrorBoundary>\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={EXPRESSION_TYPES.SQL}\n            tab={t('Custom SQL')}\n          >\n            <ErrorBoundary>\n              {!this.props.datasource ||\n              this.props.datasource.type !== 'druid' ? (\n                <AdhocFilterEditPopoverSqlTabContent\n                  adhocFilter={this.state.adhocFilter}\n                  onChange={this.onAdhocFilterChange}\n                  options={this.props.options}\n                  height={this.state.height}\n                  activeKey={this.state.activeKey}\n                />\n              ) : (\n                <div className=\"custom-sql-disabled-message\">\n                  Custom SQL Filters are not available on druid datasources\n                </div>\n              )}\n            </ErrorBoundary>\n          </Tabs.TabPane>\n        </Tabs>\n        <div>\n          <Button buttonSize=\"small\" onClick={this.props.onClose} cta>\n            {t('Close')}\n          </Button>\n          <Button\n            data-test=\"adhoc-filter-edit-popover-save-button\"\n            disabled={!stateIsValid}\n            buttonStyle={\n              hasUnsavedChanges && stateIsValid ? 'primary' : 'default'\n            }\n            buttonSize=\"small\"\n            className=\"m-r-5\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          <ResizeIcon\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </div>\n      </FilterPopoverContentContainer>\n    );\n  }\n}\n\nAdhocFilterEditPopover.propTypes = propTypes;\n"]},"metadata":{},"sourceType":"module"}