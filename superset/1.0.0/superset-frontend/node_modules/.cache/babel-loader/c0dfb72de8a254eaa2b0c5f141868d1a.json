{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _Object$keys from \"@babel/runtime-corejs3/core-js-stable/object/keys\";import _forEachInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/for-each\";import _JSON$stringify from \"@babel/runtime-corejs3/core-js-stable/json/stringify\";import _Object$values from \"@babel/runtime-corejs3/core-js-stable/object/values\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-param-reassign */\nimport { styled, t } from '@superset-ui/core';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport cx from 'classnames';\nimport Icon from 'src/components/Icon';\nimport { Tabs } from 'src/common/components';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { useImmer } from 'use-immer';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport { testWithId } from 'src/utils/testUtils';\nimport Loading from 'src/components/Loading';\nimport { getInitialDataMask } from 'src/dataMask/reducer';\nimport { getOnlyExtraFormData, TabIds } from './utils';\nimport FilterSets from './FilterSets';\nimport { useNativeFiltersDataMask, useFilters, useFilterSets, useFilterUpdates, useInitialization } from './state';\nimport EditSection from './FilterSets/EditSection';\nimport Header from './Header';\nimport FilterControls from './FilterControls/FilterControls';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst BAR_WIDTH = `250px`;\nexport const FILTER_BAR_TEST_ID = 'filter-bar';\nexport const getFilterBarTestId = testWithId(FILTER_BAR_TEST_ID);\nconst BarWrapper = styled.div`\n  width: ${({ theme }) => theme.gridUnit * 8}px;\n  & .ant-tabs-top > .ant-tabs-nav {\n    margin: 0;\n  }\n  &.open {\n    width: ${BAR_WIDTH}; // arbitrary...\n  }\n`;\nconst Bar = styled.div`\n  & .ant-typography-edit-content {\n    left: 0;\n    margin-top: 0;\n    width: 100%;\n  }\n  position: absolute;\n  top: 0;\n  left: 0;\n  flex-direction: column;\n  flex-grow: 1;\n  width: ${BAR_WIDTH}; // arbitrary...\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  min-height: 100%;\n  display: none;\n  /* &.animated {\n    display: flex;\n    transform: translateX(-100%);\n    transition: transform ${({ theme }) => theme.transitionTiming}s;\n    transition-delay: 0s;\n  }  */\n\n  &.open {\n    display: flex;\n    /* &.animated {\n      transform: translateX(0);\n      transition-delay: ${({ theme }) => theme.transitionTiming * 2}s;\n    } */\n  }\n`;\nconst CollapsedBar = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 8}px;\n  padding-top: ${({ theme }) => theme.gridUnit * 2}px;\n  display: none;\n  text-align: center;\n  /* &.animated {\n    display: block;\n    transform: translateX(-100%);\n    transition: transform ${({ theme }) => theme.transitionTiming}s;\n    transition-delay: 0s;\n  } */\n\n  &.open {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: ${({ theme }) => theme.gridUnit * 2}px;\n    /* &.animated {\n      transform: translateX(0);\n      transition-delay: ${({ theme }) => theme.transitionTiming * 3}s;\n    } */\n  }\n\n  svg {\n    width: ${({ theme }) => theme.gridUnit * 4}px;\n    height: ${({ theme }) => theme.gridUnit * 4}px;\n    cursor: pointer;\n  }\n`;\nconst StyledCollapseIcon = styled(Icon)`\n  color: ${({ theme }) => theme.colors.primary.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n`;\nconst StyledTabs = styled(Tabs)`\n  & .ant-tabs-nav-list {\n    width: 100%;\n  }\n  & .ant-tabs-tab {\n    display: flex;\n    justify-content: center;\n    margin: 0;\n    flex: 1;\n  }\n`;\nconst FilterBar = ({ filtersOpen, toggleFiltersBar, directPathToChild }) => {\n  const [editFilterSetId, setEditFilterSetId] = useState(null);\n  const [dataMaskSelected, setDataMaskSelected] = useImmer({});\n  const dispatch = useDispatch();\n  const filterSets = useFilterSets();\n  const filterSetFilterValues = _Object$values(filterSets);\n  const [tab, setTab] = useState(TabIds.AllFilters);\n  const filters = useFilters();\n  const previousFilters = usePrevious(filters);\n  const filterValues = _Object$values(filters);\n  const dataMaskApplied = useNativeFiltersDataMask();\n  const [isFilterSetChanged, setIsFilterSetChanged] = useState(false);\n  useEffect(() => {\n    setDataMaskSelected(() => dataMaskApplied);\n  }, [_JSON$stringify(dataMaskApplied), setDataMaskSelected]);\n  // reset filter state if filter type changes\n  useEffect(() => {\n    setDataMaskSelected(draft => {var _context;\n      _forEachInstanceProperty(_context = _Object$values(filters)).call(_context, filter => {var _previousFilters$filt, _previousFilters$filt2;\n        if (filter.filterType !== (previousFilters == null ? void 0 : (_previousFilters$filt = previousFilters[filter.id]) == null ? void 0 : _previousFilters$filt.filterType) &&\n        (previousFilters == null ? void 0 : (_previousFilters$filt2 = previousFilters[filter.id]) == null ? void 0 : _previousFilters$filt2.filterType) !== undefined) {\n          draft[filter.id] = getInitialDataMask(filter.id);\n        }\n      });\n    });\n  }, [\n  _JSON$stringify(filters),\n  _JSON$stringify(previousFilters),\n  setDataMaskSelected]);\n\n  const handleFilterSelectionChange = (filter, dataMask) => {\n    setIsFilterSetChanged(tab !== TabIds.AllFilters);\n    setDataMaskSelected(draft => {var _dataMask$filterState, _dataMaskSelected$fil, _dataMaskSelected$fil2;\n      // force instant updating on initialization for filters with `requiredFirst` is true or instant filters\n      if (dataMaskSelected[filter.id] && filter.isInstant ||\n      // filterState.value === undefined - means that value not initialized\n      ((_dataMask$filterState = dataMask.filterState) == null ? void 0 : _dataMask$filterState.value) !== undefined &&\n      ((_dataMaskSelected$fil = dataMaskSelected[filter.id]) == null ? void 0 : (_dataMaskSelected$fil2 = _dataMaskSelected$fil.filterState) == null ? void 0 : _dataMaskSelected$fil2.value) === undefined &&\n      filter.requiredFirst) {\n        dispatch(updateDataMask(filter.id, dataMask));\n      }\n      draft[filter.id] = {\n        ...getInitialDataMask(filter.id),\n        ...dataMask };\n\n    });\n  };\n  const handleApply = () => {\n    const filterIds = _Object$keys(dataMaskSelected);\n    _forEachInstanceProperty(filterIds).call(filterIds, filterId => {\n      if (dataMaskSelected[filterId]) {\n        dispatch(updateDataMask(filterId, dataMaskSelected[filterId]));\n      }\n    });\n  };\n  useFilterUpdates(dataMaskSelected, setDataMaskSelected);\n  const dataSelectedValues = _Object$values(dataMaskSelected);\n  const dataAppliedValues = _Object$values(dataMaskApplied);\n  const isApplyDisabled = areObjectsEqual(getOnlyExtraFormData(dataMaskSelected), getOnlyExtraFormData(dataMaskApplied), { ignoreUndefined: true }) || dataSelectedValues.length !== dataAppliedValues.length;\n  const isInitialized = useInitialization();\n  return ___EmotionJSX(BarWrapper, _extends({}, getFilterBarTestId(), { className: cx({ open: filtersOpen }) }),\n  ___EmotionJSX(CollapsedBar, _extends({}, getFilterBarTestId('collapsable'), { className: cx({ open: !filtersOpen }), onClick: () => toggleFiltersBar(true) }),\n  ___EmotionJSX(StyledCollapseIcon, _extends({ name: \"collapse\" }, getFilterBarTestId('expand-button'))),\n  ___EmotionJSX(Icon, _extends({ name: \"filter\" }, getFilterBarTestId('filter-icon')))),\n\n  ___EmotionJSX(Bar, { className: cx({ open: filtersOpen }) },\n  ___EmotionJSX(Header, { toggleFiltersBar: toggleFiltersBar, onApply: handleApply, setDataMaskSelected: setDataMaskSelected, isApplyDisabled: isApplyDisabled, dataMaskSelected: dataMaskSelected, dataMaskApplied: dataMaskApplied }),\n  !isInitialized ? ___EmotionJSX(Loading, null) : isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET) ? ___EmotionJSX(StyledTabs, { centered: true, onChange: setTab, defaultActiveKey: TabIds.AllFilters, activeKey: editFilterSetId ? TabIds.AllFilters : undefined },\n  ___EmotionJSX(Tabs.TabPane, { tab: t(`All Filters (${filterValues.length})`), key: TabIds.AllFilters },\n  editFilterSetId && ___EmotionJSX(EditSection, { dataMaskSelected: dataMaskSelected, disabled: !isApplyDisabled, onCancel: () => setEditFilterSetId(null), filterSetId: editFilterSetId }),\n  ___EmotionJSX(FilterControls, { dataMaskSelected: dataMaskSelected, directPathToChild: directPathToChild, onFilterSelectionChange: handleFilterSelectionChange })),\n\n  ___EmotionJSX(Tabs.TabPane, { disabled: !!editFilterSetId, tab: t(`Filter Sets (${filterSetFilterValues.length})`), key: TabIds.FilterSets },\n  ___EmotionJSX(FilterSets, { onEditFilterSet: setEditFilterSetId, disabled: !isApplyDisabled, dataMaskSelected: dataMaskSelected, isFilterSetChanged: isFilterSetChanged, onFilterSelectionChange: handleFilterSelectionChange }))) :\n\n  ___EmotionJSX(FilterControls, { dataMaskSelected: dataMaskSelected, directPathToChild: directPathToChild, onFilterSelectionChange: handleFilterSelectionChange })));\n\n\n};__signature__(FilterBar, \"useState{[editFilterSetId, setEditFilterSetId](null)}\\nuseImmer{[dataMaskSelected, setDataMaskSelected]}\\nuseDispatch{dispatch}\\nuseFilterSets{filterSets}\\nuseState{[tab, setTab](TabIds.AllFilters)}\\nuseFilters{filters}\\nusePrevious{previousFilters}\\nuseNativeFiltersDataMask{dataMaskApplied}\\nuseState{[isFilterSetChanged, setIsFilterSetChanged](false)}\\nuseEffect{}\\nuseEffect{}\\nuseFilterUpdates{}\\nuseInitialization{isInitialized}\", () => [useImmer, useDispatch, useFilterSets, useFilters, usePrevious, useNativeFiltersDataMask, useFilterUpdates, useInitialization]);const _default =\nFilterBar;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(BAR_WIDTH, \"BAR_WIDTH\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(FILTER_BAR_TEST_ID, \"FILTER_BAR_TEST_ID\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(getFilterBarTestId, \"getFilterBarTestId\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(BarWrapper, \"BarWrapper\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(Bar, \"Bar\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(CollapsedBar, \"CollapsedBar\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(StyledCollapseIcon, \"StyledCollapseIcon\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(StyledTabs, \"StyledTabs\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(FilterBar, \"FilterBar\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/index.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable no-param-reassign */\nimport { DataMask, HandlerFunction, styled, t } from '@superset-ui/core';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport cx from 'classnames';\nimport Icon from 'src/components/Icon';\nimport { Tabs } from 'src/common/components';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { DataMaskStateWithId, DataMaskWithId } from 'src/dataMask/types';\nimport { useImmer } from 'use-immer';\nimport { areObjectsEqual } from 'src/reduxUtils';\nimport { testWithId } from 'src/utils/testUtils';\nimport { Filter } from 'src/dashboard/components/nativeFilters/types';\nimport Loading from 'src/components/Loading';\nimport { getInitialDataMask } from 'src/dataMask/reducer';\nimport { getOnlyExtraFormData, TabIds } from './utils';\nimport FilterSets from './FilterSets';\nimport {\n  useNativeFiltersDataMask,\n  useFilters,\n  useFilterSets,\n  useFilterUpdates,\n  useInitialization,\n} from './state';\nimport EditSection from './FilterSets/EditSection';\nimport Header from './Header';\nimport FilterControls from './FilterControls/FilterControls';\n\nconst BAR_WIDTH = `250px`;\n\nexport const FILTER_BAR_TEST_ID = 'filter-bar';\nexport const getFilterBarTestId = testWithId(FILTER_BAR_TEST_ID);\n\nconst BarWrapper = styled.div`\n  width: ${({ theme }) => theme.gridUnit * 8}px;\n  & .ant-tabs-top > .ant-tabs-nav {\n    margin: 0;\n  }\n  &.open {\n    width: ${BAR_WIDTH}; // arbitrary...\n  }\n`;\n\nconst Bar = styled.div`\n  & .ant-typography-edit-content {\n    left: 0;\n    margin-top: 0;\n    width: 100%;\n  }\n  position: absolute;\n  top: 0;\n  left: 0;\n  flex-direction: column;\n  flex-grow: 1;\n  width: ${BAR_WIDTH}; // arbitrary...\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  min-height: 100%;\n  display: none;\n  /* &.animated {\n    display: flex;\n    transform: translateX(-100%);\n    transition: transform ${({ theme }) => theme.transitionTiming}s;\n    transition-delay: 0s;\n  }  */\n\n  &.open {\n    display: flex;\n    /* &.animated {\n      transform: translateX(0);\n      transition-delay: ${({ theme }) => theme.transitionTiming * 2}s;\n    } */\n  }\n`;\n\nconst CollapsedBar = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 8}px;\n  padding-top: ${({ theme }) => theme.gridUnit * 2}px;\n  display: none;\n  text-align: center;\n  /* &.animated {\n    display: block;\n    transform: translateX(-100%);\n    transition: transform ${({ theme }) => theme.transitionTiming}s;\n    transition-delay: 0s;\n  } */\n\n  &.open {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: ${({ theme }) => theme.gridUnit * 2}px;\n    /* &.animated {\n      transform: translateX(0);\n      transition-delay: ${({ theme }) => theme.transitionTiming * 3}s;\n    } */\n  }\n\n  svg {\n    width: ${({ theme }) => theme.gridUnit * 4}px;\n    height: ${({ theme }) => theme.gridUnit * 4}px;\n    cursor: pointer;\n  }\n`;\n\nconst StyledCollapseIcon = styled(Icon)`\n  color: ${({ theme }) => theme.colors.primary.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n`;\n\nconst StyledTabs = styled(Tabs)`\n  & .ant-tabs-nav-list {\n    width: 100%;\n  }\n  & .ant-tabs-tab {\n    display: flex;\n    justify-content: center;\n    margin: 0;\n    flex: 1;\n  }\n`;\n\nexport interface FiltersBarProps {\n  filtersOpen: boolean;\n  toggleFiltersBar: any;\n  directPathToChild?: string[];\n}\n\nconst FilterBar: React.FC<FiltersBarProps> = ({\n  filtersOpen,\n  toggleFiltersBar,\n  directPathToChild,\n}) => {\n  const [editFilterSetId, setEditFilterSetId] = useState<string | null>(null);\n  const [dataMaskSelected, setDataMaskSelected] = useImmer<DataMaskStateWithId>(\n    {},\n  );\n  const dispatch = useDispatch();\n  const filterSets = useFilterSets();\n  const filterSetFilterValues = Object.values(filterSets);\n  const [tab, setTab] = useState(TabIds.AllFilters);\n  const filters = useFilters();\n  const previousFilters = usePrevious(filters);\n  const filterValues = Object.values<Filter>(filters);\n  const dataMaskApplied: DataMaskStateWithId = useNativeFiltersDataMask();\n  const [isFilterSetChanged, setIsFilterSetChanged] = useState(false);\n\n  useEffect(() => {\n    setDataMaskSelected(() => dataMaskApplied);\n  }, [JSON.stringify(dataMaskApplied), setDataMaskSelected]);\n\n  // reset filter state if filter type changes\n  useEffect(() => {\n    setDataMaskSelected(draft => {\n      Object.values(filters).forEach(filter => {\n        if (\n          filter.filterType !== previousFilters?.[filter.id]?.filterType &&\n          previousFilters?.[filter.id]?.filterType !== undefined\n        ) {\n          draft[filter.id] = getInitialDataMask(filter.id) as DataMaskWithId;\n        }\n      });\n    });\n  }, [\n    JSON.stringify(filters),\n    JSON.stringify(previousFilters),\n    setDataMaskSelected,\n  ]);\n\n  const handleFilterSelectionChange = (\n    filter: Pick<Filter, 'id'> & Partial<Filter>,\n    dataMask: Partial<DataMask>,\n  ) => {\n    setIsFilterSetChanged(tab !== TabIds.AllFilters);\n    setDataMaskSelected(draft => {\n      // force instant updating on initialization for filters with `requiredFirst` is true or instant filters\n      if (\n        (dataMaskSelected[filter.id] && filter.isInstant) ||\n        // filterState.value === undefined - means that value not initialized\n        (dataMask.filterState?.value !== undefined &&\n          dataMaskSelected[filter.id]?.filterState?.value === undefined &&\n          filter.requiredFirst)\n      ) {\n        dispatch(updateDataMask(filter.id, dataMask));\n      }\n\n      draft[filter.id] = {\n        ...(getInitialDataMask(filter.id) as DataMaskWithId),\n        ...dataMask,\n      };\n    });\n  };\n\n  const handleApply = () => {\n    const filterIds = Object.keys(dataMaskSelected);\n    filterIds.forEach(filterId => {\n      if (dataMaskSelected[filterId]) {\n        dispatch(updateDataMask(filterId, dataMaskSelected[filterId]));\n      }\n    });\n  };\n\n  useFilterUpdates(dataMaskSelected, setDataMaskSelected);\n\n  const dataSelectedValues = Object.values(dataMaskSelected);\n  const dataAppliedValues = Object.values(dataMaskApplied);\n  const isApplyDisabled =\n    areObjectsEqual(\n      getOnlyExtraFormData(dataMaskSelected),\n      getOnlyExtraFormData(dataMaskApplied),\n      { ignoreUndefined: true },\n    ) || dataSelectedValues.length !== dataAppliedValues.length;\n\n  const isInitialized = useInitialization();\n\n  return (\n    <BarWrapper {...getFilterBarTestId()} className={cx({ open: filtersOpen })}>\n      <CollapsedBar\n        {...getFilterBarTestId('collapsable')}\n        className={cx({ open: !filtersOpen })}\n        onClick={() => toggleFiltersBar(true)}\n      >\n        <StyledCollapseIcon\n          name=\"collapse\"\n          {...getFilterBarTestId('expand-button')}\n        />\n        <Icon name=\"filter\" {...getFilterBarTestId('filter-icon')} />\n      </CollapsedBar>\n      <Bar className={cx({ open: filtersOpen })}>\n        <Header\n          toggleFiltersBar={toggleFiltersBar}\n          onApply={handleApply}\n          setDataMaskSelected={setDataMaskSelected}\n          isApplyDisabled={isApplyDisabled}\n          dataMaskSelected={dataMaskSelected}\n          dataMaskApplied={dataMaskApplied}\n        />\n        {!isInitialized ? (\n          <Loading />\n        ) : isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET) ? (\n          <StyledTabs\n            centered\n            onChange={setTab as HandlerFunction}\n            defaultActiveKey={TabIds.AllFilters}\n            activeKey={editFilterSetId ? TabIds.AllFilters : undefined}\n          >\n            <Tabs.TabPane\n              tab={t(`All Filters (${filterValues.length})`)}\n              key={TabIds.AllFilters}\n            >\n              {editFilterSetId && (\n                <EditSection\n                  dataMaskSelected={dataMaskSelected}\n                  disabled={!isApplyDisabled}\n                  onCancel={() => setEditFilterSetId(null)}\n                  filterSetId={editFilterSetId}\n                />\n              )}\n              <FilterControls\n                dataMaskSelected={dataMaskSelected}\n                directPathToChild={directPathToChild}\n                onFilterSelectionChange={handleFilterSelectionChange}\n              />\n            </Tabs.TabPane>\n            <Tabs.TabPane\n              disabled={!!editFilterSetId}\n              tab={t(`Filter Sets (${filterSetFilterValues.length})`)}\n              key={TabIds.FilterSets}\n            >\n              <FilterSets\n                onEditFilterSet={setEditFilterSetId}\n                disabled={!isApplyDisabled}\n                dataMaskSelected={dataMaskSelected}\n                isFilterSetChanged={isFilterSetChanged}\n                onFilterSelectionChange={handleFilterSelectionChange}\n              />\n            </Tabs.TabPane>\n          </StyledTabs>\n        ) : (\n          <FilterControls\n            dataMaskSelected={dataMaskSelected}\n            directPathToChild={directPathToChild}\n            onFilterSelectionChange={handleFilterSelectionChange}\n          />\n        )}\n      </Bar>\n    </BarWrapper>\n  );\n};\n\nexport default FilterBar;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}