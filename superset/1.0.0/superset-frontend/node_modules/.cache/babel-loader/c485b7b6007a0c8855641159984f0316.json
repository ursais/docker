{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _indexOfInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/index-of\";import _everyInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/every\";import _entriesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/entries\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _concatInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/concat\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";import _setTimeout from \"@babel/runtime-corejs3/core-js-stable/set-timeout\";import _Set from \"@babel/runtime-corejs3/core-js-stable/set\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Input, Row, Col } from 'src/common/components';\nimport { t, getChartMetadataRegistry } from '@superset-ui/core';\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport Modal from 'src/components/Modal';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Label from 'src/components/Label';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { nativeFilterGate } from 'src/dashboard/components/nativeFilters/utils';\nimport './VizTypeControl.less';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  description: PropTypes.string,\n  label: PropTypes.string,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string.isRequired,\n  labelType: PropTypes.string };\n\n\nconst defaultProps = {\n  onChange: () => {},\n  labelType: 'default' };\n\n\nconst registry = getChartMetadataRegistry();\n\nconst DEFAULT_ORDER = [\n'line',\n'big_number',\n'table',\n'filter_box',\n'dist_bar',\n'area',\n'bar',\n'deck_polygon',\n'pie',\n'time_table',\n'pivot_table',\n'histogram',\n'big_number_total',\n'deck_scatter',\n'deck_hex',\n'time_pivot',\n'deck_arc',\n'heatmap',\n'deck_grid',\n'dual_line',\n'deck_screengrid',\n'line_multi',\n'treemap',\n'box_plot',\n'sunburst',\n'sankey',\n'word_cloud',\n'mapbox',\n'kepler',\n'cal_heatmap',\n'rose',\n'bubble',\n'deck_geojson',\n'horizon',\n'deck_multi',\n'compare',\n'partition',\n'event_flow',\n'deck_path',\n'graph_chart',\n'world_map',\n'paired_ttest',\n'para',\n'country_map'];\n\n\nconst typesWithDefaultOrder = new _Set(DEFAULT_ORDER);\n\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\n\nfunction VizSupportValidation({ vizType }) {\n  const state = useDynamicPluginContext();\n  if (state.loading || registry.has(vizType)) {\n    return null;\n  }\n  return (\n    ___EmotionJSX(\"div\", { className: \"text-danger\" },\n    ___EmotionJSX(\"i\", { className: \"fa fa-exclamation-circle text-danger\" }), ' ',\n    ___EmotionJSX(\"small\", null, t('This visualization type is not supported.'))));\n\n\n}__signature__(VizSupportValidation, \"useDynamicPluginContext{state}\", () => [useDynamicPluginContext]);\n\nconst VizTypeControl = props => {var _context, _context2, _context3, _context4, _context5;\n  const [showModal, setShowModal] = useState(false);\n  const [filter, setFilter] = useState('');\n  const searchRef = useRef(null);\n\n  useEffect(() => {\n    if (showModal) {\n      _setTimeout(() => {var _searchRef$current;return searchRef == null ? void 0 : (_searchRef$current = searchRef.current) == null ? void 0 : _searchRef$current.focus();}, 200);\n    }\n  }, [showModal]);\n\n  const onChange = vizType => {\n    props.onChange(vizType);\n    setShowModal(false);\n  };\n\n  const toggleModal = () => {\n    setShowModal(prevState => !prevState);\n  };\n\n  const changeSearch = event => {\n    setFilter(event.target.value);\n  };\n\n  const renderItem = entry => {\n    const { value } = props;\n    const { key, value: type } = entry;\n    const isSelected = key === value;\n\n    return (\n      ___EmotionJSX(\"div\", {\n        role: \"button\",\n        tabIndex: 0,\n        className: `viztype-selector-container ${isSelected ? 'selected' : ''}`,\n        onClick: () => onChange(key) },\n\n      ___EmotionJSX(\"img\", {\n        alt: type.name,\n        width: \"100%\",\n        className: `viztype-selector ${isSelected ? 'selected' : ''}`,\n        src: type.thumbnail }),\n\n      ___EmotionJSX(\"div\", {\n        className: \"viztype-label\",\n        \"data-test\": `${VIZ_TYPE_CONTROL_TEST_ID}__viztype-label` },\n\n      type.name)));\n\n\n\n  };\n\n  const { value, labelType } = props;\n  const filterString = filter.toLowerCase();\n  const filterStringParts = filterString.split(' ');\n\n  const a = _filterInstanceProperty(DEFAULT_ORDER).call(DEFAULT_ORDER, type => registry.has(type));\n  const filteredTypes = _filterInstanceProperty(_context = _concatInstanceProperty(_context2 = _mapInstanceProperty(_context3 = _filterInstanceProperty(a).call(a,\n  type => {var _registry$get;\n    const behaviors = ((_registry$get = registry.get(type)) == null ? void 0 : _registry$get.behaviors) || [];\n    return nativeFilterGate(behaviors);\n  })).call(_context3,\n  type => ({\n    key: type,\n    value: registry.get(type) }))).call(_context2,\n\n\n  _filterInstanceProperty(_context4 = _filterInstanceProperty(_context5 = _entriesInstanceProperty(registry).call(registry)).call(_context5,\n\n  entry => {var _entry$value;\n    const behaviors = ((_entry$value = entry.value) == null ? void 0 : _entry$value.behaviors) || [];\n    return nativeFilterGate(behaviors);\n  })).call(_context4,\n  ({ key }) => !typesWithDefaultOrder.has(key)))).call(_context,\n\n  (entry) =>\n  _everyInstanceProperty(filterStringParts).call(filterStringParts,\n  part => {var _context6;return _indexOfInstanceProperty(_context6 = entry.value.name.toLowerCase()).call(_context6, part) !== -1;}));\n\n\n\n  return (\n    ___EmotionJSX(\"div\", null,\n    ___EmotionJSX(ControlHeader, props),\n    ___EmotionJSX(Tooltip, {\n      id: \"error-tooltip\",\n      placement: \"right\",\n      title: t('Click to change visualization type') },\n\n    ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(Label, {\n      onClick: toggleModal,\n      type: labelType,\n      \"data-test\": \"visualization-type\" },\n\n    registry.has(value) ? registry.get(value).name : `${value}`),\n\n    ___EmotionJSX(VizSupportValidation, { vizType: value }))),\n\n\n    ___EmotionJSX(Modal, {\n      show: showModal,\n      onHide: toggleModal,\n      title: t('Select a visualization type'),\n      responsive: true,\n      hideFooter: true,\n      forceRender: true },\n\n    ___EmotionJSX(\"div\", { className: \"viztype-control-search-box\" },\n    ___EmotionJSX(Input, {\n      ref: searchRef,\n      type: \"text\",\n      value: filter,\n      placeholder: t('Search'),\n      onChange: changeSearch,\n      \"data-test\": `${VIZ_TYPE_CONTROL_TEST_ID}__search-input` })),\n\n\n    ___EmotionJSX(Row, { \"data-test\": `${VIZ_TYPE_CONTROL_TEST_ID}__viz-row`, gutter: 16 },\n    _mapInstanceProperty(filteredTypes).call(filteredTypes, (entry) =>\n    ___EmotionJSX(Col, { xs: 12, sm: 8, md: 6, lg: 4, key: `grid-col-${entry.key}` },\n    renderItem(entry)))))));\n\n\n\n\n\n\n};__signature__(VizTypeControl, \"useState{[showModal, setShowModal](false)}\\nuseState{[filter, setFilter]('')}\\nuseRef{searchRef}\\nuseEffect{}\");\n\nVizTypeControl.propTypes = propTypes;\nVizTypeControl.defaultProps = defaultProps;const _default =\n\nVizTypeControl;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx\");reactHotLoader.register(registry, \"registry\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx\");reactHotLoader.register(DEFAULT_ORDER, \"DEFAULT_ORDER\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx\");reactHotLoader.register(typesWithDefaultOrder, \"typesWithDefaultOrder\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx\");reactHotLoader.register(VIZ_TYPE_CONTROL_TEST_ID, \"VIZ_TYPE_CONTROL_TEST_ID\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx\");reactHotLoader.register(VizSupportValidation, \"VizSupportValidation\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx\");reactHotLoader.register(VizTypeControl, \"VizTypeControl\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/VizTypeControl/index.jsx"],"names":["React","useEffect","useRef","useState","PropTypes","Input","Row","Col","t","getChartMetadataRegistry","useDynamicPluginContext","Modal","Tooltip","Label","ControlHeader","nativeFilterGate","propTypes","description","string","label","name","isRequired","onChange","func","value","labelType","defaultProps","registry","DEFAULT_ORDER","typesWithDefaultOrder","VIZ_TYPE_CONTROL_TEST_ID","VizSupportValidation","vizType","state","loading","has","VizTypeControl","props","showModal","setShowModal","filter","setFilter","searchRef","current","focus","toggleModal","prevState","changeSearch","event","target","renderItem","entry","key","type","isSelected","thumbnail","filterString","toLowerCase","filterStringParts","split","a","filteredTypes","behaviors","get","part"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Input, Row, Col } from 'src/common/components';\nimport { t, getChartMetadataRegistry } from '@superset-ui/core';\nimport { useDynamicPluginContext } from 'src/components/DynamicPlugins';\nimport Modal from 'src/components/Modal';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Label from 'src/components/Label';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { nativeFilterGate } from 'src/dashboard/components/nativeFilters/utils';\nimport './VizTypeControl.less';\n\nconst propTypes = {\n  description: PropTypes.string,\n  label: PropTypes.string,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string.isRequired,\n  labelType: PropTypes.string,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  labelType: 'default',\n};\n\nconst registry = getChartMetadataRegistry();\n\nconst DEFAULT_ORDER = [\n  'line',\n  'big_number',\n  'table',\n  'filter_box',\n  'dist_bar',\n  'area',\n  'bar',\n  'deck_polygon',\n  'pie',\n  'time_table',\n  'pivot_table',\n  'histogram',\n  'big_number_total',\n  'deck_scatter',\n  'deck_hex',\n  'time_pivot',\n  'deck_arc',\n  'heatmap',\n  'deck_grid',\n  'dual_line',\n  'deck_screengrid',\n  'line_multi',\n  'treemap',\n  'box_plot',\n  'sunburst',\n  'sankey',\n  'word_cloud',\n  'mapbox',\n  'kepler',\n  'cal_heatmap',\n  'rose',\n  'bubble',\n  'deck_geojson',\n  'horizon',\n  'deck_multi',\n  'compare',\n  'partition',\n  'event_flow',\n  'deck_path',\n  'graph_chart',\n  'world_map',\n  'paired_ttest',\n  'para',\n  'country_map',\n];\n\nconst typesWithDefaultOrder = new Set(DEFAULT_ORDER);\n\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\n\nfunction VizSupportValidation({ vizType }) {\n  const state = useDynamicPluginContext();\n  if (state.loading || registry.has(vizType)) {\n    return null;\n  }\n  return (\n    <div className=\"text-danger\">\n      <i className=\"fa fa-exclamation-circle text-danger\" />{' '}\n      <small>{t('This visualization type is not supported.')}</small>\n    </div>\n  );\n}\n\nconst VizTypeControl = props => {\n  const [showModal, setShowModal] = useState(false);\n  const [filter, setFilter] = useState('');\n  const searchRef = useRef(null);\n\n  useEffect(() => {\n    if (showModal) {\n      setTimeout(() => searchRef?.current?.focus(), 200);\n    }\n  }, [showModal]);\n\n  const onChange = vizType => {\n    props.onChange(vizType);\n    setShowModal(false);\n  };\n\n  const toggleModal = () => {\n    setShowModal(prevState => !prevState);\n  };\n\n  const changeSearch = event => {\n    setFilter(event.target.value);\n  };\n\n  const renderItem = entry => {\n    const { value } = props;\n    const { key, value: type } = entry;\n    const isSelected = key === value;\n\n    return (\n      <div\n        role=\"button\"\n        tabIndex={0}\n        className={`viztype-selector-container ${isSelected ? 'selected' : ''}`}\n        onClick={() => onChange(key)}\n      >\n        <img\n          alt={type.name}\n          width=\"100%\"\n          className={`viztype-selector ${isSelected ? 'selected' : ''}`}\n          src={type.thumbnail}\n        />\n        <div\n          className=\"viztype-label\"\n          data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__viztype-label`}\n        >\n          {type.name}\n        </div>\n      </div>\n    );\n  };\n\n  const { value, labelType } = props;\n  const filterString = filter.toLowerCase();\n  const filterStringParts = filterString.split(' ');\n\n  const a = DEFAULT_ORDER.filter(type => registry.has(type));\n  const filteredTypes = a\n    .filter(type => {\n      const behaviors = registry.get(type)?.behaviors || [];\n      return nativeFilterGate(behaviors);\n    })\n    .map(type => ({\n      key: type,\n      value: registry.get(type),\n    }))\n    .concat(\n      registry\n        .entries()\n        .filter(entry => {\n          const behaviors = entry.value?.behaviors || [];\n          return nativeFilterGate(behaviors);\n        })\n        .filter(({ key }) => !typesWithDefaultOrder.has(key)),\n    )\n    .filter(entry =>\n      filterStringParts.every(\n        part => entry.value.name.toLowerCase().indexOf(part) !== -1,\n      ),\n    );\n\n  return (\n    <div>\n      <ControlHeader {...props} />\n      <Tooltip\n        id=\"error-tooltip\"\n        placement=\"right\"\n        title={t('Click to change visualization type')}\n      >\n        <>\n          <Label\n            onClick={toggleModal}\n            type={labelType}\n            data-test=\"visualization-type\"\n          >\n            {registry.has(value) ? registry.get(value).name : `${value}`}\n          </Label>\n          <VizSupportValidation vizType={value} />\n        </>\n      </Tooltip>\n      <Modal\n        show={showModal}\n        onHide={toggleModal}\n        title={t('Select a visualization type')}\n        responsive\n        hideFooter\n        forceRender\n      >\n        <div className=\"viztype-control-search-box\">\n          <Input\n            ref={searchRef}\n            type=\"text\"\n            value={filter}\n            placeholder={t('Search')}\n            onChange={changeSearch}\n            data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__search-input`}\n          />\n        </div>\n        <Row data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__viz-row`} gutter={16}>\n          {filteredTypes.map(entry => (\n            <Col xs={12} sm={8} md={6} lg={4} key={`grid-col-${entry.key}`}>\n              {renderItem(entry)}\n            </Col>\n          ))}\n        </Row>\n      </Modal>\n    </div>\n  );\n};\n\nVizTypeControl.propTypes = propTypes;\nVizTypeControl.defaultProps = defaultProps;\n\nexport default VizTypeControl;\n"]},"metadata":{},"sourceType":"module"}