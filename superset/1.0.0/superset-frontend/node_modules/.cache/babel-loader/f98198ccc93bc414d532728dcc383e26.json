{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _mapInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/map\";import _reject from \"lodash/reject\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport Collapse from 'src/components/Collapse';\n\nimport { getFromLocalStorage, setInLocalStorage } from 'src/utils/localStorageHelpers';\nimport withToasts from 'src/messageToasts/enhancers/withToasts';\nimport Loading from 'src/components/Loading';\nimport { createErrorHandler, getRecentAcitivtyObjs, mq, getUserOwnedObjects } from 'src/views/CRUD/utils';\nimport { HOMEPAGE_ACTIVITY_FILTER } from 'src/views/CRUD/storageKeys';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { Switch } from 'src/common/components';\nimport ActivityTable from './ActivityTable';\nimport ChartTable from './ChartTable';\nimport SavedQueries from './SavedQueries';\nimport DashboardTable from './DashboardTable';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst WelcomeContainer = styled.div`\n  background-color: ${({ theme }) => theme.colors.grayscale.light4};\n  .ant-row.menu {\n    margin-top: -15px;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    &:after {\n      content: '';\n      display: block;\n      border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n      margin: 0px ${({ theme }) => theme.gridUnit * 6}px;\n      position: relative;\n      width: 100%;\n      ${mq[1]} {\n        margin-top: 5px;\n        margin: 0px 2px;\n      }\n    }\n    .ant-menu.ant-menu-light.ant-menu-root.ant-menu-horizontal {\n      padding-left: ${({ theme }) => theme.gridUnit * 10}px;\n    }\n    button {\n      padding: 3px 21px;\n    }\n  }\n  .ant-card.ant-card-bordered {\n    border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n`;\nconst WelcomeNav = styled.div`\n  height: 50px;\n  background-color: white;\n  .navbar-brand {\n    margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n    font-weight: ${({ theme }) => theme.typography.weights.bold};\n  }\n  .switch {\n    float: right;\n    margin: ${({ theme }) => theme.gridUnit * 5}px;\n    display: flex;\n    flex-direction: row;\n    span {\n      display: block;\n      margin: ${({ theme }) => theme.gridUnit * 1}px;\n      line-height: 1;\n    }\n  }\n`;\nfunction Welcome({ user, addDangerToast }) {\n  const recent = `/superset/recent_activity/${user.userId}/?limit=6`;\n  const [activeChild, setActiveChild] = useState('Loading');\n  const [checked, setChecked] = useState(true);\n  const [activityData, setActivityData] = useState(null);\n  const [chartData, setChartData] = useState(null);\n  const [queryData, setQueryData] = useState(null);\n  const [dashboardData, setDashboardData] = useState(null);\n  const [loadedCount, setLoadedCount] = useState(0);\n  const userid = user.userId;\n  const id = userid.toString();\n  useEffect(() => {\n    const userKey = getFromLocalStorage(id, null);\n    const activeTab = getFromLocalStorage(HOMEPAGE_ACTIVITY_FILTER, null);\n    if (userKey && !userKey.thumbnails)\n    setChecked(false);\n    getRecentAcitivtyObjs(user.userId, recent, addDangerToast).\n    then(res => {\n      const data = {};\n      if (res.viewed) {var _context;\n        const filtered = _mapInstanceProperty(_context = _reject(res.viewed, ['item_url', null])).call(_context, r => r);\n        data.Viewed = filtered;\n        if (!activeTab) {\n          setActiveChild('Viewed');\n        } else\n\n        setActiveChild(activeTab);\n      } else\n      {\n        data.Examples = res.examples;\n        if (activeTab === 'Viewed' || !activeTab) {\n          setActiveChild('Examples');\n        } else\n\n        setActiveChild(activeTab);\n      }\n      setActivityData(activityData => ({ ...activityData, ...data }));\n    }).\n    catch(createErrorHandler(errMsg => {\n      setActivityData(activityData => ({ ...activityData, Viewed: [] }));\n      addDangerToast(t('There was an issue fetching your recent activity: %s', errMsg));\n    }));\n    // Sets other activity data in parallel with recents api call\n    getUserOwnedObjects(id, 'dashboard').\n    then(r => {\n      setDashboardData(r);\n      setLoadedCount(loadedCount => loadedCount + 1);\n    }).\n    catch(err => {\n      setDashboardData([]);\n      setLoadedCount(loadedCount => loadedCount + 1);\n      addDangerToast(t('There was an issues fetching your dashboards: %s', err));\n    });\n    getUserOwnedObjects(id, 'chart').\n    then(r => {\n      setChartData(r);\n      setLoadedCount(loadedCount => loadedCount + 1);\n    }).\n    catch(err => {\n      setChartData([]);\n      setLoadedCount(loadedCount => loadedCount + 1);\n      addDangerToast(t('There was an issues fetching your chart: %s', err));\n    });\n    getUserOwnedObjects(id, 'saved_query').\n    then(r => {\n      setQueryData(r);\n      setLoadedCount(loadedCount => loadedCount + 1);\n    }).\n    catch(err => {\n      setQueryData([]);\n      setLoadedCount(loadedCount => loadedCount + 1);\n      addDangerToast(t('There was an issues fetching your saved queries: %s', err));\n    });\n  }, []);\n  const handleToggle = () => {\n    setChecked(!checked);\n    setInLocalStorage(id, { thumbnails: !checked });\n  };\n  useEffect(() => {\n    setActivityData(activityData => ({\n      ...activityData,\n      Created: [\n      ...(chartData || []),\n      ...(dashboardData || []),\n      ...(queryData || [])] }));\n\n\n  }, [chartData, queryData, dashboardData]);\n  return ___EmotionJSX(WelcomeContainer, null,\n  ___EmotionJSX(WelcomeNav, null,\n  ___EmotionJSX(\"span\", { className: \"navbar-brand\" }, \"Home\"),\n  isFeatureEnabled(FeatureFlag.THUMBNAILS) ? ___EmotionJSX(\"div\", { className: \"switch\" },\n  ___EmotionJSX(Switch, { checked: checked, onChange: handleToggle }),\n  ___EmotionJSX(\"span\", null, \"Thumbnails\")) :\n  null),\n\n  ___EmotionJSX(Collapse, { defaultActiveKey: ['1', '2', '3', '4'], ghost: true, bigger: true },\n  ___EmotionJSX(Collapse.Panel, { header: t('Recents'), key: \"1\" },\n  activityData && (\n  activityData.Viewed ||\n  activityData.Examples ||\n  activityData.Created) &&\n  activeChild !== 'Loading' ? ___EmotionJSX(ActivityTable, { user: user, activeChild: activeChild, setActiveChild: setActiveChild, activityData: activityData, loadedCount: loadedCount }) : ___EmotionJSX(Loading, { position: \"inline\" })),\n\n  ___EmotionJSX(Collapse.Panel, { header: t('Dashboards'), key: \"2\" },\n  !dashboardData ? ___EmotionJSX(Loading, { position: \"inline\" }) : ___EmotionJSX(DashboardTable, { user: user, mine: dashboardData, showThumbnails: checked })),\n\n  ___EmotionJSX(Collapse.Panel, { header: t('Saved queries'), key: \"3\" },\n  !queryData ? ___EmotionJSX(Loading, { position: \"inline\" }) : ___EmotionJSX(SavedQueries, { showThumbnails: checked, user: user, mine: queryData, featureFlag: isFeatureEnabled(FeatureFlag.THUMBNAILS) })),\n\n  ___EmotionJSX(Collapse.Panel, { header: t('Charts'), key: \"4\" },\n  !chartData ? ___EmotionJSX(Loading, { position: \"inline\" }) : ___EmotionJSX(ChartTable, { showThumbnails: checked, user: user, mine: chartData }))));\n\n\n\n}__signature__(Welcome, \"useState{[activeChild, setActiveChild]('Loading')}\\nuseState{[checked, setChecked](true)}\\nuseState{[activityData, setActivityData](null)}\\nuseState{[chartData, setChartData](null)}\\nuseState{[queryData, setQueryData](null)}\\nuseState{[dashboardData, setDashboardData](null)}\\nuseState{[loadedCount, setLoadedCount](0)}\\nuseEffect{}\\nuseEffect{}\");const _default =\nwithToasts(Welcome);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(WelcomeContainer, \"WelcomeContainer\", \"/app/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\");reactHotLoader.register(WelcomeNav, \"WelcomeNav\", \"/app/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\");reactHotLoader.register(Welcome, \"Welcome\", \"/app/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/views/CRUD/welcome/Welcome.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/views/CRUD/welcome/Welcome.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport Collapse from 'src/components/Collapse';\nimport { User } from 'src/types/bootstrapTypes';\nimport { reject } from 'lodash';\nimport {\n  getFromLocalStorage,\n  setInLocalStorage,\n} from 'src/utils/localStorageHelpers';\nimport withToasts from 'src/messageToasts/enhancers/withToasts';\nimport Loading from 'src/components/Loading';\nimport {\n  createErrorHandler,\n  getRecentAcitivtyObjs,\n  mq,\n  getUserOwnedObjects,\n} from 'src/views/CRUD/utils';\nimport { HOMEPAGE_ACTIVITY_FILTER } from 'src/views/CRUD/storageKeys';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { Switch } from 'src/common/components';\n\nimport ActivityTable from './ActivityTable';\nimport ChartTable from './ChartTable';\nimport SavedQueries from './SavedQueries';\nimport DashboardTable from './DashboardTable';\n\ninterface WelcomeProps {\n  user: User;\n  addDangerToast: (arg0: string) => void;\n}\n\nexport interface ActivityData {\n  Created?: Array<object>;\n  Edited?: Array<object>;\n  Viewed?: Array<object>;\n  Examples?: Array<object>;\n}\n\nconst WelcomeContainer = styled.div`\n  background-color: ${({ theme }) => theme.colors.grayscale.light4};\n  .ant-row.menu {\n    margin-top: -15px;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    &:after {\n      content: '';\n      display: block;\n      border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n      margin: 0px ${({ theme }) => theme.gridUnit * 6}px;\n      position: relative;\n      width: 100%;\n      ${mq[1]} {\n        margin-top: 5px;\n        margin: 0px 2px;\n      }\n    }\n    .ant-menu.ant-menu-light.ant-menu-root.ant-menu-horizontal {\n      padding-left: ${({ theme }) => theme.gridUnit * 10}px;\n    }\n    button {\n      padding: 3px 21px;\n    }\n  }\n  .ant-card.ant-card-bordered {\n    border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n`;\n\nconst WelcomeNav = styled.div`\n  height: 50px;\n  background-color: white;\n  .navbar-brand {\n    margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n    font-weight: ${({ theme }) => theme.typography.weights.bold};\n  }\n  .switch {\n    float: right;\n    margin: ${({ theme }) => theme.gridUnit * 5}px;\n    display: flex;\n    flex-direction: row;\n    span {\n      display: block;\n      margin: ${({ theme }) => theme.gridUnit * 1}px;\n      line-height: 1;\n    }\n  }\n`;\n\nfunction Welcome({ user, addDangerToast }: WelcomeProps) {\n  const recent = `/superset/recent_activity/${user.userId}/?limit=6`;\n  const [activeChild, setActiveChild] = useState('Loading');\n  const [checked, setChecked] = useState(true);\n  const [activityData, setActivityData] = useState<ActivityData | null>(null);\n  const [chartData, setChartData] = useState<Array<object> | null>(null);\n  const [queryData, setQueryData] = useState<Array<object> | null>(null);\n  const [dashboardData, setDashboardData] = useState<Array<object> | null>(\n    null,\n  );\n  const [loadedCount, setLoadedCount] = useState(0);\n\n  const userid = user.userId;\n  const id = userid.toString();\n\n  useEffect(() => {\n    const userKey = getFromLocalStorage(id, null);\n    const activeTab = getFromLocalStorage(HOMEPAGE_ACTIVITY_FILTER, null);\n    if (userKey && !userKey.thumbnails) setChecked(false);\n    getRecentAcitivtyObjs(user.userId, recent, addDangerToast)\n      .then(res => {\n        const data: ActivityData | null = {};\n        if (res.viewed) {\n          const filtered = reject(res.viewed, ['item_url', null]).map(r => r);\n          data.Viewed = filtered;\n          if (!activeTab) {\n            setActiveChild('Viewed');\n          } else setActiveChild(activeTab);\n        } else {\n          data.Examples = res.examples;\n          if (activeTab === 'Viewed' || !activeTab) {\n            setActiveChild('Examples');\n          } else setActiveChild(activeTab);\n        }\n        setActivityData(activityData => ({ ...activityData, ...data }));\n      })\n      .catch(\n        createErrorHandler((errMsg: unknown) => {\n          setActivityData(activityData => ({ ...activityData, Viewed: [] }));\n          addDangerToast(\n            t('There was an issue fetching your recent activity: %s', errMsg),\n          );\n        }),\n      );\n\n    // Sets other activity data in parallel with recents api call\n\n    getUserOwnedObjects(id, 'dashboard')\n      .then(r => {\n        setDashboardData(r);\n        setLoadedCount(loadedCount => loadedCount + 1);\n      })\n      .catch((err: unknown) => {\n        setDashboardData([]);\n        setLoadedCount(loadedCount => loadedCount + 1);\n        addDangerToast(\n          t('There was an issues fetching your dashboards: %s', err),\n        );\n      });\n    getUserOwnedObjects(id, 'chart')\n      .then(r => {\n        setChartData(r);\n        setLoadedCount(loadedCount => loadedCount + 1);\n      })\n      .catch((err: unknown) => {\n        setChartData([]);\n        setLoadedCount(loadedCount => loadedCount + 1);\n        addDangerToast(t('There was an issues fetching your chart: %s', err));\n      });\n    getUserOwnedObjects(id, 'saved_query')\n      .then(r => {\n        setQueryData(r);\n        setLoadedCount(loadedCount => loadedCount + 1);\n      })\n      .catch((err: unknown) => {\n        setQueryData([]);\n        setLoadedCount(loadedCount => loadedCount + 1);\n        addDangerToast(\n          t('There was an issues fetching your saved queries: %s', err),\n        );\n      });\n  }, []);\n\n  const handleToggle = () => {\n    setChecked(!checked);\n    setInLocalStorage(id, { thumbnails: !checked });\n  };\n\n  useEffect(() => {\n    setActivityData(activityData => ({\n      ...activityData,\n      Created: [\n        ...(chartData || []),\n        ...(dashboardData || []),\n        ...(queryData || []),\n      ],\n    }));\n  }, [chartData, queryData, dashboardData]);\n\n  return (\n    <WelcomeContainer>\n      <WelcomeNav>\n        <span className=\"navbar-brand\">Home</span>\n        {isFeatureEnabled(FeatureFlag.THUMBNAILS) ? (\n          <div className=\"switch\">\n            <Switch checked={checked} onChange={handleToggle} />\n            <span>Thumbnails</span>\n          </div>\n        ) : null}\n      </WelcomeNav>\n      <Collapse defaultActiveKey={['1', '2', '3', '4']} ghost bigger>\n        <Collapse.Panel header={t('Recents')} key=\"1\">\n          {activityData &&\n          (activityData.Viewed ||\n            activityData.Examples ||\n            activityData.Created) &&\n          activeChild !== 'Loading' ? (\n            <ActivityTable\n              user={user}\n              activeChild={activeChild}\n              setActiveChild={setActiveChild}\n              activityData={activityData}\n              loadedCount={loadedCount}\n            />\n          ) : (\n            <Loading position=\"inline\" />\n          )}\n        </Collapse.Panel>\n        <Collapse.Panel header={t('Dashboards')} key=\"2\">\n          {!dashboardData ? (\n            <Loading position=\"inline\" />\n          ) : (\n            <DashboardTable\n              user={user}\n              mine={dashboardData}\n              showThumbnails={checked}\n            />\n          )}\n        </Collapse.Panel>\n        <Collapse.Panel header={t('Saved queries')} key=\"3\">\n          {!queryData ? (\n            <Loading position=\"inline\" />\n          ) : (\n            <SavedQueries\n              showThumbnails={checked}\n              user={user}\n              mine={queryData}\n              featureFlag={isFeatureEnabled(FeatureFlag.THUMBNAILS)}\n            />\n          )}\n        </Collapse.Panel>\n        <Collapse.Panel header={t('Charts')} key=\"4\">\n          {!chartData ? (\n            <Loading position=\"inline\" />\n          ) : (\n            <ChartTable showThumbnails={checked} user={user} mine={chartData} />\n          )}\n        </Collapse.Panel>\n      </Collapse>\n    </WelcomeContainer>\n  );\n}\n\nexport default withToasts(Welcome);\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}