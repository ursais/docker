{"ast":null,"code":"import _bindInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/bind\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t, styled, supersetTheme } from '@superset-ui/core';\n\nimport { Dropdown, Menu } from 'src/common/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icon from 'src/components/Icon';\nimport Icons from 'src/components/Icons';\nimport ChangeDatasourceModal from 'src/datasource/ChangeDatasourceModal';\nimport DatasourceModal from 'src/datasource/DatasourceModal';\nimport { postForm } from 'src/explore/exploreUtils';\nimport Button from 'src/components/Button';\nimport ErrorAlert from 'src/components/ErrorMessage/ErrorAlert';\nimport WarningIconWithTooltip from 'src/components/WarningIconWithTooltip';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  datasource: PropTypes.object.isRequired,\n  isEditable: PropTypes.bool,\n  onDatasourceSave: PropTypes.func };\n\n\nconst defaultProps = {\n  onChange: () => {},\n  onDatasourceSave: null,\n  value: null,\n  isEditable: true };\n\n\nconst Styles = styled.div`\n  .data-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .error-alert {\n    margin: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .ant-dropdown-trigger {\n    margin-left: ${({ theme }) => 2 * theme.gridUnit}px;\n    box-shadow: none;\n    &:active {\n      box-shadow: none;\n    }\n  }\n  .btn-group .open .dropdown-toggle {\n    box-shadow: none;\n    &.button-default {\n      background: none;\n    }\n  }\n  i.angle {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n  svg.datasource-modal-trigger {\n    color: ${({ theme }) => theme.colors.primary.base};\n    cursor: pointer;\n  }\n  .title-select {\n    flex: 1 1 100%;\n    display: inline-block;\n    background-color: ${({ theme }) => theme.colors.grayscale.light3};\n    padding: ${({ theme }) => theme.gridUnit * 2}px;\n    border-radius: ${({ theme }) => theme.borderRadius}px;\n    text-align: center;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n  }\n  .dataset-svg {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    flex: none;\n  }\n`;\n\nconst CHANGE_DATASET = 'change_dataset';\nconst VIEW_IN_SQL_LAB = 'view_in_sql_lab';\nconst EDIT_DATASET = 'edit_dataset';\n\nclass DatasourceControl extends React.PureComponent {\n  constructor(props) {var _context, _context2, _context3, _context4, _context5;\n    super(props);\n    this.state = {\n      showEditDatasourceModal: false,\n      showChangeDatasourceModal: false };\n\n    this.onDatasourceSave = _bindInstanceProperty(_context = this.onDatasourceSave).call(_context, this);\n    this.toggleChangeDatasourceModal = _bindInstanceProperty(_context2 = this.toggleChangeDatasourceModal).call(_context2,\n    this);\n\n    this.toggleEditDatasourceModal = _bindInstanceProperty(_context3 = this.toggleEditDatasourceModal).call(_context3, this);\n    this.toggleShowDatasource = _bindInstanceProperty(_context4 = this.toggleShowDatasource).call(_context4, this);\n    this.handleMenuItemClick = _bindInstanceProperty(_context5 = this.handleMenuItemClick).call(_context5, this);\n  }\n\n  onDatasourceSave(datasource) {\n    this.props.actions.setDatasource(datasource);\n    if (this.props.onDatasourceSave) {\n      this.props.onDatasourceSave(datasource);\n    }\n  }\n\n  toggleShowDatasource() {\n    this.setState(({ showDatasource }) => ({\n      showDatasource: !showDatasource }));\n\n  }\n\n  toggleChangeDatasourceModal() {\n    this.setState(({ showChangeDatasourceModal }) => ({\n      showChangeDatasourceModal: !showChangeDatasourceModal }));\n\n  }\n\n  toggleEditDatasourceModal() {\n    this.setState(({ showEditDatasourceModal }) => ({\n      showEditDatasourceModal: !showEditDatasourceModal }));\n\n  }\n\n  handleMenuItemClick({ key }) {\n    if (key === CHANGE_DATASET) {\n      this.toggleChangeDatasourceModal();\n    }\n    if (key === EDIT_DATASET) {\n      this.toggleEditDatasourceModal();\n    }\n    if (key === VIEW_IN_SQL_LAB) {\n      const { datasource } = this.props;\n      const payload = {\n        datasourceKey: `${datasource.id}__${datasource.type}`,\n        sql: datasource.sql };\n\n      postForm('/superset/sqllab/', payload);\n    }\n  }\n\n  render() {var _extra;\n    const { showChangeDatasourceModal, showEditDatasourceModal } = this.state;\n    const { datasource, onChange } = this.props;\n    const isMissingDatasource = datasource.id == null;\n\n    const isSqlSupported = datasource.type === 'table';\n\n    const datasourceMenu =\n    ___EmotionJSX(Menu, { onClick: this.handleMenuItemClick },\n    this.props.isEditable &&\n    ___EmotionJSX(Menu.Item, { key: EDIT_DATASET, \"data-test\": \"edit-dataset\" },\n    t('Edit dataset')),\n\n\n    ___EmotionJSX(Menu.Item, { key: CHANGE_DATASET }, t('Change dataset')),\n    isSqlSupported &&\n    ___EmotionJSX(Menu.Item, { key: VIEW_IN_SQL_LAB }, t('View in SQL Lab')));\n\n\n\n\n    const { health_check_message: healthCheckMessage } = datasource;\n\n    let extra = {};\n    if (datasource != null && datasource.extra) {\n      try {\n        extra = JSON.parse(datasource == null ? void 0 : datasource.extra);\n      } catch {} // eslint-disable-line no-empty\n    }\n\n    return (\n      ___EmotionJSX(Styles, { \"data-test\": \"datasource-control\", className: \"DatasourceControl\" },\n      ___EmotionJSX(\"div\", { className: \"data-container\" },\n      ___EmotionJSX(Icon, { name: \"dataset-physical\", className: \"dataset-svg\" }),\n\n      !isMissingDatasource && datasource.name.length > 25 ?\n      ___EmotionJSX(Tooltip, { title: datasource.name },\n      ___EmotionJSX(\"span\", { className: \"title-select\" }, datasource.name)) :\n\n\n      ___EmotionJSX(\"span\", { title: datasource.name, className: \"title-select\" },\n      datasource.name),\n\n\n      healthCheckMessage &&\n      ___EmotionJSX(Tooltip, { title: healthCheckMessage },\n      ___EmotionJSX(Icons.AlertSolid, { iconColor: supersetTheme.colors.warning.base })),\n\n\n      ((_extra = extra) == null ? void 0 : _extra.warning_markdown) && // eslint-disable-line camelcase\n      ___EmotionJSX(WarningIconWithTooltip, {\n        warningMarkdown: extra.warning_markdown // eslint-disable-line camelcase\n        , size: 30 }),\n\n\n      ___EmotionJSX(Dropdown, {\n        overlay: datasourceMenu,\n        trigger: ['click'],\n        \"data-test\": \"datasource-menu\" },\n\n      ___EmotionJSX(Tooltip, { title: t('More dataset related options') },\n      ___EmotionJSX(Icon, {\n        className: \"datasource-modal-trigger\",\n        \"data-test\": \"datasource-menu-trigger\",\n        name: \"more-horiz\" })))),\n\n\n\n\n\n      isMissingDatasource &&\n      ___EmotionJSX(\"div\", { className: \"error-alert\" },\n      ___EmotionJSX(ErrorAlert, {\n        level: \"warning\",\n        title: t('Missing dataset'),\n        source: \"explore\",\n        subtitle:\n        ___EmotionJSX(React.Fragment, null,\n        ___EmotionJSX(\"p\", null,\n        t(\n        'The dataset linked to this chart may have been deleted.')),\n\n\n        ___EmotionJSX(\"p\", null,\n        ___EmotionJSX(Button, {\n          buttonStyle: \"primary\",\n          onClick: () =>\n          this.handleMenuItemClick({ key: CHANGE_DATASET }) },\n\n\n        t('Change dataset')))) })),\n\n\n\n\n\n\n\n      showEditDatasourceModal &&\n      ___EmotionJSX(DatasourceModal, {\n        datasource: datasource,\n        show: showEditDatasourceModal,\n        onDatasourceSave: this.onDatasourceSave,\n        onHide: this.toggleEditDatasourceModal }),\n\n\n      showChangeDatasourceModal &&\n      ___EmotionJSX(ChangeDatasourceModal, {\n        onDatasourceSave: this.onDatasourceSave,\n        onHide: this.toggleChangeDatasourceModal,\n        show: showChangeDatasourceModal,\n        onChange: onChange })));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nDatasourceControl.propTypes = propTypes;\nDatasourceControl.defaultProps = defaultProps;const _default =\n\nDatasourceControl;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/app/superset-frontend/src/explore/components/controls/DatasourceControl/index.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/app/superset-frontend/src/explore/components/controls/DatasourceControl/index.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/app/superset-frontend/src/explore/components/controls/DatasourceControl/index.jsx\");reactHotLoader.register(CHANGE_DATASET, \"CHANGE_DATASET\", \"/app/superset-frontend/src/explore/components/controls/DatasourceControl/index.jsx\");reactHotLoader.register(VIEW_IN_SQL_LAB, \"VIEW_IN_SQL_LAB\", \"/app/superset-frontend/src/explore/components/controls/DatasourceControl/index.jsx\");reactHotLoader.register(EDIT_DATASET, \"EDIT_DATASET\", \"/app/superset-frontend/src/explore/components/controls/DatasourceControl/index.jsx\");reactHotLoader.register(DatasourceControl, \"DatasourceControl\", \"/app/superset-frontend/src/explore/components/controls/DatasourceControl/index.jsx\");reactHotLoader.register(_default, \"default\", \"/app/superset-frontend/src/explore/components/controls/DatasourceControl/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/DatasourceControl/index.jsx"],"names":["React","PropTypes","t","styled","supersetTheme","Dropdown","Menu","Tooltip","Icon","Icons","ChangeDatasourceModal","DatasourceModal","postForm","Button","ErrorAlert","WarningIconWithTooltip","propTypes","actions","object","isRequired","onChange","func","value","string","datasource","isEditable","bool","onDatasourceSave","defaultProps","Styles","div","theme","colors","grayscale","light2","gridUnit","primary","base","light3","borderRadius","CHANGE_DATASET","VIEW_IN_SQL_LAB","EDIT_DATASET","DatasourceControl","PureComponent","constructor","props","state","showEditDatasourceModal","showChangeDatasourceModal","toggleChangeDatasourceModal","toggleEditDatasourceModal","toggleShowDatasource","handleMenuItemClick","setDatasource","setState","showDatasource","key","payload","datasourceKey","id","type","sql","render","isMissingDatasource","isSqlSupported","datasourceMenu","health_check_message","healthCheckMessage","extra","JSON","parse","name","length","warning","warning_markdown"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t, styled, supersetTheme } from '@superset-ui/core';\n\nimport { Dropdown, Menu } from 'src/common/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icon from 'src/components/Icon';\nimport Icons from 'src/components/Icons';\nimport ChangeDatasourceModal from 'src/datasource/ChangeDatasourceModal';\nimport DatasourceModal from 'src/datasource/DatasourceModal';\nimport { postForm } from 'src/explore/exploreUtils';\nimport Button from 'src/components/Button';\nimport ErrorAlert from 'src/components/ErrorMessage/ErrorAlert';\nimport WarningIconWithTooltip from 'src/components/WarningIconWithTooltip';\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  datasource: PropTypes.object.isRequired,\n  isEditable: PropTypes.bool,\n  onDatasourceSave: PropTypes.func,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  onDatasourceSave: null,\n  value: null,\n  isEditable: true,\n};\n\nconst Styles = styled.div`\n  .data-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .error-alert {\n    margin: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .ant-dropdown-trigger {\n    margin-left: ${({ theme }) => 2 * theme.gridUnit}px;\n    box-shadow: none;\n    &:active {\n      box-shadow: none;\n    }\n  }\n  .btn-group .open .dropdown-toggle {\n    box-shadow: none;\n    &.button-default {\n      background: none;\n    }\n  }\n  i.angle {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n  svg.datasource-modal-trigger {\n    color: ${({ theme }) => theme.colors.primary.base};\n    cursor: pointer;\n  }\n  .title-select {\n    flex: 1 1 100%;\n    display: inline-block;\n    background-color: ${({ theme }) => theme.colors.grayscale.light3};\n    padding: ${({ theme }) => theme.gridUnit * 2}px;\n    border-radius: ${({ theme }) => theme.borderRadius}px;\n    text-align: center;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n  }\n  .dataset-svg {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    flex: none;\n  }\n`;\n\nconst CHANGE_DATASET = 'change_dataset';\nconst VIEW_IN_SQL_LAB = 'view_in_sql_lab';\nconst EDIT_DATASET = 'edit_dataset';\n\nclass DatasourceControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showEditDatasourceModal: false,\n      showChangeDatasourceModal: false,\n    };\n    this.onDatasourceSave = this.onDatasourceSave.bind(this);\n    this.toggleChangeDatasourceModal = this.toggleChangeDatasourceModal.bind(\n      this,\n    );\n    this.toggleEditDatasourceModal = this.toggleEditDatasourceModal.bind(this);\n    this.toggleShowDatasource = this.toggleShowDatasource.bind(this);\n    this.handleMenuItemClick = this.handleMenuItemClick.bind(this);\n  }\n\n  onDatasourceSave(datasource) {\n    this.props.actions.setDatasource(datasource);\n    if (this.props.onDatasourceSave) {\n      this.props.onDatasourceSave(datasource);\n    }\n  }\n\n  toggleShowDatasource() {\n    this.setState(({ showDatasource }) => ({\n      showDatasource: !showDatasource,\n    }));\n  }\n\n  toggleChangeDatasourceModal() {\n    this.setState(({ showChangeDatasourceModal }) => ({\n      showChangeDatasourceModal: !showChangeDatasourceModal,\n    }));\n  }\n\n  toggleEditDatasourceModal() {\n    this.setState(({ showEditDatasourceModal }) => ({\n      showEditDatasourceModal: !showEditDatasourceModal,\n    }));\n  }\n\n  handleMenuItemClick({ key }) {\n    if (key === CHANGE_DATASET) {\n      this.toggleChangeDatasourceModal();\n    }\n    if (key === EDIT_DATASET) {\n      this.toggleEditDatasourceModal();\n    }\n    if (key === VIEW_IN_SQL_LAB) {\n      const { datasource } = this.props;\n      const payload = {\n        datasourceKey: `${datasource.id}__${datasource.type}`,\n        sql: datasource.sql,\n      };\n      postForm('/superset/sqllab/', payload);\n    }\n  }\n\n  render() {\n    const { showChangeDatasourceModal, showEditDatasourceModal } = this.state;\n    const { datasource, onChange } = this.props;\n    const isMissingDatasource = datasource.id == null;\n\n    const isSqlSupported = datasource.type === 'table';\n\n    const datasourceMenu = (\n      <Menu onClick={this.handleMenuItemClick}>\n        {this.props.isEditable && (\n          <Menu.Item key={EDIT_DATASET} data-test=\"edit-dataset\">\n            {t('Edit dataset')}\n          </Menu.Item>\n        )}\n        <Menu.Item key={CHANGE_DATASET}>{t('Change dataset')}</Menu.Item>\n        {isSqlSupported && (\n          <Menu.Item key={VIEW_IN_SQL_LAB}>{t('View in SQL Lab')}</Menu.Item>\n        )}\n      </Menu>\n    );\n\n    const { health_check_message: healthCheckMessage } = datasource;\n\n    let extra = {};\n    if (datasource?.extra) {\n      try {\n        extra = JSON.parse(datasource?.extra);\n      } catch {} // eslint-disable-line no-empty\n    }\n\n    return (\n      <Styles data-test=\"datasource-control\" className=\"DatasourceControl\">\n        <div className=\"data-container\">\n          <Icon name=\"dataset-physical\" className=\"dataset-svg\" />\n          {/* Add a tooltip only for long dataset names */}\n          {!isMissingDatasource && datasource.name.length > 25 ? (\n            <Tooltip title={datasource.name}>\n              <span className=\"title-select\">{datasource.name}</span>\n            </Tooltip>\n          ) : (\n            <span title={datasource.name} className=\"title-select\">\n              {datasource.name}\n            </span>\n          )}\n          {healthCheckMessage && (\n            <Tooltip title={healthCheckMessage}>\n              <Icons.AlertSolid iconColor={supersetTheme.colors.warning.base} />\n            </Tooltip>\n          )}\n          {extra?.warning_markdown && ( // eslint-disable-line camelcase\n            <WarningIconWithTooltip\n              warningMarkdown={extra.warning_markdown} // eslint-disable-line camelcase\n              size={30}\n            />\n          )}\n          <Dropdown\n            overlay={datasourceMenu}\n            trigger={['click']}\n            data-test=\"datasource-menu\"\n          >\n            <Tooltip title={t('More dataset related options')}>\n              <Icon\n                className=\"datasource-modal-trigger\"\n                data-test=\"datasource-menu-trigger\"\n                name=\"more-horiz\"\n              />\n            </Tooltip>\n          </Dropdown>\n        </div>\n        {/* missing dataset */}\n        {isMissingDatasource && (\n          <div className=\"error-alert\">\n            <ErrorAlert\n              level=\"warning\"\n              title={t('Missing dataset')}\n              source=\"explore\"\n              subtitle={\n                <>\n                  <p>\n                    {t(\n                      'The dataset linked to this chart may have been deleted.',\n                    )}\n                  </p>\n                  <p>\n                    <Button\n                      buttonStyle=\"primary\"\n                      onClick={() =>\n                        this.handleMenuItemClick({ key: CHANGE_DATASET })\n                      }\n                    >\n                      {t('Change dataset')}\n                    </Button>\n                  </p>\n                </>\n              }\n            />\n          </div>\n        )}\n        {showEditDatasourceModal && (\n          <DatasourceModal\n            datasource={datasource}\n            show={showEditDatasourceModal}\n            onDatasourceSave={this.onDatasourceSave}\n            onHide={this.toggleEditDatasourceModal}\n          />\n        )}\n        {showChangeDatasourceModal && (\n          <ChangeDatasourceModal\n            onDatasourceSave={this.onDatasourceSave}\n            onHide={this.toggleChangeDatasourceModal}\n            show={showChangeDatasourceModal}\n            onChange={onChange}\n          />\n        )}\n      </Styles>\n    );\n  }\n}\n\nDatasourceControl.propTypes = propTypes;\nDatasourceControl.defaultProps = defaultProps;\n\nexport default DatasourceControl;\n"]},"metadata":{},"sourceType":"module"}