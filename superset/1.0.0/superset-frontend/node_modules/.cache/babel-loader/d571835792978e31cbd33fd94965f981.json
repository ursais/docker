{"ast":null,"code":"import \"core-js/modules/web.dom-collections.iterator.js\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _filterInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/filter\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useMemo } from 'react';\nimport rison from 'rison';\nimport { SupersetClient, styled, supersetTheme, t } from '@superset-ui/core';\nimport { buildTimeRangeString, formatTimeRange, COMMON_RANGE_VALUES_SET, CALENDAR_RANGE_VALUES_SET, FRAME_OPTIONS, customTimeRangeDecode } from 'src/explore/components/controls/DateFilterControl/utils';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport Button from 'src/components/Button';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport Label from 'src/components/Label';\nimport Popover from 'src/components/Popover';\nimport { Divider } from 'src/common/components';\nimport Icon from 'src/components/Icon';\nimport { Select } from 'src/components/Select';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { DEFAULT_TIME_RANGE } from 'src/explore/constants';\nimport { useDebouncedEffect } from 'src/explore/exploreUtils';\nimport { SLOW_DEBOUNCE } from 'src/constants';\nimport { testWithId } from 'src/utils/testUtils';\nimport { CommonFrame, CalendarFrame, CustomFrame, AdvancedFrame } from './components';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst guessFrame = timeRange => {\n  if (COMMON_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Common';\n  }\n  if (CALENDAR_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Calendar';\n  }\n  if (timeRange === 'No filter') {\n    return 'No filter';\n  }\n  if (customTimeRangeDecode(timeRange).matchedFlag) {\n    return 'Custom';\n  }\n  return 'Advanced';\n};\nconst fetchTimeRange = async (timeRange, endpoints) => {\n  const query = rison.encode(timeRange);\n  const endpoint = `/api/v1/time_range/?q=${query}`;\n  try {var _response$json, _response$json$result, _response$json2, _response$json2$resul;\n    const response = await SupersetClient.get({ endpoint });\n    const timeRangeString = buildTimeRangeString((response == null ? void 0 : (_response$json = response.json) == null ? void 0 : (_response$json$result = _response$json.result) == null ? void 0 : _response$json$result.since) || '', (response == null ? void 0 : (_response$json2 = response.json) == null ? void 0 : (_response$json2$resul = _response$json2.result) == null ? void 0 : _response$json2$resul.until) || '');\n    return {\n      value: formatTimeRange(timeRangeString, endpoints) };\n\n  }\n  catch (response) {\n    const clientError = await getClientErrorObject(response);\n    return {\n      error: clientError.message || clientError.error };\n\n  }\n};\nconst StyledPopover = styled(Popover)``;\nconst ContentStyleWrapper = styled.div`\n  .ant-row {\n    margin-top: 8px;\n  }\n\n  .ant-input-number {\n    width: 100%;\n  }\n\n  .frame-dropdown {\n    width: 272px;\n  }\n\n  .ant-picker {\n    padding: 4px 17px 4px;\n    border-radius: 4px;\n    width: 100%;\n  }\n\n  .ant-divider-horizontal {\n    margin: 16px 0;\n  }\n\n  .control-label {\n    font-size: 11px;\n    font-weight: 500;\n    color: #b2b2b2;\n    line-height: 16px;\n    text-transform: uppercase;\n    margin: 8px 0;\n  }\n\n  .vertical-radio {\n    display: block;\n    height: 40px;\n    line-height: 40px;\n  }\n\n  .section-title {\n    font-style: normal;\n    font-weight: 500;\n    font-size: 15px;\n    line-height: 24px;\n    margin-bottom: 8px;\n  }\n\n  .control-anchor-to {\n    margin-top: 16px;\n  }\n\n  .control-anchor-to-datetime {\n    width: 217px;\n  }\n\n  .footer {\n    text-align: right;\n  }\n`;\nconst IconWrapper = styled.span`\n  svg {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    vertical-align: middle;\n  }\n  .text {\n    vertical-align: middle;\n  }\n  .error {\n    color: ${({ theme }) => theme.colors.error.base};\n  }\n`;\nexport const DATE_FILTER_CONTROL_TEST_ID = 'date-filter-control';\nexport const getDateFilterControlTestId = testWithId(DATE_FILTER_CONTROL_TEST_ID);\nexport default function DateFilterLabel(props) {\n  const { value = DEFAULT_TIME_RANGE, endpoints, onChange } = props;\n  const [actualTimeRange, setActualTimeRange] = useState(value);\n  const [show, setShow] = useState(false);\n  const guessedFrame = useMemo(() => guessFrame(value), [value]);\n  const [frame, setFrame] = useState(guessedFrame);\n  const [timeRangeValue, setTimeRangeValue] = useState(value);\n  const [validTimeRange, setValidTimeRange] = useState(false);\n  const [evalResponse, setEvalResponse] = useState(value);\n  const [tooltipTitle, setTooltipTitle] = useState(value);\n  useEffect(() => {\n    fetchTimeRange(value, endpoints).then(({ value: actualRange, error }) => {\n      if (error) {\n        setEvalResponse(error || '');\n        setValidTimeRange(false);\n        setTooltipTitle(value || '');\n      } else\n      {\n        /*\n          HRT == human readable text\n          ADR == actual datetime range\n          +--------------+------+----------+--------+----------+-----------+\n          |              | Last | Previous | Custom | Advanced | No Filter |\n          +--------------+------+----------+--------+----------+-----------+\n          | control pill | HRT  | HRT      | ADR    | ADR      |   HRT     |\n          +--------------+------+----------+--------+----------+-----------+\n          | tooltip      | ADR  | ADR      | HRT    | HRT      |   ADR     |\n          +--------------+------+----------+--------+----------+-----------+\n        */\n        if (guessedFrame === 'Common' ||\n        guessedFrame === 'Calendar' ||\n        guessedFrame === 'No filter') {\n          setActualTimeRange(value);\n          setTooltipTitle(actualRange || '');\n        } else\n        {\n          setActualTimeRange(actualRange || '');\n          setTooltipTitle(value || '');\n        }\n        setValidTimeRange(true);\n      }\n    });\n  }, [value]);\n  useDebouncedEffect(() => {\n    fetchTimeRange(timeRangeValue, endpoints).then(({ value, error }) => {\n      if (error) {\n        setEvalResponse(error || '');\n        setValidTimeRange(false);\n      } else\n      {\n        setEvalResponse(value || '');\n        setValidTimeRange(true);\n      }\n    });\n  }, SLOW_DEBOUNCE, [timeRangeValue]);\n  function onSave() {\n    onChange(timeRangeValue);\n    setShow(false);\n  }\n  function onOpen() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(true);\n  }\n  function onHide() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(false);\n  }\n  const togglePopover = () => {\n    if (show) {\n      onHide();\n    } else\n    {\n      setShow(true);\n    }\n  };\n  function onChangeFrame(option) {\n    if (option.value === 'No filter') {\n      setTimeRangeValue('No filter');\n    }\n    setFrame(option.value);\n  }\n  const overlayConetent = ___EmotionJSX(ContentStyleWrapper, null,\n  ___EmotionJSX(\"div\", { className: \"control-label\" }, t('RANGE TYPE')),\n  ___EmotionJSX(Select, { options: FRAME_OPTIONS, value: _filterInstanceProperty(FRAME_OPTIONS).call(FRAME_OPTIONS, ({ value }) => value === frame), onChange: onChangeFrame, className: \"frame-dropdown\" }),\n  frame !== 'No filter' && ___EmotionJSX(Divider, null),\n  frame === 'Common' && ___EmotionJSX(CommonFrame, { value: timeRangeValue, onChange: setTimeRangeValue }),\n  frame === 'Calendar' && ___EmotionJSX(CalendarFrame, { value: timeRangeValue, onChange: setTimeRangeValue }),\n  frame === 'Advanced' && ___EmotionJSX(AdvancedFrame, { value: timeRangeValue, onChange: setTimeRangeValue }),\n  frame === 'Custom' && ___EmotionJSX(CustomFrame, { value: timeRangeValue, onChange: setTimeRangeValue }),\n  frame === 'No filter' && ___EmotionJSX(\"div\", { \"data-test\": \"no-filter\" }),\n  ___EmotionJSX(Divider, null),\n  ___EmotionJSX(\"div\", null,\n  ___EmotionJSX(\"div\", { className: \"section-title\" }, t('Actual time range')),\n  validTimeRange && ___EmotionJSX(\"div\", null, evalResponse),\n  !validTimeRange && ___EmotionJSX(IconWrapper, { className: \"warning\" },\n  ___EmotionJSX(Icon, { name: \"error-solid-small\", color: supersetTheme.colors.error.base }),\n  ___EmotionJSX(\"span\", { className: \"text error\" }, evalResponse))),\n\n\n  ___EmotionJSX(Divider, null),\n  ___EmotionJSX(\"div\", { className: \"footer\" },\n  ___EmotionJSX(Button, { buttonStyle: \"secondary\", cta: true, key: \"cancel\", onClick: onHide, \"data-test\": \"cancel-button\" },\n  t('CANCEL')),\n\n  ___EmotionJSX(Button, _extends({ buttonStyle: \"primary\", cta: true, disabled: !validTimeRange, key: \"apply\", onClick: onSave }, getDateFilterControlTestId('apply-button')),\n  t('APPLY'))));\n\n\n\n  const title = ___EmotionJSX(IconWrapper, null,\n  ___EmotionJSX(Icon, { name: \"edit-alt\" }),\n  ___EmotionJSX(\"span\", { className: \"text\" }, t('Edit time range')));\n\n  const overlayStyle = {\n    width: '600px' };\n\n  return ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(ControlHeader, props),\n  ___EmotionJSX(StyledPopover, { placement: \"right\", trigger: \"click\", content: overlayConetent, title: title, defaultVisible: show, visible: show, onVisibleChange: togglePopover, overlayStyle: overlayStyle },\n  ___EmotionJSX(Tooltip, { placement: \"top\", title: tooltipTitle },\n  ___EmotionJSX(Label, { className: \"pointer\", \"data-test\": \"time-range-trigger\", onClick: onOpen },\n  actualTimeRange))));\n\n\n\n\n}__signature__(DateFilterLabel, \"useState{[actualTimeRange, setActualTimeRange](value)}\\nuseState{[show, setShow](false)}\\nuseMemo{guessedFrame}\\nuseState{[frame, setFrame](guessedFrame)}\\nuseState{[timeRangeValue, setTimeRangeValue](value)}\\nuseState{[validTimeRange, setValidTimeRange](false)}\\nuseState{[evalResponse, setEvalResponse](value)}\\nuseState{[tooltipTitle, setTooltipTitle](value)}\\nuseEffect{}\\nuseDebouncedEffect{}\", () => [useDebouncedEffect]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(guessFrame, \"guessFrame\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx\");reactHotLoader.register(fetchTimeRange, \"fetchTimeRange\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx\");reactHotLoader.register(StyledPopover, \"StyledPopover\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx\");reactHotLoader.register(ContentStyleWrapper, \"ContentStyleWrapper\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx\");reactHotLoader.register(IconWrapper, \"IconWrapper\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx\");reactHotLoader.register(DATE_FILTER_CONTROL_TEST_ID, \"DATE_FILTER_CONTROL_TEST_ID\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx\");reactHotLoader.register(getDateFilterControlTestId, \"getDateFilterControlTestId\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx\");reactHotLoader.register(DateFilterLabel, \"DateFilterLabel\", \"/app/superset-frontend/src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/app/superset-frontend/src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useMemo } from 'react';\nimport rison from 'rison';\nimport {\n  SupersetClient,\n  styled,\n  supersetTheme,\n  t,\n  TimeRangeEndpoints,\n} from '@superset-ui/core';\nimport {\n  buildTimeRangeString,\n  formatTimeRange,\n  COMMON_RANGE_VALUES_SET,\n  CALENDAR_RANGE_VALUES_SET,\n  FRAME_OPTIONS,\n  customTimeRangeDecode,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport Button from 'src/components/Button';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport Label from 'src/components/Label';\nimport Popover from 'src/components/Popover';\nimport { Divider } from 'src/common/components';\nimport Icon from 'src/components/Icon';\nimport { Select } from 'src/components/Select';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { DEFAULT_TIME_RANGE } from 'src/explore/constants';\nimport { useDebouncedEffect } from 'src/explore/exploreUtils';\nimport { SLOW_DEBOUNCE } from 'src/constants';\nimport { testWithId } from 'src/utils/testUtils';\nimport { SelectOptionType, FrameType } from './types';\n\nimport {\n  CommonFrame,\n  CalendarFrame,\n  CustomFrame,\n  AdvancedFrame,\n} from './components';\n\nconst guessFrame = (timeRange: string): FrameType => {\n  if (COMMON_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Common';\n  }\n  if (CALENDAR_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Calendar';\n  }\n  if (timeRange === 'No filter') {\n    return 'No filter';\n  }\n  if (customTimeRangeDecode(timeRange).matchedFlag) {\n    return 'Custom';\n  }\n  return 'Advanced';\n};\n\nconst fetchTimeRange = async (\n  timeRange: string,\n  endpoints?: TimeRangeEndpoints,\n) => {\n  const query = rison.encode(timeRange);\n  const endpoint = `/api/v1/time_range/?q=${query}`;\n  try {\n    const response = await SupersetClient.get({ endpoint });\n    const timeRangeString = buildTimeRangeString(\n      response?.json?.result?.since || '',\n      response?.json?.result?.until || '',\n    );\n    return {\n      value: formatTimeRange(timeRangeString, endpoints),\n    };\n  } catch (response) {\n    const clientError = await getClientErrorObject(response);\n    return {\n      error: clientError.message || clientError.error,\n    };\n  }\n};\n\nconst StyledPopover = styled(Popover)``;\n\nconst ContentStyleWrapper = styled.div`\n  .ant-row {\n    margin-top: 8px;\n  }\n\n  .ant-input-number {\n    width: 100%;\n  }\n\n  .frame-dropdown {\n    width: 272px;\n  }\n\n  .ant-picker {\n    padding: 4px 17px 4px;\n    border-radius: 4px;\n    width: 100%;\n  }\n\n  .ant-divider-horizontal {\n    margin: 16px 0;\n  }\n\n  .control-label {\n    font-size: 11px;\n    font-weight: 500;\n    color: #b2b2b2;\n    line-height: 16px;\n    text-transform: uppercase;\n    margin: 8px 0;\n  }\n\n  .vertical-radio {\n    display: block;\n    height: 40px;\n    line-height: 40px;\n  }\n\n  .section-title {\n    font-style: normal;\n    font-weight: 500;\n    font-size: 15px;\n    line-height: 24px;\n    margin-bottom: 8px;\n  }\n\n  .control-anchor-to {\n    margin-top: 16px;\n  }\n\n  .control-anchor-to-datetime {\n    width: 217px;\n  }\n\n  .footer {\n    text-align: right;\n  }\n`;\n\nconst IconWrapper = styled.span`\n  svg {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    vertical-align: middle;\n  }\n  .text {\n    vertical-align: middle;\n  }\n  .error {\n    color: ${({ theme }) => theme.colors.error.base};\n  }\n`;\n\ninterface DateFilterControlProps {\n  name: string;\n  onChange: (timeRange: string) => void;\n  value?: string;\n  endpoints?: TimeRangeEndpoints;\n}\n\nexport const DATE_FILTER_CONTROL_TEST_ID = 'date-filter-control';\nexport const getDateFilterControlTestId = testWithId(\n  DATE_FILTER_CONTROL_TEST_ID,\n);\n\nexport default function DateFilterLabel(props: DateFilterControlProps) {\n  const { value = DEFAULT_TIME_RANGE, endpoints, onChange } = props;\n  const [actualTimeRange, setActualTimeRange] = useState<string>(value);\n\n  const [show, setShow] = useState<boolean>(false);\n  const guessedFrame = useMemo(() => guessFrame(value), [value]);\n  const [frame, setFrame] = useState<FrameType>(guessedFrame);\n  const [timeRangeValue, setTimeRangeValue] = useState(value);\n  const [validTimeRange, setValidTimeRange] = useState<boolean>(false);\n  const [evalResponse, setEvalResponse] = useState<string>(value);\n  const [tooltipTitle, setTooltipTitle] = useState<string>(value);\n\n  useEffect(() => {\n    fetchTimeRange(value, endpoints).then(({ value: actualRange, error }) => {\n      if (error) {\n        setEvalResponse(error || '');\n        setValidTimeRange(false);\n        setTooltipTitle(value || '');\n      } else {\n        /*\n          HRT == human readable text\n          ADR == actual datetime range\n          +--------------+------+----------+--------+----------+-----------+\n          |              | Last | Previous | Custom | Advanced | No Filter |\n          +--------------+------+----------+--------+----------+-----------+\n          | control pill | HRT  | HRT      | ADR    | ADR      |   HRT     |\n          +--------------+------+----------+--------+----------+-----------+\n          | tooltip      | ADR  | ADR      | HRT    | HRT      |   ADR     |\n          +--------------+------+----------+--------+----------+-----------+\n        */\n        if (\n          guessedFrame === 'Common' ||\n          guessedFrame === 'Calendar' ||\n          guessedFrame === 'No filter'\n        ) {\n          setActualTimeRange(value);\n          setTooltipTitle(actualRange || '');\n        } else {\n          setActualTimeRange(actualRange || '');\n          setTooltipTitle(value || '');\n        }\n        setValidTimeRange(true);\n      }\n    });\n  }, [value]);\n\n  useDebouncedEffect(\n    () => {\n      fetchTimeRange(timeRangeValue, endpoints).then(({ value, error }) => {\n        if (error) {\n          setEvalResponse(error || '');\n          setValidTimeRange(false);\n        } else {\n          setEvalResponse(value || '');\n          setValidTimeRange(true);\n        }\n      });\n    },\n    SLOW_DEBOUNCE,\n    [timeRangeValue],\n  );\n\n  function onSave() {\n    onChange(timeRangeValue);\n    setShow(false);\n  }\n\n  function onOpen() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(true);\n  }\n\n  function onHide() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(false);\n  }\n\n  const togglePopover = () => {\n    if (show) {\n      onHide();\n    } else {\n      setShow(true);\n    }\n  };\n\n  function onChangeFrame(option: SelectOptionType) {\n    if (option.value === 'No filter') {\n      setTimeRangeValue('No filter');\n    }\n    setFrame(option.value as FrameType);\n  }\n\n  const overlayConetent = (\n    <ContentStyleWrapper>\n      <div className=\"control-label\">{t('RANGE TYPE')}</div>\n      <Select\n        options={FRAME_OPTIONS}\n        value={FRAME_OPTIONS.filter(({ value }) => value === frame)}\n        onChange={onChangeFrame}\n        className=\"frame-dropdown\"\n      />\n      {frame !== 'No filter' && <Divider />}\n      {frame === 'Common' && (\n        <CommonFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Calendar' && (\n        <CalendarFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Advanced' && (\n        <AdvancedFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Custom' && (\n        <CustomFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'No filter' && <div data-test=\"no-filter\" />}\n      <Divider />\n      <div>\n        <div className=\"section-title\">{t('Actual time range')}</div>\n        {validTimeRange && <div>{evalResponse}</div>}\n        {!validTimeRange && (\n          <IconWrapper className=\"warning\">\n            <Icon\n              name=\"error-solid-small\"\n              color={supersetTheme.colors.error.base}\n            />\n            <span className=\"text error\">{evalResponse}</span>\n          </IconWrapper>\n        )}\n      </div>\n      <Divider />\n      <div className=\"footer\">\n        <Button\n          buttonStyle=\"secondary\"\n          cta\n          key=\"cancel\"\n          onClick={onHide}\n          data-test=\"cancel-button\"\n        >\n          {t('CANCEL')}\n        </Button>\n        <Button\n          buttonStyle=\"primary\"\n          cta\n          disabled={!validTimeRange}\n          key=\"apply\"\n          onClick={onSave}\n          {...getDateFilterControlTestId('apply-button')}\n        >\n          {t('APPLY')}\n        </Button>\n      </div>\n    </ContentStyleWrapper>\n  );\n\n  const title = (\n    <IconWrapper>\n      <Icon name=\"edit-alt\" />\n      <span className=\"text\">{t('Edit time range')}</span>\n    </IconWrapper>\n  );\n\n  const overlayStyle = {\n    width: '600px',\n  };\n\n  return (\n    <>\n      <ControlHeader {...props} />\n      <StyledPopover\n        placement=\"right\"\n        trigger=\"click\"\n        content={overlayConetent}\n        title={title}\n        defaultVisible={show}\n        visible={show}\n        onVisibleChange={togglePopover}\n        overlayStyle={overlayStyle}\n      >\n        <Tooltip placement=\"top\" title={tooltipTitle}>\n          <Label\n            className=\"pointer\"\n            data-test=\"time-range-trigger\"\n            onClick={onOpen}\n          >\n            {actualTimeRange}\n          </Label>\n        </Tooltip>\n      </StyledPopover>\n    </>\n  );\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}