{"version":3,"sources":["../../../../src/lib/fetch/fetch-file.browser.js"],"names":["FileReadableResponse","fileOrBlob","_fileOrBlob","bodyUsed","name","_getFileReader","reader","promise","readAsArrayBuffer","readAsText","text","JSON","parse","Promise","resolve","reject","FileReader","onerror","error","Error","onabort","onload","result","Headers","size","type","fetchFileReadable","options"],"mappings":";;;;;;;;;;;;;;;;;AACA;;IAGMA,oB;AACJ,gCAAYC,UAAZ,EAAwB;AAAA;AACtB,SAAKC,WAAL,GAAmBD,UAAnB;AACA,SAAKE,QAAL,GAAgB,KAAhB;AACD;;;;0BAiBK;AAGJ,aAAO,KAAKD,WAAL,CAAiBE,IAAjB,IAAyB,EAAhC;AACD;;;;;;;;;;;uCAG2B,KAAKC,cAAL,E,EAAnBC,M,wBAAAA,M,EAAQC,O,wBAAAA,O;AACfD,gBAAAA,MAAM,CAACE,iBAAP,CAAyB,KAAKN,WAA9B;iDACOK,O;;;;;;;;;;;;;;;;;;;;;;;;;;wCAImB,KAAKF,cAAL,E,EAAnBC,M,yBAAAA,M,EAAQC,O,yBAAAA,O;AACfD,gBAAAA,MAAM,CAACG,UAAP,CAAkB,KAAKP,WAAvB;kDACOK,O;;;;;;;;;;;;;;;;;;;;;;;;;;uBAIY,KAAKG,IAAL,E;;;AAAbA,gBAAAA,I;kDACCC,IAAI,CAACC,KAAL,CAAWF,IAAX,C;;;;;;;;;;;;;;;;;;qCAaQ;AACf,8BAAO,CAAC,KAAKP,QAAb;AACA,WAAKA,QAAL,GAAgB,IAAhB;AAEA,UAAIG,MAAJ;AACA,UAAMC,OAAO,GAAG,IAAIM,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAC/C,YAAI;AACFT,UAAAA,MAAM,GAAG,IAAIU,UAAJ,EAAT;;AACAV,UAAAA,MAAM,CAACW,OAAP,GAAiB,UAAAC,KAAK;AAAA,mBAAIH,MAAM,CAAC,IAAII,KAAJ,CAAUD,KAAV,CAAD,CAAV;AAAA,WAAtB;;AACAZ,UAAAA,MAAM,CAACc,OAAP,GAAiB;AAAA,mBAAML,MAAM,CAAC,IAAII,KAAJ,CAAU,eAAV,CAAD,CAAZ;AAAA,WAAjB;;AACAb,UAAAA,MAAM,CAACe,MAAP,GAAgB;AAAA,mBAAMP,OAAO,CAACR,MAAM,CAACgB,MAAR,CAAb;AAAA,WAAhB;AACD,SALD,CAKE,OAAOJ,KAAP,EAAc;AACdH,UAAAA,MAAM,CAACG,KAAD,CAAN;AACD;AACF,OATe,CAAhB;AAUA,aAAO;AAACZ,QAAAA,MAAM,EAANA,MAAD;AAASC,QAAAA,OAAO,EAAPA;AAAT,OAAP;AACD;;;wBAhEa;AACZ,aAAO,IAAIgB,OAAJ,CAAY;AACjB,0BAAkB,KAAKrB,WAAL,CAAiBsB,IADlB;AAEjB,wBAAgB,KAAKtB,WAAL,CAAiBuB;AAFhB,OAAZ,CAAP;AAID;;;wBAEQ;AACP,aAAO,IAAP;AACD;;;wBAEY;AACX,aAAO,GAAP;AACD;;;;;AAwDY,SAASC,iBAAT,CAA2BzB,UAA3B,EAAuC0B,OAAvC,EAAgD;AAC7D,SAAOd,OAAO,CAACC,OAAR,CAAgB,IAAId,oBAAJ,CAAyBC,UAAzB,EAAqC0B,OAArC,CAAhB,CAAP;AACD","sourcesContent":["/* global FileReader, Headers */\nimport assert from '../../utils/assert';\n\n// File reader fetch \"polyfill\" for the browser\nclass FileReadableResponse {\n  constructor(fileOrBlob) {\n    this._fileOrBlob = fileOrBlob;\n    this.bodyUsed = false;\n  }\n\n  get headers() {\n    return new Headers({\n      'Content-Length': this._fileOrBlob.size,\n      'Content-Type': this._fileOrBlob.type\n    });\n  }\n\n  get ok() {\n    return true; // Blob & File objects are already in memory\n  }\n\n  get status() {\n    return 200; // Blob & File objects are already in memory\n  }\n\n  url() {\n    // Note: This is just the file name without path information\n    // Note: File has `name` field but the Blob baseclass does not\n    return this._fileOrBlob.name || '';\n  }\n\n  async arrayBuffer() {\n    const {reader, promise} = this._getFileReader();\n    reader.readAsArrayBuffer(this._fileOrBlob);\n    return promise;\n  }\n\n  async text() {\n    const {reader, promise} = this._getFileReader();\n    reader.readAsText(this._fileOrBlob);\n    return promise;\n  }\n\n  async json() {\n    const text = await this.text();\n    return JSON.parse(text);\n  }\n\n  // TODO - body, how to support stream?\n  // Can this be portable?\n  // eslint-disable-next-line\n  // https://developer.mozilla.org/en-US/docs/Web/API/Streams_API/Using_readable_streams#Creating_your_own_custom_readable_stream\n  // get body() {\n  //   assert(false);\n  // }\n\n  // PRIVATE\n\n  _getFileReader() {\n    assert(!this.bodyUsed);\n    this.bodyUsed = true;\n\n    let reader;\n    const promise = new Promise((resolve, reject) => {\n      try {\n        reader = new FileReader();\n        reader.onerror = error => reject(new Error(error));\n        reader.onabort = () => reject(new Error('Read aborted.'));\n        reader.onload = () => resolve(reader.result);\n      } catch (error) {\n        reject(error);\n      }\n    });\n    return {reader, promise};\n  }\n}\n\n// @param {File|Blob} file  HTML File or Blob object to read as string\n// @returns {Promise.string}  Resolves to a string containing file contents\nexport default function fetchFileReadable(fileOrBlob, options) {\n  return Promise.resolve(new FileReadableResponse(fileOrBlob, options));\n}\n"],"file":"fetch-file.browser.js"}