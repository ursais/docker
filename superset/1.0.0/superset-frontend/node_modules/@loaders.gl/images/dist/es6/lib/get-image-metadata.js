import { mimeTypeMap } from './image-parsers';
const ERR_INVALID_MIME_TYPE = "Invalid MIME type. Supported MIME types are: ".concat(Array.from(mimeTypeMap.keys()).join(', '));
export function isImage(arrayBuffer, mimeType) {
  if (mimeType) {
    const {
      test
    } = getImageTypeHandlers(mimeType);
    const dataView = toDataView(arrayBuffer);
    return test(dataView);
  }

  return Boolean(getImageMIMEType(arrayBuffer));
}
export function getImageMIMEType(arrayBuffer) {
  const dataView = toDataView(arrayBuffer);

  for (const [mimeType, {
    test
  }] of mimeTypeMap.entries()) {
    if (test(dataView)) {
      return mimeType;
    }
  }

  return null;
}
export function getImageSize(arrayBuffer, mimeType = null) {
  mimeType = mimeType || getImageMIMEType(arrayBuffer);
  const {
    getSize
  } = getImageTypeHandlers(mimeType);
  const dataView = toDataView(arrayBuffer);
  const size = getSize(dataView);

  if (!size) {
    throw new Error("invalid image data for type: ".concat(mimeType));
  }

  return size;
}
export function getImageMetadata(arrayBuffer, mimeType = null) {
  mimeType = mimeType || getImageMIMEType(arrayBuffer);
  const metadata = getImageSize(arrayBuffer, mimeType);
  metadata.mimeType = mimeType;
  return metadata;
}

function getImageTypeHandlers(mimeType) {
  const handlers = mimeTypeMap.get(mimeType);

  if (!handlers) {
    throw new Error(ERR_INVALID_MIME_TYPE);
  }

  return handlers;
}

function toDataView(data) {
  if (data instanceof ArrayBuffer || ArrayBuffer.isView(data)) {
    return new DataView(data.buffer || data);
  }

  throw new Error('toDataView');
}
//# sourceMappingURL=get-image-metadata.js.map